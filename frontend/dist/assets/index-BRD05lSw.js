var Nr=Object.defineProperty;var Ar=(s,e,o)=>e in s?Nr(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var cr=(s,e,o)=>Ar(s,typeof e!="symbol"?e+"":e,o);function _mergeNamespaces(s,e){for(var o=0;o<e.length;o++){const a=e[o];if(typeof a!="string"&&!Array.isArray(a)){for(const c in a)if(c!=="default"&&!(c in s)){const d=Object.getOwnPropertyDescriptor(a,c);d&&Object.defineProperty(s,c,d.get?d:{enumerable:!0,get:()=>a[c]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function o(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(c){if(c.ep)return;c.ep=!0;const d=o(c);fetch(c.href,d)}})();function getDefaultExportFromCjs$1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react$1={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(s){return s===null||typeof s!="object"?null:(s=z$1&&s[z$1]||s["@@iterator"],typeof s=="function"?s:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$1={};function E$1(s,e,o){this.props=s,this.context=e,this.refs=D$1,this.updater=o||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};E$1.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(s,e,o){this.props=s,this.context=e,this.refs=D$1,this.updater=o||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$2(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(s,e,o){var a,c={},d=null,h=null;if(e!=null)for(a in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(d=""+e.key),e)J.call(e,a)&&!L$1.hasOwnProperty(a)&&(c[a]=e[a]);var g=arguments.length-2;if(g===1)c.children=o;else if(1<g){for(var b=Array(g),j=0;j<g;j++)b[j]=arguments[j+2];c.children=b}if(s&&s.defaultProps)for(a in g=s.defaultProps,g)c[a]===void 0&&(c[a]=g[a]);return{$$typeof:l$1,type:s,key:d,ref:h,props:c,_owner:K$1.current}}function N$1(s,e){return{$$typeof:l$1,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function O$1(s){return typeof s=="object"&&s!==null&&s.$$typeof===l$1}function escape(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(o){return e[o]})}var P$1=/\/+/g;function Q$1(s,e){return typeof s=="object"&&s!==null&&s.key!=null?escape(""+s.key):e.toString(36)}function R$1(s,e,o,a,c){var d=typeof s;(d==="undefined"||d==="boolean")&&(s=null);var h=!1;if(s===null)h=!0;else switch(d){case"string":case"number":h=!0;break;case"object":switch(s.$$typeof){case l$1:case n$1:h=!0}}if(h)return h=s,c=c(h),s=a===""?"."+Q$1(h,0):a,I$1(c)?(o="",s!=null&&(o=s.replace(P$1,"$&/")+"/"),R$1(c,e,o,"",function(j){return j})):c!=null&&(O$1(c)&&(c=N$1(c,o+(!c.key||h&&h.key===c.key?"":(""+c.key).replace(P$1,"$&/")+"/")+s)),e.push(c)),1;if(h=0,a=a===""?".":a+":",I$1(s))for(var g=0;g<s.length;g++){d=s[g];var b=a+Q$1(d,g);h+=R$1(d,e,o,b,c)}else if(b=A$1(s),typeof b=="function")for(s=b.call(s),g=0;!(d=s.next()).done;)d=d.value,b=a+Q$1(d,g++),h+=R$1(d,e,o,b,c);else if(d==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function S$1(s,e,o){if(s==null)return s;var a=[],c=0;return R$1(s,a,"","",function(d){return e.call(o,d,c++)}),a}function T$1(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(o){(s._status===0||s._status===-1)&&(s._status=1,s._result=o)},function(o){(s._status===0||s._status===-1)&&(s._status=2,s._result=o)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(s,e,o){S$1(s,function(){e.apply(this,arguments)},o)},count:function(s){var e=0;return S$1(s,function(){e++}),e},toArray:function(s){return S$1(s,function(e){return e})||[]},only:function(s){if(!O$1(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(s,e,o){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var a=C$2({},s.props),c=s.key,d=s.ref,h=s._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,h=K$1.current),e.key!==void 0&&(c=""+e.key),s.type&&s.type.defaultProps)var g=s.type.defaultProps;for(b in e)J.call(e,b)&&!L$1.hasOwnProperty(b)&&(a[b]=e[b]===void 0&&g!==void 0?g[b]:e[b])}var b=arguments.length-2;if(b===1)a.children=o;else if(1<b){g=Array(b);for(var j=0;j<b;j++)g[j]=arguments[j+2];a.children=g}return{$$typeof:l$1,type:s.type,key:c,ref:d,props:a,_owner:h}};react_production_min.createContext=function(s){return s={$$typeof:u,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:t$1,_context:s},s.Consumer=s};react_production_min.createElement=M$1;react_production_min.createFactory=function(s){var e=M$1.bind(null,s);return e.type=s,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(s){return{$$typeof:v$1,render:s}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(s){return{$$typeof:y,_payload:{_status:-1,_result:s},_init:T$1}};react_production_min.memo=function(s,e){return{$$typeof:x,type:s,compare:e===void 0?null:e}};react_production_min.startTransition=function(s){var e=V$1.transition;V$1.transition={};try{s()}finally{V$1.transition=e}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(s,e){return U$1.current.useCallback(s,e)};react_production_min.useContext=function(s){return U$1.current.useContext(s)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(s){return U$1.current.useDeferredValue(s)};react_production_min.useEffect=function(s,e){return U$1.current.useEffect(s,e)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(s,e,o){return U$1.current.useImperativeHandle(s,e,o)};react_production_min.useInsertionEffect=function(s,e){return U$1.current.useInsertionEffect(s,e)};react_production_min.useLayoutEffect=function(s,e){return U$1.current.useLayoutEffect(s,e)};react_production_min.useMemo=function(s,e){return U$1.current.useMemo(s,e)};react_production_min.useReducer=function(s,e,o){return U$1.current.useReducer(s,e,o)};react_production_min.useRef=function(s){return U$1.current.useRef(s)};react_production_min.useState=function(s){return U$1.current.useState(s)};react_production_min.useSyncExternalStore=function(s,e,o){return U$1.current.useSyncExternalStore(s,e,o)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react$1.exports=react_production_min;var reactExports=react$1.exports;const React$2=getDefaultExportFromCjs$1(reactExports),React$3=_mergeNamespaces({__proto__:null,default:React$2},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(s,e,o){var a,c={},d=null,h=null;o!==void 0&&(d=""+o),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(h=e.ref);for(a in e)m$1.call(e,a)&&!p$1.hasOwnProperty(a)&&(c[a]=e[a]);if(s&&s.defaultProps)for(a in e=s.defaultProps,e)c[a]===void 0&&(c[a]=e[a]);return{$$typeof:k,type:s,key:d,ref:h,props:c,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(mt,gt){var pt=mt.length;mt.push(gt);e:for(;0<pt;){var kt=pt-1>>>1,Rt=mt[kt];if(0<c(Rt,gt))mt[kt]=gt,mt[pt]=Rt,pt=kt;else break e}}function o(mt){return mt.length===0?null:mt[0]}function a(mt){if(mt.length===0)return null;var gt=mt[0],pt=mt.pop();if(pt!==gt){mt[0]=pt;e:for(var kt=0,Rt=mt.length,At=Rt>>>1;kt<At;){var Mt=2*(kt+1)-1,Dt=mt[Mt],$t=Mt+1,_t=mt[$t];if(0>c(Dt,pt))$t<Rt&&0>c(_t,Dt)?(mt[kt]=_t,mt[$t]=pt,kt=$t):(mt[kt]=Dt,mt[Mt]=pt,kt=Mt);else if($t<Rt&&0>c(_t,pt))mt[kt]=_t,mt[$t]=pt,kt=$t;else break e}}return gt}function c(mt,gt){var pt=mt.sortIndex-gt.sortIndex;return pt!==0?pt:mt.id-gt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;s.unstable_now=function(){return d.now()}}else{var h=Date,g=h.now();s.unstable_now=function(){return h.now()-g}}var b=[],j=[],$=1,_=null,_e=3,et=!1,nt=!1,rt=!1,it=typeof setTimeout=="function"?setTimeout:null,st=typeof clearTimeout=="function"?clearTimeout:null,lt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ot(mt){for(var gt=o(j);gt!==null;){if(gt.callback===null)a(j);else if(gt.startTime<=mt)a(j),gt.sortIndex=gt.expirationTime,e(b,gt);else break;gt=o(j)}}function ct(mt){if(rt=!1,ot(mt),!nt)if(o(b)!==null)nt=!0,St(ut);else{var gt=o(j);gt!==null&&bt(ct,gt.startTime-mt)}}function ut(mt,gt){nt=!1,rt&&(rt=!1,st(ft),ft=-1),et=!0;var pt=_e;try{for(ot(gt),_=o(b);_!==null&&(!(_.expirationTime>gt)||mt&&!yt());){var kt=_.callback;if(typeof kt=="function"){_.callback=null,_e=_.priorityLevel;var Rt=kt(_.expirationTime<=gt);gt=s.unstable_now(),typeof Rt=="function"?_.callback=Rt:_===o(b)&&a(b),ot(gt)}else a(b);_=o(b)}if(_!==null)var At=!0;else{var Mt=o(j);Mt!==null&&bt(ct,Mt.startTime-gt),At=!1}return At}finally{_=null,_e=pt,et=!1}}var at=!1,dt=null,ft=-1,xt=5,Ct=-1;function yt(){return!(s.unstable_now()-Ct<xt)}function Et(){if(dt!==null){var mt=s.unstable_now();Ct=mt;var gt=!0;try{gt=dt(!0,mt)}finally{gt?Tt():(at=!1,dt=null)}}else at=!1}var Tt;if(typeof lt=="function")Tt=function(){lt(Et)};else if(typeof MessageChannel<"u"){var ht=new MessageChannel,wt=ht.port2;ht.port1.onmessage=Et,Tt=function(){wt.postMessage(null)}}else Tt=function(){it(Et,0)};function St(mt){dt=mt,at||(at=!0,Tt())}function bt(mt,gt){ft=it(function(){mt(s.unstable_now())},gt)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(mt){mt.callback=null},s.unstable_continueExecution=function(){nt||et||(nt=!0,St(ut))},s.unstable_forceFrameRate=function(mt){0>mt||125<mt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xt=0<mt?Math.floor(1e3/mt):5},s.unstable_getCurrentPriorityLevel=function(){return _e},s.unstable_getFirstCallbackNode=function(){return o(b)},s.unstable_next=function(mt){switch(_e){case 1:case 2:case 3:var gt=3;break;default:gt=_e}var pt=_e;_e=gt;try{return mt()}finally{_e=pt}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(mt,gt){switch(mt){case 1:case 2:case 3:case 4:case 5:break;default:mt=3}var pt=_e;_e=mt;try{return gt()}finally{_e=pt}},s.unstable_scheduleCallback=function(mt,gt,pt){var kt=s.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?kt+pt:kt):pt=kt,mt){case 1:var Rt=-1;break;case 2:Rt=250;break;case 5:Rt=1073741823;break;case 4:Rt=1e4;break;default:Rt=5e3}return Rt=pt+Rt,mt={id:$++,callback:gt,priorityLevel:mt,startTime:pt,expirationTime:Rt,sortIndex:-1},pt>kt?(mt.sortIndex=pt,e(j,mt),o(b)===null&&mt===o(j)&&(rt?(st(ft),ft=-1):rt=!0,bt(ct,pt-kt))):(mt.sortIndex=Rt,e(b,mt),nt||et||(nt=!0,St(ut))),mt},s.unstable_shouldYield=yt,s.unstable_wrapCallback=function(mt){var gt=_e;return function(){var pt=_e;_e=gt;try{return mt.apply(this,arguments)}finally{_e=pt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,o=1;o<arguments.length;o++)e+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(s,e){ha(s,e),ha(s+"Capture",e)}function ha(s,e){for(ea[s]=e,s=0;s<e.length;s++)da.add(e[s])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(s){return ja.call(ma,s)?!0:ja.call(la,s)?!1:ka.test(s)?ma[s]=!0:(la[s]=!0,!1)}function pa(s,e,o,a){if(o!==null&&o.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:o!==null?!o.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function qa(s,e,o,a){if(e===null||typeof e>"u"||pa(s,e,o,a))return!0;if(a)return!1;if(o!==null)switch(o.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v(s,e,o,a,c,d,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=c,this.mustUseProperty=o,this.propertyName=s,this.type=e,this.sanitizeURL=d,this.removeEmptyString=h}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){z[s]=new v(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];z[e]=new v(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){z[s]=new v(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){z[s]=new v(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){z[s]=new v(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){z[s]=new v(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){z[s]=new v(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){z[s]=new v(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){z[s]=new v(s,5,!1,s.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(ra,sa);z[e]=new v(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){z[s]=new v(s,1,!1,s.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){z[s]=new v(s,1,!1,s.toLowerCase(),null,!0,!0)});function ta$1(s,e,o,a){var c=z.hasOwnProperty(e)?z[e]:null;(c!==null?c.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa(e,o,c,a)&&(o=null),a||c===null?oa(e)&&(o===null?s.removeAttribute(e):s.setAttribute(e,""+o)):c.mustUseProperty?s[c.propertyName]=o===null?c.type===3?!1:"":o:(e=c.attributeName,a=c.attributeNamespace,o===null?s.removeAttribute(e):(c=c.type,o=c===3||c===4&&o===!0?"":""+o,a?s.setAttributeNS(a,e,o):s.setAttribute(e,o))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(s){return s===null||typeof s!="object"?null:(s=Ja&&s[Ja]||s["@@iterator"],typeof s=="function"?s:null)}var A=Object.assign,La;function Ma(s){if(La===void 0)try{throw Error()}catch(o){var e=o.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+s}var Na=!1;function Oa(s,e){if(!s||Na)return"";Na=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(j){var a=j}Reflect.construct(s,[],e)}else{try{e.call()}catch(j){a=j}s.call(e.prototype)}else{try{throw Error()}catch(j){a=j}s()}}catch(j){if(j&&a&&typeof j.stack=="string"){for(var c=j.stack.split(`
`),d=a.stack.split(`
`),h=c.length-1,g=d.length-1;1<=h&&0<=g&&c[h]!==d[g];)g--;for(;1<=h&&0<=g;h--,g--)if(c[h]!==d[g]){if(h!==1||g!==1)do if(h--,g--,0>g||c[h]!==d[g]){var b=`
`+c[h].replace(" at new "," at ");return s.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",s.displayName)),b}while(1<=h&&0<=g);break}}}finally{Na=!1,Error.prepareStackTrace=o}return(s=s?s.displayName||s.name:"")?Ma(s):""}function Pa(s){switch(s.tag){case 5:return Ma(s.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return s=Oa(s.type,!1),s;case 11:return s=Oa(s.type.render,!1),s;case 1:return s=Oa(s.type,!0),s;default:return""}}function Qa(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Ca:return(s.displayName||"Context")+".Consumer";case Ba:return(s._context.displayName||"Context")+".Provider";case Da:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Ga:return e=s.displayName||null,e!==null?e:Qa(s.type)||"Memo";case Ha:e=s._payload,s=s._init;try{return Qa(s(e))}catch{}}return null}function Ra(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(e);case 8:return e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Ta(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(s){var e=Ta(s)?"checked":"value",o=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),a=""+s[e];if(!s.hasOwnProperty(e)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var c=o.get,d=o.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return c.call(this)},set:function(h){a=""+h,d.call(this,h)}}),Object.defineProperty(s,e,{enumerable:o.enumerable}),{getValue:function(){return a},setValue:function(h){a=""+h},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function Va(s){s._valueTracker||(s._valueTracker=Ua(s))}function Wa(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var o=e.getValue(),a="";return s&&(a=Ta(s)?s.checked?"true":"false":s.value),s=a,s!==o?(e.setValue(s),!0):!1}function Xa(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Ya(s,e){var o=e.checked;return A({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??s._wrapperState.initialChecked})}function Za(s,e){var o=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;o=Sa(e.value!=null?e.value:o),s._wrapperState={initialChecked:a,initialValue:o,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(s,e){e=e.checked,e!=null&&ta$1(s,"checked",e,!1)}function bb(s,e){ab(s,e);var o=Sa(e.value),a=e.type;if(o!=null)a==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+o):s.value!==""+o&&(s.value=""+o);else if(a==="submit"||a==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?cb(s,e.type,o):e.hasOwnProperty("defaultValue")&&cb(s,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function db(s,e,o){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,o||e===s.value||(s.value=e),s.defaultValue=e}o=s.name,o!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,o!==""&&(s.name=o)}function cb(s,e,o){(e!=="number"||Xa(s.ownerDocument)!==s)&&(o==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+o&&(s.defaultValue=""+o))}var eb=Array.isArray;function fb(s,e,o,a){if(s=s.options,e){e={};for(var c=0;c<o.length;c++)e["$"+o[c]]=!0;for(o=0;o<s.length;o++)c=e.hasOwnProperty("$"+s[o].value),s[o].selected!==c&&(s[o].selected=c),c&&a&&(s[o].defaultSelected=!0)}else{for(o=""+Sa(o),e=null,c=0;c<s.length;c++){if(s[c].value===o){s[c].selected=!0,a&&(s[c].defaultSelected=!0);return}e!==null||s[c].disabled||(e=s[c])}e!==null&&(e.selected=!0)}}function gb(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function hb(s,e){var o=e.value;if(o==null){if(o=e.children,e=e.defaultValue,o!=null){if(e!=null)throw Error(p(92));if(eb(o)){if(1<o.length)throw Error(p(93));o=o[0]}e=o}e==null&&(e=""),o=e}s._wrapperState={initialValue:Sa(o)}}function ib(s,e){var o=Sa(e.value),a=Sa(e.defaultValue);o!=null&&(o=""+o,o!==s.value&&(s.value=o),e.defaultValue==null&&s.defaultValue!==o&&(s.defaultValue=o)),a!=null&&(s.defaultValue=""+a)}function jb(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function kb(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?kb(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var mb,nb=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,o,a,c){MSApp.execUnsafeLocalFunction(function(){return s(e,o,a,c)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function ob(s,e){if(e){var o=s.firstChild;if(o&&o===s.lastChild&&o.nodeType===3){o.nodeValue=e;return}}s.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(s){qb.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),pb[e]=pb[s]})});function rb(s,e,o){return e==null||typeof e=="boolean"||e===""?"":o||typeof e!="number"||e===0||pb.hasOwnProperty(s)&&pb[s]?(""+e).trim():e+"px"}function sb(s,e){s=s.style;for(var o in e)if(e.hasOwnProperty(o)){var a=o.indexOf("--")===0,c=rb(o,e[o],a);o==="float"&&(o="cssFloat"),a?s.setProperty(o,c):s[o]=c}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(s,e){if(e){if(tb[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p(62))}}function vb(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var yb=null,zb=null,Ab=null;function Bb(s){if(s=Cb(s)){if(typeof yb!="function")throw Error(p(280));var e=s.stateNode;e&&(e=Db(e),yb(s.stateNode,s.type,e))}}function Eb(s){zb?Ab?Ab.push(s):Ab=[s]:zb=s}function Fb(){if(zb){var s=zb,e=Ab;if(Ab=zb=null,Bb(s),e)for(s=0;s<e.length;s++)Bb(e[s])}}function Gb(s,e){return s(e)}function Hb(){}var Ib=!1;function Jb(s,e,o){if(Ib)return s(e,o);Ib=!0;try{return Gb(s,e,o)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(s,e){var o=s.stateNode;if(o===null)return null;var a=Db(o);if(a===null)return null;o=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(s=s.type,a=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!a;break e;default:s=!1}if(s)return null;if(o&&typeof o!="function")throw Error(p(231,e,typeof o));return o}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(s,e,o,a,c,d,h,g,b){var j=Array.prototype.slice.call(arguments,3);try{e.apply(o,j)}catch($){this.onError($)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(s){Ob=!0,Pb=s}};function Tb(s,e,o,a,c,d,h,g,b){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(s,e,o,a,c,d,h,g,b){if(Tb.apply(this,arguments),Ob){if(Ob){var j=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=j)}}function Vb(s){var e=s,o=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(o=e.return),s=e.return;while(s)}return e.tag===3?o:null}function Wb(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(s){if(Vb(s)!==s)throw Error(p(188))}function Yb(s){var e=s.alternate;if(!e){if(e=Vb(s),e===null)throw Error(p(188));return e!==s?null:s}for(var o=s,a=e;;){var c=o.return;if(c===null)break;var d=c.alternate;if(d===null){if(a=c.return,a!==null){o=a;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===o)return Xb(c),s;if(d===a)return Xb(c),e;d=d.sibling}throw Error(p(188))}if(o.return!==a.return)o=c,a=d;else{for(var h=!1,g=c.child;g;){if(g===o){h=!0,o=c,a=d;break}if(g===a){h=!0,a=c,o=d;break}g=g.sibling}if(!h){for(g=d.child;g;){if(g===o){h=!0,o=d,a=c;break}if(g===a){h=!0,a=d,o=c;break}g=g.sibling}if(!h)throw Error(p(189))}}if(o.alternate!==a)throw Error(p(190))}if(o.tag!==3)throw Error(p(188));return o.stateNode.current===o?s:e}function Zb(s){return s=Yb(s),s!==null?$b(s):null}function $b(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=$b(s);if(e!==null)return e;s=s.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc$1=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(s){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,s,void 0,(s.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(s){return s>>>=0,s===0?32:31-(pc(s)/qc|0)|0}var rc=64,sc=4194304;function tc(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function uc(s,e){var o=s.pendingLanes;if(o===0)return 0;var a=0,c=s.suspendedLanes,d=s.pingedLanes,h=o&268435455;if(h!==0){var g=h&~c;g!==0?a=tc(g):(d&=h,d!==0&&(a=tc(d)))}else h=o&~c,h!==0?a=tc(h):d!==0&&(a=tc(d));if(a===0)return 0;if(e!==0&&e!==a&&!(e&c)&&(c=a&-a,d=e&-e,c>=d||c===16&&(d&4194240)!==0))return e;if(a&4&&(a|=o&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=a;0<e;)o=31-oc(e),c=1<<o,a|=s[o],e&=~c;return a}function vc(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(s,e){for(var o=s.suspendedLanes,a=s.pingedLanes,c=s.expirationTimes,d=s.pendingLanes;0<d;){var h=31-oc(d),g=1<<h,b=c[h];b===-1?(!(g&o)||g&a)&&(c[h]=vc(g,e)):b<=e&&(s.expiredLanes|=g),d&=~g}}function xc(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function yc(){var s=rc;return rc<<=1,!(rc&4194240)&&(rc=64),s}function zc(s){for(var e=[],o=0;31>o;o++)e.push(s);return e}function Ac(s,e,o){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-oc(e),s[e]=o}function Bc(s,e){var o=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var a=s.eventTimes;for(s=s.expirationTimes;0<o;){var c=31-oc(o),d=1<<c;e[c]=0,a[c]=-1,s[c]=-1,o&=~d}}function Cc(s,e){var o=s.entangledLanes|=e;for(s=s.entanglements;o;){var a=31-oc(o),c=1<<a;c&e|s[a]&e&&(s[a]|=e),o&=~c}}var C$1=0;function Dc(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(s,e){switch(s){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(e.pointerId)}}function Tc(s,e,o,a,c,d){return s===null||s.nativeEvent!==d?(s={blockedOn:e,domEventName:o,eventSystemFlags:a,nativeEvent:d,targetContainers:[c]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),s):(s.eventSystemFlags|=a,e=s.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),s)}function Uc(s,e,o,a,c){switch(e){case"focusin":return Lc=Tc(Lc,s,e,o,a,c),!0;case"dragenter":return Mc=Tc(Mc,s,e,o,a,c),!0;case"mouseover":return Nc=Tc(Nc,s,e,o,a,c),!0;case"pointerover":var d=c.pointerId;return Oc.set(d,Tc(Oc.get(d)||null,s,e,o,a,c)),!0;case"gotpointercapture":return d=c.pointerId,Pc.set(d,Tc(Pc.get(d)||null,s,e,o,a,c)),!0}return!1}function Vc(s){var e=Wc(s.target);if(e!==null){var o=Vb(e);if(o!==null){if(e=o.tag,e===13){if(e=Wb(o),e!==null){s.blockedOn=e,Ic(s.priority,function(){Gc(o)});return}}else if(e===3&&o.stateNode.current.memoizedState.isDehydrated){s.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Xc(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var o=Yc(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(o===null){o=s.nativeEvent;var a=new o.constructor(o.type,o);wb=a,o.target.dispatchEvent(a),wb=null}else return e=Cb(o),e!==null&&Fc(e),s.blockedOn=o,!1;e.shift()}return!0}function Zc(s,e,o){Xc(s)&&o.delete(e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(s,e){s.blockedOn===e&&(s.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(s){function e(c){return ad(c,s)}if(0<Kc.length){ad(Kc[0],s);for(var o=1;o<Kc.length;o++){var a=Kc[o];a.blockedOn===s&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,s),Mc!==null&&ad(Mc,s),Nc!==null&&ad(Nc,s),Oc.forEach(e),Pc.forEach(e),o=0;o<Qc.length;o++)a=Qc[o],a.blockedOn===s&&(a.blockedOn=null);for(;0<Qc.length&&(o=Qc[0],o.blockedOn===null);)Vc(o),o.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(s,e,o,a){var c=C$1,d=cd.transition;cd.transition=null;try{C$1=1,fd(s,e,o,a)}finally{C$1=c,cd.transition=d}}function gd(s,e,o,a){var c=C$1,d=cd.transition;cd.transition=null;try{C$1=4,fd(s,e,o,a)}finally{C$1=c,cd.transition=d}}function fd(s,e,o,a){if(dd){var c=Yc(s,e,o,a);if(c===null)hd(s,e,a,id$1,o),Sc(s,a);else if(Uc(c,s,e,o,a))a.stopPropagation();else if(Sc(s,a),e&4&&-1<Rc.indexOf(s)){for(;c!==null;){var d=Cb(c);if(d!==null&&Ec(d),d=Yc(s,e,o,a),d===null&&hd(s,e,a,id$1,o),d===c)break;c=d}c!==null&&a.stopPropagation()}else hd(s,e,a,null,o)}}var id$1=null;function Yc(s,e,o,a){if(id$1=null,s=xb(a),s=Wc(s),s!==null)if(e=Vb(s),e===null)s=null;else if(o=e.tag,o===13){if(s=Wb(e),s!==null)return s;s=null}else if(o===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return id$1=s,null}function jd(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var s,e=ld,o=e.length,a,c="value"in kd?kd.value:kd.textContent,d=c.length;for(s=0;s<o&&e[s]===c[s];s++);var h=o-s;for(a=1;a<=h&&e[o-a]===c[d-a];a++);return md=c.slice(s,1<a?1-a:void 0)}function od(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function pd(){return!0}function qd(){return!1}function rd(s){function e(o,a,c,d,h){this._reactName=o,this._targetInst=c,this.type=a,this.nativeEvent=d,this.target=h,this.currentTarget=null;for(var g in s)s.hasOwnProperty(g)&&(o=s[g],this[g]=o?o(d):d[g]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==yd&&(yd&&s.type==="mousemove"?(wd=s.screenX-yd.screenX,xd=s.screenY-yd.screenY):xd=wd=0,yd=s),wd)},movementY:function(s){return"movementY"in s?s.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=Od[s])?!!e[s]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(s){if(s.key){var e=Md[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=od(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Nd[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(s){return s.type==="keypress"?od(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?od(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(s,e){switch(s){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ie$3=!1;function je(s,e){switch(s){case"compositionend":return he(e);case"keypress":return e.which!==32?null:(fe=!0,ee);case"textInput":return s=e.data,s===ee&&fe?null:s;default:return null}}function ke(s,e){if(ie$3)return s==="compositionend"||!ae&&ge(s,e)?(s=nd(),md=ld=kd=null,ie$3=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de&&e.locale!=="ko"?null:e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!le[s.type]:e==="textarea"}function ne(s,e,o,a){Eb(a),e=oe(e,"onChange"),0<e.length&&(o=new td("onChange","change",null,o,a),s.push({event:o,listeners:e}))}var pe=null,qe=null;function re(s){se(s,0)}function te(s){var e=ue(s);if(Wa(e))return s}function ve(s,e){if(s==="change")return e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(s){if(s.propertyName==="value"&&te(qe)){var e=[];ne(e,qe,s,xb(s)),Jb(re,e)}}function Ce(s,e,o){s==="focusin"?(Ae(),pe=e,qe=o,pe.attachEvent("onpropertychange",Be)):s==="focusout"&&Ae()}function De(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return te(qe)}function Ee(s,e){if(s==="click")return te(e)}function Fe(s,e){if(s==="input"||s==="change")return te(e)}function Ge(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(s,e){if(He(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var o=Object.keys(s),a=Object.keys(e);if(o.length!==a.length)return!1;for(a=0;a<o.length;a++){var c=o[a];if(!ja.call(e,c)||!He(s[c],e[c]))return!1}return!0}function Je(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Ke(s,e){var o=Je(s);s=0;for(var a;o;){if(o.nodeType===3){if(a=s+o.textContent.length,s<=e&&a>=e)return{node:o,offset:e-s};s=a}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Je(o)}}function Le(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?Le(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function Me(){for(var s=window,e=Xa();e instanceof s.HTMLIFrameElement;){try{var o=typeof e.contentWindow.location.href=="string"}catch{o=!1}if(o)s=e.contentWindow;else break;e=Xa(s.document)}return e}function Ne(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function Oe(s){var e=Me(),o=s.focusedElem,a=s.selectionRange;if(e!==o&&o&&o.ownerDocument&&Le(o.ownerDocument.documentElement,o)){if(a!==null&&Ne(o)){if(e=a.start,s=a.end,s===void 0&&(s=e),"selectionStart"in o)o.selectionStart=e,o.selectionEnd=Math.min(s,o.value.length);else if(s=(e=o.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var c=o.textContent.length,d=Math.min(a.start,c);a=a.end===void 0?d:Math.min(a.end,c),!s.extend&&d>a&&(c=a,a=d,d=c),c=Ke(o,d);var h=Ke(o,a);c&&h&&(s.rangeCount!==1||s.anchorNode!==c.node||s.anchorOffset!==c.offset||s.focusNode!==h.node||s.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),s.removeAllRanges(),d>a?(s.addRange(e),s.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),s.addRange(e)))}}for(e=[],s=o;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<e.length;o++)s=e[o],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(s,e,o){var a=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Te||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe(Re,"onSelect"),0<a.length&&(e=new td("onSelect","select",null,e,o),s.push({event:e,listeners:a}),e.target=Qe)))}function Ve(s,e){var o={};return o[s.toLowerCase()]=e.toLowerCase(),o["Webkit"+s]="webkit"+e,o["Moz"+s]="moz"+e,o}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(s){if(Xe[s])return Xe[s];if(!We[s])return s;var e=We[s],o;for(o in e)if(e.hasOwnProperty(o)&&o in Ye)return Xe[s]=e[o];return s}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(s,e){df.set(s,e),fa(e,[s])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(s,e,o){var a=s.type||"unknown-event";s.currentTarget=o,Ub(a,e,void 0,s),s.currentTarget=null}function se(s,e){e=(e&4)!==0;for(var o=0;o<s.length;o++){var a=s[o],c=a.event;a=a.listeners;e:{var d=void 0;if(e)for(var h=a.length-1;0<=h;h--){var g=a[h],b=g.instance,j=g.currentTarget;if(g=g.listener,b!==d&&c.isPropagationStopped())break e;nf(c,g,j),d=b}else for(h=0;h<a.length;h++){if(g=a[h],b=g.instance,j=g.currentTarget,g=g.listener,b!==d&&c.isPropagationStopped())break e;nf(c,g,j),d=b}}}if(Qb)throw s=Rb,Qb=!1,Rb=null,s}function D(s,e){var o=e[of];o===void 0&&(o=e[of]=new Set);var a=s+"__bubble";o.has(a)||(pf(e,s,2,!1),o.add(a))}function qf(s,e,o){var a=0;e&&(a|=4),pf(o,s,a,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(s){if(!s[rf]){s[rf]=!0,da.forEach(function(o){o!=="selectionchange"&&(mf.has(o)||qf(o,!1,s),qf(o,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(s,e,o,a){switch(jd(e)){case 1:var c=ed;break;case 4:c=gd;break;default:c=fd}o=c.bind(null,e,o,s),c=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),a?c!==void 0?s.addEventListener(e,o,{capture:!0,passive:c}):s.addEventListener(e,o,!0):c!==void 0?s.addEventListener(e,o,{passive:c}):s.addEventListener(e,o,!1)}function hd(s,e,o,a,c){var d=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var h=a.tag;if(h===3||h===4){var g=a.stateNode.containerInfo;if(g===c||g.nodeType===8&&g.parentNode===c)break;if(h===4)for(h=a.return;h!==null;){var b=h.tag;if((b===3||b===4)&&(b=h.stateNode.containerInfo,b===c||b.nodeType===8&&b.parentNode===c))return;h=h.return}for(;g!==null;){if(h=Wc(g),h===null)return;if(b=h.tag,b===5||b===6){a=d=h;continue e}g=g.parentNode}}a=a.return}Jb(function(){var j=d,$=xb(o),_=[];e:{var _e=df.get(s);if(_e!==void 0){var et=td,nt=s;switch(s){case"keypress":if(od(o)===0)break e;case"keydown":case"keyup":et=Rd;break;case"focusin":nt="focus",et=Fd;break;case"focusout":nt="blur",et=Fd;break;case"beforeblur":case"afterblur":et=Fd;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=Vd;break;case $e:case af:case bf:et=Hd;break;case cf:et=Xd;break;case"scroll":et=vd;break;case"wheel":et=Zd;break;case"copy":case"cut":case"paste":et=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=Td}var rt=(e&4)!==0,it=!rt&&s==="scroll",st=rt?_e!==null?_e+"Capture":null:_e;rt=[];for(var lt=j,ot;lt!==null;){ot=lt;var ct=ot.stateNode;if(ot.tag===5&&ct!==null&&(ot=ct,st!==null&&(ct=Kb(lt,st),ct!=null&&rt.push(tf(lt,ct,ot)))),it)break;lt=lt.return}0<rt.length&&(_e=new et(_e,nt,null,o,$),_.push({event:_e,listeners:rt}))}}if(!(e&7)){e:{if(_e=s==="mouseover"||s==="pointerover",et=s==="mouseout"||s==="pointerout",_e&&o!==wb&&(nt=o.relatedTarget||o.fromElement)&&(Wc(nt)||nt[uf]))break e;if((et||_e)&&(_e=$.window===$?$:(_e=$.ownerDocument)?_e.defaultView||_e.parentWindow:window,et?(nt=o.relatedTarget||o.toElement,et=j,nt=nt?Wc(nt):null,nt!==null&&(it=Vb(nt),nt!==it||nt.tag!==5&&nt.tag!==6)&&(nt=null)):(et=null,nt=j),et!==nt)){if(rt=Bd,ct="onMouseLeave",st="onMouseEnter",lt="mouse",(s==="pointerout"||s==="pointerover")&&(rt=Td,ct="onPointerLeave",st="onPointerEnter",lt="pointer"),it=et==null?_e:ue(et),ot=nt==null?_e:ue(nt),_e=new rt(ct,lt+"leave",et,o,$),_e.target=it,_e.relatedTarget=ot,ct=null,Wc($)===j&&(rt=new rt(st,lt+"enter",nt,o,$),rt.target=ot,rt.relatedTarget=it,ct=rt),it=ct,et&&nt)t:{for(rt=et,st=nt,lt=0,ot=rt;ot;ot=vf(ot))lt++;for(ot=0,ct=st;ct;ct=vf(ct))ot++;for(;0<lt-ot;)rt=vf(rt),lt--;for(;0<ot-lt;)st=vf(st),ot--;for(;lt--;){if(rt===st||st!==null&&rt===st.alternate)break t;rt=vf(rt),st=vf(st)}rt=null}else rt=null;et!==null&&wf(_,_e,et,rt,!1),nt!==null&&it!==null&&wf(_,it,nt,rt,!0)}}e:{if(_e=j?ue(j):window,et=_e.nodeName&&_e.nodeName.toLowerCase(),et==="select"||et==="input"&&_e.type==="file")var ut=ve;else if(me(_e))if(we)ut=Fe;else{ut=De;var at=Ce}else(et=_e.nodeName)&&et.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(ut=Ee);if(ut&&(ut=ut(s,j))){ne(_,ut,o,$);break e}at&&at(s,_e,j),s==="focusout"&&(at=_e._wrapperState)&&at.controlled&&_e.type==="number"&&cb(_e,"number",_e.value)}switch(at=j?ue(j):window,s){case"focusin":(me(at)||at.contentEditable==="true")&&(Qe=at,Re=j,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(_,o,$);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(_,o,$)}var dt;if(ae)e:{switch(s){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else ie$3?ge(s,o)&&(ft="onCompositionEnd"):s==="keydown"&&o.keyCode===229&&(ft="onCompositionStart");ft&&(de&&o.locale!=="ko"&&(ie$3||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&ie$3&&(dt=nd()):(kd=$,ld="value"in kd?kd.value:kd.textContent,ie$3=!0)),at=oe(j,ft),0<at.length&&(ft=new Ld(ft,s,null,o,$),_.push({event:ft,listeners:at}),dt?ft.data=dt:(dt=he(o),dt!==null&&(ft.data=dt)))),(dt=ce?je(s,o):ke(s,o))&&(j=oe(j,"onBeforeInput"),0<j.length&&($=new Ld("onBeforeInput","beforeinput",null,o,$),_.push({event:$,listeners:j}),$.data=dt))}se(_,e)})}function tf(s,e,o){return{instance:s,listener:e,currentTarget:o}}function oe(s,e){for(var o=e+"Capture",a=[];s!==null;){var c=s,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=Kb(s,o),d!=null&&a.unshift(tf(s,d,c)),d=Kb(s,e),d!=null&&a.push(tf(s,d,c))),s=s.return}return a}function vf(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function wf(s,e,o,a,c){for(var d=e._reactName,h=[];o!==null&&o!==a;){var g=o,b=g.alternate,j=g.stateNode;if(b!==null&&b===a)break;g.tag===5&&j!==null&&(g=j,c?(b=Kb(o,d),b!=null&&h.unshift(tf(o,b,g))):c||(b=Kb(o,d),b!=null&&h.push(tf(o,b,g)))),o=o.return}h.length!==0&&s.push({event:e,listeners:h})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(s){return(typeof s=="string"?s:""+s).replace(xf,`
`).replace(yf,"")}function Af(s,e,o){if(e=zf(e),zf(s)!==e&&o)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(s){return Hf.resolve(null).then(s).catch(If)}:Ff;function If(s){setTimeout(function(){throw s})}function Kf(s,e){var o=e,a=0;do{var c=o.nextSibling;if(s.removeChild(o),c&&c.nodeType===8)if(o=c.data,o==="/$"){if(a===0){s.removeChild(c),bd(e);return}a--}else o!=="$"&&o!=="$?"&&o!=="$!"||a++;o=c}while(o);bd(e)}function Lf(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function Mf(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var o=s.data;if(o==="$"||o==="$!"||o==="$?"){if(e===0)return s;e--}else o==="/$"&&e++}s=s.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(s){var e=s[Of];if(e)return e;for(var o=s.parentNode;o;){if(e=o[uf]||o[Of]){if(o=e.alternate,e.child!==null||o!==null&&o.child!==null)for(s=Mf(s);s!==null;){if(o=s[Of])return o;s=Mf(s)}return e}s=o,o=s.parentNode}return null}function Cb(s){return s=s[Of]||s[uf],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function ue(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(p(33))}function Db(s){return s[Pf]||null}var Sf=[],Tf=-1;function Uf(s){return{current:s}}function E(s){0>Tf||(s.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(s,e){Tf++,Sf[Tf]=s.current,s.current=e}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(s,e){var o=s.type.contextTypes;if(!o)return Vf;var a=s.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in o)c[d]=e[d];return a&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=c),c}function Zf(s){return s=s.childContextTypes,s!=null}function $f(){E(Wf),E(H)}function ag(s,e,o){if(H.current!==Vf)throw Error(p(168));G(H,e),G(Wf,o)}function bg(s,e,o){var a=s.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return o;a=a.getChildContext();for(var c in a)if(!(c in e))throw Error(p(108,Ra(s)||"Unknown",c));return A({},o,a)}function cg(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,s),G(Wf,Wf.current),!0}function dg(s,e,o){var a=s.stateNode;if(!a)throw Error(p(169));o?(s=bg(s,e,Xf),a.__reactInternalMemoizedMergedChildContext=s,E(Wf),E(H),G(H,s)):E(Wf),G(Wf,o)}var eg=null,fg=!1,gg=!1;function hg(s){eg===null?eg=[s]:eg.push(s)}function ig(s){fg=!0,hg(s)}function jg(){if(!gg&&eg!==null){gg=!0;var s=0,e=C$1;try{var o=eg;for(C$1=1;s<o.length;s++){var a=o[s];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(c){throw eg!==null&&(eg=eg.slice(s+1)),ac(fc,jg),c}finally{C$1=e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(s,e){kg[lg++]=ng,kg[lg++]=mg,mg=s,ng=e}function ug(s,e,o){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=s;var a=rg;s=sg;var c=32-oc(a)-1;a&=~(1<<c),o+=1;var d=32-oc(e)+c;if(30<d){var h=c-c%5;d=(a&(1<<h)-1).toString(32),a>>=h,c-=h,rg=1<<32-oc(e)+c|o<<c|a,sg=d+s}else rg=1<<d|o<<c|a,sg=s}function vg(s){s.return!==null&&(tg(s,1),ug(s,1,0))}function wg(s){for(;s===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;s===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(s,e){var o=Bg(5,null,null,0);o.elementType="DELETED",o.stateNode=e,o.return=s,e=s.deletions,e===null?(s.deletions=[o],s.flags|=16):e.push(o)}function Cg(s,e){switch(s.tag){case 5:var o=s.type;return e=e.nodeType!==1||o.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,xg=s,yg=Lf(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,xg=s,yg=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(o=qg!==null?{id:rg,overflow:sg}:null,s.memoizedState={dehydrated:e,treeContext:o,retryLane:1073741824},o=Bg(18,null,null,0),o.stateNode=e,o.return=s,s.child=o,xg=s,yg=null,!0):!1;default:return!1}}function Dg(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Eg(s){if(I){var e=yg;if(e){var o=e;if(!Cg(s,e)){if(Dg(s))throw Error(p(418));e=Lf(o.nextSibling);var a=xg;e&&Cg(s,e)?Ag(a,o):(s.flags=s.flags&-4097|2,I=!1,xg=s)}}else{if(Dg(s))throw Error(p(418));s.flags=s.flags&-4097|2,I=!1,xg=s}}}function Fg(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;xg=s}function Gg(s){if(s!==xg)return!1;if(!I)return Fg(s),I=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!Ef(s.type,s.memoizedProps)),e&&(e=yg)){if(Dg(s))throw Hg(),Error(p(418));for(;e;)Ag(s,e),e=Lf(e.nextSibling)}if(Fg(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(p(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var o=s.data;if(o==="/$"){if(e===0){yg=Lf(s.nextSibling);break e}e--}else o!=="$"&&o!=="$!"&&o!=="$?"||e++}s=s.nextSibling}yg=null}}else yg=xg?Lf(s.stateNode.nextSibling):null;return!0}function Hg(){for(var s=yg;s;)s=Lf(s.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(s){zg===null?zg=[s]:zg.push(s)}var Kg=ua.ReactCurrentBatchConfig;function Lg(s,e,o){if(s=o.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(p(309));var a=o.stateNode}if(!a)throw Error(p(147,s));var c=a,d=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(h){var g=c.refs;h===null?delete g[d]:g[d]=h},e._stringRef=d,e)}if(typeof s!="string")throw Error(p(284));if(!o._owner)throw Error(p(290,s))}return s}function Mg(s,e){throw s=Object.prototype.toString.call(e),Error(p(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function Ng(s){var e=s._init;return e(s._payload)}function Og(s){function e(st,lt){if(s){var ot=st.deletions;ot===null?(st.deletions=[lt],st.flags|=16):ot.push(lt)}}function o(st,lt){if(!s)return null;for(;lt!==null;)e(st,lt),lt=lt.sibling;return null}function a(st,lt){for(st=new Map;lt!==null;)lt.key!==null?st.set(lt.key,lt):st.set(lt.index,lt),lt=lt.sibling;return st}function c(st,lt){return st=Pg(st,lt),st.index=0,st.sibling=null,st}function d(st,lt,ot){return st.index=ot,s?(ot=st.alternate,ot!==null?(ot=ot.index,ot<lt?(st.flags|=2,lt):ot):(st.flags|=2,lt)):(st.flags|=1048576,lt)}function h(st){return s&&st.alternate===null&&(st.flags|=2),st}function g(st,lt,ot,ct){return lt===null||lt.tag!==6?(lt=Qg(ot,st.mode,ct),lt.return=st,lt):(lt=c(lt,ot),lt.return=st,lt)}function b(st,lt,ot,ct){var ut=ot.type;return ut===ya?$(st,lt,ot.props.children,ct,ot.key):lt!==null&&(lt.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===Ha&&Ng(ut)===lt.type)?(ct=c(lt,ot.props),ct.ref=Lg(st,lt,ot),ct.return=st,ct):(ct=Rg(ot.type,ot.key,ot.props,null,st.mode,ct),ct.ref=Lg(st,lt,ot),ct.return=st,ct)}function j(st,lt,ot,ct){return lt===null||lt.tag!==4||lt.stateNode.containerInfo!==ot.containerInfo||lt.stateNode.implementation!==ot.implementation?(lt=Sg(ot,st.mode,ct),lt.return=st,lt):(lt=c(lt,ot.children||[]),lt.return=st,lt)}function $(st,lt,ot,ct,ut){return lt===null||lt.tag!==7?(lt=Tg(ot,st.mode,ct,ut),lt.return=st,lt):(lt=c(lt,ot),lt.return=st,lt)}function _(st,lt,ot){if(typeof lt=="string"&&lt!==""||typeof lt=="number")return lt=Qg(""+lt,st.mode,ot),lt.return=st,lt;if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case va:return ot=Rg(lt.type,lt.key,lt.props,null,st.mode,ot),ot.ref=Lg(st,null,lt),ot.return=st,ot;case wa:return lt=Sg(lt,st.mode,ot),lt.return=st,lt;case Ha:var ct=lt._init;return _(st,ct(lt._payload),ot)}if(eb(lt)||Ka(lt))return lt=Tg(lt,st.mode,ot,null),lt.return=st,lt;Mg(st,lt)}return null}function _e(st,lt,ot,ct){var ut=lt!==null?lt.key:null;if(typeof ot=="string"&&ot!==""||typeof ot=="number")return ut!==null?null:g(st,lt,""+ot,ct);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case va:return ot.key===ut?b(st,lt,ot,ct):null;case wa:return ot.key===ut?j(st,lt,ot,ct):null;case Ha:return ut=ot._init,_e(st,lt,ut(ot._payload),ct)}if(eb(ot)||Ka(ot))return ut!==null?null:$(st,lt,ot,ct,null);Mg(st,ot)}return null}function et(st,lt,ot,ct,ut){if(typeof ct=="string"&&ct!==""||typeof ct=="number")return st=st.get(ot)||null,g(lt,st,""+ct,ut);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case va:return st=st.get(ct.key===null?ot:ct.key)||null,b(lt,st,ct,ut);case wa:return st=st.get(ct.key===null?ot:ct.key)||null,j(lt,st,ct,ut);case Ha:var at=ct._init;return et(st,lt,ot,at(ct._payload),ut)}if(eb(ct)||Ka(ct))return st=st.get(ot)||null,$(lt,st,ct,ut,null);Mg(lt,ct)}return null}function nt(st,lt,ot,ct){for(var ut=null,at=null,dt=lt,ft=lt=0,xt=null;dt!==null&&ft<ot.length;ft++){dt.index>ft?(xt=dt,dt=null):xt=dt.sibling;var Ct=_e(st,dt,ot[ft],ct);if(Ct===null){dt===null&&(dt=xt);break}s&&dt&&Ct.alternate===null&&e(st,dt),lt=d(Ct,lt,ft),at===null?ut=Ct:at.sibling=Ct,at=Ct,dt=xt}if(ft===ot.length)return o(st,dt),I&&tg(st,ft),ut;if(dt===null){for(;ft<ot.length;ft++)dt=_(st,ot[ft],ct),dt!==null&&(lt=d(dt,lt,ft),at===null?ut=dt:at.sibling=dt,at=dt);return I&&tg(st,ft),ut}for(dt=a(st,dt);ft<ot.length;ft++)xt=et(dt,st,ft,ot[ft],ct),xt!==null&&(s&&xt.alternate!==null&&dt.delete(xt.key===null?ft:xt.key),lt=d(xt,lt,ft),at===null?ut=xt:at.sibling=xt,at=xt);return s&&dt.forEach(function(yt){return e(st,yt)}),I&&tg(st,ft),ut}function rt(st,lt,ot,ct){var ut=Ka(ot);if(typeof ut!="function")throw Error(p(150));if(ot=ut.call(ot),ot==null)throw Error(p(151));for(var at=ut=null,dt=lt,ft=lt=0,xt=null,Ct=ot.next();dt!==null&&!Ct.done;ft++,Ct=ot.next()){dt.index>ft?(xt=dt,dt=null):xt=dt.sibling;var yt=_e(st,dt,Ct.value,ct);if(yt===null){dt===null&&(dt=xt);break}s&&dt&&yt.alternate===null&&e(st,dt),lt=d(yt,lt,ft),at===null?ut=yt:at.sibling=yt,at=yt,dt=xt}if(Ct.done)return o(st,dt),I&&tg(st,ft),ut;if(dt===null){for(;!Ct.done;ft++,Ct=ot.next())Ct=_(st,Ct.value,ct),Ct!==null&&(lt=d(Ct,lt,ft),at===null?ut=Ct:at.sibling=Ct,at=Ct);return I&&tg(st,ft),ut}for(dt=a(st,dt);!Ct.done;ft++,Ct=ot.next())Ct=et(dt,st,ft,Ct.value,ct),Ct!==null&&(s&&Ct.alternate!==null&&dt.delete(Ct.key===null?ft:Ct.key),lt=d(Ct,lt,ft),at===null?ut=Ct:at.sibling=Ct,at=Ct);return s&&dt.forEach(function(Et){return e(st,Et)}),I&&tg(st,ft),ut}function it(st,lt,ot,ct){if(typeof ot=="object"&&ot!==null&&ot.type===ya&&ot.key===null&&(ot=ot.props.children),typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case va:e:{for(var ut=ot.key,at=lt;at!==null;){if(at.key===ut){if(ut=ot.type,ut===ya){if(at.tag===7){o(st,at.sibling),lt=c(at,ot.props.children),lt.return=st,st=lt;break e}}else if(at.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===Ha&&Ng(ut)===at.type){o(st,at.sibling),lt=c(at,ot.props),lt.ref=Lg(st,at,ot),lt.return=st,st=lt;break e}o(st,at);break}else e(st,at);at=at.sibling}ot.type===ya?(lt=Tg(ot.props.children,st.mode,ct,ot.key),lt.return=st,st=lt):(ct=Rg(ot.type,ot.key,ot.props,null,st.mode,ct),ct.ref=Lg(st,lt,ot),ct.return=st,st=ct)}return h(st);case wa:e:{for(at=ot.key;lt!==null;){if(lt.key===at)if(lt.tag===4&&lt.stateNode.containerInfo===ot.containerInfo&&lt.stateNode.implementation===ot.implementation){o(st,lt.sibling),lt=c(lt,ot.children||[]),lt.return=st,st=lt;break e}else{o(st,lt);break}else e(st,lt);lt=lt.sibling}lt=Sg(ot,st.mode,ct),lt.return=st,st=lt}return h(st);case Ha:return at=ot._init,it(st,lt,at(ot._payload),ct)}if(eb(ot))return nt(st,lt,ot,ct);if(Ka(ot))return rt(st,lt,ot,ct);Mg(st,ot)}return typeof ot=="string"&&ot!==""||typeof ot=="number"?(ot=""+ot,lt!==null&&lt.tag===6?(o(st,lt.sibling),lt=c(lt,ot),lt.return=st,st=lt):(o(st,lt),lt=Qg(ot,st.mode,ct),lt.return=st,st=lt),h(st)):o(st,lt)}return it}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(s){var e=Wg.current;E(Wg),s._currentValue=e}function bh(s,e,o){for(;s!==null;){var a=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),s===o)break;s=s.return}}function ch(s,e){Xg=s,Zg=Yg=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(dh=!0),s.firstContext=null)}function eh(s){var e=s._currentValue;if(Zg!==s)if(s={context:s,memoizedValue:e,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=s,Xg.dependencies={lanes:0,firstContext:s}}else Yg=Yg.next=s;return e}var fh=null;function gh(s){fh===null?fh=[s]:fh.push(s)}function hh(s,e,o,a){var c=e.interleaved;return c===null?(o.next=o,gh(e)):(o.next=c.next,c.next=o),e.interleaved=o,ih(s,a)}function ih(s,e){s.lanes|=e;var o=s.alternate;for(o!==null&&(o.lanes|=e),o=s,s=s.return;s!==null;)s.childLanes|=e,o=s.alternate,o!==null&&(o.childLanes|=e),o=s,s=s.return;return o.tag===3?o.stateNode:null}var jh=!1;function kh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function mh(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function nh(s,e,o){var a=s.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var c=a.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),a.pending=e,ih(s,o)}return c=a.interleaved,c===null?(e.next=e,gh(a)):(e.next=c.next,c.next=e),a.interleaved=e,ih(s,o)}function oh(s,e,o){if(e=e.updateQueue,e!==null&&(e=e.shared,(o&4194240)!==0)){var a=e.lanes;a&=s.pendingLanes,o|=a,e.lanes=o,Cc(s,o)}}function ph(s,e){var o=s.updateQueue,a=s.alternate;if(a!==null&&(a=a.updateQueue,o===a)){var c=null,d=null;if(o=o.firstBaseUpdate,o!==null){do{var h={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};d===null?c=d=h:d=d.next=h,o=o.next}while(o!==null);d===null?c=d=e:d=d.next=e}else c=d=e;o={baseState:a.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:a.shared,effects:a.effects},s.updateQueue=o;return}s=o.lastBaseUpdate,s===null?o.firstBaseUpdate=e:s.next=e,o.lastBaseUpdate=e}function qh(s,e,o,a){var c=s.updateQueue;jh=!1;var d=c.firstBaseUpdate,h=c.lastBaseUpdate,g=c.shared.pending;if(g!==null){c.shared.pending=null;var b=g,j=b.next;b.next=null,h===null?d=j:h.next=j,h=b;var $=s.alternate;$!==null&&($=$.updateQueue,g=$.lastBaseUpdate,g!==h&&(g===null?$.firstBaseUpdate=j:g.next=j,$.lastBaseUpdate=b))}if(d!==null){var _=c.baseState;h=0,$=j=b=null,g=d;do{var _e=g.lane,et=g.eventTime;if((a&_e)===_e){$!==null&&($=$.next={eventTime:et,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var nt=s,rt=g;switch(_e=e,et=o,rt.tag){case 1:if(nt=rt.payload,typeof nt=="function"){_=nt.call(et,_,_e);break e}_=nt;break e;case 3:nt.flags=nt.flags&-65537|128;case 0:if(nt=rt.payload,_e=typeof nt=="function"?nt.call(et,_,_e):nt,_e==null)break e;_=A({},_,_e);break e;case 2:jh=!0}}g.callback!==null&&g.lane!==0&&(s.flags|=64,_e=c.effects,_e===null?c.effects=[g]:_e.push(g))}else et={eventTime:et,lane:_e,tag:g.tag,payload:g.payload,callback:g.callback,next:null},$===null?(j=$=et,b=_):$=$.next=et,h|=_e;if(g=g.next,g===null){if(g=c.shared.pending,g===null)break;_e=g,g=_e.next,_e.next=null,c.lastBaseUpdate=_e,c.shared.pending=null}}while(!0);if($===null&&(b=_),c.baseState=b,c.firstBaseUpdate=j,c.lastBaseUpdate=$,e=c.shared.interleaved,e!==null){c=e;do h|=c.lane,c=c.next;while(c!==e)}else d===null&&(c.shared.lanes=0);rh|=h,s.lanes=h,s.memoizedState=_}}function sh(s,e,o){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var a=s[e],c=a.callback;if(c!==null){if(a.callback=null,a=o,typeof c!="function")throw Error(p(191,c));c.call(a)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(s){if(s===th)throw Error(p(174));return s}function yh(s,e){switch(G(wh,e),G(vh,s),G(uh,th),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=lb(e,s)}E(uh),G(uh,e)}function zh(){E(uh),E(vh),E(wh)}function Ah(s){xh(wh.current);var e=xh(uh.current),o=lb(e,s.type);e!==o&&(G(vh,s),G(uh,o))}function Bh(s){vh.current===s&&(E(uh),E(vh))}var L=Uf(0);function Ch(s){for(var e=s;e!==null;){if(e.tag===13){var o=e.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Dh=[];function Eh(){for(var s=0;s<Dh.length;s++)Dh[s]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(s,e){if(e===null)return!1;for(var o=0;o<e.length&&o<s.length;o++)if(!He(s[o],e[o]))return!1;return!0}function Nh(s,e,o,a,c,d){if(Hh=d,M=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Fh.current=s===null||s.memoizedState===null?Oh:Ph,s=o(a,c),Jh){d=0;do{if(Jh=!1,Kh=0,25<=d)throw Error(p(301));d+=1,O=N=null,e.updateQueue=null,Fh.current=Qh,s=o(a,c)}while(Jh)}if(Fh.current=Rh,e=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,e)throw Error(p(300));return s}function Sh(){var s=Kh!==0;return Kh=0,s}function Th(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=s:O=O.next=s,O}function Uh(){if(N===null){var s=M.alternate;s=s!==null?s.memoizedState:null}else s=N.next;var e=O===null?M.memoizedState:O.next;if(e!==null)O=e,N=s;else{if(s===null)throw Error(p(310));N=s,s={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=s:O=O.next=s}return O}function Vh(s,e){return typeof e=="function"?e(s):e}function Wh(s){var e=Uh(),o=e.queue;if(o===null)throw Error(p(311));o.lastRenderedReducer=s;var a=N,c=a.baseQueue,d=o.pending;if(d!==null){if(c!==null){var h=c.next;c.next=d.next,d.next=h}a.baseQueue=c=d,o.pending=null}if(c!==null){d=c.next,a=a.baseState;var g=h=null,b=null,j=d;do{var $=j.lane;if((Hh&$)===$)b!==null&&(b=b.next={lane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),a=j.hasEagerState?j.eagerState:s(a,j.action);else{var _={lane:$,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null};b===null?(g=b=_,h=a):b=b.next=_,M.lanes|=$,rh|=$}j=j.next}while(j!==null&&j!==d);b===null?h=a:b.next=g,He(a,e.memoizedState)||(dh=!0),e.memoizedState=a,e.baseState=h,e.baseQueue=b,o.lastRenderedState=a}if(s=o.interleaved,s!==null){c=s;do d=c.lane,M.lanes|=d,rh|=d,c=c.next;while(c!==s)}else c===null&&(o.lanes=0);return[e.memoizedState,o.dispatch]}function Xh(s){var e=Uh(),o=e.queue;if(o===null)throw Error(p(311));o.lastRenderedReducer=s;var a=o.dispatch,c=o.pending,d=e.memoizedState;if(c!==null){o.pending=null;var h=c=c.next;do d=s(d,h.action),h=h.next;while(h!==c);He(d,e.memoizedState)||(dh=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),o.lastRenderedState=d}return[d,a]}function Yh(){}function Zh(s,e){var o=M,a=Uh(),c=e(),d=!He(a.memoizedState,c);if(d&&(a.memoizedState=c,dh=!0),a=a.queue,$h(ai.bind(null,o,a,s),[s]),a.getSnapshot!==e||d||O!==null&&O.memoizedState.tag&1){if(o.flags|=2048,bi(9,ci.bind(null,o,a,c,e),void 0,null),Q===null)throw Error(p(349));Hh&30||di(o,e,c)}return c}function di(s,e,o){s.flags|=16384,s={getSnapshot:e,value:o},e=M.updateQueue,e===null?(e={lastEffect:null,stores:null},M.updateQueue=e,e.stores=[s]):(o=e.stores,o===null?e.stores=[s]:o.push(s))}function ci(s,e,o,a){e.value=o,e.getSnapshot=a,ei(e)&&fi(s)}function ai(s,e,o){return o(function(){ei(e)&&fi(s)})}function ei(s){var e=s.getSnapshot;s=s.value;try{var o=e();return!He(s,o)}catch{return!0}}function fi(s){var e=ih(s,1);e!==null&&gi(e,s,1,-1)}function hi(s){var e=Th();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:s},e.queue=s,s=s.dispatch=ii.bind(null,M,s),[e.memoizedState,s]}function bi(s,e,o,a){return s={tag:s,create:e,destroy:o,deps:a,next:null},e=M.updateQueue,e===null?(e={lastEffect:null,stores:null},M.updateQueue=e,e.lastEffect=s.next=s):(o=e.lastEffect,o===null?e.lastEffect=s.next=s:(a=o.next,o.next=s,s.next=a,e.lastEffect=s)),s}function ji(){return Uh().memoizedState}function ki(s,e,o,a){var c=Th();M.flags|=s,c.memoizedState=bi(1|e,o,void 0,a===void 0?null:a)}function li(s,e,o,a){var c=Uh();a=a===void 0?null:a;var d=void 0;if(N!==null){var h=N.memoizedState;if(d=h.destroy,a!==null&&Mh(a,h.deps)){c.memoizedState=bi(e,o,d,a);return}}M.flags|=s,c.memoizedState=bi(1|e,o,d,a)}function mi(s,e){return ki(8390656,8,s,e)}function $h(s,e){return li(2048,8,s,e)}function ni(s,e){return li(4,2,s,e)}function oi(s,e){return li(4,4,s,e)}function pi(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function qi(s,e,o){return o=o!=null?o.concat([s]):null,li(4,4,pi.bind(null,e,s),o)}function ri(){}function si(s,e){var o=Uh();e=e===void 0?null:e;var a=o.memoizedState;return a!==null&&e!==null&&Mh(e,a[1])?a[0]:(o.memoizedState=[s,e],s)}function ti(s,e){var o=Uh();e=e===void 0?null:e;var a=o.memoizedState;return a!==null&&e!==null&&Mh(e,a[1])?a[0]:(s=s(),o.memoizedState=[s,e],s)}function ui(s,e,o){return Hh&21?(He(o,e)||(o=yc(),M.lanes|=o,rh|=o,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,dh=!0),s.memoizedState=o)}function vi(s,e){var o=C$1;C$1=o!==0&&4>o?o:4,s(!0);var a=Gh.transition;Gh.transition={};try{s(!1),e()}finally{C$1=o,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(s,e,o){var a=yi(s);if(o={lane:a,action:o,hasEagerState:!1,eagerState:null,next:null},zi(s))Ai(e,o);else if(o=hh(s,e,o,a),o!==null){var c=R();gi(o,s,a,c),Bi(o,e,a)}}function ii(s,e,o){var a=yi(s),c={lane:a,action:o,hasEagerState:!1,eagerState:null,next:null};if(zi(s))Ai(e,c);else{var d=s.alternate;if(s.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var h=e.lastRenderedState,g=d(h,o);if(c.hasEagerState=!0,c.eagerState=g,He(g,h)){var b=e.interleaved;b===null?(c.next=c,gh(e)):(c.next=b.next,b.next=c),e.interleaved=c;return}}catch{}finally{}o=hh(s,e,c,a),o!==null&&(c=R(),gi(o,s,a,c),Bi(o,e,a))}}function zi(s){var e=s.alternate;return s===M||e!==null&&e===M}function Ai(s,e){Jh=Ih=!0;var o=s.pending;o===null?e.next=e:(e.next=o.next,o.next=e),s.pending=e}function Bi(s,e,o){if(o&4194240){var a=e.lanes;a&=s.pendingLanes,o|=a,e.lanes=o,Cc(s,o)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(s,e){return Th().memoizedState=[s,e===void 0?null:e],s},useContext:eh,useEffect:mi,useImperativeHandle:function(s,e,o){return o=o!=null?o.concat([s]):null,ki(4194308,4,pi.bind(null,e,s),o)},useLayoutEffect:function(s,e){return ki(4194308,4,s,e)},useInsertionEffect:function(s,e){return ki(4,2,s,e)},useMemo:function(s,e){var o=Th();return e=e===void 0?null:e,s=s(),o.memoizedState=[s,e],s},useReducer:function(s,e,o){var a=Th();return e=o!==void 0?o(e):e,a.memoizedState=a.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},a.queue=s,s=s.dispatch=xi.bind(null,M,s),[a.memoizedState,s]},useRef:function(s){var e=Th();return s={current:s},e.memoizedState=s},useState:hi,useDebugValue:ri,useDeferredValue:function(s){return Th().memoizedState=s},useTransition:function(){var s=hi(!1),e=s[0];return s=vi.bind(null,s[1]),Th().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,o){var a=M,c=Th();if(I){if(o===void 0)throw Error(p(407));o=o()}else{if(o=e(),Q===null)throw Error(p(349));Hh&30||di(a,e,o)}c.memoizedState=o;var d={value:o,getSnapshot:e};return c.queue=d,mi(ai.bind(null,a,d,s),[s]),a.flags|=2048,bi(9,ci.bind(null,a,d,o,e),void 0,null),o},useId:function(){var s=Th(),e=Q.identifierPrefix;if(I){var o=sg,a=rg;o=(a&~(1<<32-oc(a)-1)).toString(32)+o,e=":"+e+"R"+o,o=Kh++,0<o&&(e+="H"+o.toString(32)),e+=":"}else o=Lh++,e=":"+e+"r"+o.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(s){var e=Uh();return ui(e,N.memoizedState,s)},useTransition:function(){var s=Wh(Vh)[0],e=Uh().memoizedState;return[s,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(s){var e=Uh();return N===null?e.memoizedState=s:ui(e,N.memoizedState,s)},useTransition:function(){var s=Xh(Vh)[0],e=Uh().memoizedState;return[s,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(s,e){if(s&&s.defaultProps){e=A({},e),s=s.defaultProps;for(var o in s)e[o]===void 0&&(e[o]=s[o]);return e}return e}function Di(s,e,o,a){e=s.memoizedState,o=o(a,e),o=o==null?e:A({},e,o),s.memoizedState=o,s.lanes===0&&(s.updateQueue.baseState=o)}var Ei={isMounted:function(s){return(s=s._reactInternals)?Vb(s)===s:!1},enqueueSetState:function(s,e,o){s=s._reactInternals;var a=R(),c=yi(s),d=mh(a,c);d.payload=e,o!=null&&(d.callback=o),e=nh(s,d,c),e!==null&&(gi(e,s,c,a),oh(e,s,c))},enqueueReplaceState:function(s,e,o){s=s._reactInternals;var a=R(),c=yi(s),d=mh(a,c);d.tag=1,d.payload=e,o!=null&&(d.callback=o),e=nh(s,d,c),e!==null&&(gi(e,s,c,a),oh(e,s,c))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var o=R(),a=yi(s),c=mh(o,a);c.tag=2,e!=null&&(c.callback=e),e=nh(s,c,a),e!==null&&(gi(e,s,a,o),oh(e,s,a))}};function Fi(s,e,o,a,c,d,h){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(a,d,h):e.prototype&&e.prototype.isPureReactComponent?!Ie(o,a)||!Ie(c,d):!0}function Gi(s,e,o){var a=!1,c=Vf,d=e.contextType;return typeof d=="object"&&d!==null?d=eh(d):(c=Zf(e)?Xf:H.current,a=e.contextTypes,d=(a=a!=null)?Yf(s,c):Vf),e=new e(o,d),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ei,s.stateNode=e,e._reactInternals=s,a&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=c,s.__reactInternalMemoizedMaskedChildContext=d),e}function Hi(s,e,o,a){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(o,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(o,a),e.state!==s&&Ei.enqueueReplaceState(e,e.state,null)}function Ii(s,e,o,a){var c=s.stateNode;c.props=o,c.state=s.memoizedState,c.refs={},kh(s);var d=e.contextType;typeof d=="object"&&d!==null?c.context=eh(d):(d=Zf(e)?Xf:H.current,c.context=Yf(s,d)),c.state=s.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(Di(s,e,d,o),c.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&Ei.enqueueReplaceState(c,c.state,null),qh(s,o,c,a),c.state=s.memoizedState),typeof c.componentDidMount=="function"&&(s.flags|=4194308)}function Ji(s,e){try{var o="",a=e;do o+=Pa(a),a=a.return;while(a);var c=o}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:s,source:e,stack:c,digest:null}}function Ki(s,e,o){return{value:s,source:null,stack:o??null,digest:e??null}}function Li(s,e){try{console.error(e.value)}catch(o){setTimeout(function(){throw o})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(s,e,o){o=mh(-1,o),o.tag=3,o.payload={element:null};var a=e.value;return o.callback=function(){Oi||(Oi=!0,Pi=a),Li(s,e)},o}function Qi(s,e,o){o=mh(-1,o),o.tag=3;var a=s.type.getDerivedStateFromError;if(typeof a=="function"){var c=e.value;o.payload=function(){return a(c)},o.callback=function(){Li(s,e)}}var d=s.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(o.callback=function(){Li(s,e),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),o}function Si(s,e,o){var a=s.pingCache;if(a===null){a=s.pingCache=new Mi;var c=new Set;a.set(e,c)}else c=a.get(e),c===void 0&&(c=new Set,a.set(e,c));c.has(o)||(c.add(o),s=Ti.bind(null,s,e,o),e.then(s,s))}function Ui(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function Vi(s,e,o,a,c){return s.mode&1?(s.flags|=65536,s.lanes=c,s):(s===e?s.flags|=65536:(s.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(e=mh(-1,1),e.tag=2,nh(o,e,1))),o.lanes|=1),s)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(s,e,o,a){e.child=s===null?Vg(e,null,o,a):Ug(e,s.child,o,a)}function Yi(s,e,o,a,c){o=o.render;var d=e.ref;return ch(e,c),a=Nh(s,e,o,a,d,c),o=Sh(),s!==null&&!dh?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~c,Zi(s,e,c)):(I&&o&&vg(e),e.flags|=1,Xi(s,e,a,c),e.child)}function $i(s,e,o,a,c){if(s===null){var d=o.type;return typeof d=="function"&&!aj(d)&&d.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(e.tag=15,e.type=d,bj(s,e,d,a,c)):(s=Rg(o.type,null,a,e,e.mode,c),s.ref=e.ref,s.return=e,e.child=s)}if(d=s.child,!(s.lanes&c)){var h=d.memoizedProps;if(o=o.compare,o=o!==null?o:Ie,o(h,a)&&s.ref===e.ref)return Zi(s,e,c)}return e.flags|=1,s=Pg(d,a),s.ref=e.ref,s.return=e,e.child=s}function bj(s,e,o,a,c){if(s!==null){var d=s.memoizedProps;if(Ie(d,a)&&s.ref===e.ref)if(dh=!1,e.pendingProps=a=d,(s.lanes&c)!==0)s.flags&131072&&(dh=!0);else return e.lanes=s.lanes,Zi(s,e,c)}return cj(s,e,o,a,c)}function dj(s,e,o){var a=e.pendingProps,c=a.children,d=s!==null?s.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=o;else{if(!(o&1073741824))return s=d!==null?d.baseLanes|o:o,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,G(ej,fj),fj|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=d!==null?d.baseLanes:o,G(ej,fj),fj|=a}else d!==null?(a=d.baseLanes|o,e.memoizedState=null):a=o,G(ej,fj),fj|=a;return Xi(s,e,c,o),e.child}function gj(s,e){var o=e.ref;(s===null&&o!==null||s!==null&&s.ref!==o)&&(e.flags|=512,e.flags|=2097152)}function cj(s,e,o,a,c){var d=Zf(o)?Xf:H.current;return d=Yf(e,d),ch(e,c),o=Nh(s,e,o,a,d,c),a=Sh(),s!==null&&!dh?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~c,Zi(s,e,c)):(I&&a&&vg(e),e.flags|=1,Xi(s,e,o,c),e.child)}function hj(s,e,o,a,c){if(Zf(o)){var d=!0;cg(e)}else d=!1;if(ch(e,c),e.stateNode===null)ij(s,e),Gi(e,o,a),Ii(e,o,a,c),a=!0;else if(s===null){var h=e.stateNode,g=e.memoizedProps;h.props=g;var b=h.context,j=o.contextType;typeof j=="object"&&j!==null?j=eh(j):(j=Zf(o)?Xf:H.current,j=Yf(e,j));var $=o.getDerivedStateFromProps,_=typeof $=="function"||typeof h.getSnapshotBeforeUpdate=="function";_||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(g!==a||b!==j)&&Hi(e,h,a,j),jh=!1;var _e=e.memoizedState;h.state=_e,qh(e,a,h,c),b=e.memoizedState,g!==a||_e!==b||Wf.current||jh?(typeof $=="function"&&(Di(e,o,$,a),b=e.memoizedState),(g=jh||Fi(e,o,g,a,_e,b,j))?(_||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=b),h.props=a,h.state=b,h.context=j,a=g):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{h=e.stateNode,lh(s,e),g=e.memoizedProps,j=e.type===e.elementType?g:Ci(e.type,g),h.props=j,_=e.pendingProps,_e=h.context,b=o.contextType,typeof b=="object"&&b!==null?b=eh(b):(b=Zf(o)?Xf:H.current,b=Yf(e,b));var et=o.getDerivedStateFromProps;($=typeof et=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(g!==_||_e!==b)&&Hi(e,h,a,b),jh=!1,_e=e.memoizedState,h.state=_e,qh(e,a,h,c);var nt=e.memoizedState;g!==_||_e!==nt||Wf.current||jh?(typeof et=="function"&&(Di(e,o,et,a),nt=e.memoizedState),(j=jh||Fi(e,o,j,a,_e,nt,b)||!1)?($||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(a,nt,b),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(a,nt,b)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||g===s.memoizedProps&&_e===s.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||g===s.memoizedProps&&_e===s.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=nt),h.props=a,h.state=nt,h.context=b,a=j):(typeof h.componentDidUpdate!="function"||g===s.memoizedProps&&_e===s.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||g===s.memoizedProps&&_e===s.memoizedState||(e.flags|=1024),a=!1)}return jj(s,e,o,a,d,c)}function jj(s,e,o,a,c,d){gj(s,e);var h=(e.flags&128)!==0;if(!a&&!h)return c&&dg(e,o,!1),Zi(s,e,d);a=e.stateNode,Wi.current=e;var g=h&&typeof o.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,s!==null&&h?(e.child=Ug(e,s.child,null,d),e.child=Ug(e,null,g,d)):Xi(s,e,g,d),e.memoizedState=a.state,c&&dg(e,o,!0),e.child}function kj(s){var e=s.stateNode;e.pendingContext?ag(s,e.pendingContext,e.pendingContext!==e.context):e.context&&ag(s,e.context,!1),yh(s,e.containerInfo)}function lj(s,e,o,a,c){return Ig(),Jg(c),e.flags|=256,Xi(s,e,o,a),e.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(s){return{baseLanes:s,cachePool:null,transitions:null}}function oj(s,e,o){var a=e.pendingProps,c=L.current,d=!1,h=(e.flags&128)!==0,g;if((g=h)||(g=s!==null&&s.memoizedState===null?!1:(c&2)!==0),g?(d=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(c|=1),G(L,c&1),s===null)return Eg(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=a.children,s=a.fallback,d?(a=e.mode,d=e.child,h={mode:"hidden",children:h},!(a&1)&&d!==null?(d.childLanes=0,d.pendingProps=h):d=pj(h,a,0,null),s=Tg(s,a,o,null),d.return=e,s.return=e,d.sibling=s,e.child=d,e.child.memoizedState=nj(o),e.memoizedState=mj,s):qj(e,h));if(c=s.memoizedState,c!==null&&(g=c.dehydrated,g!==null))return rj(s,e,h,a,g,c,o);if(d){d=a.fallback,h=e.mode,c=s.child,g=c.sibling;var b={mode:"hidden",children:a.children};return!(h&1)&&e.child!==c?(a=e.child,a.childLanes=0,a.pendingProps=b,e.deletions=null):(a=Pg(c,b),a.subtreeFlags=c.subtreeFlags&14680064),g!==null?d=Pg(g,d):(d=Tg(d,h,o,null),d.flags|=2),d.return=e,a.return=e,a.sibling=d,e.child=a,a=d,d=e.child,h=s.child.memoizedState,h=h===null?nj(o):{baseLanes:h.baseLanes|o,cachePool:null,transitions:h.transitions},d.memoizedState=h,d.childLanes=s.childLanes&~o,e.memoizedState=mj,a}return d=s.child,s=d.sibling,a=Pg(d,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=o),a.return=e,a.sibling=null,s!==null&&(o=e.deletions,o===null?(e.deletions=[s],e.flags|=16):o.push(s)),e.child=a,e.memoizedState=null,a}function qj(s,e){return e=pj({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function sj(s,e,o,a){return a!==null&&Jg(a),Ug(e,s.child,null,o),s=qj(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function rj(s,e,o,a,c,d,h){if(o)return e.flags&256?(e.flags&=-257,a=Ki(Error(p(422))),sj(s,e,h,a)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(d=a.fallback,c=e.mode,a=pj({mode:"visible",children:a.children},c,0,null),d=Tg(d,c,h,null),d.flags|=2,a.return=e,d.return=e,a.sibling=d,e.child=a,e.mode&1&&Ug(e,s.child,null,h),e.child.memoizedState=nj(h),e.memoizedState=mj,d);if(!(e.mode&1))return sj(s,e,h,null);if(c.data==="$!"){if(a=c.nextSibling&&c.nextSibling.dataset,a)var g=a.dgst;return a=g,d=Error(p(419)),a=Ki(d,a,void 0),sj(s,e,h,a)}if(g=(h&s.childLanes)!==0,dh||g){if(a=Q,a!==null){switch(h&-h){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(a.suspendedLanes|h)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,ih(s,c),gi(a,s,c,-1))}return tj(),a=Ki(Error(p(421))),sj(s,e,h,a)}return c.data==="$?"?(e.flags|=128,e.child=s.child,e=uj.bind(null,s),c._reactRetry=e,null):(s=d.treeContext,yg=Lf(c.nextSibling),xg=e,I=!0,zg=null,s!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=s.id,sg=s.overflow,qg=e),e=qj(e,a.children),e.flags|=4096,e)}function vj(s,e,o){s.lanes|=e;var a=s.alternate;a!==null&&(a.lanes|=e),bh(s.return,e,o)}function wj(s,e,o,a,c){var d=s.memoizedState;d===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:o,tailMode:c}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=a,d.tail=o,d.tailMode=c)}function xj(s,e,o){var a=e.pendingProps,c=a.revealOrder,d=a.tail;if(Xi(s,e,a.children,o),a=L.current,a&2)a=a&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&vj(s,o,e);else if(s.tag===19)vj(s,o,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}a&=1}if(G(L,a),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(o=e.child,c=null;o!==null;)s=o.alternate,s!==null&&Ch(s)===null&&(c=o),o=o.sibling;o=c,o===null?(c=e.child,e.child=null):(c=o.sibling,o.sibling=null),wj(e,!1,c,o,d);break;case"backwards":for(o=null,c=e.child,e.child=null;c!==null;){if(s=c.alternate,s!==null&&Ch(s)===null){e.child=c;break}s=c.sibling,c.sibling=o,o=c,c=s}wj(e,!0,o,null,d);break;case"together":wj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ij(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Zi(s,e,o){if(s!==null&&(e.dependencies=s.dependencies),rh|=e.lanes,!(o&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(p(153));if(e.child!==null){for(s=e.child,o=Pg(s,s.pendingProps),e.child=o,o.return=e;s.sibling!==null;)s=s.sibling,o=o.sibling=Pg(s,s.pendingProps),o.return=e;o.sibling=null}return e.child}function yj(s,e,o){switch(e.tag){case 3:kj(e),Ig();break;case 5:Ah(e);break;case 1:Zf(e.type)&&cg(e);break;case 4:yh(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,c=e.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=c;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(G(L,L.current&1),e.flags|=128,null):o&e.child.childLanes?oj(s,e,o):(G(L,L.current&1),s=Zi(s,e,o),s!==null?s.sibling:null);G(L,L.current&1);break;case 19:if(a=(o&e.childLanes)!==0,s.flags&128){if(a)return xj(s,e,o);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),G(L,L.current),a)break;return null;case 22:case 23:return e.lanes=0,dj(s,e,o)}return Zi(s,e,o)}var zj,Aj,Bj,Cj;zj=function(s,e){for(var o=e.child;o!==null;){if(o.tag===5||o.tag===6)s.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===e)break;for(;o.sibling===null;){if(o.return===null||o.return===e)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Aj=function(){};Bj=function(s,e,o,a){var c=s.memoizedProps;if(c!==a){s=e.stateNode,xh(uh.current);var d=null;switch(o){case"input":c=Ya(s,c),a=Ya(s,a),d=[];break;case"select":c=A({},c,{value:void 0}),a=A({},a,{value:void 0}),d=[];break;case"textarea":c=gb(s,c),a=gb(s,a),d=[];break;default:typeof c.onClick!="function"&&typeof a.onClick=="function"&&(s.onclick=Bf)}ub(o,a);var h;o=null;for(j in c)if(!a.hasOwnProperty(j)&&c.hasOwnProperty(j)&&c[j]!=null)if(j==="style"){var g=c[j];for(h in g)g.hasOwnProperty(h)&&(o||(o={}),o[h]="")}else j!=="dangerouslySetInnerHTML"&&j!=="children"&&j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(ea.hasOwnProperty(j)?d||(d=[]):(d=d||[]).push(j,null));for(j in a){var b=a[j];if(g=c!=null?c[j]:void 0,a.hasOwnProperty(j)&&b!==g&&(b!=null||g!=null))if(j==="style")if(g){for(h in g)!g.hasOwnProperty(h)||b&&b.hasOwnProperty(h)||(o||(o={}),o[h]="");for(h in b)b.hasOwnProperty(h)&&g[h]!==b[h]&&(o||(o={}),o[h]=b[h])}else o||(d||(d=[]),d.push(j,o)),o=b;else j==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,g=g?g.__html:void 0,b!=null&&g!==b&&(d=d||[]).push(j,b)):j==="children"?typeof b!="string"&&typeof b!="number"||(d=d||[]).push(j,""+b):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&(ea.hasOwnProperty(j)?(b!=null&&j==="onScroll"&&D("scroll",s),d||g===b||(d=[])):(d=d||[]).push(j,b))}o&&(d=d||[]).push("style",o);var j=d;(e.updateQueue=j)&&(e.flags|=4)}};Cj=function(s,e,o,a){o!==a&&(e.flags|=4)};function Dj(s,e){if(!I)switch(s.tailMode){case"hidden":e=s.tail;for(var o=null;e!==null;)e.alternate!==null&&(o=e),e=e.sibling;o===null?s.tail=null:o.sibling=null;break;case"collapsed":o=s.tail;for(var a=null;o!==null;)o.alternate!==null&&(a=o),o=o.sibling;a===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:a.sibling=null}}function S(s){var e=s.alternate!==null&&s.alternate.child===s.child,o=0,a=0;if(e)for(var c=s.child;c!==null;)o|=c.lanes|c.childLanes,a|=c.subtreeFlags&14680064,a|=c.flags&14680064,c.return=s,c=c.sibling;else for(c=s.child;c!==null;)o|=c.lanes|c.childLanes,a|=c.subtreeFlags,a|=c.flags,c.return=s,c=c.sibling;return s.subtreeFlags|=a,s.childLanes=o,e}function Ej(s,e,o){var a=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(e),null;case 1:return Zf(e.type)&&$f(),S(e),null;case 3:return a=e.stateNode,zh(),E(Wf),E(H),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(s===null||s.child===null)&&(Gg(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(s,e),S(e),null;case 5:Bh(e);var c=xh(wh.current);if(o=e.type,s!==null&&e.stateNode!=null)Bj(s,e,o,a,c),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(p(166));return S(e),null}if(s=xh(uh.current),Gg(e)){a=e.stateNode,o=e.type;var d=e.memoizedProps;switch(a[Of]=e,a[Pf]=d,s=(e.mode&1)!==0,o){case"dialog":D("cancel",a),D("close",a);break;case"iframe":case"object":case"embed":D("load",a);break;case"video":case"audio":for(c=0;c<lf.length;c++)D(lf[c],a);break;case"source":D("error",a);break;case"img":case"image":case"link":D("error",a),D("load",a);break;case"details":D("toggle",a);break;case"input":Za(a,d),D("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},D("invalid",a);break;case"textarea":hb(a,d),D("invalid",a)}ub(o,d),c=null;for(var h in d)if(d.hasOwnProperty(h)){var g=d[h];h==="children"?typeof g=="string"?a.textContent!==g&&(d.suppressHydrationWarning!==!0&&Af(a.textContent,g,s),c=["children",g]):typeof g=="number"&&a.textContent!==""+g&&(d.suppressHydrationWarning!==!0&&Af(a.textContent,g,s),c=["children",""+g]):ea.hasOwnProperty(h)&&g!=null&&h==="onScroll"&&D("scroll",a)}switch(o){case"input":Va(a),db(a,d,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(a.onclick=Bf)}a=c,e.updateQueue=a,a!==null&&(e.flags|=4)}else{h=c.nodeType===9?c:c.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=kb(o)),s==="http://www.w3.org/1999/xhtml"?o==="script"?(s=h.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof a.is=="string"?s=h.createElement(o,{is:a.is}):(s=h.createElement(o),o==="select"&&(h=s,a.multiple?h.multiple=!0:a.size&&(h.size=a.size))):s=h.createElementNS(s,o),s[Of]=e,s[Pf]=a,zj(s,e,!1,!1),e.stateNode=s;e:{switch(h=vb(o,a),o){case"dialog":D("cancel",s),D("close",s),c=a;break;case"iframe":case"object":case"embed":D("load",s),c=a;break;case"video":case"audio":for(c=0;c<lf.length;c++)D(lf[c],s);c=a;break;case"source":D("error",s),c=a;break;case"img":case"image":case"link":D("error",s),D("load",s),c=a;break;case"details":D("toggle",s),c=a;break;case"input":Za(s,a),c=Ya(s,a),D("invalid",s);break;case"option":c=a;break;case"select":s._wrapperState={wasMultiple:!!a.multiple},c=A({},a,{value:void 0}),D("invalid",s);break;case"textarea":hb(s,a),c=gb(s,a),D("invalid",s);break;default:c=a}ub(o,c),g=c;for(d in g)if(g.hasOwnProperty(d)){var b=g[d];d==="style"?sb(s,b):d==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&nb(s,b)):d==="children"?typeof b=="string"?(o!=="textarea"||b!=="")&&ob(s,b):typeof b=="number"&&ob(s,""+b):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ea.hasOwnProperty(d)?b!=null&&d==="onScroll"&&D("scroll",s):b!=null&&ta$1(s,d,b,h))}switch(o){case"input":Va(s),db(s,a,!1);break;case"textarea":Va(s),jb(s);break;case"option":a.value!=null&&s.setAttribute("value",""+Sa(a.value));break;case"select":s.multiple=!!a.multiple,d=a.value,d!=null?fb(s,!!a.multiple,d,!1):a.defaultValue!=null&&fb(s,!!a.multiple,a.defaultValue,!0);break;default:typeof c.onClick=="function"&&(s.onclick=Bf)}switch(o){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S(e),null;case 6:if(s&&e.stateNode!=null)Cj(s,e,s.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(p(166));if(o=xh(wh.current),xh(uh.current),Gg(e)){if(a=e.stateNode,o=e.memoizedProps,a[Of]=e,(d=a.nodeValue!==o)&&(s=xg,s!==null))switch(s.tag){case 3:Af(a.nodeValue,o,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,o,(s.mode&1)!==0)}d&&(e.flags|=4)}else a=(o.nodeType===9?o:o.ownerDocument).createTextNode(a),a[Of]=e,e.stateNode=a}return S(e),null;case 13:if(E(L),a=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(I&&yg!==null&&e.mode&1&&!(e.flags&128))Hg(),Ig(),e.flags|=98560,d=!1;else if(d=Gg(e),a!==null&&a.dehydrated!==null){if(s===null){if(!d)throw Error(p(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(p(317));d[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S(e),d=!1}else zg!==null&&(Fj(zg),zg=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=o,e):(a=a!==null,a!==(s!==null&&s.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(s===null||L.current&1?T===0&&(T=3):tj())),e.updateQueue!==null&&(e.flags|=4),S(e),null);case 4:return zh(),Aj(s,e),s===null&&sf(e.stateNode.containerInfo),S(e),null;case 10:return ah(e.type._context),S(e),null;case 17:return Zf(e.type)&&$f(),S(e),null;case 19:if(E(L),d=e.memoizedState,d===null)return S(e),null;if(a=(e.flags&128)!==0,h=d.rendering,h===null)if(a)Dj(d,!1);else{if(T!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(h=Ch(s),h!==null){for(e.flags|=128,Dj(d,!1),a=h.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=o,o=e.child;o!==null;)d=o,s=a,d.flags&=14680066,h=d.alternate,h===null?(d.childLanes=0,d.lanes=s,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=h.childLanes,d.lanes=h.lanes,d.child=h.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=h.memoizedProps,d.memoizedState=h.memoizedState,d.updateQueue=h.updateQueue,d.type=h.type,s=h.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),o=o.sibling;return G(L,L.current&1|2),e.child}s=s.sibling}d.tail!==null&&B()>Gj&&(e.flags|=128,a=!0,Dj(d,!1),e.lanes=4194304)}else{if(!a)if(s=Ch(h),s!==null){if(e.flags|=128,a=!0,o=s.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),Dj(d,!0),d.tail===null&&d.tailMode==="hidden"&&!h.alternate&&!I)return S(e),null}else 2*B()-d.renderingStartTime>Gj&&o!==1073741824&&(e.flags|=128,a=!0,Dj(d,!1),e.lanes=4194304);d.isBackwards?(h.sibling=e.child,e.child=h):(o=d.last,o!==null?o.sibling=h:e.child=h,d.last=h)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=B(),e.sibling=null,o=L.current,G(L,a?o&1|2:o&1),e):(S(e),null);case 22:case 23:return Hj(),a=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?fj&1073741824&&(S(e),e.subtreeFlags&6&&(e.flags|=8192)):S(e),null;case 24:return null;case 25:return null}throw Error(p(156,e.tag))}function Ij(s,e){switch(wg(e),e.tag){case 1:return Zf(e.type)&&$f(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return zh(),E(Wf),E(H),Eh(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return Bh(e),null;case 13:if(E(L),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(p(340));Ig()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(e.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(s,e){var o=s.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(a){W(s,e,a)}else o.current=null}function Mj(s,e,o){try{o()}catch(a){W(s,e,a)}}var Nj=!1;function Oj(s,e){if(Cf=dd,s=Me(),Ne(s)){if("selectionStart"in s)var o={start:s.selectionStart,end:s.selectionEnd};else e:{o=(o=s.ownerDocument)&&o.defaultView||window;var a=o.getSelection&&o.getSelection();if(a&&a.rangeCount!==0){o=a.anchorNode;var c=a.anchorOffset,d=a.focusNode;a=a.focusOffset;try{o.nodeType,d.nodeType}catch{o=null;break e}var h=0,g=-1,b=-1,j=0,$=0,_=s,_e=null;t:for(;;){for(var et;_!==o||c!==0&&_.nodeType!==3||(g=h+c),_!==d||a!==0&&_.nodeType!==3||(b=h+a),_.nodeType===3&&(h+=_.nodeValue.length),(et=_.firstChild)!==null;)_e=_,_=et;for(;;){if(_===s)break t;if(_e===o&&++j===c&&(g=h),_e===d&&++$===a&&(b=h),(et=_.nextSibling)!==null)break;_=_e,_e=_.parentNode}_=et}o=g===-1||b===-1?null:{start:g,end:b}}else o=null}o=o||{start:0,end:0}}else o=null;for(Df={focusedElem:s,selectionRange:o},dd=!1,V=e;V!==null;)if(e=V,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,V=s;else for(;V!==null;){e=V;try{var nt=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(nt!==null){var rt=nt.memoizedProps,it=nt.memoizedState,st=e.stateNode,lt=st.getSnapshotBeforeUpdate(e.elementType===e.type?rt:Ci(e.type,rt),it);st.__reactInternalSnapshotBeforeUpdate=lt}break;case 3:var ot=e.stateNode.containerInfo;ot.nodeType===1?ot.textContent="":ot.nodeType===9&&ot.documentElement&&ot.removeChild(ot.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(ct){W(e,e.return,ct)}if(s=e.sibling,s!==null){s.return=e.return,V=s;break}V=e.return}return nt=Nj,Nj=!1,nt}function Pj(s,e,o){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var c=a=a.next;do{if((c.tag&s)===s){var d=c.destroy;c.destroy=void 0,d!==void 0&&Mj(e,o,d)}c=c.next}while(c!==a)}}function Qj(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var o=e=e.next;do{if((o.tag&s)===s){var a=o.create;o.destroy=a()}o=o.next}while(o!==e)}}function Rj(s){var e=s.ref;if(e!==null){var o=s.stateNode;switch(s.tag){case 5:s=o;break;default:s=o}typeof e=="function"?e(s):e.current=s}}function Sj(s){var e=s.alternate;e!==null&&(s.alternate=null,Sj(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf],delete e[Rf])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function Tj(s){return s.tag===5||s.tag===3||s.tag===4}function Uj(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Tj(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Vj(s,e,o){var a=s.tag;if(a===5||a===6)s=s.stateNode,e?o.nodeType===8?o.parentNode.insertBefore(s,e):o.insertBefore(s,e):(o.nodeType===8?(e=o.parentNode,e.insertBefore(s,o)):(e=o,e.appendChild(s)),o=o._reactRootContainer,o!=null||e.onclick!==null||(e.onclick=Bf));else if(a!==4&&(s=s.child,s!==null))for(Vj(s,e,o),s=s.sibling;s!==null;)Vj(s,e,o),s=s.sibling}function Wj(s,e,o){var a=s.tag;if(a===5||a===6)s=s.stateNode,e?o.insertBefore(s,e):o.appendChild(s);else if(a!==4&&(s=s.child,s!==null))for(Wj(s,e,o),s=s.sibling;s!==null;)Wj(s,e,o),s=s.sibling}var X$1=null,Xj=!1;function Yj(s,e,o){for(o=o.child;o!==null;)Zj(s,e,o),o=o.sibling}function Zj(s,e,o){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,o)}catch{}switch(o.tag){case 5:U||Lj(o,e);case 6:var a=X$1,c=Xj;X$1=null,Yj(s,e,o),X$1=a,Xj=c,X$1!==null&&(Xj?(s=X$1,o=o.stateNode,s.nodeType===8?s.parentNode.removeChild(o):s.removeChild(o)):X$1.removeChild(o.stateNode));break;case 18:X$1!==null&&(Xj?(s=X$1,o=o.stateNode,s.nodeType===8?Kf(s.parentNode,o):s.nodeType===1&&Kf(s,o),bd(s)):Kf(X$1,o.stateNode));break;case 4:a=X$1,c=Xj,X$1=o.stateNode.containerInfo,Xj=!0,Yj(s,e,o),X$1=a,Xj=c;break;case 0:case 11:case 14:case 15:if(!U&&(a=o.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){c=a=a.next;do{var d=c,h=d.destroy;d=d.tag,h!==void 0&&(d&2||d&4)&&Mj(o,e,h),c=c.next}while(c!==a)}Yj(s,e,o);break;case 1:if(!U&&(Lj(o,e),a=o.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=o.memoizedProps,a.state=o.memoizedState,a.componentWillUnmount()}catch(g){W(o,e,g)}Yj(s,e,o);break;case 21:Yj(s,e,o);break;case 22:o.mode&1?(U=(a=U)||o.memoizedState!==null,Yj(s,e,o),U=a):Yj(s,e,o);break;default:Yj(s,e,o)}}function ak(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var o=s.stateNode;o===null&&(o=s.stateNode=new Kj),e.forEach(function(a){var c=bk.bind(null,s,a);o.has(a)||(o.add(a),a.then(c,c))})}}function ck(s,e){var o=e.deletions;if(o!==null)for(var a=0;a<o.length;a++){var c=o[a];try{var d=s,h=e,g=h;e:for(;g!==null;){switch(g.tag){case 5:X$1=g.stateNode,Xj=!1;break e;case 3:X$1=g.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=g.stateNode.containerInfo,Xj=!0;break e}g=g.return}if(X$1===null)throw Error(p(160));Zj(d,h,c),X$1=null,Xj=!1;var b=c.alternate;b!==null&&(b.return=null),c.return=null}catch(j){W(c,e,j)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)dk(e,s),e=e.sibling}function dk(s,e){var o=s.alternate,a=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(ck(e,s),ek(s),a&4){try{Pj(3,s,s.return),Qj(3,s)}catch(rt){W(s,s.return,rt)}try{Pj(5,s,s.return)}catch(rt){W(s,s.return,rt)}}break;case 1:ck(e,s),ek(s),a&512&&o!==null&&Lj(o,o.return);break;case 5:if(ck(e,s),ek(s),a&512&&o!==null&&Lj(o,o.return),s.flags&32){var c=s.stateNode;try{ob(c,"")}catch(rt){W(s,s.return,rt)}}if(a&4&&(c=s.stateNode,c!=null)){var d=s.memoizedProps,h=o!==null?o.memoizedProps:d,g=s.type,b=s.updateQueue;if(s.updateQueue=null,b!==null)try{g==="input"&&d.type==="radio"&&d.name!=null&&ab(c,d),vb(g,h);var j=vb(g,d);for(h=0;h<b.length;h+=2){var $=b[h],_=b[h+1];$==="style"?sb(c,_):$==="dangerouslySetInnerHTML"?nb(c,_):$==="children"?ob(c,_):ta$1(c,$,_,j)}switch(g){case"input":bb(c,d);break;case"textarea":ib(c,d);break;case"select":var _e=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var et=d.value;et!=null?fb(c,!!d.multiple,et,!1):_e!==!!d.multiple&&(d.defaultValue!=null?fb(c,!!d.multiple,d.defaultValue,!0):fb(c,!!d.multiple,d.multiple?[]:"",!1))}c[Pf]=d}catch(rt){W(s,s.return,rt)}}break;case 6:if(ck(e,s),ek(s),a&4){if(s.stateNode===null)throw Error(p(162));c=s.stateNode,d=s.memoizedProps;try{c.nodeValue=d}catch(rt){W(s,s.return,rt)}}break;case 3:if(ck(e,s),ek(s),a&4&&o!==null&&o.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(rt){W(s,s.return,rt)}break;case 4:ck(e,s),ek(s);break;case 13:ck(e,s),ek(s),c=s.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(fk=B())),a&4&&ak(s);break;case 22:if($=o!==null&&o.memoizedState!==null,s.mode&1?(U=(j=U)||$,ck(e,s),U=j):ck(e,s),ek(s),a&8192){if(j=s.memoizedState!==null,(s.stateNode.isHidden=j)&&!$&&s.mode&1)for(V=s,$=s.child;$!==null;){for(_=V=$;V!==null;){switch(_e=V,et=_e.child,_e.tag){case 0:case 11:case 14:case 15:Pj(4,_e,_e.return);break;case 1:Lj(_e,_e.return);var nt=_e.stateNode;if(typeof nt.componentWillUnmount=="function"){a=_e,o=_e.return;try{e=a,nt.props=e.memoizedProps,nt.state=e.memoizedState,nt.componentWillUnmount()}catch(rt){W(a,o,rt)}}break;case 5:Lj(_e,_e.return);break;case 22:if(_e.memoizedState!==null){gk(_);continue}}et!==null?(et.return=_e,V=et):gk(_)}$=$.sibling}e:for($=null,_=s;;){if(_.tag===5){if($===null){$=_;try{c=_.stateNode,j?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(g=_.stateNode,b=_.memoizedProps.style,h=b!=null&&b.hasOwnProperty("display")?b.display:null,g.style.display=rb("display",h))}catch(rt){W(s,s.return,rt)}}}else if(_.tag===6){if($===null)try{_.stateNode.nodeValue=j?"":_.memoizedProps}catch(rt){W(s,s.return,rt)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===s)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===s)break e;for(;_.sibling===null;){if(_.return===null||_.return===s)break e;$===_&&($=null),_=_.return}$===_&&($=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:ck(e,s),ek(s),a&4&&ak(s);break;case 21:break;default:ck(e,s),ek(s)}}function ek(s){var e=s.flags;if(e&2){try{e:{for(var o=s.return;o!==null;){if(Tj(o)){var a=o;break e}o=o.return}throw Error(p(160))}switch(a.tag){case 5:var c=a.stateNode;a.flags&32&&(ob(c,""),a.flags&=-33);var d=Uj(s);Wj(s,d,c);break;case 3:case 4:var h=a.stateNode.containerInfo,g=Uj(s);Vj(s,g,h);break;default:throw Error(p(161))}}catch(b){W(s,s.return,b)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function hk(s,e,o){V=s,ik(s)}function ik(s,e,o){for(var a=(s.mode&1)!==0;V!==null;){var c=V,d=c.child;if(c.tag===22&&a){var h=c.memoizedState!==null||Jj;if(!h){var g=c.alternate,b=g!==null&&g.memoizedState!==null||U;g=Jj;var j=U;if(Jj=h,(U=b)&&!j)for(V=c;V!==null;)h=V,b=h.child,h.tag===22&&h.memoizedState!==null?jk(c):b!==null?(b.return=h,V=b):jk(c);for(;d!==null;)V=d,ik(d),d=d.sibling;V=c,Jj=g,U=j}kk(s)}else c.subtreeFlags&8772&&d!==null?(d.return=c,V=d):kk(s)}}function kk(s){for(;V!==null;){var e=V;if(e.flags&8772){var o=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U||Qj(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!U)if(o===null)a.componentDidMount();else{var c=e.elementType===e.type?o.memoizedProps:Ci(e.type,o.memoizedProps);a.componentDidUpdate(c,o.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&sh(e,d,a);break;case 3:var h=e.updateQueue;if(h!==null){if(o=null,e.child!==null)switch(e.child.tag){case 5:o=e.child.stateNode;break;case 1:o=e.child.stateNode}sh(e,h,o)}break;case 5:var g=e.stateNode;if(o===null&&e.flags&4){o=g;var b=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&o.focus();break;case"img":b.src&&(o.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var j=e.alternate;if(j!==null){var $=j.memoizedState;if($!==null){var _=$.dehydrated;_!==null&&bd(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||e.flags&512&&Rj(e)}catch(_e){W(e,e.return,_e)}}if(e===s){V=null;break}if(o=e.sibling,o!==null){o.return=e.return,V=o;break}V=e.return}}function gk(s){for(;V!==null;){var e=V;if(e===s){V=null;break}var o=e.sibling;if(o!==null){o.return=e.return,V=o;break}V=e.return}}function jk(s){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var o=e.return;try{Qj(4,e)}catch(b){W(e,o,b)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var c=e.return;try{a.componentDidMount()}catch(b){W(e,c,b)}}var d=e.return;try{Rj(e)}catch(b){W(e,d,b)}break;case 5:var h=e.return;try{Rj(e)}catch(b){W(e,h,b)}}}catch(b){W(e,e.return,b)}if(e===s){V=null;break}var g=e.sibling;if(g!==null){g.return=e.return,V=g;break}V=e.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk$1=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(s){return s.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(s=C$1,s!==0||(s=window.event,s=s===void 0?16:jd(s.type)),s):1}function gi(s,e,o,a){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(s,o,a),(!(K&2)||s!==Q)&&(s===Q&&(!(K&2)&&(qk|=o),T===4&&Ck(s,Z)),Dk(s,a),o===1&&K===0&&!(e.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(s,e){var o=s.callbackNode;wc(s,e);var a=uc(s,s===Q?Z:0);if(a===0)o!==null&&bc(o),s.callbackNode=null,s.callbackPriority=0;else if(e=a&-a,s.callbackPriority!==e){if(o!=null&&bc(o),e===1)s.tag===0?ig(Ek.bind(null,s)):hg(Ek.bind(null,s)),Jf(function(){!(K&6)&&jg()}),o=null;else{switch(Dc(a)){case 1:o=fc;break;case 4:o=gc;break;case 16:o=hc;break;case 536870912:o=jc;break;default:o=hc}o=Fk(o,Gk.bind(null,s))}s.callbackPriority=e,s.callbackNode=o}}function Gk(s,e){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var o=s.callbackNode;if(Hk()&&s.callbackNode!==o)return null;var a=uc(s,s===Q?Z:0);if(a===0)return null;if(a&30||a&s.expiredLanes||e)e=Ik(s,a);else{e=a;var c=K;K|=2;var d=Jk();(Q!==s||Z!==e)&&(uk=null,Gj=B()+500,Kk(s,e));do try{Lk();break}catch(g){Mk(s,g)}while(!0);$g(),mk.current=d,K=c,Y!==null?e=0:(Q=null,Z=0,e=T)}if(e!==0){if(e===2&&(c=xc(s),c!==0&&(a=c,e=Nk(s,c))),e===1)throw o=pk,Kk(s,0),Ck(s,a),Dk(s,B()),o;if(e===6)Ck(s,a);else{if(c=s.current.alternate,!(a&30)&&!Ok(c)&&(e=Ik(s,a),e===2&&(d=xc(s),d!==0&&(a=d,e=Nk(s,d))),e===1))throw o=pk,Kk(s,0),Ck(s,a),Dk(s,B()),o;switch(s.finishedWork=c,s.finishedLanes=a,e){case 0:case 1:throw Error(p(345));case 2:Pk(s,tk$1,uk);break;case 3:if(Ck(s,a),(a&130023424)===a&&(e=fk+500-B(),10<e)){if(uc(s,0)!==0)break;if(c=s.suspendedLanes,(c&a)!==a){R(),s.pingedLanes|=s.suspendedLanes&c;break}s.timeoutHandle=Ff(Pk.bind(null,s,tk$1,uk),e);break}Pk(s,tk$1,uk);break;case 4:if(Ck(s,a),(a&4194240)===a)break;for(e=s.eventTimes,c=-1;0<a;){var h=31-oc(a);d=1<<h,h=e[h],h>c&&(c=h),a&=~d}if(a=c,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){s.timeoutHandle=Ff(Pk.bind(null,s,tk$1,uk),a);break}Pk(s,tk$1,uk);break;case 5:Pk(s,tk$1,uk);break;default:throw Error(p(329))}}}return Dk(s,B()),s.callbackNode===o?Gk.bind(null,s):null}function Nk(s,e){var o=sk;return s.current.memoizedState.isDehydrated&&(Kk(s,e).flags|=256),s=Ik(s,e),s!==2&&(e=tk$1,tk$1=o,e!==null&&Fj(e)),s}function Fj(s){tk$1===null?tk$1=s:tk$1.push.apply(tk$1,s)}function Ok(s){for(var e=s;;){if(e.flags&16384){var o=e.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var a=0;a<o.length;a++){var c=o[a],d=c.getSnapshot;c=c.value;try{if(!He(d(),c))return!1}catch{return!1}}}if(o=e.child,e.subtreeFlags&16384&&o!==null)o.return=e,e=o;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ck(s,e){for(e&=~rk,e&=~qk,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var o=31-oc(e),a=1<<o;s[o]=-1,e&=~a}}function Ek(s){if(K&6)throw Error(p(327));Hk();var e=uc(s,0);if(!(e&1))return Dk(s,B()),null;var o=Ik(s,e);if(s.tag!==0&&o===2){var a=xc(s);a!==0&&(e=a,o=Nk(s,a))}if(o===1)throw o=pk,Kk(s,0),Ck(s,e),Dk(s,B()),o;if(o===6)throw Error(p(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,Pk(s,tk$1,uk),Dk(s,B()),null}function Qk(s,e){var o=K;K|=1;try{return s(e)}finally{K=o,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(s){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var e=K;K|=1;var o=ok.transition,a=C$1;try{if(ok.transition=null,C$1=1,s)return s()}finally{C$1=a,ok.transition=o,K=e,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(s,e){s.finishedWork=null,s.finishedLanes=0;var o=s.timeoutHandle;if(o!==-1&&(s.timeoutHandle=-1,Gf(o)),Y!==null)for(o=Y.return;o!==null;){var a=o;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}o=o.return}if(Q=s,Y=s=Pg(s.current,null),Z=fj=e,T=0,pk=null,rk=qk=rh=0,tk$1=sk=null,fh!==null){for(e=0;e<fh.length;e++)if(o=fh[e],a=o.interleaved,a!==null){o.interleaved=null;var c=a.next,d=o.pending;if(d!==null){var h=d.next;d.next=c,a.next=h}o.pending=a}fh=null}return s}function Mk(s,e){do{var o=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,o===null||o.return===null){T=1,pk=e,Y=null;break}e:{var d=s,h=o.return,g=o,b=e;if(e=Z,g.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var j=b,$=g,_=$.tag;if(!($.mode&1)&&(_===0||_===11||_===15)){var _e=$.alternate;_e?($.updateQueue=_e.updateQueue,$.memoizedState=_e.memoizedState,$.lanes=_e.lanes):($.updateQueue=null,$.memoizedState=null)}var et=Ui(h);if(et!==null){et.flags&=-257,Vi(et,h,g,d,e),et.mode&1&&Si(d,j,e),e=et,b=j;var nt=e.updateQueue;if(nt===null){var rt=new Set;rt.add(b),e.updateQueue=rt}else nt.add(b);break e}else{if(!(e&1)){Si(d,j,e),tj();break e}b=Error(p(426))}}else if(I&&g.mode&1){var it=Ui(h);if(it!==null){!(it.flags&65536)&&(it.flags|=256),Vi(it,h,g,d,e),Jg(Ji(b,g));break e}}d=b=Ji(b,g),T!==4&&(T=2),sk===null?sk=[d]:sk.push(d),d=h;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var st=Ni(d,b,e);ph(d,st);break e;case 1:g=b;var lt=d.type,ot=d.stateNode;if(!(d.flags&128)&&(typeof lt.getDerivedStateFromError=="function"||ot!==null&&typeof ot.componentDidCatch=="function"&&(Ri===null||!Ri.has(ot)))){d.flags|=65536,e&=-e,d.lanes|=e;var ct=Qi(d,g,e);ph(d,ct);break e}}d=d.return}while(d!==null)}Sk(o)}catch(ut){e=ut,Y===o&&o!==null&&(Y=o=o.return);continue}break}while(!0)}function Jk(){var s=mk.current;return mk.current=Rh,s===null?Rh:s}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(s,e){var o=K;K|=2;var a=Jk();(Q!==s||Z!==e)&&(uk=null,Kk(s,e));do try{Tk();break}catch(c){Mk(s,c)}while(!0);if($g(),K=o,mk.current=a,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc$1();)Uk(Y)}function Uk(s){var e=Vk(s.alternate,s,fj);s.memoizedProps=s.pendingProps,e===null?Sk(s):Y=e,nk.current=null}function Sk(s){var e=s;do{var o=e.alternate;if(s=e.return,e.flags&32768){if(o=Ij(o,e),o!==null){o.flags&=32767,Y=o;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{T=6,Y=null;return}}else if(o=Ej(o,e,fj),o!==null){Y=o;return}if(e=e.sibling,e!==null){Y=e;return}Y=e=s}while(e!==null);T===0&&(T=5)}function Pk(s,e,o){var a=C$1,c=ok.transition;try{ok.transition=null,C$1=1,Wk(s,e,o,a)}finally{ok.transition=c,C$1=a}return null}function Wk(s,e,o,a){do Hk();while(wk!==null);if(K&6)throw Error(p(327));o=s.finishedWork;var c=s.finishedLanes;if(o===null)return null;if(s.finishedWork=null,s.finishedLanes=0,o===s.current)throw Error(p(177));s.callbackNode=null,s.callbackPriority=0;var d=o.lanes|o.childLanes;if(Bc(s,d),s===Q&&(Y=Q=null,Z=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),d=(o.flags&15990)!==0,o.subtreeFlags&15990||d){d=ok.transition,ok.transition=null;var h=C$1;C$1=1;var g=K;K|=4,nk.current=null,Oj(s,o),dk(o,s),Oe(Df),dd=!!Cf,Df=Cf=null,s.current=o,hk(o),dc(),K=g,C$1=h,ok.transition=d}else s.current=o;if(vk&&(vk=!1,wk=s,xk=c),d=s.pendingLanes,d===0&&(Ri=null),mc(o.stateNode),Dk(s,B()),e!==null)for(a=s.onRecoverableError,o=0;o<e.length;o++)c=e[o],a(c.value,{componentStack:c.stack,digest:c.digest});if(Oi)throw Oi=!1,s=Pi,Pi=null,s;return xk&1&&s.tag!==0&&Hk(),d=s.pendingLanes,d&1?s===zk?yk++:(yk=0,zk=s):yk=0,jg(),null}function Hk(){if(wk!==null){var s=Dc(xk),e=ok.transition,o=C$1;try{if(ok.transition=null,C$1=16>s?16:s,wk===null)var a=!1;else{if(s=wk,wk=null,xk=0,K&6)throw Error(p(331));var c=K;for(K|=4,V=s.current;V!==null;){var d=V,h=d.child;if(V.flags&16){var g=d.deletions;if(g!==null){for(var b=0;b<g.length;b++){var j=g[b];for(V=j;V!==null;){var $=V;switch($.tag){case 0:case 11:case 15:Pj(8,$,d)}var _=$.child;if(_!==null)_.return=$,V=_;else for(;V!==null;){$=V;var _e=$.sibling,et=$.return;if(Sj($),$===j){V=null;break}if(_e!==null){_e.return=et,V=_e;break}V=et}}}var nt=d.alternate;if(nt!==null){var rt=nt.child;if(rt!==null){nt.child=null;do{var it=rt.sibling;rt.sibling=null,rt=it}while(rt!==null)}}V=d}}if(d.subtreeFlags&2064&&h!==null)h.return=d,V=h;else e:for(;V!==null;){if(d=V,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Pj(9,d,d.return)}var st=d.sibling;if(st!==null){st.return=d.return,V=st;break e}V=d.return}}var lt=s.current;for(V=lt;V!==null;){h=V;var ot=h.child;if(h.subtreeFlags&2064&&ot!==null)ot.return=h,V=ot;else e:for(h=lt;V!==null;){if(g=V,g.flags&2048)try{switch(g.tag){case 0:case 11:case 15:Qj(9,g)}}catch(ut){W(g,g.return,ut)}if(g===h){V=null;break e}var ct=g.sibling;if(ct!==null){ct.return=g.return,V=ct;break e}V=g.return}}if(K=c,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,s)}catch{}a=!0}return a}finally{C$1=o,ok.transition=e}}return!1}function Xk(s,e,o){e=Ji(o,e),e=Ni(s,e,1),s=nh(s,e,1),e=R(),s!==null&&(Ac(s,1,e),Dk(s,e))}function W(s,e,o){if(s.tag===3)Xk(s,s,o);else for(;e!==null;){if(e.tag===3){Xk(e,s,o);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){s=Ji(o,s),s=Qi(e,s,1),e=nh(e,s,1),s=R(),e!==null&&(Ac(e,1,s),Dk(e,s));break}}e=e.return}}function Ti(s,e,o){var a=s.pingCache;a!==null&&a.delete(e),e=R(),s.pingedLanes|=s.suspendedLanes&o,Q===s&&(Z&o)===o&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(s,0):rk|=o),Dk(s,e)}function Yk(s,e){e===0&&(s.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var o=R();s=ih(s,e),s!==null&&(Ac(s,e,o),Dk(s,o))}function uj(s){var e=s.memoizedState,o=0;e!==null&&(o=e.retryLane),Yk(s,o)}function bk(s,e){var o=0;switch(s.tag){case 13:var a=s.stateNode,c=s.memoizedState;c!==null&&(o=c.retryLane);break;case 19:a=s.stateNode;break;default:throw Error(p(314))}a!==null&&a.delete(e),Yk(s,o)}var Vk;Vk=function(s,e,o){if(s!==null)if(s.memoizedProps!==e.pendingProps||Wf.current)dh=!0;else{if(!(s.lanes&o)&&!(e.flags&128))return dh=!1,yj(s,e,o);dh=!!(s.flags&131072)}else dh=!1,I&&e.flags&1048576&&ug(e,ng,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;ij(s,e),s=e.pendingProps;var c=Yf(e,H.current);ch(e,o),c=Nh(null,e,a,s,c,o);var d=Sh();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf(a)?(d=!0,cg(e)):d=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,kh(e),c.updater=Ei,e.stateNode=c,c._reactInternals=e,Ii(e,a,s,o),e=jj(null,e,a,!0,d,o)):(e.tag=0,I&&d&&vg(e),Xi(null,e,c,o),e=e.child),e;case 16:a=e.elementType;e:{switch(ij(s,e),s=e.pendingProps,c=a._init,a=c(a._payload),e.type=a,c=e.tag=Zk(a),s=Ci(a,s),c){case 0:e=cj(null,e,a,s,o);break e;case 1:e=hj(null,e,a,s,o);break e;case 11:e=Yi(null,e,a,s,o);break e;case 14:e=$i(null,e,a,Ci(a.type,s),o);break e}throw Error(p(306,a,""))}return e;case 0:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),cj(s,e,a,c,o);case 1:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),hj(s,e,a,c,o);case 3:e:{if(kj(e),s===null)throw Error(p(387));a=e.pendingProps,d=e.memoizedState,c=d.element,lh(s,e),qh(e,a,null,o);var h=e.memoizedState;if(a=h.element,d.isDehydrated)if(d={element:a,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){c=Ji(Error(p(423)),e),e=lj(s,e,a,o,c);break e}else if(a!==c){c=Ji(Error(p(424)),e),e=lj(s,e,a,o,c);break e}else for(yg=Lf(e.stateNode.containerInfo.firstChild),xg=e,I=!0,zg=null,o=Vg(e,null,a,o),e.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Ig(),a===c){e=Zi(s,e,o);break e}Xi(s,e,a,o)}e=e.child}return e;case 5:return Ah(e),s===null&&Eg(e),a=e.type,c=e.pendingProps,d=s!==null?s.memoizedProps:null,h=c.children,Ef(a,c)?h=null:d!==null&&Ef(a,d)&&(e.flags|=32),gj(s,e),Xi(s,e,h,o),e.child;case 6:return s===null&&Eg(e),null;case 13:return oj(s,e,o);case 4:return yh(e,e.stateNode.containerInfo),a=e.pendingProps,s===null?e.child=Ug(e,null,a,o):Xi(s,e,a,o),e.child;case 11:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),Yi(s,e,a,c,o);case 7:return Xi(s,e,e.pendingProps,o),e.child;case 8:return Xi(s,e,e.pendingProps.children,o),e.child;case 12:return Xi(s,e,e.pendingProps.children,o),e.child;case 10:e:{if(a=e.type._context,c=e.pendingProps,d=e.memoizedProps,h=c.value,G(Wg,a._currentValue),a._currentValue=h,d!==null)if(He(d.value,h)){if(d.children===c.children&&!Wf.current){e=Zi(s,e,o);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var g=d.dependencies;if(g!==null){h=d.child;for(var b=g.firstContext;b!==null;){if(b.context===a){if(d.tag===1){b=mh(-1,o&-o),b.tag=2;var j=d.updateQueue;if(j!==null){j=j.shared;var $=j.pending;$===null?b.next=b:(b.next=$.next,$.next=b),j.pending=b}}d.lanes|=o,b=d.alternate,b!==null&&(b.lanes|=o),bh(d.return,o,e),g.lanes|=o;break}b=b.next}}else if(d.tag===10)h=d.type===e.type?null:d.child;else if(d.tag===18){if(h=d.return,h===null)throw Error(p(341));h.lanes|=o,g=h.alternate,g!==null&&(g.lanes|=o),bh(h,o,e),h=d.sibling}else h=d.child;if(h!==null)h.return=d;else for(h=d;h!==null;){if(h===e){h=null;break}if(d=h.sibling,d!==null){d.return=h.return,h=d;break}h=h.return}d=h}Xi(s,e,c.children,o),e=e.child}return e;case 9:return c=e.type,a=e.pendingProps.children,ch(e,o),c=eh(c),a=a(c),e.flags|=1,Xi(s,e,a,o),e.child;case 14:return a=e.type,c=Ci(a,e.pendingProps),c=Ci(a.type,c),$i(s,e,a,c,o);case 15:return bj(s,e,e.type,e.pendingProps,o);case 17:return a=e.type,c=e.pendingProps,c=e.elementType===a?c:Ci(a,c),ij(s,e),e.tag=1,Zf(a)?(s=!0,cg(e)):s=!1,ch(e,o),Gi(e,a,c),Ii(e,a,c,o),jj(null,e,a,!0,s,o);case 19:return xj(s,e,o);case 22:return dj(s,e,o)}throw Error(p(156,e.tag))};function Fk(s,e){return ac(s,e)}function $k(s,e,o,a){this.tag=s,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(s,e,o,a){return new $k(s,e,o,a)}function aj(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Zk(s){if(typeof s=="function")return aj(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Da)return 11;if(s===Ga)return 14}return 2}function Pg(s,e){var o=s.alternate;return o===null?(o=Bg(s.tag,e,s.key,s.mode),o.elementType=s.elementType,o.type=s.type,o.stateNode=s.stateNode,o.alternate=s,s.alternate=o):(o.pendingProps=e,o.type=s.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=s.flags&14680064,o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},o.sibling=s.sibling,o.index=s.index,o.ref=s.ref,o}function Rg(s,e,o,a,c,d){var h=2;if(a=s,typeof s=="function")aj(s)&&(h=1);else if(typeof s=="string")h=5;else e:switch(s){case ya:return Tg(o.children,c,d,e);case za:h=8,c|=8;break;case Aa:return s=Bg(12,o,e,c|2),s.elementType=Aa,s.lanes=d,s;case Ea:return s=Bg(13,o,e,c),s.elementType=Ea,s.lanes=d,s;case Fa:return s=Bg(19,o,e,c),s.elementType=Fa,s.lanes=d,s;case Ia:return pj(o,c,d,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Ba:h=10;break e;case Ca:h=9;break e;case Da:h=11;break e;case Ga:h=14;break e;case Ha:h=16,a=null;break e}throw Error(p(130,s==null?s:typeof s,""))}return e=Bg(h,o,e,c),e.elementType=s,e.type=a,e.lanes=d,e}function Tg(s,e,o,a){return s=Bg(7,s,a,e),s.lanes=o,s}function pj(s,e,o,a){return s=Bg(22,s,a,e),s.elementType=Ia,s.lanes=o,s.stateNode={isHidden:!1},s}function Qg(s,e,o){return s=Bg(6,s,null,e),s.lanes=o,s}function Sg(s,e,o){return e=Bg(4,s.children!==null?s.children:[],s.key,e),e.lanes=o,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function al(s,e,o,a,c){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function bl(s,e,o,a,c,d,h,g,b){return s=new al(s,e,o,g,b),e===1?(e=1,d===!0&&(e|=8)):e=0,d=Bg(3,null,null,e),s.current=d,d.stateNode=s,d.memoizedState={element:a,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(d),s}function cl(s,e,o){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:s,containerInfo:e,implementation:o}}function dl(s){if(!s)return Vf;s=s._reactInternals;e:{if(Vb(s)!==s||s.tag!==1)throw Error(p(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p(171))}if(s.tag===1){var o=s.type;if(Zf(o))return bg(s,o,e)}return e}function el(s,e,o,a,c,d,h,g,b){return s=bl(o,a,!0,s,c,d,h,g,b),s.context=dl(null),o=s.current,a=R(),c=yi(o),d=mh(a,c),d.callback=e??null,nh(o,d,c),s.current.lanes=c,Ac(s,c,a),Dk(s,a),s}function fl(s,e,o,a){var c=e.current,d=R(),h=yi(c);return o=dl(o),e.context===null?e.context=o:e.pendingContext=o,e=mh(d,h),e.payload={element:s},a=a===void 0?null:a,a!==null&&(e.callback=a),s=nh(c,e,h),s!==null&&(gi(s,c,h,d),oh(s,c,h)),h}function gl(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function hl(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var o=s.retryLane;s.retryLane=o!==0&&o<e?o:e}}function il(s,e){hl(s,e),(s=s.alternate)&&hl(s,e)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(s){console.error(s)};function ll(s){this._internalRoot=s}ml.prototype.render=ll.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(p(409));fl(s,e,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;Rk(function(){fl(null,s,null,null)}),e[uf]=null}};function ml(s){this._internalRoot=s}ml.prototype.unstable_scheduleHydration=function(s){if(s){var e=Hc();s={blockedOn:null,target:s,priority:e};for(var o=0;o<Qc.length&&e!==0&&e<Qc[o].priority;o++);Qc.splice(o,0,s),o===0&&Vc(s)}};function nl(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function ol(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(s,e,o,a,c){if(c){if(typeof a=="function"){var d=a;a=function(){var j=gl(h);d.call(j)}}var h=el(e,a,s,0,null,!1,!1,"",pl);return s._reactRootContainer=h,s[uf]=h.current,sf(s.nodeType===8?s.parentNode:s),Rk(),h}for(;c=s.lastChild;)s.removeChild(c);if(typeof a=="function"){var g=a;a=function(){var j=gl(b);g.call(j)}}var b=bl(s,0,!1,null,null,!1,!1,"",pl);return s._reactRootContainer=b,s[uf]=b.current,sf(s.nodeType===8?s.parentNode:s),Rk(function(){fl(e,b,o,a)}),b}function rl(s,e,o,a,c){var d=o._reactRootContainer;if(d){var h=d;if(typeof c=="function"){var g=c;c=function(){var b=gl(h);g.call(b)}}fl(e,h,s,c)}else h=ql(o,e,s,c,a);return gl(h)}Ec=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var o=tc(e.pendingLanes);o!==0&&(Cc(e,o|1),Dk(e,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(s,1);if(a!==null){var c=R();gi(a,s,1,c)}}),il(s,1)}};Fc=function(s){if(s.tag===13){var e=ih(s,134217728);if(e!==null){var o=R();gi(e,s,134217728,o)}il(s,134217728)}};Gc=function(s){if(s.tag===13){var e=yi(s),o=ih(s,e);if(o!==null){var a=R();gi(o,s,e,a)}il(s,e)}};Hc=function(){return C$1};Ic=function(s,e){var o=C$1;try{return C$1=s,e()}finally{C$1=o}};yb=function(s,e,o){switch(e){case"input":if(bb(s,o),e=o.name,o.type==="radio"&&e!=null){for(o=s;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<o.length;e++){var a=o[e];if(a!==s&&a.form===s.form){var c=Db(a);if(!c)throw Error(p(90));Wa(a),bb(a,c)}}}break;case"textarea":ib(s,o);break;case"select":e=o.value,e!=null&&fb(s,!!o.multiple,e,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Zb(s),s===null?null:s.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(s,e){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(e))throw Error(p(200));return cl(s,e,null,o)};reactDom_production_min.createRoot=function(s,e){if(!nl(s))throw Error(p(299));var o=!1,a="",c=kl;return e!=null&&(e.unstable_strictMode===!0&&(o=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=bl(s,1,!1,null,null,o,!1,a,c),s[uf]=e.current,sf(s.nodeType===8?s.parentNode:s),new ll(e)};reactDom_production_min.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(p(188)):(s=Object.keys(s).join(","),Error(p(268,s)));return s=Zb(e),s=s===null?null:s.stateNode,s};reactDom_production_min.flushSync=function(s){return Rk(s)};reactDom_production_min.hydrate=function(s,e,o){if(!ol(e))throw Error(p(200));return rl(null,s,e,!0,o)};reactDom_production_min.hydrateRoot=function(s,e,o){if(!nl(s))throw Error(p(405));var a=o!=null&&o.hydratedSources||null,c=!1,d="",h=kl;if(o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onRecoverableError!==void 0&&(h=o.onRecoverableError)),e=el(e,null,s,1,o??null,c,!1,d,h),s[uf]=e.current,sf(s),a)for(s=0;s<a.length;s++)o=a[s],c=o._getVersion,c=c(o._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[o,c]:e.mutableSourceEagerHydrationData.push(o,c);return new ml(e)};reactDom_production_min.render=function(s,e,o){if(!ol(e))throw Error(p(200));return rl(null,s,e,!1,o)};reactDom_production_min.unmountComponentAtNode=function(s){if(!ol(s))throw Error(p(40));return s._reactRootContainer?(Rk(function(){rl(null,null,s,!1,function(){s._reactRootContainer=null,s[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(s,e,o,a){if(!ol(o))throw Error(p(200));if(s==null||s._reactInternals===void 0)throw Error(p(38));return rl(s,e,o,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(s){console.error(s)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const ReactDOM=getDefaultExportFromCjs$1(reactDomExports);var m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(s[a]=o[a])}return s},_extends$2.apply(this,arguments)}var Action;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(s){s===void 0&&(s={});function e(a,c){let{pathname:d,search:h,hash:g}=a.location;return createLocation("",{pathname:d,search:h,hash:g},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function o(a,c){return typeof c=="string"?c:createPath(c)}return getUrlBasedHistory(e,o,null,s)}function invariant(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function warning(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function createKey$1(){return Math.random().toString(36).substr(2,8)}function getHistoryState(s,e){return{usr:s.state,key:s.key,idx:e}}function createLocation(s,e,o,a){return o===void 0&&(o=null),_extends$2({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?parsePath(e):e,{state:o,key:e&&e.key||a||createKey$1()})}function createPath(s){let{pathname:e="/",search:o="",hash:a=""}=s;return o&&o!=="?"&&(e+=o.charAt(0)==="?"?o:"?"+o),a&&a!=="#"&&(e+=a.charAt(0)==="#"?a:"#"+a),e}function parsePath(s){let e={};if(s){let o=s.indexOf("#");o>=0&&(e.hash=s.substr(o),s=s.substr(0,o));let a=s.indexOf("?");a>=0&&(e.search=s.substr(a),s=s.substr(0,a)),s&&(e.pathname=s)}return e}function getUrlBasedHistory(s,e,o,a){a===void 0&&(a={});let{window:c=document.defaultView,v5Compat:d=!1}=a,h=c.history,g=Action.Pop,b=null,j=$();j==null&&(j=0,h.replaceState(_extends$2({},h.state,{idx:j}),""));function $(){return(h.state||{idx:null}).idx}function _(){g=Action.Pop;let it=$(),st=it==null?null:it-j;j=it,b&&b({action:g,location:rt.location,delta:st})}function _e(it,st){g=Action.Push;let lt=createLocation(rt.location,it,st);j=$()+1;let ot=getHistoryState(lt,j),ct=rt.createHref(lt);try{h.pushState(ot,"",ct)}catch(ut){if(ut instanceof DOMException&&ut.name==="DataCloneError")throw ut;c.location.assign(ct)}d&&b&&b({action:g,location:rt.location,delta:1})}function et(it,st){g=Action.Replace;let lt=createLocation(rt.location,it,st);j=$();let ot=getHistoryState(lt,j),ct=rt.createHref(lt);h.replaceState(ot,"",ct),d&&b&&b({action:g,location:rt.location,delta:0})}function nt(it){let st=c.location.origin!=="null"?c.location.origin:c.location.href,lt=typeof it=="string"?it:createPath(it);return lt=lt.replace(/ $/,"%20"),invariant(st,"No window.location.(origin|href) available to create URL for href: "+lt),new URL(lt,st)}let rt={get action(){return g},get location(){return s(c,h)},listen(it){if(b)throw new Error("A history only accepts one active listener");return c.addEventListener(PopStateEventType,_),b=it,()=>{c.removeEventListener(PopStateEventType,_),b=null}},createHref(it){return e(c,it)},createURL:nt,encodeLocation(it){let st=nt(it);return{pathname:st.pathname,search:st.search,hash:st.hash}},push:_e,replace:et,go(it){return h.go(it)}};return rt}var ResultType;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(ResultType||(ResultType={}));function matchRoutes(s,e,o){return o===void 0&&(o="/"),matchRoutesImpl(s,e,o)}function matchRoutesImpl(s,e,o,a){let c=typeof e=="string"?parsePath(e):e,d=stripBasename(c.pathname||"/",o);if(d==null)return null;let h=flattenRoutes(s);rankRouteBranches(h);let g=null;for(let b=0;g==null&&b<h.length;++b){let j=decodePath(d);g=matchRouteBranch(h[b],j)}return g}function flattenRoutes(s,e,o,a){e===void 0&&(e=[]),o===void 0&&(o=[]),a===void 0&&(a="");let c=(d,h,g)=>{let b={relativePath:g===void 0?d.path||"":g,caseSensitive:d.caseSensitive===!0,childrenIndex:h,route:d};b.relativePath.startsWith("/")&&(invariant(b.relativePath.startsWith(a),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(a.length));let j=joinPaths([a,b.relativePath]),$=o.concat(b);d.children&&d.children.length>0&&(invariant(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+j+'".')),flattenRoutes(d.children,e,$,j)),!(d.path==null&&!d.index)&&e.push({path:j,score:computeScore(j,d.index),routesMeta:$})};return s.forEach((d,h)=>{var g;if(d.path===""||!((g=d.path)!=null&&g.includes("?")))c(d,h);else for(let b of explodeOptionalSegments(d.path))c(d,h,b)}),e}function explodeOptionalSegments(s){let e=s.split("/");if(e.length===0)return[];let[o,...a]=e,c=o.endsWith("?"),d=o.replace(/\?$/,"");if(a.length===0)return c?[d,""]:[d];let h=explodeOptionalSegments(a.join("/")),g=[];return g.push(...h.map(b=>b===""?d:[d,b].join("/"))),c&&g.push(...h),g.map(b=>s.startsWith("/")&&b===""?"/":b)}function rankRouteBranches(s){s.sort((e,o)=>e.score!==o.score?o.score-e.score:compareIndexes(e.routesMeta.map(a=>a.childrenIndex),o.routesMeta.map(a=>a.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=s=>s==="*";function computeScore(s,e){let o=s.split("/"),a=o.length;return o.some(isSplat)&&(a+=splatPenalty),e&&(a+=indexRouteValue),o.filter(c=>!isSplat(c)).reduce((c,d)=>c+(paramRe.test(d)?dynamicSegmentValue:d===""?emptySegmentValue:staticSegmentValue),a)}function compareIndexes(s,e){return s.length===e.length&&s.slice(0,-1).every((a,c)=>a===e[c])?s[s.length-1]-e[e.length-1]:0}function matchRouteBranch(s,e,o){let{routesMeta:a}=s,c={},d="/",h=[];for(let g=0;g<a.length;++g){let b=a[g],j=g===a.length-1,$=d==="/"?e:e.slice(d.length)||"/",_=matchPath({path:b.relativePath,caseSensitive:b.caseSensitive,end:j},$),_e=b.route;if(!_)return null;Object.assign(c,_.params),h.push({params:c,pathname:joinPaths([d,_.pathname]),pathnameBase:normalizePathname(joinPaths([d,_.pathnameBase])),route:_e}),_.pathnameBase!=="/"&&(d=joinPaths([d,_.pathnameBase]))}return h}function matchPath(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[o,a]=compilePath(s.path,s.caseSensitive,s.end),c=e.match(o);if(!c)return null;let d=c[0],h=d.replace(/(.)\/+$/,"$1"),g=c.slice(1);return{params:a.reduce((j,$,_)=>{let{paramName:_e,isOptional:et}=$;if(_e==="*"){let rt=g[_]||"";h=d.slice(0,d.length-rt.length).replace(/(.)\/+$/,"$1")}const nt=g[_];return et&&!nt?j[_e]=void 0:j[_e]=(nt||"").replace(/%2F/g,"/"),j},{}),pathname:d,pathnameBase:h,pattern:s}}function compilePath(s,e,o){e===void 0&&(e=!1),o===void 0&&(o=!0),warning(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let a=[],c="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,g,b)=>(a.push({paramName:g,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(a.push({paramName:"*"}),c+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?c+="\\/*$":s!==""&&s!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),a]}function decodePath(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return warning(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function stripBasename(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let o=e.endsWith("/")?e.length-1:e.length,a=s.charAt(o);return a&&a!=="/"?null:s.slice(o)||"/"}const ABSOLUTE_URL_REGEX$1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,isAbsoluteUrl=s=>ABSOLUTE_URL_REGEX$1.test(s);function resolvePath(s,e){e===void 0&&(e="/");let{pathname:o,search:a="",hash:c=""}=typeof s=="string"?parsePath(s):s,d;if(o)if(isAbsoluteUrl(o))d=o;else{if(o.includes("//")){let h=o;o=o.replace(/\/\/+/g,"/"),warning(!1,"Pathnames cannot have embedded double slashes - normalizing "+(h+" -> "+o))}o.startsWith("/")?d=resolvePathname(o.substring(1),"/"):d=resolvePathname(o,e)}else d=e;return{pathname:d,search:normalizeSearch(a),hash:normalizeHash(c)}}function resolvePathname(s,e){let o=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(c=>{c===".."?o.length>1&&o.pop():c!=="."&&o.push(c)}),o.length>1?o.join("/"):"/"}function getInvalidPathError(s,e,o,a){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(s){return s.filter((e,o)=>o===0||e.route.path&&e.route.path.length>0)}function getResolveToMatches(s,e){let o=getPathContributingMatches(s);return e?o.map((a,c)=>c===o.length-1?a.pathname:a.pathnameBase):o.map(a=>a.pathnameBase)}function resolveTo(s,e,o,a){a===void 0&&(a=!1);let c;typeof s=="string"?c=parsePath(s):(c=_extends$2({},s),invariant(!c.pathname||!c.pathname.includes("?"),getInvalidPathError("?","pathname","search",c)),invariant(!c.pathname||!c.pathname.includes("#"),getInvalidPathError("#","pathname","hash",c)),invariant(!c.search||!c.search.includes("#"),getInvalidPathError("#","search","hash",c)));let d=s===""||c.pathname==="",h=d?"/":c.pathname,g;if(h==null)g=o;else{let _=e.length-1;if(!a&&h.startsWith("..")){let _e=h.split("/");for(;_e[0]==="..";)_e.shift(),_-=1;c.pathname=_e.join("/")}g=_>=0?e[_]:"/"}let b=resolvePath(c,g),j=h&&h!=="/"&&h.endsWith("/"),$=(d||h===".")&&o.endsWith("/");return!b.pathname.endsWith("/")&&(j||$)&&(b.pathname+="/"),b}const joinPaths=s=>s.join("/").replace(/\/\/+/g,"/"),normalizePathname=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,normalizeHash=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function isRouteErrorResponse(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(s[a]=o[a])}return s},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(s,e){let{relative:o}=e===void 0?{}:e;useInRouterContext()||invariant(!1);let{basename:a,navigator:c}=reactExports.useContext(NavigationContext),{hash:d,pathname:h,search:g}=useResolvedPath(s,{relative:o}),b=h;return a!=="/"&&(b=h==="/"?a:joinPaths([a,h])),c.createHref({pathname:b,search:g,hash:d})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect$2(s){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(s)}function useNavigate(){let{isDataRoute:s}=reactExports.useContext(RouteContext);return s?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant(!1);let s=reactExports.useContext(DataRouterContext),{basename:e,future:o,navigator:a}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),h=JSON.stringify(getResolveToMatches(c,o.v7_relativeSplatPath)),g=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{g.current=!0}),reactExports.useCallback(function(j,$){if($===void 0&&($={}),!g.current)return;if(typeof j=="number"){a.go(j);return}let _=resolveTo(j,JSON.parse(h),d,$.relative==="path");s==null&&e!=="/"&&(_.pathname=_.pathname==="/"?e:joinPaths([e,_.pathname])),($.replace?a.replace:a.push)(_,$.state,$)},[e,a,h,d,s])}function useParams(){let{matches:s}=reactExports.useContext(RouteContext),e=s[s.length-1];return e?e.params:{}}function useResolvedPath(s,e){let{relative:o}=e===void 0?{}:e,{future:a}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),h=JSON.stringify(getResolveToMatches(c,a.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(s,JSON.parse(h),d,o==="path"),[s,h,d,o])}function useRoutes(s,e){return useRoutesImpl(s,e)}function useRoutesImpl(s,e,o,a){useInRouterContext()||invariant(!1);let{navigator:c}=reactExports.useContext(NavigationContext),{matches:d}=reactExports.useContext(RouteContext),h=d[d.length-1],g=h?h.params:{};h&&h.pathname;let b=h?h.pathnameBase:"/";h&&h.route;let j=useLocation(),$;if(e){var _;let it=typeof e=="string"?parsePath(e):e;b==="/"||(_=it.pathname)!=null&&_.startsWith(b)||invariant(!1),$=it}else $=j;let _e=$.pathname||"/",et=_e;if(b!=="/"){let it=b.replace(/^\//,"").split("/");et="/"+_e.replace(/^\//,"").split("/").slice(it.length).join("/")}let nt=matchRoutes(s,{pathname:et}),rt=_renderMatches(nt&&nt.map(it=>Object.assign({},it,{params:Object.assign({},g,it.params),pathname:joinPaths([b,c.encodeLocation?c.encodeLocation(it.pathname).pathname:it.pathname]),pathnameBase:it.pathnameBase==="/"?b:joinPaths([b,c.encodeLocation?c.encodeLocation(it.pathnameBase).pathname:it.pathnameBase])})),d,o,a);return e&&rt?reactExports.createElement(LocationContext.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},$),navigationType:Action.Pop}},rt):rt}function DefaultErrorComponent(){let s=useRouteError(),e=isRouteErrorResponse(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),o=s instanceof Error?s.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},e),o?reactExports.createElement("pre",{style:c},o):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,o){return o.location!==e.location||o.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:o.error,location:o.location,revalidation:e.revalidation||o.revalidation}}componentDidCatch(e,o){console.error("React Router caught the following error during render",e,o)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(s){let{routeContext:e,match:o,children:a}=s,c=reactExports.useContext(DataRouterContext);return c&&c.static&&c.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=o.route.id),reactExports.createElement(RouteContext.Provider,{value:e},a)}function _renderMatches(s,e,o,a){var c;if(e===void 0&&(e=[]),o===void 0&&(o=null),a===void 0&&(a=null),s==null){var d;if(!o)return null;if(o.errors)s=o.matches;else if((d=a)!=null&&d.v7_partialHydration&&e.length===0&&!o.initialized&&o.matches.length>0)s=o.matches;else return null}let h=s,g=(c=o)==null?void 0:c.errors;if(g!=null){let $=h.findIndex(_=>_.route.id&&(g==null?void 0:g[_.route.id])!==void 0);$>=0||invariant(!1),h=h.slice(0,Math.min(h.length,$+1))}let b=!1,j=-1;if(o&&a&&a.v7_partialHydration)for(let $=0;$<h.length;$++){let _=h[$];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(j=$),_.route.id){let{loaderData:_e,errors:et}=o,nt=_.route.loader&&_e[_.route.id]===void 0&&(!et||et[_.route.id]===void 0);if(_.route.lazy||nt){b=!0,j>=0?h=h.slice(0,j+1):h=[h[0]];break}}}return h.reduceRight(($,_,_e)=>{let et,nt=!1,rt=null,it=null;o&&(et=g&&_.route.id?g[_.route.id]:void 0,rt=_.route.errorElement||defaultErrorElement,b&&(j<0&&_e===0?(warningOnce("route-fallback"),nt=!0,it=null):j===_e&&(nt=!0,it=_.route.hydrateFallbackElement||null)));let st=e.concat(h.slice(0,_e+1)),lt=()=>{let ot;return et?ot=rt:nt?ot=it:_.route.Component?ot=reactExports.createElement(_.route.Component,null):_.route.element?ot=_.route.element:ot=$,reactExports.createElement(RenderedRoute,{match:_,routeContext:{outlet:$,matches:st,isDataRoute:o!=null},children:ot})};return o&&(_.route.ErrorBoundary||_.route.errorElement||_e===0)?reactExports.createElement(RenderErrorBoundary,{location:o.location,revalidation:o.revalidation,component:rt,error:et,children:lt(),routeContext:{outlet:null,matches:st,isDataRoute:!0}}):lt()},null)}var DataRouterHook$1=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(DataRouterHook$1||{}),DataRouterStateHook$1=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(DataRouterStateHook$1||{});function useDataRouterContext(s){let e=reactExports.useContext(DataRouterContext);return e||invariant(!1),e}function useDataRouterState(s){let e=reactExports.useContext(DataRouterStateContext);return e||invariant(!1),e}function useRouteContext(s){let e=reactExports.useContext(RouteContext);return e||invariant(!1),e}function useCurrentRouteId(s){let e=useRouteContext(),o=e.matches[e.matches.length-1];return o.route.id||invariant(!1),o.route.id}function useRouteError(){var s;let e=reactExports.useContext(RouteErrorContext),o=useDataRouterState(),a=useCurrentRouteId();return e!==void 0?e:(s=o.errors)==null?void 0:s[a]}function useNavigateStable(){let{router:s}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),e=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),o=reactExports.useRef(!1);return useIsomorphicLayoutEffect$2(()=>{o.current=!0}),reactExports.useCallback(function(c,d){d===void 0&&(d={}),o.current&&(typeof c=="number"?s.navigate(c):s.navigate(c,_extends$1({fromRouteId:e},d)))},[s,e])}const alreadyWarned$1={};function warningOnce(s,e,o){alreadyWarned$1[s]||(alreadyWarned$1[s]=!0)}function logV6DeprecationWarnings(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function Navigate(s){let{to:e,replace:o,state:a,relative:c}=s;useInRouterContext()||invariant(!1);let{future:d,static:h}=reactExports.useContext(NavigationContext),{matches:g}=reactExports.useContext(RouteContext),{pathname:b}=useLocation(),j=useNavigate(),$=resolveTo(e,getResolveToMatches(g,d.v7_relativeSplatPath),b,c==="path"),_=JSON.stringify($);return reactExports.useEffect(()=>j(JSON.parse(_),{replace:o,state:a,relative:c}),[j,_,c,o,a]),null}function Route(s){invariant(!1)}function Router(s){let{basename:e="/",children:o=null,location:a,navigationType:c=Action.Pop,navigator:d,static:h=!1,future:g}=s;useInRouterContext()&&invariant(!1);let b=e.replace(/^\/*/,"/"),j=reactExports.useMemo(()=>({basename:b,navigator:d,static:h,future:_extends$1({v7_relativeSplatPath:!1},g)}),[b,g,d,h]);typeof a=="string"&&(a=parsePath(a));let{pathname:$="/",search:_="",hash:_e="",state:et=null,key:nt="default"}=a,rt=reactExports.useMemo(()=>{let it=stripBasename($,b);return it==null?null:{location:{pathname:it,search:_,hash:_e,state:et,key:nt},navigationType:c}},[b,$,_,_e,et,nt,c]);return rt==null?null:reactExports.createElement(NavigationContext.Provider,{value:j},reactExports.createElement(LocationContext.Provider,{children:o,value:rt}))}function Routes(s){let{children:e,location:o}=s;return useRoutes(createRoutesFromChildren(e),o)}new Promise(()=>{});function createRoutesFromChildren(s,e){e===void 0&&(e=[]);let o=[];return reactExports.Children.forEach(s,(a,c)=>{if(!reactExports.isValidElement(a))return;let d=[...e,c];if(a.type===reactExports.Fragment){o.push.apply(o,createRoutesFromChildren(a.props.children,d));return}a.type!==Route&&invariant(!1),!a.props.index||!a.props.children||invariant(!1);let h={id:a.props.id||d.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(h.children=createRoutesFromChildren(a.props.children,d)),o.push(h)}),o}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(s[a]=o[a])}return s},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(s,e){if(s==null)return{};var o={},a=Object.keys(s),c,d;for(d=0;d<a.length;d++)c=a[d],!(e.indexOf(c)>=0)&&(o[c]=s[c]);return o}function isModifiedEvent(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function shouldProcessLinkClick(s,e){return s.button===0&&(!e||e==="_self")&&!isModifiedEvent(s)}function createSearchParams(s){return s===void 0&&(s=""),new URLSearchParams(typeof s=="string"||Array.isArray(s)||s instanceof URLSearchParams?s:Object.keys(s).reduce((e,o)=>{let a=s[o];return e.concat(Array.isArray(a)?a.map(c=>[o,c]):[[o,a]])},[]))}function getSearchParamsForLocation(s,e){let o=createSearchParams(s);return e&&e.forEach((a,c)=>{o.has(c)||e.getAll(c).forEach(d=>{o.append(c,d)})}),o}const _excluded=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const START_TRANSITION="startTransition",startTransitionImpl=React$3[START_TRANSITION];function BrowserRouter(s){let{basename:e,children:o,future:a,window:c}=s,d=reactExports.useRef();d.current==null&&(d.current=createBrowserHistory({window:c,v5Compat:!0}));let h=d.current,[g,b]=reactExports.useState({action:h.action,location:h.location}),{v7_startTransition:j}=a||{},$=reactExports.useCallback(_=>{j&&startTransitionImpl?startTransitionImpl(()=>b(_)):b(_)},[b,j]);return reactExports.useLayoutEffect(()=>h.listen($),[h,$]),reactExports.useEffect(()=>logV6DeprecationWarnings(a),[a]),reactExports.createElement(Router,{basename:e,children:o,location:g.location,navigationType:g.action,navigator:h,future:a})}const isBrowser=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link$2=reactExports.forwardRef(function(e,o){let{onClick:a,relative:c,reloadDocument:d,replace:h,state:g,target:b,to:j,preventScrollReset:$,viewTransition:_}=e,_e=_objectWithoutPropertiesLoose(e,_excluded),{basename:et}=reactExports.useContext(NavigationContext),nt,rt=!1;if(typeof j=="string"&&ABSOLUTE_URL_REGEX.test(j)&&(nt=j,isBrowser))try{let ot=new URL(window.location.href),ct=j.startsWith("//")?new URL(ot.protocol+j):new URL(j),ut=stripBasename(ct.pathname,et);ct.origin===ot.origin&&ut!=null?j=ut+ct.search+ct.hash:rt=!0}catch{}let it=useHref(j,{relative:c}),st=useLinkClickHandler(j,{replace:h,state:g,target:b,preventScrollReset:$,relative:c,viewTransition:_});function lt(ot){a&&a(ot),ot.defaultPrevented||st(ot)}return reactExports.createElement("a",_extends({},_e,{href:nt||it,onClick:rt||d?a:lt,ref:o,target:b}))});var DataRouterHook;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(s,e){let{target:o,replace:a,state:c,preventScrollReset:d,relative:h,viewTransition:g}=e===void 0?{}:e,b=useNavigate(),j=useLocation(),$=useResolvedPath(s,{relative:h});return reactExports.useCallback(_=>{if(shouldProcessLinkClick(_,o)){_.preventDefault();let _e=a!==void 0?a:createPath(j)===createPath($);b(s,{replace:_e,state:c,preventScrollReset:d,relative:h,viewTransition:g})}},[j,b,$,a,c,o,s,d,h,g])}function useSearchParams(s){let e=reactExports.useRef(createSearchParams(s)),o=reactExports.useRef(!1),a=useLocation(),c=reactExports.useMemo(()=>getSearchParamsForLocation(a.search,o.current?null:e.current),[a.search]),d=useNavigate(),h=reactExports.useCallback((g,b)=>{const j=createSearchParams(typeof g=="function"?g(c):g);o.current=!0,d("?"+j,b)},[d,c]);return[c,h]}const __vite_import_meta_env__$1={},createStoreImpl=s=>{let e;const o=new Set,a=($,_)=>{const _e=typeof $=="function"?$(e):$;if(!Object.is(_e,e)){const et=e;e=_??(typeof _e!="object"||_e===null)?_e:Object.assign({},e,_e),o.forEach(nt=>nt(e,et))}},c=()=>e,b={setState:a,getState:c,getInitialState:()=>j,subscribe:$=>(o.add($),()=>o.delete($)),destroy:()=>{(__vite_import_meta_env__$1?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},j=e=s(a,c,b);return b},createStore$1=s=>s?createStoreImpl(s):createStoreImpl;var withSelector$1={exports:{}},withSelector_production={},shim$3={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React$1=reactExports;function is$1(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var objectIs$1=typeof Object.is=="function"?Object.is:is$1,useState=React$1.useState,useEffect$1=React$1.useEffect,useLayoutEffect=React$1.useLayoutEffect,useDebugValue$3=React$1.useDebugValue;function useSyncExternalStore$2(s,e){var o=e(),a=useState({inst:{value:o,getSnapshot:e}}),c=a[0].inst,d=a[1];return useLayoutEffect(function(){c.value=o,c.getSnapshot=e,checkIfSnapshotChanged(c)&&d({inst:c})},[s,o,e]),useEffect$1(function(){return checkIfSnapshotChanged(c)&&d({inst:c}),s(function(){checkIfSnapshotChanged(c)&&d({inst:c})})},[s]),useDebugValue$3(o),o}function checkIfSnapshotChanged(s){var e=s.getSnapshot;s=s.value;try{var o=e();return!objectIs$1(s,o)}catch{return!0}}function useSyncExternalStore$1(s,e){return e()}var shim$2=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=React$1.useSyncExternalStore!==void 0?React$1.useSyncExternalStore:shim$2;shim$3.exports=useSyncExternalStoreShim_production;var shimExports$1=shim$3.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React=reactExports,shim$1=shimExports$1;function is(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var objectIs=typeof Object.is=="function"?Object.is:is,useSyncExternalStore=shim$1.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue$2=React.useDebugValue;withSelector_production.useSyncExternalStoreWithSelector=function(s,e,o,a,c){var d=useRef(null);if(d.current===null){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=useMemo(function(){function b(et){if(!j){if(j=!0,$=et,et=a(et),c!==void 0&&h.hasValue){var nt=h.value;if(c(nt,et))return _=nt}return _=et}if(nt=_,objectIs($,et))return nt;var rt=a(et);return c!==void 0&&c(nt,rt)?($=et,nt):($=et,_=rt)}var j=!1,$,_,_e=o===void 0?null:o;return[function(){return b(e())},_e===null?void 0:function(){return b(_e())}]},[e,o,a,c]);var g=useSyncExternalStore(s,d[0],d[1]);return useEffect(function(){h.hasValue=!0,h.value=g},[g]),useDebugValue$2(g),g};withSelector$1.exports=withSelector_production;var withSelectorExports$1=withSelector$1.exports;const useSyncExternalStoreExports=getDefaultExportFromCjs$1(withSelectorExports$1),__vite_import_meta_env__={},{useDebugValue:useDebugValue$1}=React$2,{useSyncExternalStoreWithSelector:useSyncExternalStoreWithSelector$1}=useSyncExternalStoreExports;let didWarnAboutEqualityFn=!1;const identity$3=s=>s;function useStore$1(s,e=identity$3,o){(__vite_import_meta_env__?"production":void 0)!=="production"&&o&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const a=useSyncExternalStoreWithSelector$1(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,o);return useDebugValue$1(a),a}const createImpl=s=>{(__vite_import_meta_env__?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof s=="function"?createStore$1(s):s,o=(a,c)=>useStore$1(e,a,c);return Object.assign(o,e),o},create$2=s=>s?createImpl(s):createImpl;function bind$1(s,e){return function(){return s.apply(e,arguments)}}const{toString}=Object.prototype,{getPrototypeOf:getPrototypeOf$1}=Object,{iterator,toStringTag}=Symbol,kindOf=(s=>e=>{const o=toString.call(e);return s[o]||(s[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=s=>(s=s.toLowerCase(),e=>kindOf(e)===s),typeOfTest=s=>e=>typeof e===s,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(s){return s!==null&&!isUndefined(s)&&s.constructor!==null&&!isUndefined(s.constructor)&&isFunction$2(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&isArrayBuffer(s.buffer),e}const isString=typeOfTest("string"),isFunction$2=typeOfTest("function"),isNumber$1=typeOfTest("number"),isObject=s=>s!==null&&typeof s=="object",isBoolean=s=>s===!0||s===!1,isPlainObject$1=s=>{if(kindOf(s)!=="object")return!1;const e=getPrototypeOf$1(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(toStringTag in s)&&!(iterator in s)},isEmptyObject$1=s=>{if(!isObject(s)||isBuffer(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=s=>isObject(s)&&isFunction$2(s.pipe),isFormData=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||isFunction$2(s.append)&&((e=kindOf(s))==="formdata"||e==="object"&&isFunction$2(s.toString)&&s.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach$1(s,e,{allOwnKeys:o=!1}={}){if(s===null||typeof s>"u")return;let a,c;if(typeof s!="object"&&(s=[s]),isArray(s))for(a=0,c=s.length;a<c;a++)e.call(null,s[a],a,s);else{if(isBuffer(s))return;const d=o?Object.getOwnPropertyNames(s):Object.keys(s),h=d.length;let g;for(a=0;a<h;a++)g=d[a],e.call(null,s[g],g,s)}}function findKey(s,e){if(isBuffer(s))return null;e=e.toLowerCase();const o=Object.keys(s);let a=o.length,c;for(;a-- >0;)if(c=o[a],e===c.toLowerCase())return c;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=s=>!isUndefined(s)&&s!==_global;function merge(){const{caseless:s,skipUndefined:e}=isContextDefined(this)&&this||{},o={},a=(c,d)=>{const h=s&&findKey(o,d)||d;isPlainObject$1(o[h])&&isPlainObject$1(c)?o[h]=merge(o[h],c):isPlainObject$1(c)?o[h]=merge({},c):isArray(c)?o[h]=c.slice():(!e||!isUndefined(c))&&(o[h]=c)};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&forEach$1(arguments[c],a);return o}const extend$1=(s,e,o,{allOwnKeys:a}={})=>(forEach$1(e,(c,d)=>{o&&isFunction$2(c)?Object.defineProperty(s,d,{value:bind$1(c,o),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(s,d,{value:c,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:a}),s),stripBOM=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),inherits=(s,e,o,a)=>{s.prototype=Object.create(e.prototype,a),Object.defineProperty(s.prototype,"constructor",{value:s,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(s,"super",{value:e.prototype}),o&&Object.assign(s.prototype,o)},toFlatObject=(s,e,o,a)=>{let c,d,h;const g={};if(e=e||{},s==null)return e;do{for(c=Object.getOwnPropertyNames(s),d=c.length;d-- >0;)h=c[d],(!a||a(h,s,e))&&!g[h]&&(e[h]=s[h],g[h]=!0);s=o!==!1&&getPrototypeOf$1(s)}while(s&&(!o||o(s,e))&&s!==Object.prototype);return e},endsWith=(s,e,o)=>{s=String(s),(o===void 0||o>s.length)&&(o=s.length),o-=e.length;const a=s.indexOf(e,o);return a!==-1&&a===o},toArray=s=>{if(!s)return null;if(isArray(s))return s;let e=s.length;if(!isNumber$1(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=s[e];return o},isTypedArray=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&getPrototypeOf$1(Uint8Array)),forEachEntry=(s,e)=>{const a=(s&&s[iterator]).call(s);let c;for(;(c=a.next())&&!c.done;){const d=c.value;e.call(s,d[0],d[1])}},matchAll=(s,e)=>{let o;const a=[];for(;(o=s.exec(e))!==null;)a.push(o);return a},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,a,c){return a.toUpperCase()+c}),hasOwnProperty=(({hasOwnProperty:s})=>(e,o)=>s.call(e,o))(Object.prototype),isRegExp$1=kindOfTest("RegExp"),reduceDescriptors=(s,e)=>{const o=Object.getOwnPropertyDescriptors(s),a={};forEach$1(o,(c,d)=>{let h;(h=e(c,d,s))!==!1&&(a[d]=h||c)}),Object.defineProperties(s,a)},freezeMethods=s=>{reduceDescriptors(s,(e,o)=>{if(isFunction$2(s)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const a=s[o];if(isFunction$2(a)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},toObjectSet=(s,e)=>{const o={},a=c=>{c.forEach(d=>{o[d]=!0})};return isArray(s)?a(s):a(String(s).split(e)),o},noop$2=()=>{},toFiniteNumber=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function isSpecCompliantForm(s){return!!(s&&isFunction$2(s.append)&&s[toStringTag]==="FormData"&&s[iterator])}const toJSONObject=s=>{const e=new Array(10),o=(a,c)=>{if(isObject(a)){if(e.indexOf(a)>=0)return;if(isBuffer(a))return a;if(!("toJSON"in a)){e[c]=a;const d=isArray(a)?[]:{};return forEach$1(a,(h,g)=>{const b=o(h,c+1);!isUndefined(b)&&(d[g]=b)}),e[c]=void 0,d}}return a};return o(s,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=s=>s&&(isObject(s)||isFunction$2(s))&&isFunction$2(s.then)&&isFunction$2(s.catch),_setImmediate=((s,e)=>s?setImmediate:e?((o,a)=>(_global.addEventListener("message",({source:c,data:d})=>{c===_global&&d===o&&a.length&&a.shift()()},!1),c=>{a.push(c),_global.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",isFunction$2(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=s=>s!=null&&isFunction$2(s[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber:isNumber$1,isBoolean,isObject,isPlainObject:isPlainObject$1,isEmptyObject:isEmptyObject$1,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp:isRegExp$1,isFunction:isFunction$2,isStream,isURLSearchParams,isTypedArray,isFileList,forEach:forEach$1,merge,extend:extend$1,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop:noop$2,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};let AxiosError$1=class ur extends Error{static from(e,o,a,c,d,h){const g=new ur(e.message,o||e.code,a,c,d);return g.cause=e,g.name=e.name,h&&Object.assign(g,h),g}constructor(e,o,a,c,d){super(e),this.name="AxiosError",this.isAxiosError=!0,o&&(this.code=o),a&&(this.config=a),c&&(this.request=c),d&&(this.response=d,this.status=d.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}};AxiosError$1.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";AxiosError$1.ERR_BAD_OPTION="ERR_BAD_OPTION";AxiosError$1.ECONNABORTED="ECONNABORTED";AxiosError$1.ETIMEDOUT="ETIMEDOUT";AxiosError$1.ERR_NETWORK="ERR_NETWORK";AxiosError$1.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";AxiosError$1.ERR_DEPRECATED="ERR_DEPRECATED";AxiosError$1.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";AxiosError$1.ERR_BAD_REQUEST="ERR_BAD_REQUEST";AxiosError$1.ERR_CANCELED="ERR_CANCELED";AxiosError$1.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";AxiosError$1.ERR_INVALID_URL="ERR_INVALID_URL";const httpAdapter=null;function isVisitable(s){return utils$1.isPlainObject(s)||utils$1.isArray(s)}function removeBrackets(s){return utils$1.endsWith(s,"[]")?s.slice(0,-2):s}function renderKey(s,e,o){return s?s.concat(e).map(function(c,d){return c=removeBrackets(c),!o&&d?"["+c+"]":c}).join(o?".":""):e}function isFlatArray(s){return utils$1.isArray(s)&&!s.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function(e){return/^is[A-Z]/.test(e)});function toFormData$1(s,e,o){if(!utils$1.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,o=utils$1.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(rt,it){return!utils$1.isUndefined(it[rt])});const a=o.metaTokens,c=o.visitor||$,d=o.dots,h=o.indexes,b=(o.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(e);if(!utils$1.isFunction(c))throw new TypeError("visitor must be a function");function j(nt){if(nt===null)return"";if(utils$1.isDate(nt))return nt.toISOString();if(utils$1.isBoolean(nt))return nt.toString();if(!b&&utils$1.isBlob(nt))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(nt)||utils$1.isTypedArray(nt)?b&&typeof Blob=="function"?new Blob([nt]):Buffer.from(nt):nt}function $(nt,rt,it){let st=nt;if(nt&&!it&&typeof nt=="object"){if(utils$1.endsWith(rt,"{}"))rt=a?rt:rt.slice(0,-2),nt=JSON.stringify(nt);else if(utils$1.isArray(nt)&&isFlatArray(nt)||(utils$1.isFileList(nt)||utils$1.endsWith(rt,"[]"))&&(st=utils$1.toArray(nt)))return rt=removeBrackets(rt),st.forEach(function(ot,ct){!(utils$1.isUndefined(ot)||ot===null)&&e.append(h===!0?renderKey([rt],ct,d):h===null?rt:rt+"[]",j(ot))}),!1}return isVisitable(nt)?!0:(e.append(renderKey(it,rt,d),j(nt)),!1)}const _=[],_e=Object.assign(predicates,{defaultVisitor:$,convertValue:j,isVisitable});function et(nt,rt){if(!utils$1.isUndefined(nt)){if(_.indexOf(nt)!==-1)throw Error("Circular reference detected in "+rt.join("."));_.push(nt),utils$1.forEach(nt,function(st,lt){(!(utils$1.isUndefined(st)||st===null)&&c.call(e,st,utils$1.isString(lt)?lt.trim():lt,rt,_e))===!0&&et(st,rt?rt.concat(lt):[lt])}),_.pop()}}if(!utils$1.isObject(s))throw new TypeError("data must be an object");return et(s),e}function encode$1(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(a){return e[a]})}function AxiosURLSearchParams(s,e){this._pairs=[],s&&toFormData$1(s,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(e,o){this._pairs.push([e,o])};prototype.toString=function(e){const o=e?function(a){return e.call(this,a,encode$1)}:encode$1;return this._pairs.map(function(c){return o(c[0])+"="+o(c[1])},"").join("&")};function encode(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function buildURL(s,e,o){if(!e)return s;const a=o&&o.encode||encode,c=utils$1.isFunction(o)?{serialize:o}:o,d=c&&c.serialize;let h;if(d?h=d(e,c):h=utils$1.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,c).toString(a),h){const g=s.indexOf("#");g!==-1&&(s=s.slice(0,g)),s+=(s.indexOf("?")===-1?"?":"&")+h}return s}class InterceptorManager{constructor(){this.handlers=[]}use(e,o,a){return this.handlers.push({fulfilled:e,rejected:o,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,function(a){a!==null&&e(a)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(s,e){return toFormData$1(s,new platform.classes.URLSearchParams,{visitor:function(o,a,c,d){return platform.isNode&&utils$1.isBuffer(o)?(this.append(a,o.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)},...e})}function parsePropPath(s){return utils$1.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(s){const e={},o=Object.keys(s);let a;const c=o.length;let d;for(a=0;a<c;a++)d=o[a],e[d]=s[d];return e}function formDataToJSON(s){function e(o,a,c,d){let h=o[d++];if(h==="__proto__")return!0;const g=Number.isFinite(+h),b=d>=o.length;return h=!h&&utils$1.isArray(c)?c.length:h,b?(utils$1.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!g):((!c[h]||!utils$1.isObject(c[h]))&&(c[h]=[]),e(o,a,c[h],d)&&utils$1.isArray(c[h])&&(c[h]=arrayToObject(c[h])),!g)}if(utils$1.isFormData(s)&&utils$1.isFunction(s.entries)){const o={};return utils$1.forEachEntry(s,(a,c)=>{e(parsePropPath(a),c,o,0)}),o}return null}function stringifySafely(s,e,o){if(utils$1.isString(s))try{return(e||JSON.parse)(s),utils$1.trim(s)}catch(a){if(a.name!=="SyntaxError")throw a}return(o||JSON.stringify)(s)}const defaults$2={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(e,o){const a=o.getContentType()||"",c=a.indexOf("application/json")>-1,d=utils$1.isObject(e);if(d&&utils$1.isHTMLForm(e)&&(e=new FormData(e)),utils$1.isFormData(e))return c?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e)||utils$1.isReadableStream(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let g;if(d){if(a.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((g=utils$1.isFileList(e))||a.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return toFormData$1(g?{"files[]":e}:e,b&&new b,this.formSerializer)}}return d||c?(o.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(e){const o=this.transitional||defaults$2.transitional,a=o&&o.forcedJSONParsing,c=this.responseType==="json";if(utils$1.isResponse(e)||utils$1.isReadableStream(e))return e;if(e&&utils$1.isString(e)&&(a&&!this.responseType||c)){const h=!(o&&o.silentJSONParsing)&&c;try{return JSON.parse(e,this.parseReviver)}catch(g){if(h)throw g.name==="SyntaxError"?AxiosError$1.from(g,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):g}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],s=>{defaults$2.headers[s]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=s=>{const e={};let o,a,c;return s&&s.split(`
`).forEach(function(h){c=h.indexOf(":"),o=h.substring(0,c).trim().toLowerCase(),a=h.substring(c+1).trim(),!(!o||e[o]&&ignoreDuplicateOf[o])&&(o==="set-cookie"?e[o]?e[o].push(a):e[o]=[a]:e[o]=e[o]?e[o]+", "+a:a)}),e},$internals=Symbol("internals");function normalizeHeader(s){return s&&String(s).trim().toLowerCase()}function normalizeValue(s){return s===!1||s==null?s:utils$1.isArray(s)?s.map(normalizeValue):String(s)}function parseTokens(s){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=o.exec(s);)e[a[1]]=a[2];return e}const isValidHeaderName=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function matchHeaderValue(s,e,o,a,c){if(utils$1.isFunction(a))return a.call(this,e,o);if(c&&(e=o),!!utils$1.isString(e)){if(utils$1.isString(a))return e.indexOf(a)!==-1;if(utils$1.isRegExp(a))return a.test(e)}}function formatHeader(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,a)=>o.toUpperCase()+a)}function buildAccessors(s,e){const o=utils$1.toCamelCase(" "+e);["get","set","has"].forEach(a=>{Object.defineProperty(s,a+o,{value:function(c,d,h){return this[a].call(this,e,c,d,h)},configurable:!0})})}let AxiosHeaders$1=class{constructor(e){e&&this.set(e)}set(e,o,a){const c=this;function d(g,b,j){const $=normalizeHeader(b);if(!$)throw new Error("header name must be a non-empty string");const _=utils$1.findKey(c,$);(!_||c[_]===void 0||j===!0||j===void 0&&c[_]!==!1)&&(c[_||b]=normalizeValue(g))}const h=(g,b)=>utils$1.forEach(g,(j,$)=>d(j,$,b));if(utils$1.isPlainObject(e)||e instanceof this.constructor)h(e,o);else if(utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e))h(parseHeaders(e),o);else if(utils$1.isObject(e)&&utils$1.isIterable(e)){let g={},b,j;for(const $ of e){if(!utils$1.isArray($))throw TypeError("Object iterator must return a key-value pair");g[j=$[0]]=(b=g[j])?utils$1.isArray(b)?[...b,$[1]]:[b,$[1]]:$[1]}h(g,o)}else e!=null&&d(o,e,a);return this}get(e,o){if(e=normalizeHeader(e),e){const a=utils$1.findKey(this,e);if(a){const c=this[a];if(!o)return c;if(o===!0)return parseTokens(c);if(utils$1.isFunction(o))return o.call(this,c,a);if(utils$1.isRegExp(o))return o.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=normalizeHeader(e),e){const a=utils$1.findKey(this,e);return!!(a&&this[a]!==void 0&&(!o||matchHeaderValue(this,this[a],a,o)))}return!1}delete(e,o){const a=this;let c=!1;function d(h){if(h=normalizeHeader(h),h){const g=utils$1.findKey(a,h);g&&(!o||matchHeaderValue(a,a[g],g,o))&&(delete a[g],c=!0)}}return utils$1.isArray(e)?e.forEach(d):d(e),c}clear(e){const o=Object.keys(this);let a=o.length,c=!1;for(;a--;){const d=o[a];(!e||matchHeaderValue(this,this[d],d,e,!0))&&(delete this[d],c=!0)}return c}normalize(e){const o=this,a={};return utils$1.forEach(this,(c,d)=>{const h=utils$1.findKey(a,d);if(h){o[h]=normalizeValue(c),delete o[d];return}const g=e?formatHeader(d):String(d).trim();g!==d&&delete o[d],o[g]=normalizeValue(c),a[g]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return utils$1.forEach(this,(a,c)=>{a!=null&&a!==!1&&(o[c]=e&&utils$1.isArray(a)?a.join(", "):a)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const a=new this(e);return o.forEach(c=>a.set(c)),a}static accessor(e){const a=(this[$internals]=this[$internals]={accessors:{}}).accessors,c=this.prototype;function d(h){const g=normalizeHeader(h);a[g]||(buildAccessors(c,h),a[g]=!0)}return utils$1.isArray(e)?e.forEach(d):d(e),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:s},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(a){this[o]=a}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(s,e){const o=this||defaults$2,a=e||o,c=AxiosHeaders$1.from(a.headers);let d=a.data;return utils$1.forEach(s,function(g){d=g.call(o,d,c.normalize(),e?e.status:void 0)}),c.normalize(),d}function isCancel$1(s){return!!(s&&s.__CANCEL__)}let CanceledError$1=class extends AxiosError$1{constructor(e,o,a){super(e??"canceled",AxiosError$1.ERR_CANCELED,o,a),this.name="CanceledError",this.__CANCEL__=!0}};function settle(s,e,o){const a=o.config.validateStatus;!o.status||!a||a(o.status)?s(o):e(new AxiosError$1("Request failed with status code "+o.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function parseProtocol(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function speedometer(s,e){s=s||10;const o=new Array(s),a=new Array(s);let c=0,d=0,h;return e=e!==void 0?e:1e3,function(b){const j=Date.now(),$=a[d];h||(h=j),o[c]=b,a[c]=j;let _=d,_e=0;for(;_!==c;)_e+=o[_++],_=_%s;if(c=(c+1)%s,c===d&&(d=(d+1)%s),j-h<e)return;const et=$&&j-$;return et?Math.round(_e*1e3/et):void 0}}function throttle(s,e){let o=0,a=1e3/e,c,d;const h=(j,$=Date.now())=>{o=$,c=null,d&&(clearTimeout(d),d=null),s(...j)};return[(...j)=>{const $=Date.now(),_=$-o;_>=a?h(j,$):(c=j,d||(d=setTimeout(()=>{d=null,h(c)},a-_)))},()=>c&&h(c)]}const progressEventReducer=(s,e,o=3)=>{let a=0;const c=speedometer(50,250);return throttle(d=>{const h=d.loaded,g=d.lengthComputable?d.total:void 0,b=h-a,j=c(b),$=h<=g;a=h;const _={loaded:h,total:g,progress:g?h/g:void 0,bytes:b,rate:j||void 0,estimated:j&&g&&$?(g-h)/j:void 0,event:d,lengthComputable:g!=null,[e?"download":"upload"]:!0};s(_)},o)},progressEventDecorator=(s,e)=>{const o=s!=null;return[a=>e[0]({lengthComputable:o,total:s,loaded:a}),e[1]]},asyncDecorator=s=>(...e)=>utils$1.asap(()=>s(...e)),isURLSameOrigin=platform.hasStandardBrowserEnv?((s,e)=>o=>(o=new URL(o,platform.origin),s.protocol===o.protocol&&s.host===o.host&&(e||s.port===o.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(s,e,o,a,c,d,h){if(typeof document>"u")return;const g=[`${s}=${encodeURIComponent(e)}`];utils$1.isNumber(o)&&g.push(`expires=${new Date(o).toUTCString()}`),utils$1.isString(a)&&g.push(`path=${a}`),utils$1.isString(c)&&g.push(`domain=${c}`),d===!0&&g.push("secure"),utils$1.isString(h)&&g.push(`SameSite=${h}`),document.cookie=g.join("; ")},read(s){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function combineURLs(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function buildFullPath(s,e,o){let a=!isAbsoluteURL(e);return s&&(a||o==!1)?combineURLs(s,e):e}const headersToObject=s=>s instanceof AxiosHeaders$1?{...s}:s;function mergeConfig$1(s,e){e=e||{};const o={};function a(j,$,_,_e){return utils$1.isPlainObject(j)&&utils$1.isPlainObject($)?utils$1.merge.call({caseless:_e},j,$):utils$1.isPlainObject($)?utils$1.merge({},$):utils$1.isArray($)?$.slice():$}function c(j,$,_,_e){if(utils$1.isUndefined($)){if(!utils$1.isUndefined(j))return a(void 0,j,_,_e)}else return a(j,$,_,_e)}function d(j,$){if(!utils$1.isUndefined($))return a(void 0,$)}function h(j,$){if(utils$1.isUndefined($)){if(!utils$1.isUndefined(j))return a(void 0,j)}else return a(void 0,$)}function g(j,$,_){if(_ in e)return a(j,$);if(_ in s)return a(void 0,j)}const b={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:g,headers:(j,$,_)=>c(headersToObject(j),headersToObject($),_,!0)};return utils$1.forEach(Object.keys({...s,...e}),function($){const _=b[$]||c,_e=_(s[$],e[$],$);utils$1.isUndefined(_e)&&_!==g||(o[$]=_e)}),o}const resolveConfig=s=>{const e=mergeConfig$1({},s);let{data:o,withXSRFToken:a,xsrfHeaderName:c,xsrfCookieName:d,headers:h,auth:g}=e;if(e.headers=h=AxiosHeaders$1.from(h),e.url=buildURL(buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),g&&h.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),utils$1.isFormData(o)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(utils$1.isFunction(o.getHeaders)){const b=o.getHeaders(),j=["content-type","content-length"];Object.entries(b).forEach(([$,_])=>{j.includes($.toLowerCase())&&h.set($,_)})}}if(platform.hasStandardBrowserEnv&&(a&&utils$1.isFunction(a)&&(a=a(e)),a||a!==!1&&isURLSameOrigin(e.url))){const b=c&&d&&cookies.read(d);b&&h.set(c,b)}return e},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(s){return new Promise(function(o,a){const c=resolveConfig(s);let d=c.data;const h=AxiosHeaders$1.from(c.headers).normalize();let{responseType:g,onUploadProgress:b,onDownloadProgress:j}=c,$,_,_e,et,nt;function rt(){et&&et(),nt&&nt(),c.cancelToken&&c.cancelToken.unsubscribe($),c.signal&&c.signal.removeEventListener("abort",$)}let it=new XMLHttpRequest;it.open(c.method.toUpperCase(),c.url,!0),it.timeout=c.timeout;function st(){if(!it)return;const ot=AxiosHeaders$1.from("getAllResponseHeaders"in it&&it.getAllResponseHeaders()),ut={data:!g||g==="text"||g==="json"?it.responseText:it.response,status:it.status,statusText:it.statusText,headers:ot,config:s,request:it};settle(function(dt){o(dt),rt()},function(dt){a(dt),rt()},ut),it=null}"onloadend"in it?it.onloadend=st:it.onreadystatechange=function(){!it||it.readyState!==4||it.status===0&&!(it.responseURL&&it.responseURL.indexOf("file:")===0)||setTimeout(st)},it.onabort=function(){it&&(a(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,s,it)),it=null)},it.onerror=function(ct){const ut=ct&&ct.message?ct.message:"Network Error",at=new AxiosError$1(ut,AxiosError$1.ERR_NETWORK,s,it);at.event=ct||null,a(at),it=null},it.ontimeout=function(){let ct=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const ut=c.transitional||transitionalDefaults;c.timeoutErrorMessage&&(ct=c.timeoutErrorMessage),a(new AxiosError$1(ct,ut.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,s,it)),it=null},d===void 0&&h.setContentType(null),"setRequestHeader"in it&&utils$1.forEach(h.toJSON(),function(ct,ut){it.setRequestHeader(ut,ct)}),utils$1.isUndefined(c.withCredentials)||(it.withCredentials=!!c.withCredentials),g&&g!=="json"&&(it.responseType=c.responseType),j&&([_e,nt]=progressEventReducer(j,!0),it.addEventListener("progress",_e)),b&&it.upload&&([_,et]=progressEventReducer(b),it.upload.addEventListener("progress",_),it.upload.addEventListener("loadend",et)),(c.cancelToken||c.signal)&&($=ot=>{it&&(a(!ot||ot.type?new CanceledError$1(null,s,it):ot),it.abort(),it=null)},c.cancelToken&&c.cancelToken.subscribe($),c.signal&&(c.signal.aborted?$():c.signal.addEventListener("abort",$)));const lt=parseProtocol(c.url);if(lt&&platform.protocols.indexOf(lt)===-1){a(new AxiosError$1("Unsupported protocol "+lt+":",AxiosError$1.ERR_BAD_REQUEST,s));return}it.send(d||null)})},composeSignals=(s,e)=>{const{length:o}=s=s?s.filter(Boolean):[];if(e||o){let a=new AbortController,c;const d=function(j){if(!c){c=!0,g();const $=j instanceof Error?j:this.reason;a.abort($ instanceof AxiosError$1?$:new CanceledError$1($ instanceof Error?$.message:$))}};let h=e&&setTimeout(()=>{h=null,d(new AxiosError$1(`timeout of ${e}ms exceeded`,AxiosError$1.ETIMEDOUT))},e);const g=()=>{s&&(h&&clearTimeout(h),h=null,s.forEach(j=>{j.unsubscribe?j.unsubscribe(d):j.removeEventListener("abort",d)}),s=null)};s.forEach(j=>j.addEventListener("abort",d));const{signal:b}=a;return b.unsubscribe=()=>utils$1.asap(g),b}},streamChunk=function*(s,e){let o=s.byteLength;if(o<e){yield s;return}let a=0,c;for(;a<o;)c=a+e,yield s.slice(a,c),a=c},readBytes=async function*(s,e){for await(const o of readStream(s))yield*streamChunk(o,e)},readStream=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:o,value:a}=await e.read();if(o)break;yield a}}finally{await e.cancel()}},trackStream=(s,e,o,a)=>{const c=readBytes(s,e);let d=0,h,g=b=>{h||(h=!0,a&&a(b))};return new ReadableStream({async pull(b){try{const{done:j,value:$}=await c.next();if(j){g(),b.close();return}let _=$.byteLength;if(o){let _e=d+=_;o(_e)}b.enqueue(new Uint8Array($))}catch(j){throw g(j),j}},cancel(b){return g(b),c.return()}},{highWaterMark:2})},DEFAULT_CHUNK_SIZE=64*1024,{isFunction:isFunction$1}=utils$1,globalFetchAPI=(({Request:s,Response:e})=>({Request:s,Response:e}))(utils$1.global),{ReadableStream:ReadableStream$1,TextEncoder}=utils$1.global,test=(s,...e)=>{try{return!!s(...e)}catch{return!1}},factory=s=>{s=utils$1.merge.call({skipUndefined:!0},globalFetchAPI,s);const{fetch:e,Request:o,Response:a}=s,c=e?isFunction$1(e):typeof fetch=="function",d=isFunction$1(o),h=isFunction$1(a);if(!c)return!1;const g=c&&isFunction$1(ReadableStream$1),b=c&&(typeof TextEncoder=="function"?(nt=>rt=>nt.encode(rt))(new TextEncoder):async nt=>new Uint8Array(await new o(nt).arrayBuffer())),j=d&&g&&test(()=>{let nt=!1;const rt=new o(platform.origin,{body:new ReadableStream$1,method:"POST",get duplex(){return nt=!0,"half"}}).headers.has("Content-Type");return nt&&!rt}),$=h&&g&&test(()=>utils$1.isReadableStream(new a("").body)),_={stream:$&&(nt=>nt.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(nt=>{!_[nt]&&(_[nt]=(rt,it)=>{let st=rt&&rt[nt];if(st)return st.call(rt);throw new AxiosError$1(`Response type '${nt}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,it)})});const _e=async nt=>{if(nt==null)return 0;if(utils$1.isBlob(nt))return nt.size;if(utils$1.isSpecCompliantForm(nt))return(await new o(platform.origin,{method:"POST",body:nt}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(nt)||utils$1.isArrayBuffer(nt))return nt.byteLength;if(utils$1.isURLSearchParams(nt)&&(nt=nt+""),utils$1.isString(nt))return(await b(nt)).byteLength},et=async(nt,rt)=>{const it=utils$1.toFiniteNumber(nt.getContentLength());return it??_e(rt)};return async nt=>{let{url:rt,method:it,data:st,signal:lt,cancelToken:ot,timeout:ct,onDownloadProgress:ut,onUploadProgress:at,responseType:dt,headers:ft,withCredentials:xt="same-origin",fetchOptions:Ct}=resolveConfig(nt),yt=e||fetch;dt=dt?(dt+"").toLowerCase():"text";let Et=composeSignals([lt,ot&&ot.toAbortSignal()],ct),Tt=null;const ht=Et&&Et.unsubscribe&&(()=>{Et.unsubscribe()});let wt;try{if(at&&j&&it!=="get"&&it!=="head"&&(wt=await et(ft,st))!==0){let kt=new o(rt,{method:"POST",body:st,duplex:"half"}),Rt;if(utils$1.isFormData(st)&&(Rt=kt.headers.get("content-type"))&&ft.setContentType(Rt),kt.body){const[At,Mt]=progressEventDecorator(wt,progressEventReducer(asyncDecorator(at)));st=trackStream(kt.body,DEFAULT_CHUNK_SIZE,At,Mt)}}utils$1.isString(xt)||(xt=xt?"include":"omit");const St=d&&"credentials"in o.prototype,bt={...Ct,signal:Et,method:it.toUpperCase(),headers:ft.normalize().toJSON(),body:st,duplex:"half",credentials:St?xt:void 0};Tt=d&&new o(rt,bt);let mt=await(d?yt(Tt,Ct):yt(rt,bt));const gt=$&&(dt==="stream"||dt==="response");if($&&(ut||gt&&ht)){const kt={};["status","statusText","headers"].forEach(Dt=>{kt[Dt]=mt[Dt]});const Rt=utils$1.toFiniteNumber(mt.headers.get("content-length")),[At,Mt]=ut&&progressEventDecorator(Rt,progressEventReducer(asyncDecorator(ut),!0))||[];mt=new a(trackStream(mt.body,DEFAULT_CHUNK_SIZE,At,()=>{Mt&&Mt(),ht&&ht()}),kt)}dt=dt||"text";let pt=await _[utils$1.findKey(_,dt)||"text"](mt,nt);return!gt&&ht&&ht(),await new Promise((kt,Rt)=>{settle(kt,Rt,{data:pt,headers:AxiosHeaders$1.from(mt.headers),status:mt.status,statusText:mt.statusText,config:nt,request:Tt})})}catch(St){throw ht&&ht(),St&&St.name==="TypeError"&&/Load failed|fetch/i.test(St.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,nt,Tt),{cause:St.cause||St}):AxiosError$1.from(St,St&&St.code,nt,Tt)}}},seedCache=new Map,getFetch=s=>{let e=s&&s.env||{};const{fetch:o,Request:a,Response:c}=e,d=[a,c,o];let h=d.length,g=h,b,j,$=seedCache;for(;g--;)b=d[g],j=$.get(b),j===void 0&&$.set(b,j=g?new Map:factory(e)),$=j;return j};getFetch();const knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:{get:getFetch}};utils$1.forEach(knownAdapters,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const renderReason=s=>`- ${s}`,isResolvedHandle=s=>utils$1.isFunction(s)||s===null||s===!1;function getAdapter$1(s,e){s=utils$1.isArray(s)?s:[s];const{length:o}=s;let a,c;const d={};for(let h=0;h<o;h++){a=s[h];let g;if(c=a,!isResolvedHandle(a)&&(c=knownAdapters[(g=String(a)).toLowerCase()],c===void 0))throw new AxiosError$1(`Unknown adapter '${g}'`);if(c&&(utils$1.isFunction(c)||(c=c.get(e))))break;d[g||"#"+h]=c}if(!c){const h=Object.entries(d).map(([b,j])=>`adapter ${b} `+(j===!1?"is not supported by the environment":"is not available in the build"));let g=o?h.length>1?`since :
`+h.map(renderReason).join(`
`):" "+renderReason(h[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+g,"ERR_NOT_SUPPORT")}return c}const adapters={getAdapter:getAdapter$1,adapters:knownAdapters};function throwIfCancellationRequested(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new CanceledError$1(null,s)}function dispatchRequest(s){return throwIfCancellationRequested(s),s.headers=AxiosHeaders$1.from(s.headers),s.data=transformData.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(s.adapter||defaults$2.adapter,s)(s).then(function(a){return throwIfCancellationRequested(s),a.data=transformData.call(s,s.transformResponse,a),a.headers=AxiosHeaders$1.from(a.headers),a},function(a){return isCancel$1(a)||(throwIfCancellationRequested(s),a&&a.response&&(a.response.data=transformData.call(s,s.transformResponse,a.response),a.response.headers=AxiosHeaders$1.from(a.response.headers))),Promise.reject(a)})}const VERSION$1="1.13.3",validators$1={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{validators$1[s]=function(a){return typeof a===s||"a"+(e<1?"n ":" ")+s}});const deprecatedWarnings={};validators$1.transitional=function(e,o,a){function c(d,h){return"[Axios v"+VERSION$1+"] Transitional option '"+d+"'"+h+(a?". "+a:"")}return(d,h,g)=>{if(e===!1)throw new AxiosError$1(c(h," has been removed"+(o?" in "+o:"")),AxiosError$1.ERR_DEPRECATED);return o&&!deprecatedWarnings[h]&&(deprecatedWarnings[h]=!0,console.warn(c(h," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(d,h,g):!0}};validators$1.spelling=function(e){return(o,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};function assertOptions(s,e,o){if(typeof s!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const a=Object.keys(s);let c=a.length;for(;c-- >0;){const d=a[c],h=e[d];if(h){const g=s[d],b=g===void 0||h(g,d,s);if(b!==!0)throw new AxiosError$1("option "+d+" must be "+b,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new AxiosError$1("Unknown option "+d,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(e){this.defaults=e||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(e,o){try{return await this._request(e,o)}catch(a){if(a instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const d=c.stack?c.stack.replace(/^.+\n/,""):"";try{a.stack?d&&!String(a.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+d):a.stack=d}catch{}}throw a}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=mergeConfig$1(this.defaults,o);const{transitional:a,paramsSerializer:c,headers:d}=o;a!==void 0&&validator.assertOptions(a,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),c!=null&&(utils$1.isFunction(c)?o.paramsSerializer={serialize:c}:validator.assertOptions(c,{encode:validators.function,serialize:validators.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),validator.assertOptions(o,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let h=d&&utils$1.merge(d.common,d[o.method]);d&&utils$1.forEach(["delete","get","head","post","put","patch","common"],nt=>{delete d[nt]}),o.headers=AxiosHeaders$1.concat(h,d);const g=[];let b=!0;this.interceptors.request.forEach(function(rt){typeof rt.runWhen=="function"&&rt.runWhen(o)===!1||(b=b&&rt.synchronous,g.unshift(rt.fulfilled,rt.rejected))});const j=[];this.interceptors.response.forEach(function(rt){j.push(rt.fulfilled,rt.rejected)});let $,_=0,_e;if(!b){const nt=[dispatchRequest.bind(this),void 0];nt.unshift(...g),nt.push(...j),_e=nt.length,$=Promise.resolve(o);let rt=o;for(;_<_e;)$=$.then(nt[_++]).then(it=>{rt=it!==void 0?it:rt}).catch(nt[_++]).then(()=>rt);return $}_e=g.length;let et=o;for(;_<_e;){const nt=g[_++],rt=g[_++];try{et=nt(et)}catch(it){rt.call(this,it);break}}try{$=dispatchRequest.call(this,et)}catch(nt){return Promise.reject(nt)}for(_=0,_e=j.length;_<_e;)$=$.then(j[_++]).catch(j[_++]);return $}getUri(e){e=mergeConfig$1(this.defaults,e);const o=buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls);return buildURL(o,e.params,e.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function(e){Axios$1.prototype[e]=function(o,a){return this.request(mergeConfig$1(a||{},{method:e,url:o,data:(a||{}).data}))}});utils$1.forEach(["post","put","patch"],function(e){function o(a){return function(d,h,g){return this.request(mergeConfig$1(g||{},{method:e,headers:a?{"Content-Type":"multipart/form-data"}:{},url:d,data:h}))}}Axios$1.prototype[e]=o(),Axios$1.prototype[e+"Form"]=o(!0)});let CancelToken$1=class dr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(d){o=d});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new Promise(g=>{a.subscribe(g),d=g}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},e(function(d,h,g){a.reason||(a.reason=new CanceledError$1(d,h,g),o(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=a=>{e.abort(a)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new dr(function(c){e=c}),cancel:e}}};function spread$1(s){return function(o){return s.apply(null,o)}}function isAxiosError$1(s){return utils$1.isObject(s)&&s.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(HttpStatusCode$1).forEach(([s,e])=>{HttpStatusCode$1[e]=s});function createInstance(s){const e=new Axios$1(s),o=bind$1(Axios$1.prototype.request,e);return utils$1.extend(o,Axios$1.prototype,e,{allOwnKeys:!0}),utils$1.extend(o,e,null,{allOwnKeys:!0}),o.create=function(c){return createInstance(mergeConfig$1(s,c))},o}const axios=createInstance(defaults$2);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function(e){return Promise.all(e)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=s=>formDataToJSON(utils$1.isHTMLForm(s)?new FormData(s):s);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,api=axios.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});api.interceptors.request.use(s=>{const e=localStorage.getItem("auth_token");return e&&(s.headers.Authorization=`Bearer ${e}`),s});api.interceptors.response.use(s=>s,s=>{var e;return((e=s.response)==null?void 0:e.status)===401&&(localStorage.removeItem("auth_token"),window.location.href="/login"),Promise.reject(s)});const useAuthStore=create$2(s=>({user:null,isLoading:!0,isAuthenticated:!1,login:async(e,o)=>{const a=await api.post("/auth/login",{email:e,password:o}),{access_token:c}=a.data;localStorage.setItem("auth_token",c);const d=await api.get("/auth/me");s({user:d.data,isAuthenticated:!0})},register:async(e,o,a)=>{await api.post("/auth/register",{email:e,password:o,name:a})},logout:()=>{localStorage.removeItem("auth_token"),s({user:null,isAuthenticated:!1})},checkAuth:async()=>{if(!localStorage.getItem("auth_token")){s({isLoading:!1,isAuthenticated:!1});return}try{const o=await api.get("/auth/me");s({user:o.data,isAuthenticated:!0,isLoading:!1})}catch{localStorage.removeItem("auth_token"),s({user:null,isAuthenticated:!1,isLoading:!1})}}}));/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),createLucideIcon=(s,e)=>{const o=reactExports.forwardRef(({color:a="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:h,className:g="",children:b,...j},$)=>reactExports.createElement("svg",{ref:$,...defaultAttributes,width:c,height:c,stroke:a,strokeWidth:h?Number(d)*24/Number(c):d,className:["lucide",`lucide-${toKebabCase(s)}`,g].join(" "),...j},[...e.map(([_,_e])=>reactExports.createElement(_,_e)),...Array.isArray(b)?b:[b]]));return o.displayName=`${s}`,o};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AlertCircle=createLucideIcon("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AlignCenter=createLucideIcon("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AlignJustify=createLucideIcon("AlignJustify",[["line",{x1:"3",x2:"21",y1:"6",y2:"6",key:"4m8b97"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}],["line",{x1:"3",x2:"21",y1:"18",y2:"18",key:"kwyyxn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AlignLeft=createLucideIcon("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AlignRight=createLucideIcon("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowRight=createLucideIcon("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Award=createLucideIcon("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bold$1=createLucideIcon("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BookOpen=createLucideIcon("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BookmarkCheck=createLucideIcon("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bookmark=createLucideIcon("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Brain=createLucideIcon("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CheckCircle=createLucideIcon("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronUp=createLucideIcon("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Code$1=createLucideIcon("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Columns=createLucideIcon("Columns",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"12",x2:"12",y1:"3",y2:"21",key:"1efggb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Compass=createLucideIcon("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Copy=createLucideIcon("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Download=createLucideIcon("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ExternalLink=createLucideIcon("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=createLucideIcon("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FileText=createLucideIcon("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Flag=createLucideIcon("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gamepad2=createLucideIcon("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GitFork=createLucideIcon("GitFork",[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GripVertical=createLucideIcon("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heading1=createLucideIcon("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heading2=createLucideIcon("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heading3=createLucideIcon("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Heart=createLucideIcon("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HelpCircle=createLucideIcon("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Highlighter=createLucideIcon("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const History$1=createLucideIcon("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Home=createLucideIcon("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Image$1=createLucideIcon("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Italic$1=createLucideIcon("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lightbulb=createLucideIcon("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Link$1=createLucideIcon("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ListOrdered=createLucideIcon("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const List=createLucideIcon("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Loader2=createLucideIcon("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogOut=createLucideIcon("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Map$1=createLucideIcon("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Maximize2=createLucideIcon("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Merge=createLucideIcon("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageSquare=createLucideIcon("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minimize2=createLucideIcon("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Palette=createLucideIcon("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pencil=createLucideIcon("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Play=createLucideIcon("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Quote=createLucideIcon("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Redo=createLucideIcon("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Reply=createLucideIcon("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rocket=createLucideIcon("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RotateCcw=createLucideIcon("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rows=createLucideIcon("Rows",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"12",y2:"12",key:"10d38w"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Save=createLucideIcon("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Send=createLucideIcon("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sparkles=createLucideIcon("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Split=createLucideIcon("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Strikethrough=createLucideIcon("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Table$1=createLucideIcon("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Target=createLucideIcon("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Undo=createLucideIcon("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Unlink=createLucideIcon("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Upload=createLucideIcon("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Users=createLucideIcon("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zap=createLucideIcon("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Button=({variant:s="primary",size:e="md",loading:o=!1,children:a,className:c="",disabled:d,...h})=>{const g=`
    inline-flex items-center justify-center font-medium rounded-lg
    transition-all duration-200 ease-out
    focus:outline-none focus:ring-2 focus:ring-offset-2
    active:scale-[0.98]
  `,b={primary:`
      bg-primary-600 text-white
      hover:bg-primary-700 hover:shadow-md
      focus:ring-primary-500
      disabled:bg-gray-300 disabled:shadow-none
    `,secondary:`
      border border-gray-300 text-gray-700 bg-white
      hover:bg-gray-50 hover:border-gray-400
      focus:ring-primary-500
    `,ghost:`
      text-gray-600
      hover:bg-gray-100 hover:text-gray-900
      focus:ring-gray-500
    `,danger:`
      bg-red-600 text-white
      hover:bg-red-700 hover:shadow-md
      focus:ring-red-500
      disabled:bg-red-300 disabled:shadow-none
    `},j={sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-sm gap-2",lg:"px-6 py-3 text-base gap-2"},$=d||o;return jsxRuntimeExports.jsxs("button",{className:`
        ${g}
        ${b[s]}
        ${j[e]}
        ${$?"cursor-not-allowed opacity-60":""}
        ${c}
      `,disabled:$,...h,children:[o&&jsxRuntimeExports.jsxs("svg",{className:"animate-spin -ml-1 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a]})},Input=({label:s,error:e,hint:o,success:a,leftIcon:c,rightIcon:d,className:h="",required:g,...b})=>{const j=b.id||b.name;return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[s&&jsxRuntimeExports.jsxs("label",{htmlFor:j,className:"block text-sm font-medium text-gray-700 mb-1.5",children:[s,g&&jsxRuntimeExports.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[c&&jsxRuntimeExports.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:c}),jsxRuntimeExports.jsx("input",{id:j,className:`
            w-full px-4 py-2.5 border rounded-lg text-gray-900 placeholder-gray-400
            transition-all duration-150 ease-out
            focus:outline-none focus:ring-2 focus:ring-offset-0
            ${c?"pl-10":""}
            ${d||e||a?"pr-10":""}
            ${e?"border-red-400 focus:border-red-500 focus:ring-red-100 bg-red-50/50":a?"border-green-400 focus:border-green-500 focus:ring-green-100 bg-green-50/50":"border-gray-300 focus:border-primary-500 focus:ring-primary-100 hover:border-gray-400"}
            disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed
            ${h}
          `,"aria-invalid":e?"true":"false","aria-describedby":e?`${j}-error`:o?`${j}-hint`:void 0,...b}),(d||e||a)&&jsxRuntimeExports.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e?jsxRuntimeExports.jsx(AlertCircle,{className:"w-5 h-5 text-red-500"}):a?jsxRuntimeExports.jsx(CheckCircle,{className:"w-5 h-5 text-green-500"}):d})]}),e&&jsxRuntimeExports.jsx("p",{id:`${j}-error`,className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:e}),o&&!e&&jsxRuntimeExports.jsx("p",{id:`${j}-hint`,className:"mt-1.5 text-sm text-gray-500",children:o})]})},Modal=({isOpen:s,onClose:e,title:o,children:a})=>s?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:e}),jsxRuntimeExports.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6",children:[o&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:o}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 rounded-lg hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-gray-500"})})]}),a]})]}):null,Card=({children:s,className:e="",onClick:o,hover:a=!1})=>jsxRuntimeExports.jsx("div",{className:`bg-white border border-gray-200 rounded-xl p-6 shadow-sm ${a?"hover:border-primary-300 hover:shadow-md cursor-pointer":""} transition-all duration-200 ${e}`,onClick:o,children:s}),Header=()=>{const{user:s,isAuthenticated:e,logout:o}=useAuthStore(),a=useNavigate(),c=()=>{o(),a("/")};return jsxRuntimeExports.jsxs("header",{className:"h-16 bg-white border-b border-gray-200 px-6 flex items-center justify-between fixed top-0 left-0 right-0 z-40",children:[jsxRuntimeExports.jsxs(Link$2,{to:"/",className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-white font-bold text-sm",children:"AI"})}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900 text-lg",children:"AI  "})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-4",children:e?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[(s==null?void 0:s.role)&&["super_admin","editor"].includes(s.role)&&jsxRuntimeExports.jsx(Link$2,{to:"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",children:[jsxRuntimeExports.jsx(Settings,{className:"w-4 h-4 mr-2"}),"Admin"]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[jsxRuntimeExports.jsx(User,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:s==null?void 0:s.name})]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",onClick:c,children:[jsxRuntimeExports.jsx(LogOut,{className:"w-4 h-4 mr-2"}),"Logout"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Link$2,{to:"/login",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",children:"Login"})}),jsxRuntimeExports.jsx(Link$2,{to:"/register",children:jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",children:"Register"})})]})})]})},Layout=({children:s,showSidebars:e=!1})=>jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsx("main",{className:`pt-16 ${e?"":"container mx-auto px-4"}`,children:s})]}),useUIStore=create$2(s=>({leftSidebarCollapsed:!1,rightSidebarCollapsed:!1,showContinueModal:!1,toggleLeftSidebar:()=>s(e=>({leftSidebarCollapsed:!e.leftSidebarCollapsed})),toggleRightSidebar:()=>s(e=>({rightSidebarCollapsed:!e.rightSidebarCollapsed})),setShowContinueModal:e=>s({showContinueModal:e})}));function computeMainPath(s){var j;const{passages:e,links:o,start_passage_id:a}=s;if(!a||e.length===0)return[];const c=new Map(e.map($=>[$.id,$])),d=new Map;o.forEach($=>{const _=d.get($.source_passage_id)||[];_.push($),d.set($.source_passage_id,_)});const h=[],g=new Set;let b=a;for(;b&&!g.has(b);){g.add(b);const $=c.get(b);if(!$)break;h.push({id:$.id,name:$.name,type:$.passage_type}),b=((j=[...d.get(b)||[]].sort((et,nt)=>et.condition_type!=="user_selection"&&nt.condition_type==="user_selection"?-1:et.condition_type==="user_selection"&&nt.condition_type!=="user_selection"?1:et.link_order-nt.link_order)[0])==null?void 0:j.target_passage_id)||null}return h}const useStoryStore=create$2((s,e)=>({stories:[],currentStory:null,storyStructure:null,mainPath:[],currentPassage:null,previousPassageId:null,navigationHistory:[],navigationHistoryWithNames:[],currentHistoryIndex:-1,bookmarks:[],isLoading:!1,fetchStories:async()=>{s({isLoading:!0});try{const o=await api.get("/stories");s({stories:Array.isArray(o.data)?o.data:[]})}catch(o){console.error("Failed to fetch stories:",o),s({stories:[]})}finally{s({isLoading:!1})}},fetchStory:async o=>{const a=await api.get(`/stories/${o}`);s({currentStory:a.data})},fetchStoryStructure:async o=>{try{const c=(await api.get(`/stories/structure/${o}`)).data,d=computeMainPath(c);s({storyStructure:c,mainPath:d})}catch(a){console.error("Failed to fetch story structure:",a)}},startStory:async o=>{s({isLoading:!0});try{await e().fetchStory(o);const a=await api.get(`/stories/${o}/start`),c=a.data.passage;s({currentPassage:a.data,previousPassageId:null,navigationHistory:[c.id],navigationHistoryWithNames:[{id:c.id,name:c.name}],currentHistoryIndex:0}),e().saveLastVisit()}finally{s({isLoading:!1})}},loadPassageById:async(o,a=!0)=>{s({isLoading:!0});try{const c=await api.get(`/passages/${o}`),d=c.data.passage,h=d.story_id,g=e().currentStory;(!g||g.id!==h)&&await e().fetchStory(h),s(a?b=>{var j;return{currentPassage:c.data,previousPassageId:((j=b.currentPassage)==null?void 0:j.passage.id)||null,navigationHistory:[...b.navigationHistory,d.id],navigationHistoryWithNames:[...b.navigationHistoryWithNames,{id:d.id,name:d.name}],currentHistoryIndex:b.navigationHistoryWithNames.length}}:{currentPassage:c.data}),e().saveLastVisit()}finally{s({isLoading:!1})}},loadPassageByNumber:async(o,a)=>{s({isLoading:!0});try{const c=`#${o.toString().padStart(6,"0")}`,h=(await api.get("/passages/resolve",{params:{story_id:a,reference:c}})).data,g=e().currentStory;(!g||g.id!==a)&&await e().fetchStory(a),await e().loadPassageById(h.id,!1)}catch(c){throw console.error("Error loading passage by number:",c),s({isLoading:!1}),c}finally{s({isLoading:!1})}},navigateToPassage:async(o,a)=>{var c,d;s({isLoading:!0});try{const h=a||((c=e().currentPassage)==null?void 0:c.passage.id),g=(d=e().currentStory)==null?void 0:d.id,b=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o);let j;b?j=await api.get(`/passages/${o}`,{params:{previous_passage_id:h}}):j=await api.get(`/stories/${g}/passages/by-name/${encodeURIComponent(o)}`,{params:{previous_passage_id:h}});const $=j.data.passage;s(_=>({currentPassage:j.data,previousPassageId:h||null,navigationHistory:[..._.navigationHistory,$.id],navigationHistoryWithNames:[..._.navigationHistoryWithNames,{id:$.id,name:$.name}],currentHistoryIndex:_.navigationHistoryWithNames.length})),e().saveLastVisit()}finally{s({isLoading:!1})}},navigateViaLink:async o=>{var c;const a=(c=e().currentPassage)==null?void 0:c.passage.id;if(a){s({isLoading:!0});try{const d=await api.post(`/passages/${a}/navigate`,{link_id:o}),h=d.data.passage;s(g=>({currentPassage:d.data,previousPassageId:a,navigationHistory:[...g.navigationHistory,h.id],navigationHistoryWithNames:[...g.navigationHistoryWithNames,{id:h.id,name:h.name}],currentHistoryIndex:g.navigationHistoryWithNames.length})),e().saveLastVisit()}finally{s({isLoading:!1})}}},goBack:async()=>{const o=e().currentHistoryIndex;if(o<=0)return;const a=o-1,c=e().navigationHistoryWithNames,d=a>0?a-1:void 0,h=d!==void 0?c[d].id:void 0,g=c[a].id;s({isLoading:!0});try{const b=await api.get(`/passages/${g}`,{params:{previous_passage_id:h}});s({currentPassage:b.data,previousPassageId:h||null,currentHistoryIndex:a})}finally{s({isLoading:!1})}},navigateToHistoryIndex:async o=>{const a=e().navigationHistoryWithNames;if(o<0||o>=a.length)return;const c=o>0?o-1:void 0,d=c!==void 0?a[c].id:void 0,h=a[o].id;s({isLoading:!0});try{const g=await api.get(`/passages/${h}`,{params:{previous_passage_id:d}});s({currentPassage:g.data,previousPassageId:d||null,currentHistoryIndex:o})}finally{s({isLoading:!1})}},navigateToMainPathIndex:async o=>{const a=e().mainPath;if(o<0||o>=a.length)return;const c=a[o].id,d=o>0?a[o-1].id:void 0;s({isLoading:!0});try{const h=await api.get(`/passages/${c}`,{params:{previous_passage_id:d}}),g=a.slice(0,o+1).map(j=>j.id),b=a.slice(0,o+1).map(j=>({id:j.id,name:j.name}));s({currentPassage:h.data,previousPassageId:d||null,navigationHistory:g,navigationHistoryWithNames:b,currentHistoryIndex:o}),e().saveLastVisit()}finally{s({isLoading:!1})}},fetchBookmarks:async()=>{try{const o=await api.get("/bookmarks");s({bookmarks:o.data})}catch{}},addBookmark:async o=>{await api.post(`/bookmarks/${o}`),await e().fetchBookmarks()},removeBookmark:async o=>{await api.delete(`/bookmarks/${o}`),await e().fetchBookmarks()},saveLastVisit:()=>{const{currentStory:o,currentPassage:a}=e();o&&a&&localStorage.setItem("last_visit",JSON.stringify({storyId:o.id,passageId:a.passage.id,timestamp:Date.now()}))},getLastVisit:()=>{const o=localStorage.getItem("last_visit");if(!o)return null;try{return JSON.parse(o)}catch{return null}},refreshCurrentPassage:async()=>{const o=e().currentPassage,a=e().previousPassageId;if(o)try{const c=await api.get(`/passages/${o.passage.id}`,{params:{previous_passage_id:a}});s({currentPassage:c.data})}catch(c){console.error("Failed to refresh passage:",c)}}})),LeftSidebar=()=>{const s=useNavigate(),{leftSidebarCollapsed:e,toggleLeftSidebar:o}=useUIStore(),{bookmarks:a,currentPassage:c,navigateToPassage:d,currentStory:h,navigationHistoryWithNames:g,currentHistoryIndex:b,navigateToHistoryIndex:j,stories:$,fetchStories:_,startStory:_e}=useStoryStore();reactExports.useEffect(()=>{_()},[_]);const et=a.filter(nt=>nt.story_id===(h==null?void 0:h.id));return e?jsxRuntimeExports.jsx("aside",{className:"w-[60px] bg-white border-r border-gray-200 flex flex-col sticky top-16 h-[calc(100vh-64px)]",children:jsxRuntimeExports.jsx("button",{onClick:o,className:"p-4 hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-gray-500"})})}):jsxRuntimeExports.jsxs("aside",{className:"w-[280px] bg-white border-r border-gray-200 flex flex-col overflow-hidden sticky top-16 h-[calc(100vh-64px)]",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:""}),jsxRuntimeExports.jsx("button",{onClick:o,className:"p-1 rounded hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5 text-gray-500"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-600 mb-3",children:[jsxRuntimeExports.jsx(Bookmark,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:""})]}),et.length>0?jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:et.map(nt=>jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsx("button",{onClick:()=>d(nt.passage_id),className:`w-full text-left px-3 py-2 text-sm rounded-lg transition-colors ${(c==null?void 0:c.passage.id)===nt.passage_id?"bg-primary-100 text-primary-700":"hover:bg-gray-100 text-gray-700"}`,children:nt.passage_name||" "})},nt.id))}):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400",children:"  "})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-600 mb-3",children:[jsxRuntimeExports.jsx(History$1,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:""})]}),g.length>0?jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:g.slice(-10).map((nt,rt)=>{const st=Math.max(0,g.length-10)+rt;return jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsxs("button",{onClick:()=>j(st),className:`w-full text-left px-3 py-2 text-sm rounded-lg transition-colors ${st===b?"bg-primary-100 text-primary-700 font-medium":"hover:bg-gray-100 text-gray-700"}`,children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-400 mr-2",children:[rt+1,"."]}),nt.name||" "]})},`${nt.id}-${rt}`)})}):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400",children:"  "})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-600 mb-3",children:[jsxRuntimeExports.jsx(List,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:""})]}),$.length>0?jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:$.map(nt=>jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsxs("button",{onClick:async()=>{await _e(nt.id),s("/passage")},className:`w-full text-left px-3 py-3 rounded-lg transition-colors ${(h==null?void 0:h.id)===nt.id?"bg-primary-100 text-primary-700 font-medium":"hover:bg-gray-100 text-gray-700"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-sm",children:nt.name}),nt.description&&jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:nt.description})]})},nt.id))}):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400",children:"   "})]})]})]})},FeedbackItem=({feedback:s,onReply:e,onDelete:o,isAuthenticated:a,currentUserId:c,isAdmin:d,depth:h=0})=>{var st;const[g,b]=reactExports.useState(!1),[j,$]=reactExports.useState(""),[_,_e]=reactExports.useState(!1),[et,nt]=reactExports.useState(!1),rt=d||s.user_id===c,it=async lt=>{if(lt.preventDefault(),!!j.trim()){nt(!0);try{await e(s.id,j,_),$(""),b(!1)}finally{nt(!1)}}};return jsxRuntimeExports.jsxs("div",{className:`${h>0?"pl-3 border-l-2 border-gray-200":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.is_anonymous?"":s.user_name||""}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString("ko-KR")}),rt&&jsxRuntimeExports.jsx("button",{onClick:()=>o(s.id),className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"",children:jsxRuntimeExports.jsx(Trash2,{className:"w-3 h-3"})})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:s.content}),a&&h<2&&jsxRuntimeExports.jsxs("button",{onClick:()=>b(!g),className:"flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700",children:[jsxRuntimeExports.jsx(Reply,{className:"w-3 h-3"}),""]}),g&&jsxRuntimeExports.jsxs("form",{onSubmit:it,className:"mt-2 space-y-2",children:[jsxRuntimeExports.jsx("textarea",{value:j,onChange:lt=>$(lt.target.value),placeholder:" ...",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm resize-none focus:outline-none focus:border-primary-500",rows:2}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_,onChange:lt=>_e(lt.target.checked),className:"rounded border-gray-300 w-3 h-3"}),""]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-2 py-1 text-xs text-gray-500 hover:text-gray-700",children:""}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:!j.trim()||et,className:"px-2 py-1 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 disabled:opacity-50",children:""})]})]})]})]}),((st=s.replies)==null?void 0:st.length)>0&&jsxRuntimeExports.jsx("div",{className:"mt-2 space-y-2",children:s.replies.map(lt=>jsxRuntimeExports.jsx(FeedbackItem,{feedback:lt,onReply:e,onDelete:o,isAuthenticated:a,currentUserId:c,isAdmin:d,depth:h+1},lt.id))})]})},RightSidebar=()=>{const{rightSidebarCollapsed:s,toggleRightSidebar:e}=useUIStore(),{currentPassage:o}=useStoryStore(),{isAuthenticated:a,user:c}=useAuthStore(),[d,h]=reactExports.useState([]),[g,b]=reactExports.useState(""),[j,$]=reactExports.useState(!1),[_,_e]=reactExports.useState(!1),et=(c==null?void 0:c.role)==="super_admin"||(c==null?void 0:c.role)==="editor";reactExports.useEffect(()=>{nt()},[o==null?void 0:o.passage.id]);const nt=async()=>{try{const lt=o!=null&&o.passage.id?{passage_id:o.passage.id}:{},ot=await api.get("/feedback",{params:lt});h(ot.data)}catch(lt){console.error("Failed to fetch feedbacks:",lt)}},rt=async lt=>{if(lt.preventDefault(),!!g.trim()){_e(!0);try{await api.post("/feedback",{passage_id:o==null?void 0:o.passage.id,content:g,is_anonymous:j}),b(""),nt()}catch(ot){console.error("Failed to submit feedback:",ot)}finally{_e(!1)}}},it=async(lt,ot,ct)=>{await api.post(`/feedback/${lt}/reply`,{content:ot,is_anonymous:ct}),nt()},st=async lt=>{confirm("  ?")&&(await api.delete(`/feedback/${lt}`),nt())};return s?jsxRuntimeExports.jsx("aside",{className:"w-[48px] bg-white border-l border-gray-200 flex flex-col sticky top-16 h-[calc(100vh-64px)]",children:jsxRuntimeExports.jsx("button",{onClick:e,className:"p-3 hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5 text-gray-500"})})}):jsxRuntimeExports.jsxs("aside",{className:"w-[320px] bg-white border-l border-gray-200 flex flex-col sticky top-16 h-[calc(100vh-64px)]",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MessageSquare,{className:"w-5 h-5 text-gray-600"}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:""}),d.length>0&&jsxRuntimeExports.jsx("span",{className:"text-xs bg-primary-100 text-primary-700 px-2 py-0.5 rounded-full",children:d.length})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 pb-[200px]",children:d.length>0?d.map(lt=>jsxRuntimeExports.jsx(FeedbackItem,{feedback:lt,onReply:it,onDelete:st,isAuthenticated:a,currentUserId:c==null?void 0:c.id,isAdmin:et},lt.id)):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"  .   !"})}),jsxRuntimeExports.jsxs("form",{onSubmit:rt,className:"absolute bottom-[72px] left-0 right-0 p-4 border-t border-gray-200 bg-white",children:[jsxRuntimeExports.jsx("textarea",{value:g,onChange:lt=>b(lt.target.value),placeholder:a?" ...":"     ",disabled:!a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:border-primary-500",rows:3}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mt-2",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:j,onChange:lt=>$(lt.target.checked),className:"rounded border-gray-300"}),""]}),jsxRuntimeExports.jsxs(Button,{type:"submit",size:"sm",disabled:!a||!g.trim()||_,children:[jsxRuntimeExports.jsx(Send,{className:"w-4 h-4 mr-1"}),""]})]})]})]})},LoginPage=()=>{const[s,e]=reactExports.useState(""),[o,a]=reactExports.useState(""),[c,d]=reactExports.useState(""),[h,g]=reactExports.useState(!1),{login:b}=useAuthStore(),j=useNavigate(),$=async _=>{var _e,et;_.preventDefault(),d(""),g(!0);try{await b(s,o),j("/")}catch(nt){d(((et=(_e=nt.response)==null?void 0:_e.data)==null?void 0:et.detail)||"Login failed")}finally{g(!1)}};return jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx("div",{className:"min-h-[calc(100vh-64px)] flex items-center justify-center py-12",children:jsxRuntimeExports.jsxs(Card,{className:"w-full max-w-md",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 text-center mb-6",children:"Login"}),c&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm",children:c}),jsxRuntimeExports.jsxs("form",{onSubmit:$,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",value:s,onChange:_=>e(_.target.value),placeholder:"your@email.com",required:!0}),jsxRuntimeExports.jsx(Input,{type:"password",label:"Password",value:o,onChange:_=>a(_.target.value),placeholder:"Your password",required:!0}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full",disabled:h,children:h?"Logging in...":"Login"})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Don't have an account?"," ",jsxRuntimeExports.jsx(Link$2,{to:"/register",className:"text-primary-600 hover:text-primary-700 font-medium",children:"Register"})]})]})})})},RegisterPage=()=>{const[s,e]=reactExports.useState(""),[o,a]=reactExports.useState(""),[c,d]=reactExports.useState(""),[h,g]=reactExports.useState(""),[b,j]=reactExports.useState(""),[$,_]=reactExports.useState(!1),{register:_e}=useAuthStore(),et=useNavigate(),nt=async rt=>{var it,st;if(rt.preventDefault(),j(""),c!==h){j("Passwords do not match");return}_(!0);try{await _e(o,c,s),et("/login")}catch(lt){j(((st=(it=lt.response)==null?void 0:it.data)==null?void 0:st.detail)||"Registration failed")}finally{_(!1)}};return jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx("div",{className:"min-h-[calc(100vh-64px)] flex items-center justify-center py-12",children:jsxRuntimeExports.jsxs(Card,{className:"w-full max-w-md",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 text-center mb-6",children:"Register"}),b&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm",children:b}),jsxRuntimeExports.jsxs("form",{onSubmit:nt,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Name",value:s,onChange:rt=>e(rt.target.value),placeholder:"Your name",required:!0}),jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",value:o,onChange:rt=>a(rt.target.value),placeholder:"your@email.com",required:!0}),jsxRuntimeExports.jsx(Input,{type:"password",label:"Password",value:c,onChange:rt=>d(rt.target.value),placeholder:"Create a password",required:!0}),jsxRuntimeExports.jsx(Input,{type:"password",label:"Confirm Password",value:h,onChange:rt=>g(rt.target.value),placeholder:"Confirm your password",required:!0}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"w-full",disabled:$,children:$?"Creating account...":"Register"})]}),jsxRuntimeExports.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",jsxRuntimeExports.jsx(Link$2,{to:"/login",className:"text-primary-600 hover:text-primary-700 font-medium",children:"Login"})]})]})})})},ICON_MAP={"book-open":BookOpen,lightbulb:Lightbulb,target:Target,rocket:Rocket,brain:Brain,code:Code$1,gamepad2:Gamepad2,map:Map$1,compass:Compass,star:Star,heart:Heart,zap:Zap,award:Award,sparkles:Sparkles,image:Image$1},getIcon=s=>ICON_MAP[s||"book-open"]||BookOpen,StorySelectPage=()=>{const s=useNavigate(),{stories:e,fetchStories:o,startStory:a,getLastVisit:c,isLoading:d}=useStoryStore(),{showContinueModal:h,setShowContinueModal:g}=useUIStore();reactExports.useEffect(()=>{o(),c()&&g(!0)},[]);const b=async _=>{await a(_),s("/passage")},j=async()=>{const _=c();_&&(await a(_.storyId),s("/passage")),g(!1)},$=()=>{localStorage.removeItem("last_visit"),g(!1)};return jsxRuntimeExports.jsxs(Layout,{children:[jsxRuntimeExports.jsx("div",{className:"min-h-[calc(100vh-64px)] py-12",children:jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-12",children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"AI  "}),jsxRuntimeExports.jsx("p",{className:"text-xl text-gray-600",children:"Choose your learning path to get started"})]}),d?jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"})}):jsxRuntimeExports.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.map(_=>{const _e=getIcon(_.icon);return jsxRuntimeExports.jsxs(Card,{hover:!0,onClick:()=>b(_.id),className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-primary-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(_e,{className:"w-8 h-8 text-primary-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:_.name}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:_.description||"Start your learning journey"}),jsxRuntimeExports.jsx(Button,{children:"Start"})]},_.id)}),e.length===0&&jsxRuntimeExports.jsx("div",{className:"col-span-2 text-center py-12 text-gray-500",children:"No stories available yet. Check back later!"})]})]})}),jsxRuntimeExports.jsxs(Modal,{isOpen:h,onClose:()=>g(!1),title:" ?",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"   .     ?"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(Button,{onClick:j,className:"flex-1",children:""}),jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:$,className:"flex-1",children:" "})]})]})]})},Minimap=()=>{const{mainPath:s,currentPassage:e,navigationHistory:o,navigateToMainPathIndex:a}=useStoryStore(),[c,d]=reactExports.useState(null),h=reactExports.useRef(null),g=s.findIndex(nt=>nt.id===(e==null?void 0:e.passage.id)),b=nt=>o.includes(nt),j=nt=>{var rt;if(nt===0)return!0;for(let it=nt;it>=0;it--)if(b(s[it].id))return!0;return b((rt=s[nt-1])==null?void 0:rt.id)};reactExports.useEffect(()=>{if(h.current&&g>=0){const nt=h.current,it=nt.querySelectorAll("[data-indicator]")[g];if(it){const st=nt.getBoundingClientRect(),lt=it.getBoundingClientRect(),ot=lt.left-st.left-st.width/2+lt.width/2;nt.scrollBy({left:ot,behavior:"smooth"})}}},[g]);const $=async nt=>{j(nt)&&s[nt].id!==(e==null?void 0:e.passage.id)&&await a(nt)},_=()=>{var nt;(nt=h.current)==null||nt.scrollBy({left:-200,behavior:"smooth"})},_e=()=>{var nt;(nt=h.current)==null||nt.scrollBy({left:200,behavior:"smooth"})};if(s.length===0)return null;const et=nt=>{switch(nt){case"start":return jsxRuntimeExports.jsx(Play,{className:"w-3 h-3"});case"branch":return jsxRuntimeExports.jsx(GitFork,{className:"w-3 h-3"});case"end":return jsxRuntimeExports.jsx(Flag,{className:"w-3 h-3"});default:return null}};return jsxRuntimeExports.jsx("div",{className:"bg-white border-b border-gray-200 px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"max-w-5xl mx-auto relative",children:[jsxRuntimeExports.jsx("button",{onClick:_,className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 p-1 bg-white/90 rounded-full shadow-md hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-4 h-4 text-gray-600"})}),jsxRuntimeExports.jsx("button",{onClick:_e,className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 p-1 bg-white/90 rounded-full shadow-md hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4 text-gray-600"})}),jsxRuntimeExports.jsx("div",{ref:h,className:"flex items-start gap-1 overflow-x-auto scrollbar-hide px-8 py-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s.map((nt,rt)=>{var ct;const it=nt.id===(e==null?void 0:e.passage.id),st=b(nt.id),lt=j(rt),ot=rt===s.length-1;return jsxRuntimeExports.jsxs(React$2.Fragment,{children:[jsxRuntimeExports.jsxs("div",{"data-indicator":!0,className:"flex flex-col items-center flex-shrink-0 relative",onMouseEnter:()=>d(rt),onMouseLeave:()=>d(null),children:[jsxRuntimeExports.jsx("button",{onClick:()=>$(rt),disabled:!lt,className:`relative w-8 h-8 rounded-full flex items-center justify-center transition-all ${it?"bg-primary-600 text-white ring-4 ring-primary-100 scale-110":st?"bg-primary-200 text-primary-700 hover:bg-primary-300":lt?"bg-gray-200 text-gray-500 hover:bg-gray-300":"bg-gray-100 text-gray-300 cursor-not-allowed"}`,children:et(nt.type)||jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:rt+1})}),jsxRuntimeExports.jsx("span",{className:`mt-1 text-[10px] max-w-[60px] text-center truncate ${it?"text-primary-700 font-semibold":st?"text-gray-600":"text-gray-400"}`,title:nt.name,children:nt.name}),c===rt&&jsxRuntimeExports.jsxs("div",{className:"absolute bottom-full mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap z-20",children:[nt.name,nt.type!=="content"&&jsxRuntimeExports.jsxs("span",{className:"ml-1 text-gray-400",children:["(",nt.type,")"]})]})]}),!ot&&jsxRuntimeExports.jsx("div",{className:"flex items-center self-center mt-[-12px]",children:jsxRuntimeExports.jsx("div",{className:`flex-shrink-0 w-6 h-0.5 ${st&&b((ct=s[rt+1])==null?void 0:ct.id)?"bg-primary-300":"bg-gray-200"}`})})]},`${nt.id}-${rt}`)})})]})})};/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries,setPrototypeOf,isFrozen,getPrototypeOf,getOwnPropertyDescriptor}=Object;let{freeze,seal,create:create$1}=Object,{apply:apply$1,construct}=typeof Reflect<"u"&&Reflect;freeze||(freeze=function(e){return e});seal||(seal=function(e){return e});apply$1||(apply$1=function(e,o){for(var a=arguments.length,c=new Array(a>2?a-2:0),d=2;d<a;d++)c[d-2]=arguments[d];return e.apply(o,c)});construct||(construct=function(e){for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return new e(...a)});const arrayForEach=unapply(Array.prototype.forEach),arrayLastIndexOf=unapply(Array.prototype.lastIndexOf),arrayPop=unapply(Array.prototype.pop),arrayPush=unapply(Array.prototype.push),arraySplice=unapply(Array.prototype.splice),stringToLowerCase=unapply(String.prototype.toLowerCase),stringToString=unapply(String.prototype.toString),stringMatch=unapply(String.prototype.match),stringReplace=unapply(String.prototype.replace),stringIndexOf=unapply(String.prototype.indexOf),stringTrim=unapply(String.prototype.trim),objectHasOwnProperty=unapply(Object.prototype.hasOwnProperty),regExpTest=unapply(RegExp.prototype.test),typeErrorCreate=unconstruct(TypeError);function unapply(s){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return apply$1(s,e,a)}}function unconstruct(s){return function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return construct(s,o)}}function addToSet(s,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:stringToLowerCase;setPrototypeOf&&setPrototypeOf(s,null);let a=e.length;for(;a--;){let c=e[a];if(typeof c=="string"){const d=o(c);d!==c&&(isFrozen(e)||(e[a]=d),c=d)}s[c]=!0}return s}function cleanArray(s){for(let e=0;e<s.length;e++)objectHasOwnProperty(s,e)||(s[e]=null);return s}function clone(s){const e=create$1(null);for(const[o,a]of entries(s))objectHasOwnProperty(s,o)&&(Array.isArray(a)?e[o]=cleanArray(a):a&&typeof a=="object"&&a.constructor===Object?e[o]=clone(a):e[o]=a);return e}function lookupGetter(s,e){for(;s!==null;){const a=getOwnPropertyDescriptor(s,e);if(a){if(a.get)return unapply(a.get);if(typeof a.value=="function")return unapply(a.value)}s=getPrototypeOf(s)}function o(){return null}return o}const html$1=freeze(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),svg$1=freeze(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),svgFilters=freeze(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),svgDisallowed=freeze(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),mathMl$1=freeze(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),mathMlDisallowed=freeze(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),text=freeze(["#text"]),html=freeze(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),svg=freeze(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),mathMl=freeze(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),xml=freeze(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),MUSTACHE_EXPR=seal(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ERB_EXPR=seal(/<%[\w\W]*|[\w\W]*%>/gm),TMPLIT_EXPR=seal(/\$\{[\w\W]*/gm),DATA_ATTR=seal(/^data-[\-\w.\u00B7-\uFFFF]+$/),ARIA_ATTR=seal(/^aria-[\-\w]+$/),IS_ALLOWED_URI=seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),IS_SCRIPT_OR_DATA=seal(/^(?:\w+script|data):/i),ATTR_WHITESPACE=seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),DOCTYPE_NAME=seal(/^html$/i),CUSTOM_ELEMENT=seal(/^[a-z][.\w]*(-[.\w]+)+$/i);var EXPRESSIONS=Object.freeze({__proto__:null,ARIA_ATTR,ATTR_WHITESPACE,CUSTOM_ELEMENT,DATA_ATTR,DOCTYPE_NAME,ERB_EXPR,IS_ALLOWED_URI,IS_SCRIPT_OR_DATA,MUSTACHE_EXPR,TMPLIT_EXPR});const NODE_TYPE={element:1,text:3,progressingInstruction:7,comment:8,document:9},getGlobal=function(){return typeof window>"u"?null:window},_createTrustedTypesPolicy=function(e,o){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const c="data-tt-policy-suffix";o&&o.hasAttribute(c)&&(a=o.getAttribute(c));const d="dompurify"+(a?"#"+a:"");try{return e.createPolicy(d,{createHTML(h){return h},createScriptURL(h){return h}})}catch{return console.warn("TrustedTypes policy "+d+" could not be created."),null}},_createHooksMap=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function createDOMPurify(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:getGlobal();const e=Vt=>createDOMPurify(Vt);if(e.version="3.3.1",e.removed=[],!s||!s.document||s.document.nodeType!==NODE_TYPE.document||!s.Element)return e.isSupported=!1,e;let{document:o}=s;const a=o,c=a.currentScript,{DocumentFragment:d,HTMLTemplateElement:h,Node:g,Element:b,NodeFilter:j,NamedNodeMap:$=s.NamedNodeMap||s.MozNamedAttrMap,HTMLFormElement:_,DOMParser:_e,trustedTypes:et}=s,nt=b.prototype,rt=lookupGetter(nt,"cloneNode"),it=lookupGetter(nt,"remove"),st=lookupGetter(nt,"nextSibling"),lt=lookupGetter(nt,"childNodes"),ot=lookupGetter(nt,"parentNode");if(typeof h=="function"){const Vt=o.createElement("template");Vt.content&&Vt.content.ownerDocument&&(o=Vt.content.ownerDocument)}let ct,ut="";const{implementation:at,createNodeIterator:dt,createDocumentFragment:ft,getElementsByTagName:xt}=o,{importNode:Ct}=a;let yt=_createHooksMap();e.isSupported=typeof entries=="function"&&typeof ot=="function"&&at&&at.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Et,ERB_EXPR:Tt,TMPLIT_EXPR:ht,DATA_ATTR:wt,ARIA_ATTR:St,IS_SCRIPT_OR_DATA:bt,ATTR_WHITESPACE:mt,CUSTOM_ELEMENT:gt}=EXPRESSIONS;let{IS_ALLOWED_URI:pt}=EXPRESSIONS,kt=null;const Rt=addToSet({},[...html$1,...svg$1,...svgFilters,...mathMl$1,...text]);let At=null;const Mt=addToSet({},[...html,...svg,...mathMl,...xml]);let Dt=Object.seal(create$1(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),$t=null,_t=null;const Pt=Object.seal(create$1(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ht=!0,Kt=!0,Ut=!1,Nt=!0,Ot=!1,Wt=!0,Ft=!1,qt=!1,en=!1,on=!1,cn=!1,dn=!1,mn=!0,gn=!1;const En="user-content-";let bn=!0,jt=!1,It={},Bt=null;const Yt=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Qt=null;const Xt=addToSet({},["audio","video","img","source","image","track"]);let hn=null;const vn=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),kn="http://www.w3.org/1998/Math/MathML",Gt="http://www.w3.org/2000/svg",Jt="http://www.w3.org/1999/xhtml";let tn=Jt,ln=!1,fn=null;const Nn=addToSet({},[kn,Gt,Jt],stringToString);let wn=addToSet({},["mi","mo","mn","ms","mtext"]),xn=addToSet({},["annotation-xml"]);const An=addToSet({},["title","style","font","a","script"]);let Cn=null;const Jn=["application/xhtml+xml","text/html"],Qn="text/html";let rn=null,Mn=null;const Zn=o.createElement("form"),Hn=function(vt){return vt instanceof RegExp||vt instanceof Function},Dn=function(){let vt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Mn&&Mn===vt)){if((!vt||typeof vt!="object")&&(vt={}),vt=clone(vt),Cn=Jn.indexOf(vt.PARSER_MEDIA_TYPE)===-1?Qn:vt.PARSER_MEDIA_TYPE,rn=Cn==="application/xhtml+xml"?stringToString:stringToLowerCase,kt=objectHasOwnProperty(vt,"ALLOWED_TAGS")?addToSet({},vt.ALLOWED_TAGS,rn):Rt,At=objectHasOwnProperty(vt,"ALLOWED_ATTR")?addToSet({},vt.ALLOWED_ATTR,rn):Mt,fn=objectHasOwnProperty(vt,"ALLOWED_NAMESPACES")?addToSet({},vt.ALLOWED_NAMESPACES,stringToString):Nn,hn=objectHasOwnProperty(vt,"ADD_URI_SAFE_ATTR")?addToSet(clone(vn),vt.ADD_URI_SAFE_ATTR,rn):vn,Qt=objectHasOwnProperty(vt,"ADD_DATA_URI_TAGS")?addToSet(clone(Xt),vt.ADD_DATA_URI_TAGS,rn):Xt,Bt=objectHasOwnProperty(vt,"FORBID_CONTENTS")?addToSet({},vt.FORBID_CONTENTS,rn):Yt,$t=objectHasOwnProperty(vt,"FORBID_TAGS")?addToSet({},vt.FORBID_TAGS,rn):clone({}),_t=objectHasOwnProperty(vt,"FORBID_ATTR")?addToSet({},vt.FORBID_ATTR,rn):clone({}),It=objectHasOwnProperty(vt,"USE_PROFILES")?vt.USE_PROFILES:!1,Ht=vt.ALLOW_ARIA_ATTR!==!1,Kt=vt.ALLOW_DATA_ATTR!==!1,Ut=vt.ALLOW_UNKNOWN_PROTOCOLS||!1,Nt=vt.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ot=vt.SAFE_FOR_TEMPLATES||!1,Wt=vt.SAFE_FOR_XML!==!1,Ft=vt.WHOLE_DOCUMENT||!1,on=vt.RETURN_DOM||!1,cn=vt.RETURN_DOM_FRAGMENT||!1,dn=vt.RETURN_TRUSTED_TYPE||!1,en=vt.FORCE_BODY||!1,mn=vt.SANITIZE_DOM!==!1,gn=vt.SANITIZE_NAMED_PROPS||!1,bn=vt.KEEP_CONTENT!==!1,jt=vt.IN_PLACE||!1,pt=vt.ALLOWED_URI_REGEXP||IS_ALLOWED_URI,tn=vt.NAMESPACE||Jt,wn=vt.MATHML_TEXT_INTEGRATION_POINTS||wn,xn=vt.HTML_INTEGRATION_POINTS||xn,Dt=vt.CUSTOM_ELEMENT_HANDLING||{},vt.CUSTOM_ELEMENT_HANDLING&&Hn(vt.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Dt.tagNameCheck=vt.CUSTOM_ELEMENT_HANDLING.tagNameCheck),vt.CUSTOM_ELEMENT_HANDLING&&Hn(vt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Dt.attributeNameCheck=vt.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),vt.CUSTOM_ELEMENT_HANDLING&&typeof vt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Dt.allowCustomizedBuiltInElements=vt.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ot&&(Kt=!1),cn&&(on=!0),It&&(kt=addToSet({},text),At=[],It.html===!0&&(addToSet(kt,html$1),addToSet(At,html)),It.svg===!0&&(addToSet(kt,svg$1),addToSet(At,svg),addToSet(At,xml)),It.svgFilters===!0&&(addToSet(kt,svgFilters),addToSet(At,svg),addToSet(At,xml)),It.mathMl===!0&&(addToSet(kt,mathMl$1),addToSet(At,mathMl),addToSet(At,xml))),vt.ADD_TAGS&&(typeof vt.ADD_TAGS=="function"?Pt.tagCheck=vt.ADD_TAGS:(kt===Rt&&(kt=clone(kt)),addToSet(kt,vt.ADD_TAGS,rn))),vt.ADD_ATTR&&(typeof vt.ADD_ATTR=="function"?Pt.attributeCheck=vt.ADD_ATTR:(At===Mt&&(At=clone(At)),addToSet(At,vt.ADD_ATTR,rn))),vt.ADD_URI_SAFE_ATTR&&addToSet(hn,vt.ADD_URI_SAFE_ATTR,rn),vt.FORBID_CONTENTS&&(Bt===Yt&&(Bt=clone(Bt)),addToSet(Bt,vt.FORBID_CONTENTS,rn)),vt.ADD_FORBID_CONTENTS&&(Bt===Yt&&(Bt=clone(Bt)),addToSet(Bt,vt.ADD_FORBID_CONTENTS,rn)),bn&&(kt["#text"]=!0),Ft&&addToSet(kt,["html","head","body"]),kt.table&&(addToSet(kt,["tbody"]),delete $t.tbody),vt.TRUSTED_TYPES_POLICY){if(typeof vt.TRUSTED_TYPES_POLICY.createHTML!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof vt.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ct=vt.TRUSTED_TYPES_POLICY,ut=ct.createHTML("")}else ct===void 0&&(ct=_createTrustedTypesPolicy(et,c)),ct!==null&&typeof ut=="string"&&(ut=ct.createHTML(""));freeze&&freeze(vt),Mn=vt}},zn=addToSet({},[...svg$1,...svgFilters,...svgDisallowed]),Vn=addToSet({},[...mathMl$1,...mathMlDisallowed]),er=function(vt){let Lt=ot(vt);(!Lt||!Lt.tagName)&&(Lt={namespaceURI:tn,tagName:"template"});const zt=stringToLowerCase(vt.tagName),Zt=stringToLowerCase(Lt.tagName);return fn[vt.namespaceURI]?vt.namespaceURI===Gt?Lt.namespaceURI===Jt?zt==="svg":Lt.namespaceURI===kn?zt==="svg"&&(Zt==="annotation-xml"||wn[Zt]):!!zn[zt]:vt.namespaceURI===kn?Lt.namespaceURI===Jt?zt==="math":Lt.namespaceURI===Gt?zt==="math"&&xn[Zt]:!!Vn[zt]:vt.namespaceURI===Jt?Lt.namespaceURI===Gt&&!xn[Zt]||Lt.namespaceURI===kn&&!wn[Zt]?!1:!Vn[zt]&&(An[zt]||!zn[zt]):!!(Cn==="application/xhtml+xml"&&fn[vt.namespaceURI]):!1},pn=function(vt){arrayPush(e.removed,{element:vt});try{ot(vt).removeChild(vt)}catch{it(vt)}},Rn=function(vt,Lt){try{arrayPush(e.removed,{attribute:Lt.getAttributeNode(vt),from:Lt})}catch{arrayPush(e.removed,{attribute:null,from:Lt})}if(Lt.removeAttribute(vt),vt==="is")if(on||cn)try{pn(Lt)}catch{}else try{Lt.setAttribute(vt,"")}catch{}},Wn=function(vt){let Lt=null,zt=null;if(en)vt="<remove></remove>"+vt;else{const nn=stringMatch(vt,/^[\r\n\t ]+/);zt=nn&&nn[0]}Cn==="application/xhtml+xml"&&tn===Jt&&(vt='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+vt+"</body></html>");const Zt=ct?ct.createHTML(vt):vt;if(tn===Jt)try{Lt=new _e().parseFromString(Zt,Cn)}catch{}if(!Lt||!Lt.documentElement){Lt=at.createDocument(tn,"template",null);try{Lt.documentElement.innerHTML=ln?ut:Zt}catch{}}const an=Lt.body||Lt.documentElement;return vt&&zt&&an.insertBefore(o.createTextNode(zt),an.childNodes[0]||null),tn===Jt?xt.call(Lt,Ft?"html":"body")[0]:Ft?Lt.documentElement:an},Un=function(vt){return dt.call(vt.ownerDocument||vt,vt,j.SHOW_ELEMENT|j.SHOW_COMMENT|j.SHOW_TEXT|j.SHOW_PROCESSING_INSTRUCTION|j.SHOW_CDATA_SECTION,null)},On=function(vt){return vt instanceof _&&(typeof vt.nodeName!="string"||typeof vt.textContent!="string"||typeof vt.removeChild!="function"||!(vt.attributes instanceof $)||typeof vt.removeAttribute!="function"||typeof vt.setAttribute!="function"||typeof vt.namespaceURI!="string"||typeof vt.insertBefore!="function"||typeof vt.hasChildNodes!="function")},Kn=function(vt){return typeof g=="function"&&vt instanceof g};function yn(Vt,vt,Lt){arrayForEach(Vt,zt=>{zt.call(e,vt,Lt,Mn)})}const Pn=function(vt){let Lt=null;if(yn(yt.beforeSanitizeElements,vt,null),On(vt))return pn(vt),!0;const zt=rn(vt.nodeName);if(yn(yt.uponSanitizeElement,vt,{tagName:zt,allowedTags:kt}),Wt&&vt.hasChildNodes()&&!Kn(vt.firstElementChild)&&regExpTest(/<[/\w!]/g,vt.innerHTML)&&regExpTest(/<[/\w!]/g,vt.textContent)||vt.nodeType===NODE_TYPE.progressingInstruction||Wt&&vt.nodeType===NODE_TYPE.comment&&regExpTest(/<[/\w]/g,vt.data))return pn(vt),!0;if(!(Pt.tagCheck instanceof Function&&Pt.tagCheck(zt))&&(!kt[zt]||$t[zt])){if(!$t[zt]&&Ln(zt)&&(Dt.tagNameCheck instanceof RegExp&&regExpTest(Dt.tagNameCheck,zt)||Dt.tagNameCheck instanceof Function&&Dt.tagNameCheck(zt)))return!1;if(bn&&!Bt[zt]){const Zt=ot(vt)||vt.parentNode,an=lt(vt)||vt.childNodes;if(an&&Zt){const nn=an.length;for(let un=nn-1;un>=0;--un){const Sn=rt(an[un],!0);Sn.__removalCount=(vt.__removalCount||0)+1,Zt.insertBefore(Sn,st(vt))}}}return pn(vt),!0}return vt instanceof b&&!er(vt)||(zt==="noscript"||zt==="noembed"||zt==="noframes")&&regExpTest(/<\/no(script|embed|frames)/i,vt.innerHTML)?(pn(vt),!0):(Ot&&vt.nodeType===NODE_TYPE.text&&(Lt=vt.textContent,arrayForEach([Et,Tt,ht],Zt=>{Lt=stringReplace(Lt,Zt," ")}),vt.textContent!==Lt&&(arrayPush(e.removed,{element:vt.cloneNode()}),vt.textContent=Lt)),yn(yt.afterSanitizeElements,vt,null),!1)},In=function(vt,Lt,zt){if(mn&&(Lt==="id"||Lt==="name")&&(zt in o||zt in Zn))return!1;if(!(Kt&&!_t[Lt]&&regExpTest(wt,Lt))){if(!(Ht&&regExpTest(St,Lt))){if(!(Pt.attributeCheck instanceof Function&&Pt.attributeCheck(Lt,vt))){if(!At[Lt]||_t[Lt]){if(!(Ln(vt)&&(Dt.tagNameCheck instanceof RegExp&&regExpTest(Dt.tagNameCheck,vt)||Dt.tagNameCheck instanceof Function&&Dt.tagNameCheck(vt))&&(Dt.attributeNameCheck instanceof RegExp&&regExpTest(Dt.attributeNameCheck,Lt)||Dt.attributeNameCheck instanceof Function&&Dt.attributeNameCheck(Lt,vt))||Lt==="is"&&Dt.allowCustomizedBuiltInElements&&(Dt.tagNameCheck instanceof RegExp&&regExpTest(Dt.tagNameCheck,zt)||Dt.tagNameCheck instanceof Function&&Dt.tagNameCheck(zt))))return!1}else if(!hn[Lt]){if(!regExpTest(pt,stringReplace(zt,mt,""))){if(!((Lt==="src"||Lt==="xlink:href"||Lt==="href")&&vt!=="script"&&stringIndexOf(zt,"data:")===0&&Qt[vt])){if(!(Ut&&!regExpTest(bt,stringReplace(zt,mt,"")))){if(zt)return!1}}}}}}}return!0},Ln=function(vt){return vt!=="annotation-xml"&&stringMatch(vt,gt)},Gn=function(vt){yn(yt.beforeSanitizeAttributes,vt,null);const{attributes:Lt}=vt;if(!Lt||On(vt))return;const zt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:At,forceKeepAttr:void 0};let Zt=Lt.length;for(;Zt--;){const an=Lt[Zt],{name:nn,namespaceURI:un,value:Sn}=an,jn=rn(nn),$n=Sn;let sn=nn==="value"?$n:stringTrim($n);if(zt.attrName=jn,zt.attrValue=sn,zt.keepAttr=!0,zt.forceKeepAttr=void 0,yn(yt.uponSanitizeAttribute,vt,zt),sn=zt.attrValue,gn&&(jn==="id"||jn==="name")&&(Rn(nn,vt),sn=En+sn),Wt&&regExpTest(/((--!?|])>)|<\/(style|title|textarea)/i,sn)){Rn(nn,vt);continue}if(jn==="attributename"&&stringMatch(sn,"href")){Rn(nn,vt);continue}if(zt.forceKeepAttr)continue;if(!zt.keepAttr){Rn(nn,vt);continue}if(!Nt&&regExpTest(/\/>/i,sn)){Rn(nn,vt);continue}Ot&&arrayForEach([Et,Tt,ht],qn=>{sn=stringReplace(sn,qn," ")});const _n=rn(vt.nodeName);if(!In(_n,jn,sn)){Rn(nn,vt);continue}if(ct&&typeof et=="object"&&typeof et.getAttributeType=="function"&&!un)switch(et.getAttributeType(_n,jn)){case"TrustedHTML":{sn=ct.createHTML(sn);break}case"TrustedScriptURL":{sn=ct.createScriptURL(sn);break}}if(sn!==$n)try{un?vt.setAttributeNS(un,nn,sn):vt.setAttribute(nn,sn),On(vt)?pn(vt):arrayPop(e.removed)}catch{Rn(nn,vt)}}yn(yt.afterSanitizeAttributes,vt,null)},nr=function Vt(vt){let Lt=null;const zt=Un(vt);for(yn(yt.beforeSanitizeShadowDOM,vt,null);Lt=zt.nextNode();)yn(yt.uponSanitizeShadowNode,Lt,null),Pn(Lt),Gn(Lt),Lt.content instanceof d&&Vt(Lt.content);yn(yt.afterSanitizeShadowDOM,vt,null)};return e.sanitize=function(Vt){let vt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Lt=null,zt=null,Zt=null,an=null;if(ln=!Vt,ln&&(Vt="<!-->"),typeof Vt!="string"&&!Kn(Vt))if(typeof Vt.toString=="function"){if(Vt=Vt.toString(),typeof Vt!="string")throw typeErrorCreate("dirty is not a string, aborting")}else throw typeErrorCreate("toString is not a function");if(!e.isSupported)return Vt;if(qt||Dn(vt),e.removed=[],typeof Vt=="string"&&(jt=!1),jt){if(Vt.nodeName){const Sn=rn(Vt.nodeName);if(!kt[Sn]||$t[Sn])throw typeErrorCreate("root node is forbidden and cannot be sanitized in-place")}}else if(Vt instanceof g)Lt=Wn("<!---->"),zt=Lt.ownerDocument.importNode(Vt,!0),zt.nodeType===NODE_TYPE.element&&zt.nodeName==="BODY"||zt.nodeName==="HTML"?Lt=zt:Lt.appendChild(zt);else{if(!on&&!Ot&&!Ft&&Vt.indexOf("<")===-1)return ct&&dn?ct.createHTML(Vt):Vt;if(Lt=Wn(Vt),!Lt)return on?null:dn?ut:""}Lt&&en&&pn(Lt.firstChild);const nn=Un(jt?Vt:Lt);for(;Zt=nn.nextNode();)Pn(Zt),Gn(Zt),Zt.content instanceof d&&nr(Zt.content);if(jt)return Vt;if(on){if(cn)for(an=ft.call(Lt.ownerDocument);Lt.firstChild;)an.appendChild(Lt.firstChild);else an=Lt;return(At.shadowroot||At.shadowrootmode)&&(an=Ct.call(a,an,!0)),an}let un=Ft?Lt.outerHTML:Lt.innerHTML;return Ft&&kt["!doctype"]&&Lt.ownerDocument&&Lt.ownerDocument.doctype&&Lt.ownerDocument.doctype.name&&regExpTest(DOCTYPE_NAME,Lt.ownerDocument.doctype.name)&&(un="<!DOCTYPE "+Lt.ownerDocument.doctype.name+`>
`+un),Ot&&arrayForEach([Et,Tt,ht],Sn=>{un=stringReplace(un,Sn," ")}),ct&&dn?ct.createHTML(un):un},e.setConfig=function(){let Vt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Dn(Vt),qt=!0},e.clearConfig=function(){Mn=null,qt=!1},e.isValidAttribute=function(Vt,vt,Lt){Mn||Dn({});const zt=rn(Vt),Zt=rn(vt);return In(zt,Zt,Lt)},e.addHook=function(Vt,vt){typeof vt=="function"&&arrayPush(yt[Vt],vt)},e.removeHook=function(Vt,vt){if(vt!==void 0){const Lt=arrayLastIndexOf(yt[Vt],vt);return Lt===-1?void 0:arraySplice(yt[Vt],Lt,1)[0]}return arrayPop(yt[Vt])},e.removeHooks=function(Vt){yt[Vt]=[]},e.removeAllHooks=function(){yt=_createHooksMap()},e}var purify=createDOMPurify();const createInitialState=()=>({variables:{},visitedPassages:[],currentPassage:"",hooks:{}});function executeMacro(s,e,o){const a={...o};switch(s.toLowerCase()){case"set":{const c=e.match(/\$([a-zA-Z_][a-zA-Z0-9_]*)\s+to\s+(.+)/i);if(c){const[,d,h]=c;a.variables[d]=parseValue(h.trim(),a)}return{result:"",state:a}}case"print":{const c=evaluateExpression(e.trim(),a);return{result:String(c??""),state:a}}case"if":return{result:`__IF_MARKER__${e}__`,state:a};case"else-if":case"elseif":return{result:`__ELSEIF_MARKER__${e}__`,state:a};case"else":return{result:"__ELSE_MARKER__",state:a};case"link-goto":{const c=e.match(/"([^"]+)"\s*,\s*"([^"]+)"/);if(c){const[,d,h]=c;return{result:`<a class="passage-link" data-passage="${h}">${d}</a>`,state:a}}return{result:"",state:a}}case"link":{const c=e.match(/"([^"]+)"/);return c?{result:`<a class="passage-link" data-action="true">${c[1]}</a>`,state:a}:{result:"",state:a}}case"goto":{const c=e.match(/"([^"]+)"/);return c?{result:`__GOTO__${c[1]}__`,state:a}:{result:"",state:a}}case"display":{const c=e.match(/"([^"]+)"/);return c?{result:`__DISPLAY__${c[1]}__`,state:a}:{result:"",state:a}}case"random":{const c=e.match(/(\d+)\s*,\s*(\d+)/);if(c){const d=parseInt(c[1]),h=parseInt(c[2]),g=Math.floor(Math.random()*(h-d+1))+d;return{result:String(g),state:a}}return{result:"0",state:a}}case"either":{const c=e.match(/"[^"]+"|'[^']+'|\d+/g);return c&&c.length>0?{result:c[Math.floor(Math.random()*c.length)].replace(/['"]/g,""),state:a}:{result:"",state:a}}case"cond":{const c=e.split(",").map(d=>d.trim());return c.length>=3?{result:(evaluateCondition(c[0],a)?c[1]:c[2]).replace(/['"]/g,""),state:a}:{result:"",state:a}}case"text-style":{const c=e.match(/"([^"]+)"/);if(c){const d=c[1];return{result:`<span style="${{bold:"font-weight: bold",italic:"font-style: italic",underline:"text-decoration: underline",strike:"text-decoration: line-through",uppercase:"text-transform: uppercase",lowercase:"text-transform: lowercase"}[d]||""}">`,state:a}}return{result:"",state:a}}case"text-color":case"color":return{result:`<span style="color: ${e.trim().replace(/['"]/g,"")}">`,state:a};case"background":return{result:`<span style="background-color: ${e.trim().replace(/['"]/g,"")}">`,state:a};case"show":{const c=e.match(/\?([a-zA-Z_][a-zA-Z0-9_]*)/);return c&&a.hooks[c[1]]&&(a.hooks[c[1]].visible=!0),{result:"",state:a}}case"hide":{const c=e.match(/\?([a-zA-Z_][a-zA-Z0-9_]*)/);return c&&a.hooks[c[1]]&&(a.hooks[c[1]].visible=!1),{result:"",state:a}}default:return{result:`(${s}: ${e})`,state:a}}}function parseValue(s,e){if(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'"))return s.slice(1,-1);if(s==="true")return!0;if(s==="false")return!1;const o=parseFloat(s);if(!isNaN(o))return o;if(s.startsWith("$")){const a=s.slice(1);return e.variables[a]}return evaluateExpression(s,e)}function evaluateExpression(expr,state){let processed=expr.replace(/\$([a-zA-Z_][a-zA-Z0-9_]*)/g,(s,e)=>{const o=state.variables[e];return typeof o=="string"?`"${o}"`:String(o??0)});processed=processed.replace(/visits\s*\(\s*\)/g,()=>String(state.visitedPassages.filter(s=>s===state.currentPassage).length));try{const safeExpr=processed.replace(/[^0-9+\-*/().<>=!&|"'\s]/g,"");if(safeExpr===processed||processed.match(/^"[^"]*"$/))return eval(processed)}catch{}return processed.replace(/['"]/g,"")}function evaluateCondition(s,e){return!!evaluateExpression(s,e)}function findPassageByNumber(s,e){return s.find(o=>o.passage_number===e)}function processPassageContent(s,e,o,a){let c={...e},d=s;return d=d.replace(/\|([a-zA-Z_][a-zA-Z0-9_]*)>\[([^\]]*)\]/g,(h,g,b)=>(c.hooks[g]={visible:!1,content:b},`<span class="hook-hidden" data-hook="${g}">${b}</span>`)),d=d.replace(/\(([a-zA-Z_][a-zA-Z0-9_-]*):([^)]*)\)/g,(h,g,b)=>{const{result:j,state:$}=executeMacro(g,b,c);return c=$,j}),d=d.replace(/\[\[([^\]|]+?)(?:\||->)#(\d{1,6})\]\]/g,(h,g,b)=>{const j=parseInt(b,10),$=a?findPassageByNumber(a,j):null;return $?`<a class="passage-link" data-passage="${$.name}" data-passage-id="${b}">${g.trim()}</a>`:`<a class="passage-link passage-link-broken" data-passage-id="${b}" title="Passage not found">${g.trim()} </a>`}),d=d.replace(/\[\[#(\d{1,6})\]\]/g,(h,g)=>{const b=parseInt(g,10),j=a?findPassageByNumber(a,b):null;return j?`<a class="passage-link" data-passage="${j.name}" data-passage-id="${g}">${j.name}</a>`:`<a class="passage-link passage-link-broken" data-passage-id="${g}" title="Passage not found">#${g} </a>`}),d=d.replace(/\[\[([^\]|]+?)(?:\||->)([^\]]+)\]\]/g,(h,g,b)=>`<a class="passage-link" data-passage="${b.trim()}">${g.trim()}</a>`),d=d.replace(/\[\[([^\]]+)\]\]/g,(h,g)=>`<a class="passage-link" data-passage="${g.trim()}">${g.trim()}</a>`),d=d.replace(/\$([a-zA-Z_][a-zA-Z0-9_]*)/g,(h,g)=>`<span class="variable-display">${c.variables[g]??""}</span>`),d=processConditionals(d,c),{html:d,state:c}}function processConditionals(s,e){const o=/__IF_MARKER__(.+?)__\[([^\]]*)\]/g;return s=s.replace(o,(a,c,d)=>evaluateCondition(c,e)?d:""),s=s.replace(/__\w+_MARKER__[^_]*__/g,""),s}function extractLinksFromContent(s){const e=[],o=/\[\[([^\]|]+?)(?:->|\|)([^\]]+)\]\]/g;let a;for(;(a=o.exec(s))!==null;){const d=a[2].trim();d&&!e.includes(d)&&e.push(d)}const c=/\[\[([^\]|>\-]+)\]\]/g;for(;(a=c.exec(s))!==null;){const d=a[1].trim();d&&!e.includes(d)&&e.push(d)}return e}const TwinePassageRenderer=({content:s,state:e,onStateChange:o,onNavigate:a,passages:c=[],className:d=""})=>{const h=reactExports.useRef(null),[g,b]=reactExports.useState(null),{html:j,newState:$}=reactExports.useMemo(()=>{const _=processPassageContent(s,e,void 0,c);return{html:purify.sanitize(_.html,{ADD_ATTR:["data-passage","data-passage-id","data-action","data-hook"],ADD_TAGS:["span","a","img"],ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","a","span","div","img","blockquote","code","pre","table","thead","tbody","tr","th","td","caption","colgroup","col"],ALLOWED_ATTR:["class","data-passage","data-passage-id","data-action","data-hook","href","src","alt","width","height","title","style"]}),newState:_.state}},[s,e,c]);return reactExports.useEffect(()=>{JSON.stringify($)!==JSON.stringify(e)&&o($)},[$,e,o]),reactExports.useEffect(()=>{const _=h.current;if(!_)return;const _e=et=>{const nt=et.target;if(nt.tagName==="IMG"){if(nt.closest("[data-passage]"))return;const st=nt.getAttribute("src");if(st){et.preventDefault(),b(st);return}}const rt=nt.closest("[data-passage]");if(rt){et.preventDefault();const it=rt.getAttribute("data-passage-id");if(it&&c.length>0){const lt=parseInt(it,10),ot=c.find(ct=>ct.passage_number===lt);if(ot){a(ot.name);return}}const st=rt.getAttribute("data-passage");st&&a(st)}};return _.addEventListener("click",_e),()=>_.removeEventListener("click",_e)},[a,c]),reactExports.useEffect(()=>{const _=_e=>{_e.key==="Escape"&&g&&b(null)};if(g)return document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)},[g]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{ref:h,className:`twine-content passage-content ${d}`,dangerouslySetInnerHTML:{__html:j}}),g&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>b(null),children:jsxRuntimeExports.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh]",onClick:_=>_.stopPropagation(),children:[jsxRuntimeExports.jsx("img",{src:g,alt:"Enlarged",className:"max-w-[90vw] max-h-[90vh] object-contain"}),jsxRuntimeExports.jsx("button",{onClick:()=>b(null),className:"absolute top-2 right-2 bg-white rounded-full p-2 hover:bg-gray-200 transition-colors","aria-label":"Close",children:jsxRuntimeExports.jsx(X,{size:24,className:"text-gray-800"})})]})})]})};function OrderedMap(s){this.content=s}OrderedMap.prototype={constructor:OrderedMap,find:function(s){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===s)return e;return-1},get:function(s){var e=this.find(s);return e==-1?void 0:this.content[e+1]},update:function(s,e,o){var a=o&&o!=s?this.remove(o):this,c=a.find(s),d=a.content.slice();return c==-1?d.push(o||s,e):(d[c+1]=e,o&&(d[c]=o)),new OrderedMap(d)},remove:function(s){var e=this.find(s);if(e==-1)return this;var o=this.content.slice();return o.splice(e,2),new OrderedMap(o)},addToStart:function(s,e){return new OrderedMap([s,e].concat(this.remove(s).content))},addToEnd:function(s,e){var o=this.remove(s).content.slice();return o.push(s,e),new OrderedMap(o)},addBefore:function(s,e,o){var a=this.remove(e),c=a.content.slice(),d=a.find(s);return c.splice(d==-1?c.length:d,0,e,o),new OrderedMap(c)},forEach:function(s){for(var e=0;e<this.content.length;e+=2)s(this.content[e],this.content[e+1])},prepend:function(s){return s=OrderedMap.from(s),s.size?new OrderedMap(s.content.concat(this.subtract(s).content)):this},append:function(s){return s=OrderedMap.from(s),s.size?new OrderedMap(this.subtract(s).content.concat(s.content)):this},subtract:function(s){var e=this;s=OrderedMap.from(s);for(var o=0;o<s.content.length;o+=2)e=e.remove(s.content[o]);return e},toObject:function(){var s={};return this.forEach(function(e,o){s[e]=o}),s},get size(){return this.content.length>>1}};OrderedMap.from=function(s){if(s instanceof OrderedMap)return s;var e=[];if(s)for(var o in s)e.push(o,s[o]);return new OrderedMap(e)};function findDiffStart(s,e,o){for(let a=0;;a++){if(a==s.childCount||a==e.childCount)return s.childCount==e.childCount?null:o;let c=s.child(a),d=e.child(a);if(c==d){o+=c.nodeSize;continue}if(!c.sameMarkup(d))return o;if(c.isText&&c.text!=d.text){for(let h=0;c.text[h]==d.text[h];h++)o++;return o}if(c.content.size||d.content.size){let h=findDiffStart(c.content,d.content,o+1);if(h!=null)return h}o+=c.nodeSize}}function findDiffEnd(s,e,o,a){for(let c=s.childCount,d=e.childCount;;){if(c==0||d==0)return c==d?null:{a:o,b:a};let h=s.child(--c),g=e.child(--d),b=h.nodeSize;if(h==g){o-=b,a-=b;continue}if(!h.sameMarkup(g))return{a:o,b:a};if(h.isText&&h.text!=g.text){let j=0,$=Math.min(h.text.length,g.text.length);for(;j<$&&h.text[h.text.length-j-1]==g.text[g.text.length-j-1];)j++,o--,a--;return{a:o,b:a}}if(h.content.size||g.content.size){let j=findDiffEnd(h.content,g.content,o-1,a-1);if(j)return j}o-=b,a-=b}}class Fragment{constructor(e,o){if(this.content=e,this.size=o||0,o==null)for(let a=0;a<e.length;a++)this.size+=e[a].nodeSize}nodesBetween(e,o,a,c=0,d){for(let h=0,g=0;g<o;h++){let b=this.content[h],j=g+b.nodeSize;if(j>e&&a(b,c+g,d||null,h)!==!1&&b.content.size){let $=g+1;b.nodesBetween(Math.max(0,e-$),Math.min(b.content.size,o-$),a,c+$)}g=j}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,o,a,c){let d="",h=!0;return this.nodesBetween(e,o,(g,b)=>{let j=g.isText?g.text.slice(Math.max(e,b)-b,o-b):g.isLeaf?c?typeof c=="function"?c(g):c:g.type.spec.leafText?g.type.spec.leafText(g):"":"";g.isBlock&&(g.isLeaf&&j||g.isTextblock)&&a&&(h?h=!1:d+=a),d+=j},0),d}append(e){if(!e.size)return this;if(!this.size)return e;let o=this.lastChild,a=e.firstChild,c=this.content.slice(),d=0;for(o.isText&&o.sameMarkup(a)&&(c[c.length-1]=o.withText(o.text+a.text),d=1);d<e.content.length;d++)c.push(e.content[d]);return new Fragment(c,this.size+e.size)}cut(e,o=this.size){if(e==0&&o==this.size)return this;let a=[],c=0;if(o>e)for(let d=0,h=0;h<o;d++){let g=this.content[d],b=h+g.nodeSize;b>e&&((h<e||b>o)&&(g.isText?g=g.cut(Math.max(0,e-h),Math.min(g.text.length,o-h)):g=g.cut(Math.max(0,e-h-1),Math.min(g.content.size,o-h-1))),a.push(g),c+=g.nodeSize),h=b}return new Fragment(a,c)}cutByIndex(e,o){return e==o?Fragment.empty:e==0&&o==this.content.length?this:new Fragment(this.content.slice(e,o))}replaceChild(e,o){let a=this.content[e];if(a==o)return this;let c=this.content.slice(),d=this.size+o.nodeSize-a.nodeSize;return c[e]=o,new Fragment(c,d)}addToStart(e){return new Fragment([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Fragment(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let o=0;o<this.content.length;o++)if(!this.content[o].eq(e.content[o]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let o=this.content[e];if(!o)throw new RangeError("Index "+e+" out of range for "+this);return o}maybeChild(e){return this.content[e]||null}forEach(e){for(let o=0,a=0;o<this.content.length;o++){let c=this.content[o];e(c,a,o),a+=c.nodeSize}}findDiffStart(e,o=0){return findDiffStart(this,e,o)}findDiffEnd(e,o=this.size,a=e.size){return findDiffEnd(this,e,o,a)}findIndex(e){if(e==0)return retIndex(0,e);if(e==this.size)return retIndex(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let o=0,a=0;;o++){let c=this.child(o),d=a+c.nodeSize;if(d>=e)return d==e?retIndex(o+1,d):retIndex(o,a);a=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,o){if(!o)return Fragment.empty;if(!Array.isArray(o))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(o.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Fragment.empty;let o,a=0;for(let c=0;c<e.length;c++){let d=e[c];a+=d.nodeSize,c&&d.isText&&e[c-1].sameMarkup(d)?(o||(o=e.slice(0,c)),o[o.length-1]=d.withText(o[o.length-1].text+d.text)):o&&o.push(d)}return new Fragment(o||e,a)}static from(e){if(!e)return Fragment.empty;if(e instanceof Fragment)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Fragment([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(s,e){return found.index=s,found.offset=e,found}function compareDeep(s,e){if(s===e)return!0;if(!(s&&typeof s=="object")||!(e&&typeof e=="object"))return!1;let o=Array.isArray(s);if(Array.isArray(e)!=o)return!1;if(o){if(s.length!=e.length)return!1;for(let a=0;a<s.length;a++)if(!compareDeep(s[a],e[a]))return!1}else{for(let a in s)if(!(a in e)||!compareDeep(s[a],e[a]))return!1;for(let a in e)if(!(a in s))return!1}return!0}let Mark$1=class ir{constructor(e,o){this.type=e,this.attrs=o}addToSet(e){let o,a=!1;for(let c=0;c<e.length;c++){let d=e[c];if(this.eq(d))return e;if(this.type.excludes(d.type))o||(o=e.slice(0,c));else{if(d.type.excludes(this.type))return e;!a&&d.type.rank>this.type.rank&&(o||(o=e.slice(0,c)),o.push(this),a=!0),o&&o.push(d)}}return o||(o=e.slice()),a||o.push(this),o}removeFromSet(e){for(let o=0;o<e.length;o++)if(this.eq(e[o]))return e.slice(0,o).concat(e.slice(o+1));return e}isInSet(e){for(let o=0;o<e.length;o++)if(this.eq(e[o]))return!0;return!1}eq(e){return this==e||this.type==e.type&&compareDeep(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let o in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,o){if(!o)throw new RangeError("Invalid input for Mark.fromJSON");let a=e.marks[o.type];if(!a)throw new RangeError(`There is no mark type ${o.type} in this schema`);let c=a.create(o.attrs);return a.checkAttrs(c.attrs),c}static sameSet(e,o){if(e==o)return!0;if(e.length!=o.length)return!1;for(let a=0;a<e.length;a++)if(!e[a].eq(o[a]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return ir.none;if(e instanceof ir)return[e];let o=e.slice();return o.sort((a,c)=>a.type.rank-c.type.rank),o}};Mark$1.none=[];class ReplaceError extends Error{}class Slice{constructor(e,o,a){this.content=e,this.openStart=o,this.openEnd=a}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,o){let a=insertInto(this.content,e+this.openStart,o);return a&&new Slice(a,this.openStart,this.openEnd)}removeBetween(e,o){return new Slice(removeRange(this.content,e+this.openStart,o+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,o){if(!o)return Slice.empty;let a=o.openStart||0,c=o.openEnd||0;if(typeof a!="number"||typeof c!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(e,o.content),a,c)}static maxOpen(e,o=!0){let a=0,c=0;for(let d=e.firstChild;d&&!d.isLeaf&&(o||!d.type.spec.isolating);d=d.firstChild)a++;for(let d=e.lastChild;d&&!d.isLeaf&&(o||!d.type.spec.isolating);d=d.lastChild)c++;return new Slice(e,a,c)}}Slice.empty=new Slice(Fragment.empty,0,0);function removeRange(s,e,o){let{index:a,offset:c}=s.findIndex(e),d=s.maybeChild(a),{index:h,offset:g}=s.findIndex(o);if(c==e||d.isText){if(g!=o&&!s.child(h).isText)throw new RangeError("Removing non-flat range");return s.cut(0,e).append(s.cut(o))}if(a!=h)throw new RangeError("Removing non-flat range");return s.replaceChild(a,d.copy(removeRange(d.content,e-c-1,o-c-1)))}function insertInto(s,e,o,a){let{index:c,offset:d}=s.findIndex(e),h=s.maybeChild(c);if(d==e||h.isText)return a&&!a.canReplace(c,c,o)?null:s.cut(0,e).append(o).append(s.cut(e));let g=insertInto(h.content,e-d-1,o,h);return g&&s.replaceChild(c,h.copy(g))}function replace$1(s,e,o){if(o.openStart>s.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(s.depth-o.openStart!=e.depth-o.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter(s,e,o,0)}function replaceOuter(s,e,o,a){let c=s.index(a),d=s.node(a);if(c==e.index(a)&&a<s.depth-o.openStart){let h=replaceOuter(s,e,o,a+1);return d.copy(d.content.replaceChild(c,h))}else if(o.content.size)if(!o.openStart&&!o.openEnd&&s.depth==a&&e.depth==a){let h=s.parent,g=h.content;return close(h,g.cut(0,s.parentOffset).append(o.content).append(g.cut(e.parentOffset)))}else{let{start:h,end:g}=prepareSliceForReplace(o,s);return close(d,replaceThreeWay(s,h,g,e,a))}else return close(d,replaceTwoWay(s,e,a))}function checkJoin(s,e){if(!e.type.compatibleContent(s.type))throw new ReplaceError("Cannot join "+e.type.name+" onto "+s.type.name)}function joinable$1(s,e,o){let a=s.node(o);return checkJoin(a,e.node(o)),a}function addNode(s,e){let o=e.length-1;o>=0&&s.isText&&s.sameMarkup(e[o])?e[o]=s.withText(e[o].text+s.text):e.push(s)}function addRange$1(s,e,o,a){let c=(e||s).node(o),d=0,h=e?e.index(o):c.childCount;s&&(d=s.index(o),s.depth>o?d++:s.textOffset&&(addNode(s.nodeAfter,a),d++));for(let g=d;g<h;g++)addNode(c.child(g),a);e&&e.depth==o&&e.textOffset&&addNode(e.nodeBefore,a)}function close(s,e){return s.type.checkContent(e),s.copy(e)}function replaceThreeWay(s,e,o,a,c){let d=s.depth>c&&joinable$1(s,e,c+1),h=a.depth>c&&joinable$1(o,a,c+1),g=[];return addRange$1(null,s,c,g),d&&h&&e.index(c)==o.index(c)?(checkJoin(d,h),addNode(close(d,replaceThreeWay(s,e,o,a,c+1)),g)):(d&&addNode(close(d,replaceTwoWay(s,e,c+1)),g),addRange$1(e,o,c,g),h&&addNode(close(h,replaceTwoWay(o,a,c+1)),g)),addRange$1(a,null,c,g),new Fragment(g)}function replaceTwoWay(s,e,o){let a=[];if(addRange$1(null,s,o,a),s.depth>o){let c=joinable$1(s,e,o+1);addNode(close(c,replaceTwoWay(s,e,o+1)),a)}return addRange$1(e,null,o,a),new Fragment(a)}function prepareSliceForReplace(s,e){let o=e.depth-s.openStart,c=e.node(o).copy(s.content);for(let d=o-1;d>=0;d--)c=e.node(d).copy(Fragment.from(c));return{start:c.resolveNoCache(s.openStart+o),end:c.resolveNoCache(c.content.size-s.openEnd-o)}}class ResolvedPos{constructor(e,o,a){this.pos=e,this.path=o,this.parentOffset=a,this.depth=o.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,o=this.index(this.depth);if(o==e.childCount)return null;let a=this.pos-this.path[this.path.length-1],c=e.child(o);return a?e.child(o).cut(a):c}get nodeBefore(){let e=this.index(this.depth),o=this.pos-this.path[this.path.length-1];return o?this.parent.child(e).cut(0,o):e==0?null:this.parent.child(e-1)}posAtIndex(e,o){o=this.resolveDepth(o);let a=this.path[o*3],c=o==0?0:this.path[o*3-1]+1;for(let d=0;d<e;d++)c+=a.child(d).nodeSize;return c}marks(){let e=this.parent,o=this.index();if(e.content.size==0)return Mark$1.none;if(this.textOffset)return e.child(o).marks;let a=e.maybeChild(o-1),c=e.maybeChild(o);if(!a){let g=a;a=c,c=g}let d=a.marks;for(var h=0;h<d.length;h++)d[h].type.spec.inclusive===!1&&(!c||!d[h].isInSet(c.marks))&&(d=d[h--].removeFromSet(d));return d}marksAcross(e){let o=this.parent.maybeChild(this.index());if(!o||!o.isInline)return null;let a=o.marks,c=e.parent.maybeChild(e.index());for(var d=0;d<a.length;d++)a[d].type.spec.inclusive===!1&&(!c||!a[d].isInSet(c.marks))&&(a=a[d--].removeFromSet(a));return a}sharedDepth(e){for(let o=this.depth;o>0;o--)if(this.start(o)<=e&&this.end(o)>=e)return o;return 0}blockRange(e=this,o){if(e.pos<this.pos)return e.blockRange(this);for(let a=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);a>=0;a--)if(e.pos<=this.end(a)&&(!o||o(this.node(a))))return new NodeRange(this,e,a);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let o=1;o<=this.depth;o++)e+=(e?"/":"")+this.node(o).type.name+"_"+this.index(o-1);return e+":"+this.parentOffset}static resolve(e,o){if(!(o>=0&&o<=e.content.size))throw new RangeError("Position "+o+" out of range");let a=[],c=0,d=o;for(let h=e;;){let{index:g,offset:b}=h.content.findIndex(d),j=d-b;if(a.push(h,g,c+b),!j||(h=h.child(g),h.isText))break;d=j-1,c+=b+1}return new ResolvedPos(o,a,d)}static resolveCached(e,o){let a=resolveCache.get(e);if(a)for(let d=0;d<a.elts.length;d++){let h=a.elts[d];if(h.pos==o)return h}else resolveCache.set(e,a=new ResolveCache);let c=a.elts[a.i]=ResolvedPos.resolve(e,o);return a.i=(a.i+1)%resolveCacheSize,c}}class ResolveCache{constructor(){this.elts=[],this.i=0}}const resolveCacheSize=12,resolveCache=new WeakMap;class NodeRange{constructor(e,o,a){this.$from=e,this.$to=o,this.depth=a}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);let Node$1=class sr{constructor(e,o,a,c=Mark$1.none){this.type=e,this.attrs=o,this.marks=c,this.content=a||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,o,a,c=0){this.content.nodesBetween(e,o,a,c,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,o,a,c){return this.content.textBetween(e,o,a,c)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,o,a){return this.type==e&&compareDeep(this.attrs,o||e.defaultAttrs||emptyAttrs)&&Mark$1.sameSet(this.marks,a||Mark$1.none)}copy(e=null){return e==this.content?this:new sr(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new sr(this.type,this.attrs,this.content,e)}cut(e,o=this.content.size){return e==0&&o==this.content.size?this:this.copy(this.content.cut(e,o))}slice(e,o=this.content.size,a=!1){if(e==o)return Slice.empty;let c=this.resolve(e),d=this.resolve(o),h=a?0:c.sharedDepth(o),g=c.start(h),j=c.node(h).content.cut(c.pos-g,d.pos-g);return new Slice(j,c.depth-h,d.depth-h)}replace(e,o,a){return replace$1(this.resolve(e),this.resolve(o),a)}nodeAt(e){for(let o=this;;){let{index:a,offset:c}=o.content.findIndex(e);if(o=o.maybeChild(a),!o)return null;if(c==e||o.isText)return o;e-=c+1}}childAfter(e){let{index:o,offset:a}=this.content.findIndex(e);return{node:this.content.maybeChild(o),index:o,offset:a}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:o,offset:a}=this.content.findIndex(e);if(a<e)return{node:this.content.child(o),index:o,offset:a};let c=this.content.child(o-1);return{node:c,index:o-1,offset:a-c.nodeSize}}resolve(e){return ResolvedPos.resolveCached(this,e)}resolveNoCache(e){return ResolvedPos.resolve(this,e)}rangeHasMark(e,o,a){let c=!1;return o>e&&this.nodesBetween(e,o,d=>(a.isInSet(d.marks)&&(c=!0),!c)),c}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,e)}contentMatchAt(e){let o=this.type.contentMatch.matchFragment(this.content,0,e);if(!o)throw new Error("Called contentMatchAt on a node with invalid content");return o}canReplace(e,o,a=Fragment.empty,c=0,d=a.childCount){let h=this.contentMatchAt(e).matchFragment(a,c,d),g=h&&h.matchFragment(this.content,o);if(!g||!g.validEnd)return!1;for(let b=c;b<d;b++)if(!this.type.allowsMarks(a.child(b).marks))return!1;return!0}canReplaceWith(e,o,a,c){if(c&&!this.type.allowsMarks(c))return!1;let d=this.contentMatchAt(e).matchType(a),h=d&&d.matchFragment(this.content,o);return h?h.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Mark$1.none;for(let o=0;o<this.marks.length;o++){let a=this.marks[o];a.type.checkAttrs(a.attrs),e=a.addToSet(e)}if(!Mark$1.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(o=>o.type.name)}`);this.content.forEach(o=>o.check())}toJSON(){let e={type:this.type.name};for(let o in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(o=>o.toJSON())),e}static fromJSON(e,o){if(!o)throw new RangeError("Invalid input for Node.fromJSON");let a;if(o.marks){if(!Array.isArray(o.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=o.marks.map(e.markFromJSON)}if(o.type=="text"){if(typeof o.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(o.text,a)}let c=Fragment.fromJSON(e,o.content),d=e.nodeType(o.type).create(o.attrs,c,a);return d.type.checkAttrs(d.attrs),d}};Node$1.prototype.text=void 0;let TextNode$1=class or extends Node$1{constructor(e,o,a,c){if(super(e,o,null,c),!a)throw new RangeError("Empty text nodes are not allowed");this.text=a}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,o){return this.text.slice(e,o)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new or(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new or(this.type,this.attrs,e,this.marks)}cut(e=0,o=this.text.length){return e==0&&o==this.text.length?this:this.withText(this.text.slice(e,o))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function wrapMarks(s,e){for(let o=s.length-1;o>=0;o--)e=s[o].type.name+"("+e+")";return e}class ContentMatch{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,o){let a=new TokenStream(e,o);if(a.next==null)return ContentMatch.empty;let c=parseExpr(a);a.next&&a.err("Unexpected trailing text");let d=dfa(nfa(c));return checkForDeadEnds(d,a),d}matchType(e){for(let o=0;o<this.next.length;o++)if(this.next[o].type==e)return this.next[o].next;return null}matchFragment(e,o=0,a=e.childCount){let c=this;for(let d=o;c&&d<a;d++)c=c.matchType(e.child(d).type);return c}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:o}=this.next[e];if(!(o.isText||o.hasRequiredAttrs()))return o}return null}compatible(e){for(let o=0;o<this.next.length;o++)for(let a=0;a<e.next.length;a++)if(this.next[o].type==e.next[a].type)return!0;return!1}fillBefore(e,o=!1,a=0){let c=[this];function d(h,g){let b=h.matchFragment(e,a);if(b&&(!o||b.validEnd))return Fragment.from(g.map(j=>j.createAndFill()));for(let j=0;j<h.next.length;j++){let{type:$,next:_}=h.next[j];if(!($.isText||$.hasRequiredAttrs())&&c.indexOf(_)==-1){c.push(_);let _e=d(_,g.concat($));if(_e)return _e}}return null}return d(this,[])}findWrapping(e){for(let a=0;a<this.wrapCache.length;a+=2)if(this.wrapCache[a]==e)return this.wrapCache[a+1];let o=this.computeWrapping(e);return this.wrapCache.push(e,o),o}computeWrapping(e){let o=Object.create(null),a=[{match:this,type:null,via:null}];for(;a.length;){let c=a.shift(),d=c.match;if(d.matchType(e)){let h=[];for(let g=c;g.type;g=g.via)h.push(g.type);return h.reverse()}for(let h=0;h<d.next.length;h++){let{type:g,next:b}=d.next[h];!g.isLeaf&&!g.hasRequiredAttrs()&&!(g.name in o)&&(!c.type||b.validEnd)&&(a.push({match:g.contentMatch,type:g,via:c}),o[g.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function o(a){e.push(a);for(let c=0;c<a.next.length;c++)e.indexOf(a.next[c].next)==-1&&o(a.next[c].next)}return o(this),e.map((a,c)=>{let d=c+(a.validEnd?"*":" ")+" ";for(let h=0;h<a.next.length;h++)d+=(h?", ":"")+a.next[h].type.name+"->"+e.indexOf(a.next[h].next);return d}).join(`
`)}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(e,o){this.string=e,this.nodeTypes=o,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function parseExpr(s){let e=[];do e.push(parseExprSeq(s));while(s.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function parseExprSeq(s){let e=[];do e.push(parseExprSubscript(s));while(s.next&&s.next!=")"&&s.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function parseExprSubscript(s){let e=parseExprAtom(s);for(;;)if(s.eat("+"))e={type:"plus",expr:e};else if(s.eat("*"))e={type:"star",expr:e};else if(s.eat("?"))e={type:"opt",expr:e};else if(s.eat("{"))e=parseExprRange(s,e);else break;return e}function parseNum(s){/\D/.test(s.next)&&s.err("Expected number, got '"+s.next+"'");let e=Number(s.next);return s.pos++,e}function parseExprRange(s,e){let o=parseNum(s),a=o;return s.eat(",")&&(s.next!="}"?a=parseNum(s):a=-1),s.eat("}")||s.err("Unclosed braced range"),{type:"range",min:o,max:a,expr:e}}function resolveName(s,e){let o=s.nodeTypes,a=o[e];if(a)return[a];let c=[];for(let d in o){let h=o[d];h.isInGroup(e)&&c.push(h)}return c.length==0&&s.err("No node type or group '"+e+"' found"),c}function parseExprAtom(s){if(s.eat("(")){let e=parseExpr(s);return s.eat(")")||s.err("Missing closing paren"),e}else if(/\W/.test(s.next))s.err("Unexpected token '"+s.next+"'");else{let e=resolveName(s,s.next).map(o=>(s.inline==null?s.inline=o.isInline:s.inline!=o.isInline&&s.err("Mixing inline and block content"),{type:"name",value:o}));return s.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nfa(s){let e=[[]];return c(d(s,0),o()),e;function o(){return e.push([])-1}function a(h,g,b){let j={term:b,to:g};return e[h].push(j),j}function c(h,g){h.forEach(b=>b.to=g)}function d(h,g){if(h.type=="choice")return h.exprs.reduce((b,j)=>b.concat(d(j,g)),[]);if(h.type=="seq")for(let b=0;;b++){let j=d(h.exprs[b],g);if(b==h.exprs.length-1)return j;c(j,g=o())}else if(h.type=="star"){let b=o();return a(g,b),c(d(h.expr,b),b),[a(b)]}else if(h.type=="plus"){let b=o();return c(d(h.expr,g),b),c(d(h.expr,b),b),[a(b)]}else{if(h.type=="opt")return[a(g)].concat(d(h.expr,g));if(h.type=="range"){let b=g;for(let j=0;j<h.min;j++){let $=o();c(d(h.expr,b),$),b=$}if(h.max==-1)c(d(h.expr,b),b);else for(let j=h.min;j<h.max;j++){let $=o();a(b,$),c(d(h.expr,b),$),b=$}return[a(b)]}else{if(h.type=="name")return[a(g,void 0,h.value)];throw new Error("Unknown expr type")}}}}function cmp(s,e){return e-s}function nullFrom(s,e){let o=[];return a(e),o.sort(cmp);function a(c){let d=s[c];if(d.length==1&&!d[0].term)return a(d[0].to);o.push(c);for(let h=0;h<d.length;h++){let{term:g,to:b}=d[h];!g&&o.indexOf(b)==-1&&a(b)}}}function dfa(s){let e=Object.create(null);return o(nullFrom(s,0));function o(a){let c=[];a.forEach(h=>{s[h].forEach(({term:g,to:b})=>{if(!g)return;let j;for(let $=0;$<c.length;$++)c[$][0]==g&&(j=c[$][1]);nullFrom(s,b).forEach($=>{j||c.push([g,j=[]]),j.indexOf($)==-1&&j.push($)})})});let d=e[a.join(",")]=new ContentMatch(a.indexOf(s.length-1)>-1);for(let h=0;h<c.length;h++){let g=c[h][1].sort(cmp);d.next.push({type:c[h][0],next:e[g.join(",")]||o(g)})}return d}}function checkForDeadEnds(s,e){for(let o=0,a=[s];o<a.length;o++){let c=a[o],d=!c.validEnd,h=[];for(let g=0;g<c.next.length;g++){let{type:b,next:j}=c.next[g];h.push(b.name),d&&!(b.isText||b.hasRequiredAttrs())&&(d=!1),a.indexOf(j)==-1&&a.push(j)}d&&e.err("Only non-generatable nodes ("+h.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(s){let e=Object.create(null);for(let o in s){let a=s[o];if(!a.hasDefault)return null;e[o]=a.default}return e}function computeAttrs(s,e){let o=Object.create(null);for(let a in s){let c=e&&e[a];if(c===void 0){let d=s[a];if(d.hasDefault)c=d.default;else throw new RangeError("No value supplied for attribute "+a)}o[a]=c}return o}function checkAttrs(s,e,o,a){for(let c in e)if(!(c in s))throw new RangeError(`Unsupported attribute ${c} for ${o} of type ${c}`);for(let c in s){let d=s[c];d.validate&&d.validate(e[c])}}function initAttrs(s,e){let o=Object.create(null);if(e)for(let a in e)o[a]=new Attribute(s,a,e[a]);return o}let NodeType$2=class fr{constructor(e,o,a){this.name=e,this.schema=o,this.spec=a,this.markSet=null,this.groups=a.group?a.group.split(" "):[],this.attrs=initAttrs(e,a.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(a.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,e)}create(e=null,o,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node$1(this,this.computeAttrs(e),Fragment.from(o),Mark$1.setFrom(a))}createChecked(e=null,o,a){return o=Fragment.from(o),this.checkContent(o),new Node$1(this,this.computeAttrs(e),o,Mark$1.setFrom(a))}createAndFill(e=null,o,a){if(e=this.computeAttrs(e),o=Fragment.from(o),o.size){let h=this.contentMatch.fillBefore(o);if(!h)return null;o=h.append(o)}let c=this.contentMatch.matchFragment(o),d=c&&c.fillBefore(Fragment.empty,!0);return d?new Node$1(this,e,o.append(d),Mark$1.setFrom(a)):null}validContent(e){let o=this.contentMatch.matchFragment(e);if(!o||!o.validEnd)return!1;for(let a=0;a<e.childCount;a++)if(!this.allowsMarks(e.child(a).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){checkAttrs(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let o=0;o<e.length;o++)if(!this.allowsMarkType(e[o].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let o;for(let a=0;a<e.length;a++)this.allowsMarkType(e[a].type)?o&&o.push(e[a]):o||(o=e.slice(0,a));return o?o.length?o:Mark$1.none:e}static compile(e,o){let a=Object.create(null);e.forEach((d,h)=>a[d]=new fr(d,o,h));let c=o.spec.topNode||"doc";if(!a[c])throw new RangeError("Schema is missing its top node type ('"+c+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(let d in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a}};function validateType(s,e,o){let a=o.split("|");return c=>{let d=c===null?"null":typeof c;if(a.indexOf(d)<0)throw new RangeError(`Expected value of type ${a} for attribute ${e} on type ${s}, got ${d}`)}}class Attribute{constructor(e,o,a){this.hasDefault=Object.prototype.hasOwnProperty.call(a,"default"),this.default=a.default,this.validate=typeof a.validate=="string"?validateType(e,o,a.validate):a.validate}get isRequired(){return!this.hasDefault}}class MarkType{constructor(e,o,a,c){this.name=e,this.rank=o,this.schema=a,this.spec=c,this.attrs=initAttrs(e,c.attrs),this.excluded=null;let d=defaultAttrs(this.attrs);this.instance=d?new Mark$1(this,d):null}create(e=null){return!e&&this.instance?this.instance:new Mark$1(this,computeAttrs(this.attrs,e))}static compile(e,o){let a=Object.create(null),c=0;return e.forEach((d,h)=>a[d]=new MarkType(d,c++,o,h)),a}removeFromSet(e){for(var o=0;o<e.length;o++)e[o].type==this&&(e=e.slice(0,o).concat(e.slice(o+1)),o--);return e}isInSet(e){for(let o=0;o<e.length;o++)if(e[o].type==this)return e[o]}checkAttrs(e){checkAttrs(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Schema{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let o=this.spec={};for(let c in e)o[c]=e[c];o.nodes=OrderedMap.from(e.nodes),o.marks=OrderedMap.from(e.marks||{}),this.nodes=NodeType$2.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let a=Object.create(null);for(let c in this.nodes){if(c in this.marks)throw new RangeError(c+" can not be both a node and a mark");let d=this.nodes[c],h=d.spec.content||"",g=d.spec.marks;if(d.contentMatch=a[h]||(a[h]=ContentMatch.parse(h,this.nodes)),d.inlineContent=d.contentMatch.inlineContent,d.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!d.isInline||!d.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=d}d.markSet=g=="_"?null:g?gatherMarks(this,g.split(" ")):g==""||!d.inlineContent?[]:null}for(let c in this.marks){let d=this.marks[c],h=d.spec.excludes;d.excluded=h==null?[d]:h==""?[]:gatherMarks(this,h.split(" "))}this.nodeFromJSON=c=>Node$1.fromJSON(this,c),this.markFromJSON=c=>Mark$1.fromJSON(this,c),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,o=null,a,c){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof NodeType$2){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(o,a,c)}text(e,o){let a=this.nodes.text;return new TextNode$1(a,a.defaultAttrs,e,Mark$1.setFrom(o))}mark(e,o){return typeof e=="string"&&(e=this.marks[e]),e.create(o)}nodeType(e){let o=this.nodes[e];if(!o)throw new RangeError("Unknown node type: "+e);return o}}function gatherMarks(s,e){let o=[];for(let a=0;a<e.length;a++){let c=e[a],d=s.marks[c],h=d;if(d)o.push(d);else for(let g in s.marks){let b=s.marks[g];(c=="_"||b.spec.group&&b.spec.group.split(" ").indexOf(c)>-1)&&o.push(h=b)}if(!h)throw new SyntaxError("Unknown mark type: '"+e[a]+"'")}return o}function isTagRule(s){return s.tag!=null}function isStyleRule(s){return s.style!=null}class DOMParser{constructor(e,o){this.schema=e,this.rules=o,this.tags=[],this.styles=[];let a=this.matchedStyles=[];o.forEach(c=>{if(isTagRule(c))this.tags.push(c);else if(isStyleRule(c)){let d=/[^=]*/.exec(c.style)[0];a.indexOf(d)<0&&a.push(d),this.styles.push(c)}}),this.normalizeLists=!this.tags.some(c=>{if(!/^(ul|ol)\b/.test(c.tag)||!c.node)return!1;let d=e.nodes[c.node];return d.contentMatch.matchType(d)})}parse(e,o={}){let a=new ParseContext$1(this,o,!1);return a.addAll(e,Mark$1.none,o.from,o.to),a.finish()}parseSlice(e,o={}){let a=new ParseContext$1(this,o,!0);return a.addAll(e,Mark$1.none,o.from,o.to),Slice.maxOpen(a.finish())}matchTag(e,o,a){for(let c=a?this.tags.indexOf(a)+1:0;c<this.tags.length;c++){let d=this.tags[c];if(matches(e,d.tag)&&(d.namespace===void 0||e.namespaceURI==d.namespace)&&(!d.context||o.matchesContext(d.context))){if(d.getAttrs){let h=d.getAttrs(e);if(h===!1)continue;d.attrs=h||void 0}return d}}}matchStyle(e,o,a,c){for(let d=c?this.styles.indexOf(c)+1:0;d<this.styles.length;d++){let h=this.styles[d],g=h.style;if(!(g.indexOf(e)!=0||h.context&&!a.matchesContext(h.context)||g.length>e.length&&(g.charCodeAt(e.length)!=61||g.slice(e.length+1)!=o))){if(h.getAttrs){let b=h.getAttrs(o);if(b===!1)continue;h.attrs=b||void 0}return h}}}static schemaRules(e){let o=[];function a(c){let d=c.priority==null?50:c.priority,h=0;for(;h<o.length;h++){let g=o[h];if((g.priority==null?50:g.priority)<d)break}o.splice(h,0,c)}for(let c in e.marks){let d=e.marks[c].spec.parseDOM;d&&d.forEach(h=>{a(h=copy(h)),h.mark||h.ignore||h.clearMark||(h.mark=c)})}for(let c in e.nodes){let d=e.nodes[c].spec.parseDOM;d&&d.forEach(h=>{a(h=copy(h)),h.node||h.ignore||h.mark||(h.node=c)})}return o}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new DOMParser(e,DOMParser.schemaRules(e)))}}const blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(s,e,o){return e!=null?(e?OPT_PRESERVE_WS:0)|(e==="full"?OPT_PRESERVE_WS_FULL:0):s&&s.whitespace=="pre"?OPT_PRESERVE_WS|OPT_PRESERVE_WS_FULL:o&~OPT_OPEN_LEFT}class NodeContext{constructor(e,o,a,c,d,h){this.type=e,this.attrs=o,this.marks=a,this.solid=c,this.options=h,this.content=[],this.activeMarks=Mark$1.none,this.match=d||(h&OPT_OPEN_LEFT?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let o=this.type.contentMatch.fillBefore(Fragment.from(e));if(o)this.match=this.type.contentMatch.matchFragment(o);else{let a=this.type.contentMatch,c;return(c=a.findWrapping(e.type))?(this.match=a,c):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&OPT_PRESERVE_WS)){let a=this.content[this.content.length-1],c;if(a&&a.isText&&(c=/[ \t\r\n\u000c]+$/.exec(a.text))){let d=a;a.text.length==c[0].length?this.content.pop():this.content[this.content.length-1]=d.withText(d.text.slice(0,d.text.length-c[0].length))}}let o=Fragment.from(this.content);return!e&&this.match&&(o=o.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!blockTags.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}let ParseContext$1=class{constructor(e,o,a){this.parser=e,this.options=o,this.isOpen=a,this.open=0,this.localPreserveWS=!1;let c=o.topNode,d,h=wsOptionsFor(null,o.preserveWhitespace,0)|(a?OPT_OPEN_LEFT:0);c?d=new NodeContext(c.type,c.attrs,Mark$1.none,!0,o.topMatch||c.type.contentMatch,h):a?d=new NodeContext(null,null,Mark$1.none,!0,null,h):d=new NodeContext(e.schema.topNodeType,null,Mark$1.none,!0,null,h),this.nodes=[d],this.find=o.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,o){e.nodeType==3?this.addTextNode(e,o):e.nodeType==1&&this.addElement(e,o)}addTextNode(e,o){let a=e.nodeValue,c=this.top,d=c.options&OPT_PRESERVE_WS_FULL?"full":this.localPreserveWS||(c.options&OPT_PRESERVE_WS)>0,{schema:h}=this.parser;if(d==="full"||c.inlineContext(e)||/[^ \t\r\n\u000c]/.test(a)){if(d)if(d==="full")a=a.replace(/\r\n?/g,`
`);else if(h.linebreakReplacement&&/[\r\n]/.test(a)&&this.top.findWrapping(h.linebreakReplacement.create())){let g=a.split(/\r?\n|\r/);for(let b=0;b<g.length;b++)b&&this.insertNode(h.linebreakReplacement.create(),o,!0),g[b]&&this.insertNode(h.text(g[b]),o,!/\S/.test(g[b]));a=""}else a=a.replace(/\r?\n|\r/g," ");else if(a=a.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(a)&&this.open==this.nodes.length-1){let g=c.content[c.content.length-1],b=e.previousSibling;(!g||b&&b.nodeName=="BR"||g.isText&&/[ \t\r\n\u000c]$/.test(g.text))&&(a=a.slice(1))}a&&this.insertNode(h.text(a),o,!/\S/.test(a)),this.findInText(e)}else this.findInside(e)}addElement(e,o,a){let c=this.localPreserveWS,d=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let h=e.nodeName.toLowerCase(),g;listTags.hasOwnProperty(h)&&this.parser.normalizeLists&&normalizeList(e);let b=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(g=this.parser.matchTag(e,this,a));e:if(b?b.ignore:ignoreTags.hasOwnProperty(h))this.findInside(e),this.ignoreFallback(e,o);else if(!b||b.skip||b.closeParent){b&&b.closeParent?this.open=Math.max(0,this.open-1):b&&b.skip.nodeType&&(e=b.skip);let j,$=this.needsBlock;if(blockTags.hasOwnProperty(h))d.content.length&&d.content[0].isInline&&this.open&&(this.open--,d=this.top),j=!0,d.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,o);break e}let _=b&&b.skip?o:this.readStyles(e,o);_&&this.addAll(e,_),j&&this.sync(d),this.needsBlock=$}else{let j=this.readStyles(e,o);j&&this.addElementByRule(e,b,j,b.consuming===!1?g:void 0)}this.localPreserveWS=c}leafFallback(e,o){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),o)}ignoreFallback(e,o){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),o,!0)}readStyles(e,o){let a=e.style;if(a&&a.length)for(let c=0;c<this.parser.matchedStyles.length;c++){let d=this.parser.matchedStyles[c],h=a.getPropertyValue(d);if(h)for(let g=void 0;;){let b=this.parser.matchStyle(d,h,this,g);if(!b)break;if(b.ignore)return null;if(b.clearMark?o=o.filter(j=>!b.clearMark(j)):o=o.concat(this.parser.schema.marks[b.mark].create(b.attrs)),b.consuming===!1)g=b;else break}}return o}addElementByRule(e,o,a,c){let d,h;if(o.node)if(h=this.parser.schema.nodes[o.node],h.isLeaf)this.insertNode(h.create(o.attrs),a,e.nodeName=="BR")||this.leafFallback(e,a);else{let b=this.enter(h,o.attrs||null,a,o.preserveWhitespace);b&&(d=!0,a=b)}else{let b=this.parser.schema.marks[o.mark];a=a.concat(b.create(o.attrs))}let g=this.top;if(h&&h.isLeaf)this.findInside(e);else if(c)this.addElement(e,a,c);else if(o.getContent)this.findInside(e),o.getContent(e,this.parser.schema).forEach(b=>this.insertNode(b,a,!1));else{let b=e;typeof o.contentElement=="string"?b=e.querySelector(o.contentElement):typeof o.contentElement=="function"?b=o.contentElement(e):o.contentElement&&(b=o.contentElement),this.findAround(e,b,!0),this.addAll(b,a),this.findAround(e,b,!1)}d&&this.sync(g)&&this.open--}addAll(e,o,a,c){let d=a||0;for(let h=a?e.childNodes[a]:e.firstChild,g=c==null?null:e.childNodes[c];h!=g;h=h.nextSibling,++d)this.findAtPoint(e,d),this.addDOM(h,o);this.findAtPoint(e,d)}findPlace(e,o,a){let c,d;for(let h=this.open,g=0;h>=0;h--){let b=this.nodes[h],j=b.findWrapping(e);if(j&&(!c||c.length>j.length+g)&&(c=j,d=b,!j.length))break;if(b.solid){if(a)break;g+=2}}if(!c)return null;this.sync(d);for(let h=0;h<c.length;h++)o=this.enterInner(c[h],null,o,!1);return o}insertNode(e,o,a){if(e.isInline&&this.needsBlock&&!this.top.type){let d=this.textblockFromContext();d&&(o=this.enterInner(d,null,o))}let c=this.findPlace(e,o,a);if(c){this.closeExtra();let d=this.top;d.match&&(d.match=d.match.matchType(e.type));let h=Mark$1.none;for(let g of c.concat(e.marks))(d.type?d.type.allowsMarkType(g.type):markMayApply(g.type,e.type))&&(h=g.addToSet(h));return d.content.push(e.mark(h)),!0}return!1}enter(e,o,a,c){let d=this.findPlace(e.create(o),a,!1);return d&&(d=this.enterInner(e,o,a,!0,c)),d}enterInner(e,o,a,c=!1,d){this.closeExtra();let h=this.top;h.match=h.match&&h.match.matchType(e);let g=wsOptionsFor(e,d,h.options);h.options&OPT_OPEN_LEFT&&h.content.length==0&&(g|=OPT_OPEN_LEFT);let b=Mark$1.none;return a=a.filter(j=>(h.type?h.type.allowsMarkType(j.type):markMayApply(j.type,e))?(b=j.addToSet(b),!1):!0),this.nodes.push(new NodeContext(e,o,b,c,null,g)),this.open++,a}closeExtra(e=!1){let o=this.nodes.length-1;if(o>this.open){for(;o>this.open;o--)this.nodes[o-1].content.push(this.nodes[o].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let o=this.open;o>=0;o--){if(this.nodes[o]==e)return this.open=o,!0;this.localPreserveWS&&(this.nodes[o].options|=OPT_PRESERVE_WS)}return!1}get currentPos(){this.closeExtra();let e=0;for(let o=this.open;o>=0;o--){let a=this.nodes[o].content;for(let c=a.length-1;c>=0;c--)e+=a[c].nodeSize;o&&e++}return e}findAtPoint(e,o){if(this.find)for(let a=0;a<this.find.length;a++)this.find[a].node==e&&this.find[a].offset==o&&(this.find[a].pos=this.currentPos)}findInside(e){if(this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&e.nodeType==1&&e.contains(this.find[o].node)&&(this.find[o].pos=this.currentPos)}findAround(e,o,a){if(e!=o&&this.find)for(let c=0;c<this.find.length;c++)this.find[c].pos==null&&e.nodeType==1&&e.contains(this.find[c].node)&&o.compareDocumentPosition(this.find[c].node)&(a?2:4)&&(this.find[c].pos=this.currentPos)}findInText(e){if(this.find)for(let o=0;o<this.find.length;o++)this.find[o].node==e&&(this.find[o].pos=this.currentPos-(e.nodeValue.length-this.find[o].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let o=e.split("/"),a=this.options.context,c=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(c?0:1),h=(g,b)=>{for(;g>=0;g--){let j=o[g];if(j==""){if(g==o.length-1||g==0)continue;for(;b>=d;b--)if(h(g-1,b))return!0;return!1}else{let $=b>0||b==0&&c?this.nodes[b].type:a&&b>=d?a.node(b-d).type:null;if(!$||$.name!=j&&!$.isInGroup(j))return!1;b--}}return!0};return h(o.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let o=e.depth;o>=0;o--){let a=e.node(o).contentMatchAt(e.indexAfter(o)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(let o in this.parser.schema.nodes){let a=this.parser.schema.nodes[o];if(a.isTextblock&&a.defaultAttrs)return a}}};function normalizeList(s){for(let e=s.firstChild,o=null;e;e=e.nextSibling){let a=e.nodeType==1?e.nodeName.toLowerCase():null;a&&listTags.hasOwnProperty(a)&&o?(o.appendChild(e),e=o):a=="li"?o=e:a&&(o=null)}}function matches(s,e){return(s.matches||s.msMatchesSelector||s.webkitMatchesSelector||s.mozMatchesSelector).call(s,e)}function copy(s){let e={};for(let o in s)e[o]=s[o];return e}function markMayApply(s,e){let o=e.schema.nodes;for(let a in o){let c=o[a];if(!c.allowsMarkType(s))continue;let d=[],h=g=>{d.push(g);for(let b=0;b<g.edgeCount;b++){let{type:j,next:$}=g.edge(b);if(j==e||d.indexOf($)<0&&h($))return!0}};if(h(c.contentMatch))return!0}}class DOMSerializer{constructor(e,o){this.nodes=e,this.marks=o}serializeFragment(e,o={},a){a||(a=doc$2(o).createDocumentFragment());let c=a,d=[];return e.forEach(h=>{if(d.length||h.marks.length){let g=0,b=0;for(;g<d.length&&b<h.marks.length;){let j=h.marks[b];if(!this.marks[j.type.name]){b++;continue}if(!j.eq(d[g][0])||j.type.spec.spanning===!1)break;g++,b++}for(;g<d.length;)c=d.pop()[1];for(;b<h.marks.length;){let j=h.marks[b++],$=this.serializeMark(j,h.isInline,o);$&&(d.push([j,c]),c.appendChild($.dom),c=$.contentDOM||$.dom)}}c.appendChild(this.serializeNodeInner(h,o))}),a}serializeNodeInner(e,o){let{dom:a,contentDOM:c}=renderSpec(doc$2(o),this.nodes[e.type.name](e),null,e.attrs);if(c){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,o,c)}return a}serializeNode(e,o={}){let a=this.serializeNodeInner(e,o);for(let c=e.marks.length-1;c>=0;c--){let d=this.serializeMark(e.marks[c],e.isInline,o);d&&((d.contentDOM||d.dom).appendChild(a),a=d.dom)}return a}serializeMark(e,o,a={}){let c=this.marks[e.type.name];return c&&renderSpec(doc$2(a),c(e,o),null,e.attrs)}static renderSpec(e,o,a=null,c){return renderSpec(e,o,a,c)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let o=gatherToDOM(e.nodes);return o.text||(o.text=a=>a.text),o}static marksFromSchema(e){return gatherToDOM(e.marks)}}function gatherToDOM(s){let e={};for(let o in s){let a=s[o].spec.toDOM;a&&(e[o]=a)}return e}function doc$2(s){return s.document||window.document}const suspiciousAttributeCache=new WeakMap;function suspiciousAttributes(s){let e=suspiciousAttributeCache.get(s);return e===void 0&&suspiciousAttributeCache.set(s,e=suspiciousAttributesInner(s)),e}function suspiciousAttributesInner(s){let e=null;function o(a){if(a&&typeof a=="object")if(Array.isArray(a))if(typeof a[0]=="string")e||(e=[]),e.push(a);else for(let c=0;c<a.length;c++)o(a[c]);else for(let c in a)o(a[c])}return o(s),e}function renderSpec(s,e,o,a){if(typeof e=="string")return{dom:s.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let c=e[0],d;if(typeof c!="string")throw new RangeError("Invalid array passed to renderSpec");if(a&&(d=suspiciousAttributes(a))&&d.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let h=c.indexOf(" ");h>0&&(o=c.slice(0,h),c=c.slice(h+1));let g,b=o?s.createElementNS(o,c):s.createElement(c),j=e[1],$=1;if(j&&typeof j=="object"&&j.nodeType==null&&!Array.isArray(j)){$=2;for(let _ in j)if(j[_]!=null){let _e=_.indexOf(" ");_e>0?b.setAttributeNS(_.slice(0,_e),_.slice(_e+1),j[_]):_=="style"&&b.style?b.style.cssText=j[_]:b.setAttribute(_,j[_])}}for(let _=$;_<e.length;_++){let _e=e[_];if(_e===0){if(_<e.length-1||_>$)throw new RangeError("Content hole must be the only child of its parent node");return{dom:b,contentDOM:b}}else{let{dom:et,contentDOM:nt}=renderSpec(s,_e,o,a);if(b.appendChild(et),nt){if(g)throw new RangeError("Multiple content holes");g=nt}}}return{dom:b,contentDOM:g}}const lower16=65535,factor16=Math.pow(2,16);function makeRecover(s,e){return s+e*factor16}function recoverIndex(s){return s&lower16}function recoverOffset(s){return(s-(s&lower16))/factor16}const DEL_BEFORE=1,DEL_AFTER=2,DEL_ACROSS=4,DEL_SIDE=8;class MapResult{constructor(e,o,a){this.pos=e,this.delInfo=o,this.recover=a}get deleted(){return(this.delInfo&DEL_SIDE)>0}get deletedBefore(){return(this.delInfo&(DEL_BEFORE|DEL_ACROSS))>0}get deletedAfter(){return(this.delInfo&(DEL_AFTER|DEL_ACROSS))>0}get deletedAcross(){return(this.delInfo&DEL_ACROSS)>0}}class StepMap{constructor(e,o=!1){if(this.ranges=e,this.inverted=o,!e.length&&StepMap.empty)return StepMap.empty}recover(e){let o=0,a=recoverIndex(e);if(!this.inverted)for(let c=0;c<a;c++)o+=this.ranges[c*3+2]-this.ranges[c*3+1];return this.ranges[a*3]+o+recoverOffset(e)}mapResult(e,o=1){return this._map(e,o,!1)}map(e,o=1){return this._map(e,o,!0)}_map(e,o,a){let c=0,d=this.inverted?2:1,h=this.inverted?1:2;for(let g=0;g<this.ranges.length;g+=3){let b=this.ranges[g]-(this.inverted?c:0);if(b>e)break;let j=this.ranges[g+d],$=this.ranges[g+h],_=b+j;if(e<=_){let _e=j?e==b?-1:e==_?1:o:o,et=b+c+(_e<0?0:$);if(a)return et;let nt=e==(o<0?b:_)?null:makeRecover(g/3,e-b),rt=e==b?DEL_AFTER:e==_?DEL_BEFORE:DEL_ACROSS;return(o<0?e!=b:e!=_)&&(rt|=DEL_SIDE),new MapResult(et,rt,nt)}c+=$-j}return a?e+c:new MapResult(e+c,0,null)}touches(e,o){let a=0,c=recoverIndex(o),d=this.inverted?2:1,h=this.inverted?1:2;for(let g=0;g<this.ranges.length;g+=3){let b=this.ranges[g]-(this.inverted?a:0);if(b>e)break;let j=this.ranges[g+d],$=b+j;if(e<=$&&g==c*3)return!0;a+=this.ranges[g+h]-j}return!1}forEach(e){let o=this.inverted?2:1,a=this.inverted?1:2;for(let c=0,d=0;c<this.ranges.length;c+=3){let h=this.ranges[c],g=h-(this.inverted?d:0),b=h+(this.inverted?0:d),j=this.ranges[c+o],$=this.ranges[c+a];e(g,g+j,b,b+$),d+=$-j}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?StepMap.empty:new StepMap(e<0?[0,-e,0]:[0,0,e])}}StepMap.empty=new StepMap([]);class Mapping{constructor(e,o,a=0,c=e?e.length:0){this.mirror=o,this.from=a,this.to=c,this._maps=e||[],this.ownData=!(e||o)}get maps(){return this._maps}slice(e=0,o=this.maps.length){return new Mapping(this._maps,this.mirror,e,o)}appendMap(e,o){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),o!=null&&this.setMirror(this._maps.length-1,o)}appendMapping(e){for(let o=0,a=this._maps.length;o<e._maps.length;o++){let c=e.getMirror(o);this.appendMap(e._maps[o],c!=null&&c<o?a+c:void 0)}}getMirror(e){if(this.mirror){for(let o=0;o<this.mirror.length;o++)if(this.mirror[o]==e)return this.mirror[o+(o%2?-1:1)]}}setMirror(e,o){this.mirror||(this.mirror=[]),this.mirror.push(e,o)}appendMappingInverted(e){for(let o=e.maps.length-1,a=this._maps.length+e._maps.length;o>=0;o--){let c=e.getMirror(o);this.appendMap(e._maps[o].invert(),c!=null&&c>o?a-c-1:void 0)}}invert(){let e=new Mapping;return e.appendMappingInverted(this),e}map(e,o=1){if(this.mirror)return this._map(e,o,!0);for(let a=this.from;a<this.to;a++)e=this._maps[a].map(e,o);return e}mapResult(e,o=1){return this._map(e,o,!1)}_map(e,o,a){let c=0;for(let d=this.from;d<this.to;d++){let h=this._maps[d],g=h.mapResult(e,o);if(g.recover!=null){let b=this.getMirror(d);if(b!=null&&b>d&&b<this.to){d=b,e=this._maps[b].recover(g.recover);continue}}c|=g.delInfo,e=g.pos}return a?e:new MapResult(e,c,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(e){return null}static fromJSON(e,o){if(!o||!o.stepType)throw new RangeError("Invalid input for Step.fromJSON");let a=stepsByID[o.stepType];if(!a)throw new RangeError(`No step type ${o.stepType} defined`);return a.fromJSON(e,o)}static jsonID(e,o){if(e in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+e);return stepsByID[e]=o,o.prototype.jsonID=e,o}}class StepResult{constructor(e,o){this.doc=e,this.failed=o}static ok(e){return new StepResult(e,null)}static fail(e){return new StepResult(null,e)}static fromReplace(e,o,a,c){try{return StepResult.ok(e.replace(o,a,c))}catch(d){if(d instanceof ReplaceError)return StepResult.fail(d.message);throw d}}}function mapFragment(s,e,o){let a=[];for(let c=0;c<s.childCount;c++){let d=s.child(c);d.content.size&&(d=d.copy(mapFragment(d.content,e,d))),d.isInline&&(d=e(d,o,c)),a.push(d)}return Fragment.fromArray(a)}class AddMarkStep extends Step{constructor(e,o,a){super(),this.from=e,this.to=o,this.mark=a}apply(e){let o=e.slice(this.from,this.to),a=e.resolve(this.from),c=a.node(a.sharedDepth(this.to)),d=new Slice(mapFragment(o.content,(h,g)=>!h.isAtom||!g.type.allowsMarkType(this.mark.type)?h:h.mark(this.mark.addToSet(h.marks)),c),o.openStart,o.openEnd);return StepResult.fromReplace(e,this.from,this.to,d)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(e){let o=e.mapResult(this.from,1),a=e.mapResult(this.to,-1);return o.deleted&&a.deleted||o.pos>=a.pos?null:new AddMarkStep(o.pos,a.pos,this.mark)}merge(e){return e instanceof AddMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new AddMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(o.from,o.to,e.markFromJSON(o.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(e,o,a){super(),this.from=e,this.to=o,this.mark=a}apply(e){let o=e.slice(this.from,this.to),a=new Slice(mapFragment(o.content,c=>c.mark(this.mark.removeFromSet(c.marks)),e),o.openStart,o.openEnd);return StepResult.fromReplace(e,this.from,this.to,a)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(e){let o=e.mapResult(this.from,1),a=e.mapResult(this.to,-1);return o.deleted&&a.deleted||o.pos>=a.pos?null:new RemoveMarkStep(o.pos,a.pos,this.mark)}merge(e){return e instanceof RemoveMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new RemoveMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(o.from,o.to,e.markFromJSON(o.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(e,o){super(),this.pos=e,this.mark=o}apply(e){let o=e.nodeAt(this.pos);if(!o)return StepResult.fail("No node at mark step's position");let a=o.type.create(o.attrs,null,this.mark.addToSet(o.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(a),0,o.isLeaf?0:1))}invert(e){let o=e.nodeAt(this.pos);if(o){let a=this.mark.addToSet(o.marks);if(a.length==o.marks.length){for(let c=0;c<o.marks.length;c++)if(!o.marks[c].isInSet(a))return new AddNodeMarkStep(this.pos,o.marks[c]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(e){let o=e.mapResult(this.pos,1);return o.deletedAfter?null:new AddNodeMarkStep(o.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,o){if(typeof o.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(o.pos,e.markFromJSON(o.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(e,o){super(),this.pos=e,this.mark=o}apply(e){let o=e.nodeAt(this.pos);if(!o)return StepResult.fail("No node at mark step's position");let a=o.type.create(o.attrs,null,this.mark.removeFromSet(o.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(a),0,o.isLeaf?0:1))}invert(e){let o=e.nodeAt(this.pos);return!o||!this.mark.isInSet(o.marks)?this:new AddNodeMarkStep(this.pos,this.mark)}map(e){let o=e.mapResult(this.pos,1);return o.deletedAfter?null:new RemoveNodeMarkStep(o.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,o){if(typeof o.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(o.pos,e.markFromJSON(o.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(e,o,a,c=!1){super(),this.from=e,this.to=o,this.slice=a,this.structure=c}apply(e){return this.structure&&contentBetween(e,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(e){return new ReplaceStep(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let o=e.mapResult(this.from,1),a=e.mapResult(this.to,-1);return o.deletedAcross&&a.deletedAcross?null:new ReplaceStep(o.pos,Math.max(o.pos,a.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ReplaceStep)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let o=this.slice.size+e.slice.size==0?Slice.empty:new Slice(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ReplaceStep(this.from,this.to+(e.to-e.from),o,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let o=this.slice.size+e.slice.size==0?Slice.empty:new Slice(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ReplaceStep(e.from,this.to,o,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(o.from,o.to,Slice.fromJSON(e,o.slice),!!o.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(e,o,a,c,d,h,g=!1){super(),this.from=e,this.to=o,this.gapFrom=a,this.gapTo=c,this.slice=d,this.insert=h,this.structure=g}apply(e){if(this.structure&&(contentBetween(e,this.from,this.gapFrom)||contentBetween(e,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let o=e.slice(this.gapFrom,this.gapTo);if(o.openStart||o.openEnd)return StepResult.fail("Gap is not a flat range");let a=this.slice.insertAt(this.insert,o.content);return a?StepResult.fromReplace(e,this.from,this.to,a):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let o=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+o,this.from+this.insert,this.from+this.insert+o,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let o=e.mapResult(this.from,1),a=e.mapResult(this.to,-1),c=this.from==this.gapFrom?o.pos:e.map(this.gapFrom,-1),d=this.to==this.gapTo?a.pos:e.map(this.gapTo,1);return o.deletedAcross&&a.deletedAcross||c<o.pos||d>a.pos?null:new ReplaceAroundStep(o.pos,a.pos,c,d,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,o){if(typeof o.from!="number"||typeof o.to!="number"||typeof o.gapFrom!="number"||typeof o.gapTo!="number"||typeof o.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(o.from,o.to,o.gapFrom,o.gapTo,Slice.fromJSON(e,o.slice),o.insert,!!o.structure)}}Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(s,e,o){let a=s.resolve(e),c=o-e,d=a.depth;for(;c>0&&d>0&&a.indexAfter(d)==a.node(d).childCount;)d--,c--;if(c>0){let h=a.node(d).maybeChild(a.indexAfter(d));for(;c>0;){if(!h||h.isLeaf)return!0;h=h.firstChild,c--}}return!1}function addMark(s,e,o,a){let c=[],d=[],h,g;s.doc.nodesBetween(e,o,(b,j,$)=>{if(!b.isInline)return;let _=b.marks;if(!a.isInSet(_)&&$.type.allowsMarkType(a.type)){let _e=Math.max(j,e),et=Math.min(j+b.nodeSize,o),nt=a.addToSet(_);for(let rt=0;rt<_.length;rt++)_[rt].isInSet(nt)||(h&&h.to==_e&&h.mark.eq(_[rt])?h.to=et:c.push(h=new RemoveMarkStep(_e,et,_[rt])));g&&g.to==_e?g.to=et:d.push(g=new AddMarkStep(_e,et,a))}}),c.forEach(b=>s.step(b)),d.forEach(b=>s.step(b))}function removeMark(s,e,o,a){let c=[],d=0;s.doc.nodesBetween(e,o,(h,g)=>{if(!h.isInline)return;d++;let b=null;if(a instanceof MarkType){let j=h.marks,$;for(;$=a.isInSet(j);)(b||(b=[])).push($),j=$.removeFromSet(j)}else a?a.isInSet(h.marks)&&(b=[a]):b=h.marks;if(b&&b.length){let j=Math.min(g+h.nodeSize,o);for(let $=0;$<b.length;$++){let _=b[$],_e;for(let et=0;et<c.length;et++){let nt=c[et];nt.step==d-1&&_.eq(c[et].style)&&(_e=nt)}_e?(_e.to=j,_e.step=d):c.push({style:_,from:Math.max(g,e),to:j,step:d})}}}),c.forEach(h=>s.step(new RemoveMarkStep(h.from,h.to,h.style)))}function clearIncompatible(s,e,o,a=o.contentMatch,c=!0){let d=s.doc.nodeAt(e),h=[],g=e+1;for(let b=0;b<d.childCount;b++){let j=d.child(b),$=g+j.nodeSize,_=a.matchType(j.type);if(!_)h.push(new ReplaceStep(g,$,Slice.empty));else{a=_;for(let _e=0;_e<j.marks.length;_e++)o.allowsMarkType(j.marks[_e].type)||s.step(new RemoveMarkStep(g,$,j.marks[_e]));if(c&&j.isText&&o.whitespace!="pre"){let _e,et=/\r?\n|\r/g,nt;for(;_e=et.exec(j.text);)nt||(nt=new Slice(Fragment.from(o.schema.text(" ",o.allowedMarks(j.marks))),0,0)),h.push(new ReplaceStep(g+_e.index,g+_e.index+_e[0].length,nt))}}g=$}if(!a.validEnd){let b=a.fillBefore(Fragment.empty,!0);s.replace(g,g,new Slice(b,0,0))}for(let b=h.length-1;b>=0;b--)s.step(h[b])}function canCut(s,e,o){return(e==0||s.canReplace(e,s.childCount))&&(o==s.childCount||s.canReplace(0,o))}function liftTarget(s){let o=s.parent.content.cutByIndex(s.startIndex,s.endIndex);for(let a=s.depth,c=0,d=0;;--a){let h=s.$from.node(a),g=s.$from.index(a)+c,b=s.$to.indexAfter(a)-d;if(a<s.depth&&h.canReplace(g,b,o))return a;if(a==0||h.type.spec.isolating||!canCut(h,g,b))break;g&&(c=1),b<h.childCount&&(d=1)}return null}function lift$2(s,e,o){let{$from:a,$to:c,depth:d}=e,h=a.before(d+1),g=c.after(d+1),b=h,j=g,$=Fragment.empty,_=0;for(let nt=d,rt=!1;nt>o;nt--)rt||a.index(nt)>0?(rt=!0,$=Fragment.from(a.node(nt).copy($)),_++):b--;let _e=Fragment.empty,et=0;for(let nt=d,rt=!1;nt>o;nt--)rt||c.after(nt+1)<c.end(nt)?(rt=!0,_e=Fragment.from(c.node(nt).copy(_e)),et++):j++;s.step(new ReplaceAroundStep(b,j,h,g,new Slice($.append(_e),_,et),$.size-_,!0))}function findWrapping(s,e,o=null,a=s){let c=findWrappingOutside(s,e),d=c&&findWrappingInside(a,e);return d?c.map(withAttrs).concat({type:e,attrs:o}).concat(d.map(withAttrs)):null}function withAttrs(s){return{type:s,attrs:null}}function findWrappingOutside(s,e){let{parent:o,startIndex:a,endIndex:c}=s,d=o.contentMatchAt(a).findWrapping(e);if(!d)return null;let h=d.length?d[0]:e;return o.canReplaceWith(a,c,h)?d:null}function findWrappingInside(s,e){let{parent:o,startIndex:a,endIndex:c}=s,d=o.child(a),h=e.contentMatch.findWrapping(d.type);if(!h)return null;let b=(h.length?h[h.length-1]:e).contentMatch;for(let j=a;b&&j<c;j++)b=b.matchType(o.child(j).type);return!b||!b.validEnd?null:h}function wrap(s,e,o){let a=Fragment.empty;for(let h=o.length-1;h>=0;h--){if(a.size){let g=o[h].type.contentMatch.matchFragment(a);if(!g||!g.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}a=Fragment.from(o[h].type.create(o[h].attrs,a))}let c=e.start,d=e.end;s.step(new ReplaceAroundStep(c,d,c,d,new Slice(a,0,0),o.length,!0))}function setBlockType$1(s,e,o,a,c){if(!a.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let d=s.steps.length;s.doc.nodesBetween(e,o,(h,g)=>{let b=typeof c=="function"?c(h):c;if(h.isTextblock&&!h.hasMarkup(a,b)&&canChangeType(s.doc,s.mapping.slice(d).map(g),a)){let j=null;if(a.schema.linebreakReplacement){let et=a.whitespace=="pre",nt=!!a.contentMatch.matchType(a.schema.linebreakReplacement);et&&!nt?j=!1:!et&&nt&&(j=!0)}j===!1&&replaceLinebreaks(s,h,g,d),clearIncompatible(s,s.mapping.slice(d).map(g,1),a,void 0,j===null);let $=s.mapping.slice(d),_=$.map(g,1),_e=$.map(g+h.nodeSize,1);return s.step(new ReplaceAroundStep(_,_e,_+1,_e-1,new Slice(Fragment.from(a.create(b,null,h.marks)),0,0),1,!0)),j===!0&&replaceNewlines(s,h,g,d),!1}})}function replaceNewlines(s,e,o,a){e.forEach((c,d)=>{if(c.isText){let h,g=/\r?\n|\r/g;for(;h=g.exec(c.text);){let b=s.mapping.slice(a).map(o+1+d+h.index);s.replaceWith(b,b+1,e.type.schema.linebreakReplacement.create())}}})}function replaceLinebreaks(s,e,o,a){e.forEach((c,d)=>{if(c.type==c.type.schema.linebreakReplacement){let h=s.mapping.slice(a).map(o+1+d);s.replaceWith(h,h+1,e.type.schema.text(`
`))}})}function canChangeType(s,e,o){let a=s.resolve(e),c=a.index();return a.parent.canReplaceWith(c,c+1,o)}function setNodeMarkup(s,e,o,a,c){let d=s.doc.nodeAt(e);if(!d)throw new RangeError("No node at given position");o||(o=d.type);let h=o.create(a,null,c||d.marks);if(d.isLeaf)return s.replaceWith(e,e+d.nodeSize,h);if(!o.validContent(d.content))throw new RangeError("Invalid content for node type "+o.name);s.step(new ReplaceAroundStep(e,e+d.nodeSize,e+1,e+d.nodeSize-1,new Slice(Fragment.from(h),0,0),1,!0))}function canSplit(s,e,o=1,a){let c=s.resolve(e),d=c.depth-o,h=a&&a[a.length-1]||c.parent;if(d<0||c.parent.type.spec.isolating||!c.parent.canReplace(c.index(),c.parent.childCount)||!h.type.validContent(c.parent.content.cutByIndex(c.index(),c.parent.childCount)))return!1;for(let j=c.depth-1,$=o-2;j>d;j--,$--){let _=c.node(j),_e=c.index(j);if(_.type.spec.isolating)return!1;let et=_.content.cutByIndex(_e,_.childCount),nt=a&&a[$+1];nt&&(et=et.replaceChild(0,nt.type.create(nt.attrs)));let rt=a&&a[$]||_;if(!_.canReplace(_e+1,_.childCount)||!rt.type.validContent(et))return!1}let g=c.indexAfter(d),b=a&&a[0];return c.node(d).canReplaceWith(g,g,b?b.type:c.node(d+1).type)}function split(s,e,o=1,a){let c=s.doc.resolve(e),d=Fragment.empty,h=Fragment.empty;for(let g=c.depth,b=c.depth-o,j=o-1;g>b;g--,j--){d=Fragment.from(c.node(g).copy(d));let $=a&&a[j];h=Fragment.from($?$.type.create($.attrs,h):c.node(g).copy(h))}s.step(new ReplaceStep(e,e,new Slice(d.append(h),o,o),!0))}function canJoin(s,e){let o=s.resolve(e),a=o.index();return joinable(o.nodeBefore,o.nodeAfter)&&o.parent.canReplace(a,a+1)}function canAppendWithSubstitutedLinebreaks(s,e){e.content.size||s.type.compatibleContent(e.type);let o=s.contentMatchAt(s.childCount),{linebreakReplacement:a}=s.type.schema;for(let c=0;c<e.childCount;c++){let d=e.child(c),h=d.type==a?s.type.schema.nodes.text:d.type;if(o=o.matchType(h),!o||!s.type.allowsMarks(d.marks))return!1}return o.validEnd}function joinable(s,e){return!!(s&&e&&!s.isLeaf&&canAppendWithSubstitutedLinebreaks(s,e))}function joinPoint(s,e,o=-1){let a=s.resolve(e);for(let c=a.depth;;c--){let d,h,g=a.index(c);if(c==a.depth?(d=a.nodeBefore,h=a.nodeAfter):o>0?(d=a.node(c+1),g++,h=a.node(c).maybeChild(g)):(d=a.node(c).maybeChild(g-1),h=a.node(c+1)),d&&!d.isTextblock&&joinable(d,h)&&a.node(c).canReplace(g,g+1))return e;if(c==0)break;e=o<0?a.before(c):a.after(c)}}function join(s,e,o){let a=null,{linebreakReplacement:c}=s.doc.type.schema,d=s.doc.resolve(e-o),h=d.node().type;if(c&&h.inlineContent){let $=h.whitespace=="pre",_=!!h.contentMatch.matchType(c);$&&!_?a=!1:!$&&_&&(a=!0)}let g=s.steps.length;if(a===!1){let $=s.doc.resolve(e+o);replaceLinebreaks(s,$.node(),$.before(),g)}h.inlineContent&&clearIncompatible(s,e+o-1,h,d.node().contentMatchAt(d.index()),a==null);let b=s.mapping.slice(g),j=b.map(e-o);if(s.step(new ReplaceStep(j,b.map(e+o,-1),Slice.empty,!0)),a===!0){let $=s.doc.resolve(j);replaceNewlines(s,$.node(),$.before(),s.steps.length)}return s}function insertPoint(s,e,o){let a=s.resolve(e);if(a.parent.canReplaceWith(a.index(),a.index(),o))return e;if(a.parentOffset==0)for(let c=a.depth-1;c>=0;c--){let d=a.index(c);if(a.node(c).canReplaceWith(d,d,o))return a.before(c+1);if(d>0)return null}if(a.parentOffset==a.parent.content.size)for(let c=a.depth-1;c>=0;c--){let d=a.indexAfter(c);if(a.node(c).canReplaceWith(d,d,o))return a.after(c+1);if(d<a.node(c).childCount)return null}return null}function dropPoint(s,e,o){let a=s.resolve(e);if(!o.content.size)return e;let c=o.content;for(let d=0;d<o.openStart;d++)c=c.firstChild.content;for(let d=1;d<=(o.openStart==0&&o.size?2:1);d++)for(let h=a.depth;h>=0;h--){let g=h==a.depth?0:a.pos<=(a.start(h+1)+a.end(h+1))/2?-1:1,b=a.index(h)+(g>0?1:0),j=a.node(h),$=!1;if(d==1)$=j.canReplace(b,b,c);else{let _=j.contentMatchAt(b).findWrapping(c.firstChild.type);$=_&&j.canReplaceWith(b,b,_[0])}if($)return g==0?a.pos:g<0?a.before(h+1):a.after(h+1)}return null}function replaceStep(s,e,o=e,a=Slice.empty){if(e==o&&!a.size)return null;let c=s.resolve(e),d=s.resolve(o);return fitsTrivially(c,d,a)?new ReplaceStep(e,o,a):new Fitter(c,d,a).fit()}function fitsTrivially(s,e,o){return!o.openStart&&!o.openEnd&&s.start()==e.start()&&s.parent.canReplace(s.index(),e.index(),o.content)}class Fitter{constructor(e,o,a){this.$from=e,this.$to=o,this.unplaced=a,this.frontier=[],this.placed=Fragment.empty;for(let c=0;c<=e.depth;c++){let d=e.node(c);this.frontier.push({type:d.type,match:d.contentMatchAt(e.indexAfter(c))})}for(let c=e.depth;c>0;c--)this.placed=Fragment.from(e.node(c).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let j=this.findFittable();j?this.placeNodes(j):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,c=this.close(e<0?this.$to:a.doc.resolve(e));if(!c)return null;let d=this.placed,h=a.depth,g=c.depth;for(;h&&g&&d.childCount==1;)d=d.firstChild.content,h--,g--;let b=new Slice(d,h,g);return e>-1?new ReplaceAroundStep(a.pos,e,this.$to.pos,this.$to.end(),b,o):b.size||a.pos!=this.$to.pos?new ReplaceStep(a.pos,c.pos,b):null}findFittable(){let e=this.unplaced.openStart;for(let o=this.unplaced.content,a=0,c=this.unplaced.openEnd;a<e;a++){let d=o.firstChild;if(o.childCount>1&&(c=0),d.type.spec.isolating&&c<=a){e=a;break}o=d.content}for(let o=1;o<=2;o++)for(let a=o==1?e:this.unplaced.openStart;a>=0;a--){let c,d=null;a?(d=contentAt(this.unplaced.content,a-1).firstChild,c=d.content):c=this.unplaced.content;let h=c.firstChild;for(let g=this.depth;g>=0;g--){let{type:b,match:j}=this.frontier[g],$,_=null;if(o==1&&(h?j.matchType(h.type)||(_=j.fillBefore(Fragment.from(h),!1)):d&&b.compatibleContent(d.type)))return{sliceDepth:a,frontierDepth:g,parent:d,inject:_};if(o==2&&h&&($=j.findWrapping(h.type)))return{sliceDepth:a,frontierDepth:g,parent:d,wrap:$};if(d&&j.matchType(d.type))break}}}openMore(){let{content:e,openStart:o,openEnd:a}=this.unplaced,c=contentAt(e,o);return!c.childCount||c.firstChild.isLeaf?!1:(this.unplaced=new Slice(e,o+1,Math.max(a,c.size+o>=e.size-a?o+1:0)),!0)}dropNode(){let{content:e,openStart:o,openEnd:a}=this.unplaced,c=contentAt(e,o);if(c.childCount<=1&&o>0){let d=e.size-o<=o+c.size;this.unplaced=new Slice(dropFromFragment(e,o-1,1),o-1,d?o-1:a)}else this.unplaced=new Slice(dropFromFragment(e,o,1),o,a)}placeNodes({sliceDepth:e,frontierDepth:o,parent:a,inject:c,wrap:d}){for(;this.depth>o;)this.closeFrontierNode();if(d)for(let rt=0;rt<d.length;rt++)this.openFrontierNode(d[rt]);let h=this.unplaced,g=a?a.content:h.content,b=h.openStart-e,j=0,$=[],{match:_,type:_e}=this.frontier[o];if(c){for(let rt=0;rt<c.childCount;rt++)$.push(c.child(rt));_=_.matchFragment(c)}let et=g.size+e-(h.content.size-h.openEnd);for(;j<g.childCount;){let rt=g.child(j),it=_.matchType(rt.type);if(!it)break;j++,(j>1||b==0||rt.content.size)&&(_=it,$.push(closeNodeStart(rt.mark(_e.allowedMarks(rt.marks)),j==1?b:0,j==g.childCount?et:-1)))}let nt=j==g.childCount;nt||(et=-1),this.placed=addToFragment(this.placed,o,Fragment.from($)),this.frontier[o].match=_,nt&&et<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let rt=0,it=g;rt<et;rt++){let st=it.lastChild;this.frontier.push({type:st.type,match:st.contentMatchAt(st.childCount)}),it=st.content}this.unplaced=nt?e==0?Slice.empty:new Slice(dropFromFragment(h.content,e-1,1),e-1,et<0?h.openEnd:e-1):new Slice(dropFromFragment(h.content,e,j),h.openStart,h.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],o;if(!e.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(o=this.findCloseLevel(this.$to))&&o.depth==this.depth)return-1;let{depth:a}=this.$to,c=this.$to.after(a);for(;a>1&&c==this.$to.end(--a);)++c;return c}findCloseLevel(e){e:for(let o=Math.min(this.depth,e.depth);o>=0;o--){let{match:a,type:c}=this.frontier[o],d=o<e.depth&&e.end(o+1)==e.pos+(e.depth-(o+1)),h=contentAfterFits(e,o,c,a,d);if(h){for(let g=o-1;g>=0;g--){let{match:b,type:j}=this.frontier[g],$=contentAfterFits(e,g,j,b,!0);if(!$||$.childCount)continue e}return{depth:o,fit:h,move:d?e.doc.resolve(e.after(o+1)):e}}}}close(e){let o=this.findCloseLevel(e);if(!o)return null;for(;this.depth>o.depth;)this.closeFrontierNode();o.fit.childCount&&(this.placed=addToFragment(this.placed,o.depth,o.fit)),e=o.move;for(let a=o.depth+1;a<=e.depth;a++){let c=e.node(a),d=c.type.contentMatch.fillBefore(c.content,!0,e.index(a));this.openFrontierNode(c.type,c.attrs,d)}return e}openFrontierNode(e,o=null,a){let c=this.frontier[this.depth];c.match=c.match.matchType(e),this.placed=addToFragment(this.placed,this.depth,Fragment.from(e.create(o,a))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let o=this.frontier.pop().match.fillBefore(Fragment.empty,!0);o.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,o))}}function dropFromFragment(s,e,o){return e==0?s.cutByIndex(o,s.childCount):s.replaceChild(0,s.firstChild.copy(dropFromFragment(s.firstChild.content,e-1,o)))}function addToFragment(s,e,o){return e==0?s.append(o):s.replaceChild(s.childCount-1,s.lastChild.copy(addToFragment(s.lastChild.content,e-1,o)))}function contentAt(s,e){for(let o=0;o<e;o++)s=s.firstChild.content;return s}function closeNodeStart(s,e,o){if(e<=0)return s;let a=s.content;return e>1&&(a=a.replaceChild(0,closeNodeStart(a.firstChild,e-1,a.childCount==1?o-1:0))),e>0&&(a=s.type.contentMatch.fillBefore(a).append(a),o<=0&&(a=a.append(s.type.contentMatch.matchFragment(a).fillBefore(Fragment.empty,!0)))),s.copy(a)}function contentAfterFits(s,e,o,a,c){let d=s.node(e),h=c?s.indexAfter(e):s.index(e);if(h==d.childCount&&!o.compatibleContent(d.type))return null;let g=a.fillBefore(d.content,!0,h);return g&&!invalidMarks(o,d.content,h)?g:null}function invalidMarks(s,e,o){for(let a=o;a<e.childCount;a++)if(!s.allowsMarks(e.child(a).marks))return!0;return!1}function definesContent(s){return s.spec.defining||s.spec.definingForContent}function replaceRange(s,e,o,a){if(!a.size)return s.deleteRange(e,o);let c=s.doc.resolve(e),d=s.doc.resolve(o);if(fitsTrivially(c,d,a))return s.step(new ReplaceStep(e,o,a));let h=coveredDepths(c,d);h[h.length-1]==0&&h.pop();let g=-(c.depth+1);h.unshift(g);for(let _e=c.depth,et=c.pos-1;_e>0;_e--,et--){let nt=c.node(_e).type.spec;if(nt.defining||nt.definingAsContext||nt.isolating)break;h.indexOf(_e)>-1?g=_e:c.before(_e)==et&&h.splice(1,0,-_e)}let b=h.indexOf(g),j=[],$=a.openStart;for(let _e=a.content,et=0;;et++){let nt=_e.firstChild;if(j.push(nt),et==a.openStart)break;_e=nt.content}for(let _e=$-1;_e>=0;_e--){let et=j[_e],nt=definesContent(et.type);if(nt&&!et.sameMarkup(c.node(Math.abs(g)-1)))$=_e;else if(nt||!et.type.isTextblock)break}for(let _e=a.openStart;_e>=0;_e--){let et=(_e+$+1)%(a.openStart+1),nt=j[et];if(nt)for(let rt=0;rt<h.length;rt++){let it=h[(rt+b)%h.length],st=!0;it<0&&(st=!1,it=-it);let lt=c.node(it-1),ot=c.index(it-1);if(lt.canReplaceWith(ot,ot,nt.type,nt.marks))return s.replace(c.before(it),st?d.after(it):o,new Slice(closeFragment(a.content,0,a.openStart,et),et,a.openEnd))}}let _=s.steps.length;for(let _e=h.length-1;_e>=0&&(s.replace(e,o,a),!(s.steps.length>_));_e--){let et=h[_e];et<0||(e=c.before(et),o=d.after(et))}}function closeFragment(s,e,o,a,c){if(e<o){let d=s.firstChild;s=s.replaceChild(0,d.copy(closeFragment(d.content,e+1,o,a,d)))}if(e>a){let d=c.contentMatchAt(0),h=d.fillBefore(s).append(s);s=h.append(d.matchFragment(h).fillBefore(Fragment.empty,!0))}return s}function replaceRangeWith(s,e,o,a){if(!a.isInline&&e==o&&s.doc.resolve(e).parent.content.size){let c=insertPoint(s.doc,e,a.type);c!=null&&(e=o=c)}s.replaceRange(e,o,new Slice(Fragment.from(a),0,0))}function deleteRange$1(s,e,o){let a=s.doc.resolve(e),c=s.doc.resolve(o),d=coveredDepths(a,c);for(let h=0;h<d.length;h++){let g=d[h],b=h==d.length-1;if(b&&g==0||a.node(g).type.contentMatch.validEnd)return s.delete(a.start(g),c.end(g));if(g>0&&(b||a.node(g-1).canReplace(a.index(g-1),c.indexAfter(g-1))))return s.delete(a.before(g),c.after(g))}for(let h=1;h<=a.depth&&h<=c.depth;h++)if(e-a.start(h)==a.depth-h&&o>a.end(h)&&c.end(h)-o!=c.depth-h&&a.start(h-1)==c.start(h-1)&&a.node(h-1).canReplace(a.index(h-1),c.index(h-1)))return s.delete(a.before(h),o);s.delete(e,o)}function coveredDepths(s,e){let o=[],a=Math.min(s.depth,e.depth);for(let c=a;c>=0;c--){let d=s.start(c);if(d<s.pos-(s.depth-c)||e.end(c)>e.pos+(e.depth-c)||s.node(c).type.spec.isolating||e.node(c).type.spec.isolating)break;(d==e.start(c)||c==s.depth&&c==e.depth&&s.parent.inlineContent&&e.parent.inlineContent&&c&&e.start(c-1)==d-1)&&o.push(c)}return o}class AttrStep extends Step{constructor(e,o,a){super(),this.pos=e,this.attr=o,this.value=a}apply(e){let o=e.nodeAt(this.pos);if(!o)return StepResult.fail("No node at attribute step's position");let a=Object.create(null);for(let d in o.attrs)a[d]=o.attrs[d];a[this.attr]=this.value;let c=o.type.create(a,null,o.marks);return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(c),0,o.isLeaf?0:1))}getMap(){return StepMap.empty}invert(e){return new AttrStep(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let o=e.mapResult(this.pos,1);return o.deletedAfter?null:new AttrStep(o.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,o){if(typeof o.pos!="number"||typeof o.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(o.pos,o.attr,o.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(e,o){super(),this.attr=e,this.value=o}apply(e){let o=Object.create(null);for(let c in e.attrs)o[c]=e.attrs[c];o[this.attr]=this.value;let a=e.type.create(o,e.content,e.marks);return StepResult.ok(a)}getMap(){return StepMap.empty}invert(e){return new DocAttrStep(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,o){if(typeof o.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(o.attr,o.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function s(e){let o=Error.call(this,e);return o.__proto__=s.prototype,o};TransformError.prototype=Object.create(Error.prototype);TransformError.prototype.constructor=TransformError;TransformError.prototype.name="TransformError";let Transform$1=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let o=this.maybeStep(e);if(o.failed)throw new TransformError(o.failed);return this}maybeStep(e){let o=e.apply(this.doc);return o.failed||this.addStep(e,o.doc),o}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,o=-1e9;for(let a=0;a<this.mapping.maps.length;a++){let c=this.mapping.maps[a];a&&(e=c.map(e,1),o=c.map(o,-1)),c.forEach((d,h,g,b)=>{e=Math.min(e,g),o=Math.max(o,b)})}return e==1e9?null:{from:e,to:o}}addStep(e,o){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=o}replace(e,o=e,a=Slice.empty){let c=replaceStep(this.doc,e,o,a);return c&&this.step(c),this}replaceWith(e,o,a){return this.replace(e,o,new Slice(Fragment.from(a),0,0))}delete(e,o){return this.replace(e,o,Slice.empty)}insert(e,o){return this.replaceWith(e,e,o)}replaceRange(e,o,a){return replaceRange(this,e,o,a),this}replaceRangeWith(e,o,a){return replaceRangeWith(this,e,o,a),this}deleteRange(e,o){return deleteRange$1(this,e,o),this}lift(e,o){return lift$2(this,e,o),this}join(e,o=1){return join(this,e,o),this}wrap(e,o){return wrap(this,e,o),this}setBlockType(e,o=e,a,c=null){return setBlockType$1(this,e,o,a,c),this}setNodeMarkup(e,o,a=null,c){return setNodeMarkup(this,e,o,a,c),this}setNodeAttribute(e,o,a){return this.step(new AttrStep(e,o,a)),this}setDocAttribute(e,o){return this.step(new DocAttrStep(e,o)),this}addNodeMark(e,o){return this.step(new AddNodeMarkStep(e,o)),this}removeNodeMark(e,o){let a=this.doc.nodeAt(e);if(!a)throw new RangeError("No node at position "+e);if(o instanceof Mark$1)o.isInSet(a.marks)&&this.step(new RemoveNodeMarkStep(e,o));else{let c=a.marks,d,h=[];for(;d=o.isInSet(c);)h.push(new RemoveNodeMarkStep(e,d)),c=d.removeFromSet(c);for(let g=h.length-1;g>=0;g--)this.step(h[g])}return this}split(e,o=1,a){return split(this,e,o,a),this}addMark(e,o,a){return addMark(this,e,o,a),this}removeMark(e,o,a){return removeMark(this,e,o,a),this}clearIncompatible(e,o,a){return clearIncompatible(this,e,o,a),this}};const classesById=Object.create(null);let Selection$2=class{constructor(e,o,a){this.$anchor=e,this.$head=o,this.ranges=a||[new SelectionRange$1(e.min(o),e.max(o))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let o=0;o<e.length;o++)if(e[o].$from.pos!=e[o].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,o=Slice.empty){let a=o.content.lastChild,c=null;for(let g=0;g<o.openEnd;g++)c=a,a=a.lastChild;let d=e.steps.length,h=this.ranges;for(let g=0;g<h.length;g++){let{$from:b,$to:j}=h[g],$=e.mapping.slice(d);e.replaceRange($.map(b.pos),$.map(j.pos),g?Slice.empty:o),g==0&&selectionToInsertionEnd$1(e,d,(a?a.isInline:c&&c.isTextblock)?-1:1)}}replaceWith(e,o){let a=e.steps.length,c=this.ranges;for(let d=0;d<c.length;d++){let{$from:h,$to:g}=c[d],b=e.mapping.slice(a),j=b.map(h.pos),$=b.map(g.pos);d?e.deleteRange(j,$):(e.replaceRangeWith(j,$,o),selectionToInsertionEnd$1(e,a,o.isInline?-1:1))}}static findFrom(e,o,a=!1){let c=e.parent.inlineContent?new TextSelection(e):findSelectionIn(e.node(0),e.parent,e.pos,e.index(),o,a);if(c)return c;for(let d=e.depth-1;d>=0;d--){let h=o<0?findSelectionIn(e.node(0),e.node(d),e.before(d+1),e.index(d),o,a):findSelectionIn(e.node(0),e.node(d),e.after(d+1),e.index(d)+1,o,a);if(h)return h}return null}static near(e,o=1){return this.findFrom(e,o)||this.findFrom(e,-o)||new AllSelection(e.node(0))}static atStart(e){return findSelectionIn(e,e,0,0,1)||new AllSelection(e)}static atEnd(e){return findSelectionIn(e,e,e.content.size,e.childCount,-1)||new AllSelection(e)}static fromJSON(e,o){if(!o||!o.type)throw new RangeError("Invalid input for Selection.fromJSON");let a=classesById[o.type];if(!a)throw new RangeError(`No selection type ${o.type} defined`);return a.fromJSON(e,o)}static jsonID(e,o){if(e in classesById)throw new RangeError("Duplicate use of selection JSON ID "+e);return classesById[e]=o,o.prototype.jsonID=e,o}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}};Selection$2.prototype.visible=!0;let SelectionRange$1=class{constructor(e,o){this.$from=e,this.$to=o}},warnedAboutTextSelection=!1;function checkTextSelection(s){!warnedAboutTextSelection&&!s.parent.inlineContent&&(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+s.parent.type.name+")"))}class TextSelection extends Selection$2{constructor(e,o=e){checkTextSelection(e),checkTextSelection(o),super(e,o)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,o){let a=e.resolve(o.map(this.head));if(!a.parent.inlineContent)return Selection$2.near(a);let c=e.resolve(o.map(this.anchor));return new TextSelection(c.parent.inlineContent?c:a,a)}replace(e,o=Slice.empty){if(super.replace(e,o),o==Slice.empty){let a=this.$from.marksAcross(this.$to);a&&e.ensureMarks(a)}}eq(e){return e instanceof TextSelection&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,o){if(typeof o.anchor!="number"||typeof o.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(e.resolve(o.anchor),e.resolve(o.head))}static create(e,o,a=o){let c=e.resolve(o);return new this(c,a==o?c:e.resolve(a))}static between(e,o,a){let c=e.pos-o.pos;if((!a||c)&&(a=c>=0?1:-1),!o.parent.inlineContent){let d=Selection$2.findFrom(o,a,!0)||Selection$2.findFrom(o,-a,!0);if(d)o=d.$head;else return Selection$2.near(o,a)}return e.parent.inlineContent||(c==0?e=o:(e=(Selection$2.findFrom(e,-a,!0)||Selection$2.findFrom(e,a,!0)).$anchor,e.pos<o.pos!=c<0&&(e=o))),new TextSelection(e,o)}}Selection$2.jsonID("text",TextSelection);class TextBookmark{constructor(e,o){this.anchor=e,this.head=o}map(e){return new TextBookmark(e.map(this.anchor),e.map(this.head))}resolve(e){return TextSelection.between(e.resolve(this.anchor),e.resolve(this.head))}}class NodeSelection extends Selection$2{constructor(e){let o=e.nodeAfter,a=e.node(0).resolve(e.pos+o.nodeSize);super(e,a),this.node=o}map(e,o){let{deleted:a,pos:c}=o.mapResult(this.anchor),d=e.resolve(c);return a?Selection$2.near(d):new NodeSelection(d)}content(){return new Slice(Fragment.from(this.node),0,0)}eq(e){return e instanceof NodeSelection&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(e,o){if(typeof o.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(e.resolve(o.anchor))}static create(e,o){return new NodeSelection(e.resolve(o))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}NodeSelection.prototype.visible=!1;Selection$2.jsonID("node",NodeSelection);class NodeBookmark{constructor(e){this.anchor=e}map(e){let{deleted:o,pos:a}=e.mapResult(this.anchor);return o?new TextBookmark(a,a):new NodeBookmark(a)}resolve(e){let o=e.resolve(this.anchor),a=o.nodeAfter;return a&&NodeSelection.isSelectable(a)?new NodeSelection(o):Selection$2.near(o)}}class AllSelection extends Selection$2{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,o=Slice.empty){if(o==Slice.empty){e.delete(0,e.doc.content.size);let a=Selection$2.atStart(e.doc);a.eq(e.selection)||e.setSelection(a)}else super.replace(e,o)}toJSON(){return{type:"all"}}static fromJSON(e){return new AllSelection(e)}map(e){return new AllSelection(e)}eq(e){return e instanceof AllSelection}getBookmark(){return AllBookmark}}Selection$2.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve(s){return new AllSelection(s)}};function findSelectionIn(s,e,o,a,c,d=!1){if(e.inlineContent)return TextSelection.create(s,o);for(let h=a-(c>0?0:1);c>0?h<e.childCount:h>=0;h+=c){let g=e.child(h);if(g.isAtom){if(!d&&NodeSelection.isSelectable(g))return NodeSelection.create(s,o-(c<0?g.nodeSize:0))}else{let b=findSelectionIn(s,g,o+c,c<0?g.childCount:0,c,d);if(b)return b}o+=g.nodeSize*c}return null}function selectionToInsertionEnd$1(s,e,o){let a=s.steps.length-1;if(a<e)return;let c=s.steps[a];if(!(c instanceof ReplaceStep||c instanceof ReplaceAroundStep))return;let d=s.mapping.maps[a],h;d.forEach((g,b,j,$)=>{h==null&&(h=$)}),s.setSelection(Selection$2.near(s.doc.resolve(h),o))}const UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4;let Transaction$1=class extends Transform$1{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|UPDATED_SEL)&~UPDATED_MARKS,this.storedMarks=null,this}get selectionSet(){return(this.updated&UPDATED_SEL)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=UPDATED_MARKS,this}ensureMarks(e){return Mark$1.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&UPDATED_MARKS)>0}addStep(e,o){super.addStep(e,o),this.updated=this.updated&~UPDATED_MARKS,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,o=!0){let a=this.selection;return o&&(e=e.mark(this.storedMarks||(a.empty?a.$from.marks():a.$from.marksAcross(a.$to)||Mark$1.none))),a.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,o,a){let c=this.doc.type.schema;if(o==null)return e?this.replaceSelectionWith(c.text(e),!0):this.deleteSelection();{if(a==null&&(a=o),!e)return this.deleteRange(o,a);let d=this.storedMarks;if(!d){let h=this.doc.resolve(o);d=a==o?h.marks():h.marksAcross(this.doc.resolve(a))}return this.replaceRangeWith(o,a,c.text(e,d)),!this.selection.empty&&this.selection.to==o+e.length&&this.setSelection(Selection$2.near(this.selection.$to)),this}}setMeta(e,o){return this.meta[typeof e=="string"?e:e.key]=o,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=UPDATED_SCROLL,this}get scrolledIntoView(){return(this.updated&UPDATED_SCROLL)>0}};function bind(s,e){return!e||!s?s:s.bind(e)}class FieldDesc{constructor(e,o,a){this.name=e,this.init=bind(o.init,a),this.apply=bind(o.apply,a)}}const baseFields=[new FieldDesc("doc",{init(s){return s.doc||s.schema.topNodeType.createAndFill()},apply(s){return s.doc}}),new FieldDesc("selection",{init(s,e){return s.selection||Selection$2.atStart(e.doc)},apply(s){return s.selection}}),new FieldDesc("storedMarks",{init(s){return s.storedMarks||null},apply(s,e,o,a){return a.selection.$cursor?s.storedMarks:null}}),new FieldDesc("scrollToSelection",{init(){return 0},apply(s,e){return s.scrolledIntoView?e+1:e}})];let Configuration$1=class{constructor(e,o){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),o&&o.forEach(a=>{if(this.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");this.plugins.push(a),this.pluginsByKey[a.key]=a,a.spec.state&&this.fields.push(new FieldDesc(a.key,a.spec.state,a))})}},EditorState$1=class Bn{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,o=-1){for(let a=0;a<this.config.plugins.length;a++)if(a!=o){let c=this.config.plugins[a];if(c.spec.filterTransaction&&!c.spec.filterTransaction.call(c,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let o=[e],a=this.applyInner(e),c=null;for(;;){let d=!1;for(let h=0;h<this.config.plugins.length;h++){let g=this.config.plugins[h];if(g.spec.appendTransaction){let b=c?c[h].n:0,j=c?c[h].state:this,$=b<o.length&&g.spec.appendTransaction.call(g,b?o.slice(b):o,j,a);if($&&a.filterTransaction($,h)){if($.setMeta("appendedTransaction",e),!c){c=[];for(let _=0;_<this.config.plugins.length;_++)c.push(_<h?{state:a,n:o.length}:{state:this,n:0})}o.push($),a=a.applyInner($),d=!0}c&&(c[h]={state:a,n:o.length})}}if(!d)return{state:a,transactions:o}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let o=new Bn(this.config),a=this.config.fields;for(let c=0;c<a.length;c++){let d=a[c];o[d.name]=d.apply(e,this[d.name],this,o)}return o}get tr(){return new Transaction$1(this)}static create(e){let o=new Configuration$1(e.doc?e.doc.type.schema:e.schema,e.plugins),a=new Bn(o);for(let c=0;c<o.fields.length;c++)a[o.fields[c].name]=o.fields[c].init(e,a);return a}reconfigure(e){let o=new Configuration$1(this.schema,e.plugins),a=o.fields,c=new Bn(o);for(let d=0;d<a.length;d++){let h=a[d].name;c[h]=this.hasOwnProperty(h)?this[h]:a[d].init(e,c)}return c}toJSON(e){let o={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(o.storedMarks=this.storedMarks.map(a=>a.toJSON())),e&&typeof e=="object")for(let a in e){if(a=="doc"||a=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let c=e[a],d=c.spec.state;d&&d.toJSON&&(o[a]=d.toJSON.call(c,this[c.key]))}return o}static fromJSON(e,o,a){if(!o)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let c=new Configuration$1(e.schema,e.plugins),d=new Bn(c);return c.fields.forEach(h=>{if(h.name=="doc")d.doc=Node$1.fromJSON(e.schema,o.doc);else if(h.name=="selection")d.selection=Selection$2.fromJSON(d.doc,o.selection);else if(h.name=="storedMarks")o.storedMarks&&(d.storedMarks=o.storedMarks.map(e.schema.markFromJSON));else{if(a)for(let g in a){let b=a[g],j=b.spec.state;if(b.key==h.name&&j&&j.fromJSON&&Object.prototype.hasOwnProperty.call(o,g)){d[h.name]=j.fromJSON.call(b,e,o[g],d);return}}d[h.name]=h.init(e,d)}}),d}};function bindProps(s,e,o){for(let a in s){let c=s[a];c instanceof Function?c=c.bind(e):a=="handleDOMEvents"&&(c=bindProps(c,e,{})),o[a]=c}return o}class Plugin{constructor(e){this.spec=e,this.props={},e.props&&bindProps(e.props,this,this.props),this.key=e.key?e.key.key:createKey("plugin")}getState(e){return e[this.key]}}const keys$1=Object.create(null);function createKey(s){return s in keys$1?s+"$"+ ++keys$1[s]:(keys$1[s]=0,s+"$")}class PluginKey{constructor(e="key"){this.key=createKey(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const domIndex$1=function(s){for(var e=0;;e++)if(s=s.previousSibling,!s)return e},parentNode=function(s){let e=s.assignedSlot||s.parentNode;return e&&e.nodeType==11?e.host:e};let reusedRange=null;const textRange$1=function(s,e,o){let a=reusedRange||(reusedRange=document.createRange());return a.setEnd(s,o??s.nodeValue.length),a.setStart(s,e||0),a},clearReusedRange=function(){reusedRange=null},isEquivalentPosition$1=function(s,e,o,a){return o&&(scanFor$1(s,e,o,a,-1)||scanFor$1(s,e,o,a,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor$1(s,e,o,a,c){for(var d;;){if(s==o&&e==a)return!0;if(e==(c<0?0:nodeSize$1(s))){let h=s.parentNode;if(!h||h.nodeType!=1||hasBlockDesc(s)||atomElements.test(s.nodeName)||s.contentEditable=="false")return!1;e=domIndex$1(s)+(c<0?0:1),s=h}else if(s.nodeType==1){let h=s.childNodes[e+(c<0?-1:0)];if(h.nodeType==1&&h.contentEditable=="false")if(!((d=h.pmViewDesc)===null||d===void 0)&&d.ignoreForSelection)e+=c;else return!1;else s=h,e=c<0?nodeSize$1(s):0}else return!1}}function nodeSize$1(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function textNodeBefore$1(s,e){for(;;){if(s.nodeType==3&&e)return s;if(s.nodeType==1&&e>0){if(s.contentEditable=="false")return null;s=s.childNodes[e-1],e=nodeSize$1(s)}else if(s.parentNode&&!hasBlockDesc(s))e=domIndex$1(s),s=s.parentNode;else return null}}function textNodeAfter$1(s,e){for(;;){if(s.nodeType==3&&e<s.nodeValue.length)return s;if(s.nodeType==1&&e<s.childNodes.length){if(s.contentEditable=="false")return null;s=s.childNodes[e],e=0}else if(s.parentNode&&!hasBlockDesc(s))e=domIndex$1(s)+1,s=s.parentNode;else return null}}function isOnEdge(s,e,o){for(let a=e==0,c=e==nodeSize$1(s);a||c;){if(s==o)return!0;let d=domIndex$1(s);if(s=s.parentNode,!s)return!1;a=a&&d==0,c=c&&d==nodeSize$1(s)}}function hasBlockDesc(s){let e;for(let o=s;o&&!(e=o.pmViewDesc);o=o.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==s||e.contentDOM==s)}const selectionCollapsed=function(s){return s.focusNode&&isEquivalentPosition$1(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)};function keyEvent(s,e){let o=document.createEvent("Event");return o.initEvent("keydown",!0,!0),o.keyCode=s,o.key=o.code=e,o}function deepActiveElement(s){let e=s.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function caretFromPoint(s,e,o){if(s.caretPositionFromPoint)try{let a=s.caretPositionFromPoint(e,o);if(a)return{node:a.offsetNode,offset:Math.min(nodeSize$1(a.offsetNode),a.offset)}}catch{}if(s.caretRangeFromPoint){let a=s.caretRangeFromPoint(e,o);if(a)return{node:a.startContainer,offset:Math.min(nodeSize$1(a.startContainer),a.startOffset)}}}const nav$1=typeof navigator<"u"?navigator:null,doc$1=typeof document<"u"?document:null,agent=nav$1&&nav$1.userAgent||"",ie_edge$1=/Edge\/(\d+)/.exec(agent),ie_upto10$1=/MSIE \d/.exec(agent),ie_11up$1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$2=!!(ie_upto10$1||ie_11up$1||ie_edge$1),ie_version=ie_upto10$1?document.documentMode:ie_11up$1?+ie_11up$1[1]:ie_edge$1?+ie_edge$1[1]:0,gecko$1=!ie$2&&/gecko\/(\d+)/i.test(agent);gecko$1&&+(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie$2&&/Chrome\/(\d+)/.exec(agent),chrome$1=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari$1=!ie$2&&!!nav$1&&/Apple Computer/.test(nav$1.vendor),ios$1=safari$1&&(/Mobile\/\w+/.test(agent)||!!nav$1&&nav$1.maxTouchPoints>2),mac$2=ios$1||(nav$1?/Mac/.test(nav$1.platform):!1),windows$2=nav$1?/Win/.test(nav$1.platform):!1,android=/Android \d/.test(agent),webkit$1=!!doc$1&&"webkitFontSmoothing"in doc$1.documentElement.style,webkit_version=webkit$1?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function windowRect$1(s){let e=s.defaultView&&s.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:s.documentElement.clientWidth,top:0,bottom:s.documentElement.clientHeight}}function getSide(s,e){return typeof s=="number"?s:s[e]}function clientRect(s){let e=s.getBoundingClientRect(),o=e.width/s.offsetWidth||1,a=e.height/s.offsetHeight||1;return{left:e.left,right:e.left+s.clientWidth*o,top:e.top,bottom:e.top+s.clientHeight*a}}function scrollRectIntoView$1(s,e,o){let a=s.someProp("scrollThreshold")||0,c=s.someProp("scrollMargin")||5,d=s.dom.ownerDocument;for(let h=o||s.dom;h;){if(h.nodeType!=1){h=parentNode(h);continue}let g=h,b=g==d.body,j=b?windowRect$1(d):clientRect(g),$=0,_=0;if(e.top<j.top+getSide(a,"top")?_=-(j.top-e.top+getSide(c,"top")):e.bottom>j.bottom-getSide(a,"bottom")&&(_=e.bottom-e.top>j.bottom-j.top?e.top+getSide(c,"top")-j.top:e.bottom-j.bottom+getSide(c,"bottom")),e.left<j.left+getSide(a,"left")?$=-(j.left-e.left+getSide(c,"left")):e.right>j.right-getSide(a,"right")&&($=e.right-j.right+getSide(c,"right")),$||_)if(b)d.defaultView.scrollBy($,_);else{let et=g.scrollLeft,nt=g.scrollTop;_&&(g.scrollTop+=_),$&&(g.scrollLeft+=$);let rt=g.scrollLeft-et,it=g.scrollTop-nt;e={left:e.left-rt,top:e.top-it,right:e.right-rt,bottom:e.bottom-it}}let _e=b?"fixed":getComputedStyle(h).position;if(/^(fixed|sticky)$/.test(_e))break;h=_e=="absolute"?h.offsetParent:parentNode(h)}}function storeScrollPos(s){let e=s.dom.getBoundingClientRect(),o=Math.max(0,e.top),a,c;for(let d=(e.left+e.right)/2,h=o+1;h<Math.min(innerHeight,e.bottom);h+=5){let g=s.root.elementFromPoint(d,h);if(!g||g==s.dom||!s.dom.contains(g))continue;let b=g.getBoundingClientRect();if(b.top>=o-20){a=g,c=b.top;break}}return{refDOM:a,refTop:c,stack:scrollStack(s.dom)}}function scrollStack(s){let e=[],o=s.ownerDocument;for(let a=s;a&&(e.push({dom:a,top:a.scrollTop,left:a.scrollLeft}),s!=o);a=parentNode(a));return e}function resetScrollPos({refDOM:s,refTop:e,stack:o}){let a=s?s.getBoundingClientRect().top:0;restoreScrollStack(o,a==0?0:a-e)}function restoreScrollStack(s,e){for(let o=0;o<s.length;o++){let{dom:a,top:c,left:d}=s[o];a.scrollTop!=c+e&&(a.scrollTop=c+e),a.scrollLeft!=d&&(a.scrollLeft=d)}}let preventScrollSupported$1=null;function focusPreventScroll$1(s){if(s.setActive)return s.setActive();if(preventScrollSupported$1)return s.focus(preventScrollSupported$1);let e=scrollStack(s);s.focus(preventScrollSupported$1==null?{get preventScroll(){return preventScrollSupported$1={preventScroll:!0},!0}}:void 0),preventScrollSupported$1||(preventScrollSupported$1=!1,restoreScrollStack(e,0))}function findOffsetInNode(s,e){let o,a=2e8,c,d=0,h=e.top,g=e.top,b,j;for(let $=s.firstChild,_=0;$;$=$.nextSibling,_++){let _e;if($.nodeType==1)_e=$.getClientRects();else if($.nodeType==3)_e=textRange$1($).getClientRects();else continue;for(let et=0;et<_e.length;et++){let nt=_e[et];if(nt.top<=h&&nt.bottom>=g){h=Math.max(nt.bottom,h),g=Math.min(nt.top,g);let rt=nt.left>e.left?nt.left-e.left:nt.right<e.left?e.left-nt.right:0;if(rt<a){o=$,a=rt,c=rt&&o.nodeType==3?{left:nt.right<e.left?nt.right:nt.left,top:e.top}:e,$.nodeType==1&&rt&&(d=_+(e.left>=(nt.left+nt.right)/2?1:0));continue}}else nt.top>e.top&&!b&&nt.left<=e.left&&nt.right>=e.left&&(b=$,j={left:Math.max(nt.left,Math.min(nt.right,e.left)),top:nt.top});!o&&(e.left>=nt.right&&e.top>=nt.top||e.left>=nt.left&&e.top>=nt.bottom)&&(d=_+1)}}return!o&&b&&(o=b,c=j,a=0),o&&o.nodeType==3?findOffsetInText(o,c):!o||a&&o.nodeType==1?{node:s,offset:d}:findOffsetInNode(o,c)}function findOffsetInText(s,e){let o=s.nodeValue.length,a=document.createRange(),c;for(let d=0;d<o;d++){a.setEnd(s,d+1),a.setStart(s,d);let h=singleRect(a,1);if(h.top!=h.bottom&&inRect(e,h)){c={node:s,offset:d+(e.left>=(h.left+h.right)/2?1:0)};break}}return a.detach(),c||{node:s,offset:0}}function inRect(s,e){return s.left>=e.left-1&&s.left<=e.right+1&&s.top>=e.top-1&&s.top<=e.bottom+1}function targetKludge(s,e){let o=s.parentNode;return o&&/^li$/i.test(o.nodeName)&&e.left<s.getBoundingClientRect().left?o:s}function posFromElement(s,e,o){let{node:a,offset:c}=findOffsetInNode(e,o),d=-1;if(a.nodeType==1&&!a.firstChild){let h=a.getBoundingClientRect();d=h.left!=h.right&&o.left>(h.left+h.right)/2?1:-1}return s.docView.posFromDOM(a,c,d)}function posFromCaret(s,e,o,a){let c=-1;for(let d=e,h=!1;d!=s.dom;){let g=s.docView.nearestDesc(d,!0),b;if(!g)return null;if(g.dom.nodeType==1&&(g.node.isBlock&&g.parent||!g.contentDOM)&&((b=g.dom.getBoundingClientRect()).width||b.height)&&(g.node.isBlock&&g.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(g.dom.nodeName)&&(!h&&b.left>a.left||b.top>a.top?c=g.posBefore:(!h&&b.right<a.left||b.bottom<a.top)&&(c=g.posAfter),h=!0),!g.contentDOM&&c<0&&!g.node.isText))return(g.node.isBlock?a.top<(b.top+b.bottom)/2:a.left<(b.left+b.right)/2)?g.posBefore:g.posAfter;d=g.dom.parentNode}return c>-1?c:s.docView.posFromDOM(e,o,-1)}function elementFromPoint(s,e,o){let a=s.childNodes.length;if(a&&o.top<o.bottom)for(let c=Math.max(0,Math.min(a-1,Math.floor(a*(e.top-o.top)/(o.bottom-o.top))-2)),d=c;;){let h=s.childNodes[d];if(h.nodeType==1){let g=h.getClientRects();for(let b=0;b<g.length;b++){let j=g[b];if(inRect(e,j))return elementFromPoint(h,e,j)}}if((d=(d+1)%a)==c)break}return s}function posAtCoords$1(s,e){let o=s.dom.ownerDocument,a,c=0,d=caretFromPoint(o,e.left,e.top);d&&({node:a,offset:c}=d);let h=(s.root.elementFromPoint?s.root:o).elementFromPoint(e.left,e.top),g;if(!h||!s.dom.contains(h.nodeType!=1?h.parentNode:h)){let j=s.dom.getBoundingClientRect();if(!inRect(e,j)||(h=elementFromPoint(s.dom,e,j),!h))return null}if(safari$1)for(let j=h;a&&j;j=parentNode(j))j.draggable&&(a=void 0);if(h=targetKludge(h,e),a){if(gecko$1&&a.nodeType==1&&(c=Math.min(c,a.childNodes.length),c<a.childNodes.length)){let $=a.childNodes[c],_;$.nodeName=="IMG"&&(_=$.getBoundingClientRect()).right<=e.left&&_.bottom>e.top&&c++}let j;webkit$1&&c&&a.nodeType==1&&(j=a.childNodes[c-1]).nodeType==1&&j.contentEditable=="false"&&j.getBoundingClientRect().top>=e.top&&c--,a==s.dom&&c==a.childNodes.length-1&&a.lastChild.nodeType==1&&e.top>a.lastChild.getBoundingClientRect().bottom?g=s.state.doc.content.size:(c==0||a.nodeType!=1||a.childNodes[c-1].nodeName!="BR")&&(g=posFromCaret(s,a,c,e))}g==null&&(g=posFromElement(s,h,e));let b=s.docView.nearestDesc(h,!0);return{pos:g,inside:b?b.posAtStart-b.border:-1}}function nonZero(s){return s.top<s.bottom||s.left<s.right}function singleRect(s,e){let o=s.getClientRects();if(o.length){let a=o[e<0?0:o.length-1];if(nonZero(a))return a}return Array.prototype.find.call(o,nonZero)||s.getBoundingClientRect()}const BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(s,e,o){let{node:a,offset:c,atom:d}=s.docView.domFromPos(e,o<0?-1:1),h=webkit$1||gecko$1;if(a.nodeType==3)if(h&&(BIDI.test(a.nodeValue)||(o<0?!c:c==a.nodeValue.length))){let b=singleRect(textRange$1(a,c,c),o);if(gecko$1&&c&&/\s/.test(a.nodeValue[c-1])&&c<a.nodeValue.length){let j=singleRect(textRange$1(a,c-1,c-1),-1);if(j.top==b.top){let $=singleRect(textRange$1(a,c,c+1),-1);if($.top!=b.top)return flattenV($,$.left<j.left)}}return b}else{let b=c,j=c,$=o<0?1:-1;return o<0&&!c?(j++,$=-1):o>=0&&c==a.nodeValue.length?(b--,$=1):o<0?b--:j++,flattenV(singleRect(textRange$1(a,b,j),$),$<0)}if(!s.state.doc.resolve(e-(d||0)).parent.inlineContent){if(d==null&&c&&(o<0||c==nodeSize$1(a))){let b=a.childNodes[c-1];if(b.nodeType==1)return flattenH(b.getBoundingClientRect(),!1)}if(d==null&&c<nodeSize$1(a)){let b=a.childNodes[c];if(b.nodeType==1)return flattenH(b.getBoundingClientRect(),!0)}return flattenH(a.getBoundingClientRect(),o>=0)}if(d==null&&c&&(o<0||c==nodeSize$1(a))){let b=a.childNodes[c-1],j=b.nodeType==3?textRange$1(b,nodeSize$1(b)-(h?0:1)):b.nodeType==1&&(b.nodeName!="BR"||!b.nextSibling)?b:null;if(j)return flattenV(singleRect(j,1),!1)}if(d==null&&c<nodeSize$1(a)){let b=a.childNodes[c];for(;b.pmViewDesc&&b.pmViewDesc.ignoreForCoords;)b=b.nextSibling;let j=b?b.nodeType==3?textRange$1(b,0,h?0:1):b.nodeType==1?b:null:null;if(j)return flattenV(singleRect(j,-1),!0)}return flattenV(singleRect(a.nodeType==3?textRange$1(a):a,-o),o>=0)}function flattenV(s,e){if(s.width==0)return s;let o=e?s.left:s.right;return{top:s.top,bottom:s.bottom,left:o,right:o}}function flattenH(s,e){if(s.height==0)return s;let o=e?s.top:s.bottom;return{top:o,bottom:o,left:s.left,right:s.right}}function withFlushedState(s,e,o){let a=s.state,c=s.root.activeElement;a!=e&&s.updateState(e),c!=s.dom&&s.focus();try{return o()}finally{a!=e&&s.updateState(a),c!=s.dom&&c&&c.focus()}}function endOfTextblockVertical(s,e,o){let a=e.selection,c=o=="up"?a.$from:a.$to;return withFlushedState(s,e,()=>{let{node:d}=s.docView.domFromPos(c.pos,o=="up"?-1:1);for(;;){let g=s.docView.nearestDesc(d,!0);if(!g)break;if(g.node.isBlock){d=g.contentDOM||g.dom;break}d=g.dom.parentNode}let h=coordsAtPos(s,c.pos,1);for(let g=d.firstChild;g;g=g.nextSibling){let b;if(g.nodeType==1)b=g.getClientRects();else if(g.nodeType==3)b=textRange$1(g,0,g.nodeValue.length).getClientRects();else continue;for(let j=0;j<b.length;j++){let $=b[j];if($.bottom>$.top+1&&(o=="up"?h.top-$.top>($.bottom-h.top)*2:$.bottom-h.bottom>(h.bottom-$.top)*2))return!1}}return!0})}const maybeRTL=/[\u0590-\u08ac]/;function endOfTextblockHorizontal(s,e,o){let{$head:a}=e.selection;if(!a.parent.isTextblock)return!1;let c=a.parentOffset,d=!c,h=c==a.parent.content.size,g=s.domSelection();return g?!maybeRTL.test(a.parent.textContent)||!g.modify?o=="left"||o=="backward"?d:h:withFlushedState(s,e,()=>{let{focusNode:b,focusOffset:j,anchorNode:$,anchorOffset:_}=s.domSelectionRange(),_e=g.caretBidiLevel;g.modify("move",o,"character");let et=a.depth?s.docView.domAfterPos(a.before()):s.dom,{focusNode:nt,focusOffset:rt}=s.domSelectionRange(),it=nt&&!et.contains(nt.nodeType==1?nt:nt.parentNode)||b==nt&&j==rt;try{g.collapse($,_),b&&(b!=$||j!=_)&&g.extend&&g.extend(b,j)}catch{}return _e!=null&&(g.caretBidiLevel=_e),it}):a.pos==a.start()||a.pos==a.end()}let cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(s,e,o){return cachedState==e&&cachedDir==o?cachedResult:(cachedState=e,cachedDir=o,cachedResult=o=="up"||o=="down"?endOfTextblockVertical(s,e,o):endOfTextblockHorizontal(s,e,o))}const NOT_DIRTY=0,CHILD_DIRTY=1,CONTENT_DIRTY=2,NODE_DIRTY=3;class ViewDesc{constructor(e,o,a,c){this.parent=e,this.children=o,this.dom=a,this.contentDOM=c,this.dirty=NOT_DIRTY,a.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,o,a){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let o=0;o<this.children.length;o++)e+=this.children[o].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let o=0,a=this.posAtStart;;o++){let c=this.children[o];if(c==e)return a;a+=c.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,o,a){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(a<0){let d,h;if(e==this.contentDOM)d=e.childNodes[o-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;d=e.previousSibling}for(;d&&!((h=d.pmViewDesc)&&h.parent==this);)d=d.previousSibling;return d?this.posBeforeChild(h)+h.size:this.posAtStart}else{let d,h;if(e==this.contentDOM)d=e.childNodes[o];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;d=e.nextSibling}for(;d&&!((h=d.pmViewDesc)&&h.parent==this);)d=d.nextSibling;return d?this.posBeforeChild(h):this.posAtEnd}let c;if(e==this.dom&&this.contentDOM)c=o>domIndex$1(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))c=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(o==0)for(let d=e;;d=d.parentNode){if(d==this.dom){c=!1;break}if(d.previousSibling)break}if(c==null&&o==e.childNodes.length)for(let d=e;;d=d.parentNode){if(d==this.dom){c=!0;break}if(d.nextSibling)break}}return c??a>0?this.posAtEnd:this.posAtStart}nearestDesc(e,o=!1){for(let a=!0,c=e;c;c=c.parentNode){let d=this.getDesc(c),h;if(d&&(!o||d.node))if(a&&(h=d.nodeDOM)&&!(h.nodeType==1?h.contains(e.nodeType==1?e:e.parentNode):h==e))a=!1;else return d}}getDesc(e){let o=e.pmViewDesc;for(let a=o;a;a=a.parent)if(a==this)return o}posFromDOM(e,o,a){for(let c=e;c;c=c.parentNode){let d=this.getDesc(c);if(d)return d.localPosFromDOM(e,o,a)}return-1}descAt(e){for(let o=0,a=0;o<this.children.length;o++){let c=this.children[o],d=a+c.size;if(a==e&&d!=a){for(;!c.border&&c.children.length;)for(let h=0;h<c.children.length;h++){let g=c.children[h];if(g.size){c=g;break}}return c}if(e<d)return c.descAt(e-a-c.border);a=d}}domFromPos(e,o){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let a=0,c=0;for(let d=0;a<this.children.length;a++){let h=this.children[a],g=d+h.size;if(g>e||h instanceof TrailingHackViewDesc){c=e-d;break}d=g}if(c)return this.children[a].domFromPos(c-this.children[a].border,o);for(let d;a&&!(d=this.children[a-1]).size&&d instanceof WidgetViewDesc&&d.side>=0;a--);if(o<=0){let d,h=!0;for(;d=a?this.children[a-1]:null,!(!d||d.dom.parentNode==this.contentDOM);a--,h=!1);return d&&o&&h&&!d.border&&!d.domAtom?d.domFromPos(d.size,o):{node:this.contentDOM,offset:d?domIndex$1(d.dom)+1:0}}else{let d,h=!0;for(;d=a<this.children.length?this.children[a]:null,!(!d||d.dom.parentNode==this.contentDOM);a++,h=!1);return d&&h&&!d.border&&!d.domAtom?d.domFromPos(0,o):{node:this.contentDOM,offset:d?domIndex$1(d.dom):this.contentDOM.childNodes.length}}}parseRange(e,o,a=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:o,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let c=-1,d=-1;for(let h=a,g=0;;g++){let b=this.children[g],j=h+b.size;if(c==-1&&e<=j){let $=h+b.border;if(e>=$&&o<=j-b.border&&b.node&&b.contentDOM&&this.contentDOM.contains(b.contentDOM))return b.parseRange(e,o,$);e=h;for(let _=g;_>0;_--){let _e=this.children[_-1];if(_e.size&&_e.dom.parentNode==this.contentDOM&&!_e.emptyChildAt(1)){c=domIndex$1(_e.dom)+1;break}e-=_e.size}c==-1&&(c=0)}if(c>-1&&(j>o||g==this.children.length-1)){o=j;for(let $=g+1;$<this.children.length;$++){let _=this.children[$];if(_.size&&_.dom.parentNode==this.contentDOM&&!_.emptyChildAt(-1)){d=domIndex$1(_.dom);break}o+=_.size}d==-1&&(d=this.contentDOM.childNodes.length);break}h=j}return{node:this.contentDOM,from:e,to:o,fromOffset:c,toOffset:d}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let o=this.children[e<0?0:this.children.length-1];return o.size==0||o.emptyChildAt(e)}domAfterPos(e){let{node:o,offset:a}=this.domFromPos(e,0);if(o.nodeType!=1||a==o.childNodes.length)throw new RangeError("No node after pos "+e);return o.childNodes[a]}setSelection(e,o,a,c=!1){let d=Math.min(e,o),h=Math.max(e,o);for(let et=0,nt=0;et<this.children.length;et++){let rt=this.children[et],it=nt+rt.size;if(d>nt&&h<it)return rt.setSelection(e-nt-rt.border,o-nt-rt.border,a,c);nt=it}let g=this.domFromPos(e,e?-1:1),b=o==e?g:this.domFromPos(o,o?-1:1),j=a.root.getSelection(),$=a.domSelectionRange(),_=!1;if((gecko$1||safari$1)&&e==o){let{node:et,offset:nt}=g;if(et.nodeType==3){if(_=!!(nt&&et.nodeValue[nt-1]==`
`),_&&nt==et.nodeValue.length)for(let rt=et,it;rt;rt=rt.parentNode){if(it=rt.nextSibling){it.nodeName=="BR"&&(g=b={node:it.parentNode,offset:domIndex$1(it)+1});break}let st=rt.pmViewDesc;if(st&&st.node&&st.node.isBlock)break}}else{let rt=et.childNodes[nt-1];_=rt&&(rt.nodeName=="BR"||rt.contentEditable=="false")}}if(gecko$1&&$.focusNode&&$.focusNode!=b.node&&$.focusNode.nodeType==1){let et=$.focusNode.childNodes[$.focusOffset];et&&et.contentEditable=="false"&&(c=!0)}if(!(c||_&&safari$1)&&isEquivalentPosition$1(g.node,g.offset,$.anchorNode,$.anchorOffset)&&isEquivalentPosition$1(b.node,b.offset,$.focusNode,$.focusOffset))return;let _e=!1;if((j.extend||e==o)&&!(_&&gecko$1)){j.collapse(g.node,g.offset);try{e!=o&&j.extend(b.node,b.offset),_e=!0}catch{}}if(!_e){if(e>o){let nt=g;g=b,b=nt}let et=document.createRange();et.setEnd(b.node,b.offset),et.setStart(g.node,g.offset),j.removeAllRanges(),j.addRange(et)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,o){for(let a=0,c=0;c<this.children.length;c++){let d=this.children[c],h=a+d.size;if(a==h?e<=h&&o>=a:e<h&&o>a){let g=a+d.border,b=h-d.border;if(e>=g&&o<=b){this.dirty=e==a||o==h?CONTENT_DIRTY:CHILD_DIRTY,e==g&&o==b&&(d.contentLost||d.dom.parentNode!=this.contentDOM)?d.dirty=NODE_DIRTY:d.markDirty(e-g,o-g);return}else d.dirty=d.dom==d.contentDOM&&d.dom.parentNode==this.contentDOM&&!d.children.length?CONTENT_DIRTY:NODE_DIRTY}a=h}this.dirty=CONTENT_DIRTY}markParentsDirty(){let e=1;for(let o=this.parent;o;o=o.parent,e++){let a=e==1?CONTENT_DIRTY:CHILD_DIRTY;o.dirty<a&&(o.dirty=a)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class WidgetViewDesc extends ViewDesc{constructor(e,o,a,c){let d,h=o.type.toDOM;if(typeof h=="function"&&(h=h(a,()=>{if(!d)return c;if(d.parent)return d.parent.posBeforeChild(d)})),!o.type.spec.raw){if(h.nodeType!=1){let g=document.createElement("span");g.appendChild(h),h=g}h.contentEditable="false",h.classList.add("ProseMirror-widget")}super(e,[],h,null),this.widget=o,this.widget=o,d=this}matchesWidget(e){return this.dirty==NOT_DIRTY&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let o=this.widget.spec.stopEvent;return o?o(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(e,o,a,c){super(e,[],o,null),this.textDOM=a,this.text=c}get size(){return this.text.length}localPosFromDOM(e,o){return e!=this.textDOM?this.posAtStart+(o?this.size:0):this.posAtStart+o}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class MarkViewDesc extends ViewDesc{constructor(e,o,a,c,d){super(e,[],a,c),this.mark=o,this.spec=d}static create(e,o,a,c){let d=c.nodeViews[o.type.name],h=d&&d(o,c,a);return(!h||!h.dom)&&(h=DOMSerializer.renderSpec(document,o.type.spec.toDOM(o,a),null,o.attrs)),new MarkViewDesc(e,o,h.dom,h.contentDOM||h.dom,h)}parseRule(){return this.dirty&NODE_DIRTY||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=NODE_DIRTY&&this.mark.eq(e)}markDirty(e,o){if(super.markDirty(e,o),this.dirty!=NOT_DIRTY){let a=this.parent;for(;!a.node;)a=a.parent;a.dirty<this.dirty&&(a.dirty=this.dirty),this.dirty=NOT_DIRTY}}slice(e,o,a){let c=MarkViewDesc.create(this.parent,this.mark,!0,a),d=this.children,h=this.size;o<h&&(d=replaceNodes(d,o,h,a)),e>0&&(d=replaceNodes(d,0,e,a));for(let g=0;g<d.length;g++)d[g].parent=c;return c.children=d,c}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class NodeViewDesc extends ViewDesc{constructor(e,o,a,c,d,h,g,b,j){super(e,[],d,h),this.node=o,this.outerDeco=a,this.innerDeco=c,this.nodeDOM=g}static create(e,o,a,c,d,h){let g=d.nodeViews[o.type.name],b,j=g&&g(o,d,()=>{if(!b)return h;if(b.parent)return b.parent.posBeforeChild(b)},a,c),$=j&&j.dom,_=j&&j.contentDOM;if(o.isText){if(!$)$=document.createTextNode(o.text);else if($.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else $||({dom:$,contentDOM:_}=DOMSerializer.renderSpec(document,o.type.spec.toDOM(o),null,o.attrs));!_&&!o.isText&&$.nodeName!="BR"&&($.hasAttribute("contenteditable")||($.contentEditable="false"),o.type.spec.draggable&&($.draggable=!0));let _e=$;return $=applyOuterDeco($,a,o),j?b=new CustomNodeViewDesc(e,o,a,c,$,_||null,_e,j,d,h+1):o.isText?new TextViewDesc(e,o,a,c,$,_e,d):new NodeViewDesc(e,o,a,c,$,_||null,_e,d,h+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let o=this.children.length-1;o>=0;o--){let a=this.children[o];if(this.dom.contains(a.dom.parentNode)){e.contentElement=a.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Fragment.empty)}return e}matchesNode(e,o,a){return this.dirty==NOT_DIRTY&&e.eq(this.node)&&sameOuterDeco(o,this.outerDeco)&&a.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,o){let a=this.node.inlineContent,c=o,d=e.composing?this.localCompositionInfo(e,o):null,h=d&&d.pos>-1?d:null,g=d&&d.pos<0,b=new ViewTreeUpdater(this,h&&h.node,e);iterDeco(this.node,this.innerDeco,(j,$,_)=>{j.spec.marks?b.syncToMarks(j.spec.marks,a,e,$):j.type.side>=0&&!_&&b.syncToMarks($==this.node.childCount?Mark$1.none:this.node.child($).marks,a,e,$),b.placeWidget(j,e,c)},(j,$,_,_e)=>{b.syncToMarks(j.marks,a,e,_e);let et;b.findNodeMatch(j,$,_,_e)||g&&e.state.selection.from>c&&e.state.selection.to<c+j.nodeSize&&(et=b.findIndexWithChild(d.node))>-1&&b.updateNodeAt(j,$,_,et,e)||b.updateNextNode(j,$,_,e,_e,c)||b.addNode(j,$,_,e,c),c+=j.nodeSize}),b.syncToMarks([],a,e,0),this.node.isTextblock&&b.addTextblockHacks(),b.destroyRest(),(b.changed||this.dirty==CONTENT_DIRTY)&&(h&&this.protectLocalComposition(e,h),renderDescs(this.contentDOM,this.children,e),ios$1&&iosHacks(this.dom))}localCompositionInfo(e,o){let{from:a,to:c}=e.state.selection;if(!(e.state.selection instanceof TextSelection)||a<o||c>o+this.node.content.size)return null;let d=e.input.compositionNode;if(!d||!this.dom.contains(d.parentNode))return null;if(this.node.inlineContent){let h=d.nodeValue,g=findTextInFragment(this.node.content,h,a-o,c-o);return g<0?null:{node:d,pos:g,text:h}}else return{node:d,pos:-1,text:""}}protectLocalComposition(e,{node:o,pos:a,text:c}){if(this.getDesc(o))return;let d=o;for(;d.parentNode!=this.contentDOM;d=d.parentNode){for(;d.previousSibling;)d.parentNode.removeChild(d.previousSibling);for(;d.nextSibling;)d.parentNode.removeChild(d.nextSibling);d.pmViewDesc&&(d.pmViewDesc=void 0)}let h=new CompositionViewDesc(this,d,o,c);e.input.compositionNodes.push(h),this.children=replaceNodes(this.children,a,a+c.length,e,h)}update(e,o,a,c){return this.dirty==NODE_DIRTY||!e.sameMarkup(this.node)?!1:(this.updateInner(e,o,a,c),!0)}updateInner(e,o,a,c){this.updateOuterDeco(o),this.node=e,this.innerDeco=a,this.contentDOM&&this.updateChildren(c,this.posAtStart),this.dirty=NOT_DIRTY}updateOuterDeco(e){if(sameOuterDeco(e,this.outerDeco))return;let o=this.nodeDOM.nodeType!=1,a=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,o),computeOuterDeco(e,this.node,o)),this.dom!=a&&(a.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function docViewDesc(s,e,o,a,c){applyOuterDeco(a,e,s);let d=new NodeViewDesc(void 0,s,e,o,a,a,a,c,0);return d.contentDOM&&d.updateChildren(c,0),d}class TextViewDesc extends NodeViewDesc{constructor(e,o,a,c,d,h,g){super(e,o,a,c,d,null,h,g,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,o,a,c){return this.dirty==NODE_DIRTY||this.dirty!=NOT_DIRTY&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(o),(this.dirty!=NOT_DIRTY||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,c.trackWrites==this.nodeDOM&&(c.trackWrites=null)),this.node=e,this.dirty=NOT_DIRTY,!0)}inParent(){let e=this.parent.contentDOM;for(let o=this.nodeDOM;o;o=o.parentNode)if(o==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,o,a){return e==this.nodeDOM?this.posAtStart+Math.min(o,this.node.text.length):super.localPosFromDOM(e,o,a)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,o,a){let c=this.node.cut(e,o),d=document.createTextNode(c.text);return new TextViewDesc(this.parent,c,this.outerDeco,this.innerDeco,d,d,a)}markDirty(e,o){super.markDirty(e,o),this.dom!=this.nodeDOM&&(e==0||o==this.nodeDOM.nodeValue.length)&&(this.dirty=NODE_DIRTY)}get domAtom(){return!1}isText(e){return this.node.text==e}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==NOT_DIRTY&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class CustomNodeViewDesc extends NodeViewDesc{constructor(e,o,a,c,d,h,g,b,j,$){super(e,o,a,c,d,h,g,j,$),this.spec=b}update(e,o,a,c){if(this.dirty==NODE_DIRTY)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let d=this.spec.update(e,o,a);return d&&this.updateInner(e,o,a,c),d}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,o,a,c)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,o,a,c){this.spec.setSelection?this.spec.setSelection(e,o,a.root):super.setSelection(e,o,a,c)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function renderDescs(s,e,o){let a=s.firstChild,c=!1;for(let d=0;d<e.length;d++){let h=e[d],g=h.dom;if(g.parentNode==s){for(;g!=a;)a=rm$2(a),c=!0;a=a.nextSibling}else c=!0,s.insertBefore(g,a);if(h instanceof MarkViewDesc){let b=a?a.previousSibling:s.lastChild;renderDescs(h.contentDOM,h.children,o),a=b?b.nextSibling:s.firstChild}}for(;a;)a=rm$2(a),c=!0;c&&o.trackWrites==s&&(o.trackWrites=null)}const OuterDecoLevel=function(s){s&&(this.nodeName=s)};OuterDecoLevel.prototype=Object.create(null);const noDeco=[new OuterDecoLevel];function computeOuterDeco(s,e,o){if(s.length==0)return noDeco;let a=o?noDeco[0]:new OuterDecoLevel,c=[a];for(let d=0;d<s.length;d++){let h=s[d].type.attrs;if(h){h.nodeName&&c.push(a=new OuterDecoLevel(h.nodeName));for(let g in h){let b=h[g];b!=null&&(o&&c.length==1&&c.push(a=new OuterDecoLevel(e.isInline?"span":"div")),g=="class"?a.class=(a.class?a.class+" ":"")+b:g=="style"?a.style=(a.style?a.style+";":"")+b:g!="nodeName"&&(a[g]=b))}}}return c}function patchOuterDeco(s,e,o,a){if(o==noDeco&&a==noDeco)return e;let c=e;for(let d=0;d<a.length;d++){let h=a[d],g=o[d];if(d){let b;g&&g.nodeName==h.nodeName&&c!=s&&(b=c.parentNode)&&b.nodeName.toLowerCase()==h.nodeName||(b=document.createElement(h.nodeName),b.pmIsDeco=!0,b.appendChild(c),g=noDeco[0]),c=b}patchAttributes(c,g||noDeco[0],h)}return c}function patchAttributes(s,e,o){for(let a in e)a!="class"&&a!="style"&&a!="nodeName"&&!(a in o)&&s.removeAttribute(a);for(let a in o)a!="class"&&a!="style"&&a!="nodeName"&&o[a]!=e[a]&&s.setAttribute(a,o[a]);if(e.class!=o.class){let a=e.class?e.class.split(" ").filter(Boolean):[],c=o.class?o.class.split(" ").filter(Boolean):[];for(let d=0;d<a.length;d++)c.indexOf(a[d])==-1&&s.classList.remove(a[d]);for(let d=0;d<c.length;d++)a.indexOf(c[d])==-1&&s.classList.add(c[d]);s.classList.length==0&&s.removeAttribute("class")}if(e.style!=o.style){if(e.style){let a=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,c;for(;c=a.exec(e.style);)s.style.removeProperty(c[1])}o.style&&(s.style.cssText+=o.style)}}function applyOuterDeco(s,e,o){return patchOuterDeco(s,s,noDeco,computeOuterDeco(e,o,s.nodeType!=1))}function sameOuterDeco(s,e){if(s.length!=e.length)return!1;for(let o=0;o<s.length;o++)if(!s[o].type.eq(e[o].type))return!1;return!0}function rm$2(s){let e=s.nextSibling;return s.parentNode.removeChild(s),e}class ViewTreeUpdater{constructor(e,o,a){this.lock=o,this.view=a,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=preMatch(e.node.content,e)}destroyBetween(e,o){if(e!=o){for(let a=e;a<o;a++)this.top.children[a].destroy();this.top.children.splice(e,o-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,o,a,c){let d=0,h=this.stack.length>>1,g=Math.min(h,e.length);for(;d<g&&(d==h-1?this.top:this.stack[d+1<<1]).matchesMark(e[d])&&e[d].type.spec.spanning!==!1;)d++;for(;d<h;)this.destroyRest(),this.top.dirty=NOT_DIRTY,this.index=this.stack.pop(),this.top=this.stack.pop(),h--;for(;h<e.length;){this.stack.push(this.top,this.index+1);let b=-1,j=this.top.children.length;c<this.preMatch.index&&(j=Math.min(this.index+3,j));for(let $=this.index;$<j;$++){let _=this.top.children[$];if(_.matchesMark(e[h])&&!this.isLocked(_.dom)){b=$;break}}if(b>-1)b>this.index&&(this.changed=!0,this.destroyBetween(this.index,b)),this.top=this.top.children[this.index];else{let $=MarkViewDesc.create(this.top,e[h],o,a);this.top.children.splice(this.index,0,$),this.top=$,this.changed=!0}this.index=0,h++}}findNodeMatch(e,o,a,c){let d=-1,h;if(c>=this.preMatch.index&&(h=this.preMatch.matches[c-this.preMatch.index]).parent==this.top&&h.matchesNode(e,o,a))d=this.top.children.indexOf(h,this.index);else for(let g=this.index,b=Math.min(this.top.children.length,g+5);g<b;g++){let j=this.top.children[g];if(j.matchesNode(e,o,a)&&!this.preMatch.matched.has(j)){d=g;break}}return d<0?!1:(this.destroyBetween(this.index,d),this.index++,!0)}updateNodeAt(e,o,a,c,d){let h=this.top.children[c];return h.dirty==NODE_DIRTY&&h.dom==h.contentDOM&&(h.dirty=CONTENT_DIRTY),h.update(e,o,a,d)?(this.destroyBetween(this.index,c),this.index++,!0):!1}findIndexWithChild(e){for(;;){let o=e.parentNode;if(!o)return-1;if(o==this.top.contentDOM){let a=e.pmViewDesc;if(a){for(let c=this.index;c<this.top.children.length;c++)if(this.top.children[c]==a)return c}return-1}e=o}}updateNextNode(e,o,a,c,d,h){for(let g=this.index;g<this.top.children.length;g++){let b=this.top.children[g];if(b instanceof NodeViewDesc){let j=this.preMatch.matched.get(b);if(j!=null&&j!=d)return!1;let $=b.dom,_,_e=this.isLocked($)&&!(e.isText&&b.node&&b.node.isText&&b.nodeDOM.nodeValue==e.text&&b.dirty!=NODE_DIRTY&&sameOuterDeco(o,b.outerDeco));if(!_e&&b.update(e,o,a,c))return this.destroyBetween(this.index,g),b.dom!=$&&(this.changed=!0),this.index++,!0;if(!_e&&(_=this.recreateWrapper(b,e,o,a,c,h)))return this.destroyBetween(this.index,g),this.top.children[this.index]=_,_.contentDOM&&(_.dirty=CONTENT_DIRTY,_.updateChildren(c,h+1),_.dirty=NOT_DIRTY),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,o,a,c,d,h){if(e.dirty||o.isAtom||!e.children.length||!e.node.content.eq(o.content)||!sameOuterDeco(a,e.outerDeco)||!c.eq(e.innerDeco))return null;let g=NodeViewDesc.create(this.top,o,a,c,d,h);if(g.contentDOM){g.children=e.children,e.children=[];for(let b of g.children)b.parent=g}return e.destroy(),g}addNode(e,o,a,c,d){let h=NodeViewDesc.create(this.top,e,o,a,c,d);h.contentDOM&&h.updateChildren(c,d+1),this.top.children.splice(this.index++,0,h),this.changed=!0}placeWidget(e,o,a){let c=this.index<this.top.children.length?this.top.children[this.index]:null;if(c&&c.matchesWidget(e)&&(e==c.widget||!c.widget.type.toDOM.parentNode))this.index++;else{let d=new WidgetViewDesc(this.top,e,o,a);this.top.children.splice(this.index++,0,d),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],o=this.top;for(;e instanceof MarkViewDesc;)o=e,e=o.children[o.children.length-1];(!e||!(e instanceof TextViewDesc)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((safari$1||chrome$1)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",o),this.addHackNode("BR",this.top))}addHackNode(e,o){if(o==this.top&&this.index<o.children.length&&o.children[this.index].matchesHack(e))this.index++;else{let a=document.createElement(e);e=="IMG"&&(a.className="ProseMirror-separator",a.alt=""),e=="BR"&&(a.className="ProseMirror-trailingBreak");let c=new TrailingHackViewDesc(this.top,[],a,null);o!=this.top?o.children.push(c):o.children.splice(this.index++,0,c),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function preMatch(s,e){let o=e,a=o.children.length,c=s.childCount,d=new Map,h=[];e:for(;c>0;){let g;for(;;)if(a){let j=o.children[a-1];if(j instanceof MarkViewDesc)o=j,a=j.children.length;else{g=j,a--;break}}else{if(o==e)break e;a=o.parent.children.indexOf(o),o=o.parent}let b=g.node;if(b){if(b!=s.child(c-1))break;--c,d.set(g,c),h.push(g)}}return{index:c,matched:d,matches:h.reverse()}}function compareSide(s,e){return s.type.side-e.type.side}function iterDeco(s,e,o,a){let c=e.locals(s),d=0;if(c.length==0){for(let j=0;j<s.childCount;j++){let $=s.child(j);a($,c,e.forChild(d,$),j),d+=$.nodeSize}return}let h=0,g=[],b=null;for(let j=0;;){let $,_;for(;h<c.length&&c[h].to==d;){let it=c[h++];it.widget&&($?(_||(_=[$])).push(it):$=it)}if($)if(_){_.sort(compareSide);for(let it=0;it<_.length;it++)o(_[it],j,!!b)}else o($,j,!!b);let _e,et;if(b)et=-1,_e=b,b=null;else if(j<s.childCount)et=j,_e=s.child(j++);else break;for(let it=0;it<g.length;it++)g[it].to<=d&&g.splice(it--,1);for(;h<c.length&&c[h].from<=d&&c[h].to>d;)g.push(c[h++]);let nt=d+_e.nodeSize;if(_e.isText){let it=nt;h<c.length&&c[h].from<it&&(it=c[h].from);for(let st=0;st<g.length;st++)g[st].to<it&&(it=g[st].to);it<nt&&(b=_e.cut(it-d),_e=_e.cut(0,it-d),nt=it,et=-1)}else for(;h<c.length&&c[h].to<nt;)h++;let rt=_e.isInline&&!_e.isLeaf?g.filter(it=>!it.inline):g.slice();a(_e,rt,e.forChild(d,_e),et),d=nt}}function iosHacks(s){if(s.nodeName=="UL"||s.nodeName=="OL"){let e=s.style.cssText;s.style.cssText=e+"; list-style: square !important",window.getComputedStyle(s).listStyle,s.style.cssText=e}}function findTextInFragment(s,e,o,a){for(let c=0,d=0;c<s.childCount&&d<=a;){let h=s.child(c++),g=d;if(d+=h.nodeSize,!h.isText)continue;let b=h.text;for(;c<s.childCount;){let j=s.child(c++);if(d+=j.nodeSize,!j.isText)break;b+=j.text}if(d>=o){if(d>=a&&b.slice(a-e.length-g,a-g)==e)return a-e.length;let j=g<a?b.lastIndexOf(e,a-g-1):-1;if(j>=0&&j+e.length+g>=o)return g+j;if(o==a&&b.length>=a+e.length-g&&b.slice(a-g,a-g+e.length)==e)return a}}return-1}function replaceNodes(s,e,o,a,c){let d=[];for(let h=0,g=0;h<s.length;h++){let b=s[h],j=g,$=g+=b.size;j>=o||$<=e?d.push(b):(j<e&&d.push(b.slice(0,e-j,a)),c&&(d.push(c),c=void 0),$>o&&d.push(b.slice(o-j,b.size,a)))}return d}function selectionFromDOM(s,e=null){let o=s.domSelectionRange(),a=s.state.doc;if(!o.focusNode)return null;let c=s.docView.nearestDesc(o.focusNode),d=c&&c.size==0,h=s.docView.posFromDOM(o.focusNode,o.focusOffset,1);if(h<0)return null;let g=a.resolve(h),b,j;if(selectionCollapsed(o)){for(b=h;c&&!c.node;)c=c.parent;let _=c.node;if(c&&_.isAtom&&NodeSelection.isSelectable(_)&&c.parent&&!(_.isInline&&isOnEdge(o.focusNode,o.focusOffset,c.dom))){let _e=c.posBefore;j=new NodeSelection(h==_e?g:a.resolve(_e))}}else{if(o instanceof s.dom.ownerDocument.defaultView.Selection&&o.rangeCount>1){let _=h,_e=h;for(let et=0;et<o.rangeCount;et++){let nt=o.getRangeAt(et);_=Math.min(_,s.docView.posFromDOM(nt.startContainer,nt.startOffset,1)),_e=Math.max(_e,s.docView.posFromDOM(nt.endContainer,nt.endOffset,-1))}if(_<0)return null;[b,h]=_e==s.state.selection.anchor?[_e,_]:[_,_e],g=a.resolve(h)}else b=s.docView.posFromDOM(o.anchorNode,o.anchorOffset,1);if(b<0)return null}let $=a.resolve(b);if(!j){let _=e=="pointer"||s.state.selection.head<g.pos&&!d?1:-1;j=selectionBetween(s,$,g,_)}return j}function editorOwnsSelection(s){return s.editable?s.hasFocus():hasSelection$1(s)&&document.activeElement&&document.activeElement.contains(s.dom)}function selectionToDOM(s,e=!1){let o=s.state.selection;if(syncNodeSelection(s,o),!!editorOwnsSelection(s)){if(!e&&s.input.mouseDown&&s.input.mouseDown.allowDefault&&chrome$1){let a=s.domSelectionRange(),c=s.domObserver.currentSelection;if(a.anchorNode&&c.anchorNode&&isEquivalentPosition$1(a.anchorNode,a.anchorOffset,c.anchorNode,c.anchorOffset)){s.input.mouseDown.delayedSelectionSync=!0,s.domObserver.setCurSelection();return}}if(s.domObserver.disconnectSelection(),s.cursorWrapper)selectCursorWrapper(s);else{let{anchor:a,head:c}=o,d,h;brokenSelectBetweenUneditable&&!(o instanceof TextSelection)&&(o.$from.parent.inlineContent||(d=temporarilyEditableNear(s,o.from)),!o.empty&&!o.$from.parent.inlineContent&&(h=temporarilyEditableNear(s,o.to))),s.docView.setSelection(a,c,s,e),brokenSelectBetweenUneditable&&(d&&resetEditable(d),h&&resetEditable(h)),o.visible?s.dom.classList.remove("ProseMirror-hideselection"):(s.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&removeClassOnSelectionChange(s))}s.domObserver.setCurSelection(),s.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari$1||chrome$1&&chrome_version<63;function temporarilyEditableNear(s,e){let{node:o,offset:a}=s.docView.domFromPos(e,0),c=a<o.childNodes.length?o.childNodes[a]:null,d=a?o.childNodes[a-1]:null;if(safari$1&&c&&c.contentEditable=="false")return setEditable(c);if((!c||c.contentEditable=="false")&&(!d||d.contentEditable=="false")){if(c)return setEditable(c);if(d)return setEditable(d)}}function setEditable(s){return s.contentEditable="true",safari$1&&s.draggable&&(s.draggable=!1,s.wasDraggable=!0),s}function resetEditable(s){s.contentEditable="false",s.wasDraggable&&(s.draggable=!0,s.wasDraggable=null)}function removeClassOnSelectionChange(s){let e=s.dom.ownerDocument;e.removeEventListener("selectionchange",s.input.hideSelectionGuard);let o=s.domSelectionRange(),a=o.anchorNode,c=o.anchorOffset;e.addEventListener("selectionchange",s.input.hideSelectionGuard=()=>{(o.anchorNode!=a||o.anchorOffset!=c)&&(e.removeEventListener("selectionchange",s.input.hideSelectionGuard),setTimeout(()=>{(!editorOwnsSelection(s)||s.state.selection.visible)&&s.dom.classList.remove("ProseMirror-hideselection")},20))})}function selectCursorWrapper(s){let e=s.domSelection();if(!e)return;let o=s.cursorWrapper.dom,a=o.nodeName=="IMG";a?e.collapse(o.parentNode,domIndex$1(o)+1):e.collapse(o,0),!a&&!s.state.selection.visible&&ie$2&&ie_version<=11&&(o.disabled=!0,o.disabled=!1)}function syncNodeSelection(s,e){if(e instanceof NodeSelection){let o=s.docView.descAt(e.from);o!=s.lastSelectedViewDesc&&(clearNodeSelection(s),o&&o.selectNode(),s.lastSelectedViewDesc=o)}else clearNodeSelection(s)}function clearNodeSelection(s){s.lastSelectedViewDesc&&(s.lastSelectedViewDesc.parent&&s.lastSelectedViewDesc.deselectNode(),s.lastSelectedViewDesc=void 0)}function selectionBetween(s,e,o,a){return s.someProp("createSelectionBetween",c=>c(s,e,o))||TextSelection.between(e,o,a)}function hasFocusAndSelection(s){return s.editable&&!s.hasFocus()?!1:hasSelection$1(s)}function hasSelection$1(s){let e=s.domSelectionRange();if(!e.anchorNode)return!1;try{return s.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(s.editable||s.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function anchorInRightPlace(s){let e=s.docView.domFromPos(s.state.selection.anchor,0),o=s.domSelectionRange();return isEquivalentPosition$1(e.node,e.offset,o.anchorNode,o.anchorOffset)}function moveSelectionBlock(s,e){let{$anchor:o,$head:a}=s.selection,c=e>0?o.max(a):o.min(a),d=c.parent.inlineContent?c.depth?s.doc.resolve(e>0?c.after():c.before()):null:c;return d&&Selection$2.findFrom(d,e)}function apply(s,e){return s.dispatch(s.state.tr.setSelection(e).scrollIntoView()),!0}function selectHorizontally(s,e,o){let a=s.state.selection;if(a instanceof TextSelection)if(o.indexOf("s")>-1){let{$head:c}=a,d=c.textOffset?null:e<0?c.nodeBefore:c.nodeAfter;if(!d||d.isText||!d.isLeaf)return!1;let h=s.state.doc.resolve(c.pos+d.nodeSize*(e<0?-1:1));return apply(s,new TextSelection(a.$anchor,h))}else if(a.empty){if(s.endOfTextblock(e>0?"forward":"backward")){let c=moveSelectionBlock(s.state,e);return c&&c instanceof NodeSelection?apply(s,c):!1}else if(!(mac$2&&o.indexOf("m")>-1)){let c=a.$head,d=c.textOffset?null:e<0?c.nodeBefore:c.nodeAfter,h;if(!d||d.isText)return!1;let g=e<0?c.pos-d.nodeSize:c.pos;return d.isAtom||(h=s.docView.descAt(g))&&!h.contentDOM?NodeSelection.isSelectable(d)?apply(s,new NodeSelection(e<0?s.state.doc.resolve(c.pos-d.nodeSize):c)):webkit$1?apply(s,new TextSelection(s.state.doc.resolve(e<0?g:g+d.nodeSize))):!1:!1}}else return!1;else{if(a instanceof NodeSelection&&a.node.isInline)return apply(s,new TextSelection(e>0?a.$to:a.$from));{let c=moveSelectionBlock(s.state,e);return c?apply(s,c):!1}}}function nodeLen(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function isIgnorable(s,e){let o=s.pmViewDesc;return o&&o.size==0&&(e<0||s.nextSibling||s.nodeName!="BR")}function skipIgnoredNodes(s,e){return e<0?skipIgnoredNodesBefore(s):skipIgnoredNodesAfter(s)}function skipIgnoredNodesBefore(s){let e=s.domSelectionRange(),o=e.focusNode,a=e.focusOffset;if(!o)return;let c,d,h=!1;for(gecko$1&&o.nodeType==1&&a<nodeLen(o)&&isIgnorable(o.childNodes[a],-1)&&(h=!0);;)if(a>0){if(o.nodeType!=1)break;{let g=o.childNodes[a-1];if(isIgnorable(g,-1))c=o,d=--a;else if(g.nodeType==3)o=g,a=o.nodeValue.length;else break}}else{if(isBlockNode(o))break;{let g=o.previousSibling;for(;g&&isIgnorable(g,-1);)c=o.parentNode,d=domIndex$1(g),g=g.previousSibling;if(g)o=g,a=nodeLen(o);else{if(o=o.parentNode,o==s.dom)break;a=0}}}h?setSelFocus(s,o,a):c&&setSelFocus(s,c,d)}function skipIgnoredNodesAfter(s){let e=s.domSelectionRange(),o=e.focusNode,a=e.focusOffset;if(!o)return;let c=nodeLen(o),d,h;for(;;)if(a<c){if(o.nodeType!=1)break;let g=o.childNodes[a];if(isIgnorable(g,1))d=o,h=++a;else break}else{if(isBlockNode(o))break;{let g=o.nextSibling;for(;g&&isIgnorable(g,1);)d=g.parentNode,h=domIndex$1(g)+1,g=g.nextSibling;if(g)o=g,a=0,c=nodeLen(o);else{if(o=o.parentNode,o==s.dom)break;a=c=0}}}d&&setSelFocus(s,d,h)}function isBlockNode(s){let e=s.pmViewDesc;return e&&e.node&&e.node.isBlock}function textNodeAfter$2(s,e){for(;s&&e==s.childNodes.length&&!hasBlockDesc(s);)e=domIndex$1(s)+1,s=s.parentNode;for(;s&&e<s.childNodes.length;){let o=s.childNodes[e];if(o.nodeType==3)return o;if(o.nodeType==1&&o.contentEditable=="false")break;s=o,e=0}}function textNodeBefore$2(s,e){for(;s&&!e&&!hasBlockDesc(s);)e=domIndex$1(s),s=s.parentNode;for(;s&&e;){let o=s.childNodes[e-1];if(o.nodeType==3)return o;if(o.nodeType==1&&o.contentEditable=="false")break;s=o,e=s.childNodes.length}}function setSelFocus(s,e,o){if(e.nodeType!=3){let d,h;(h=textNodeAfter$2(e,o))?(e=h,o=0):(d=textNodeBefore$2(e,o))&&(e=d,o=d.nodeValue.length)}let a=s.domSelection();if(!a)return;if(selectionCollapsed(a)){let d=document.createRange();d.setEnd(e,o),d.setStart(e,o),a.removeAllRanges(),a.addRange(d)}else a.extend&&a.extend(e,o);s.domObserver.setCurSelection();let{state:c}=s;setTimeout(()=>{s.state==c&&selectionToDOM(s)},50)}function findDirection(s,e){let o=s.state.doc.resolve(e);if(!(chrome$1||windows$2)&&o.parent.inlineContent){let c=s.coordsAtPos(e);if(e>o.start()){let d=s.coordsAtPos(e-1),h=(d.top+d.bottom)/2;if(h>c.top&&h<c.bottom&&Math.abs(d.left-c.left)>1)return d.left<c.left?"ltr":"rtl"}if(e<o.end()){let d=s.coordsAtPos(e+1),h=(d.top+d.bottom)/2;if(h>c.top&&h<c.bottom&&Math.abs(d.left-c.left)>1)return d.left>c.left?"ltr":"rtl"}}return getComputedStyle(s.dom).direction=="rtl"?"rtl":"ltr"}function selectVertically(s,e,o){let a=s.state.selection;if(a instanceof TextSelection&&!a.empty||o.indexOf("s")>-1||mac$2&&o.indexOf("m")>-1)return!1;let{$from:c,$to:d}=a;if(!c.parent.inlineContent||s.endOfTextblock(e<0?"up":"down")){let h=moveSelectionBlock(s.state,e);if(h&&h instanceof NodeSelection)return apply(s,h)}if(!c.parent.inlineContent){let h=e<0?c:d,g=a instanceof AllSelection?Selection$2.near(h,e):Selection$2.findFrom(h,e);return g?apply(s,g):!1}return!1}function stopNativeHorizontalDelete(s,e){if(!(s.state.selection instanceof TextSelection))return!0;let{$head:o,$anchor:a,empty:c}=s.state.selection;if(!o.sameParent(a))return!0;if(!c)return!1;if(s.endOfTextblock(e>0?"forward":"backward"))return!0;let d=!o.textOffset&&(e<0?o.nodeBefore:o.nodeAfter);if(d&&!d.isText){let h=s.state.tr;return e<0?h.delete(o.pos-d.nodeSize,o.pos):h.delete(o.pos,o.pos+d.nodeSize),s.dispatch(h),!0}return!1}function switchEditable(s,e,o){s.domObserver.stop(),e.contentEditable=o,s.domObserver.start()}function safariDownArrowBug(s){if(!safari$1||s.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:o}=s.domSelectionRange();if(e&&e.nodeType==1&&o==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let a=e.firstChild;switchEditable(s,a,"true"),setTimeout(()=>switchEditable(s,a,"false"),20)}return!1}function getMods(s){let e="";return s.ctrlKey&&(e+="c"),s.metaKey&&(e+="m"),s.altKey&&(e+="a"),s.shiftKey&&(e+="s"),e}function captureKeyDown(s,e){let o=e.keyCode,a=getMods(e);if(o==8||mac$2&&o==72&&a=="c")return stopNativeHorizontalDelete(s,-1)||skipIgnoredNodes(s,-1);if(o==46&&!e.shiftKey||mac$2&&o==68&&a=="c")return stopNativeHorizontalDelete(s,1)||skipIgnoredNodes(s,1);if(o==13||o==27)return!0;if(o==37||mac$2&&o==66&&a=="c"){let c=o==37?findDirection(s,s.state.selection.from)=="ltr"?-1:1:-1;return selectHorizontally(s,c,a)||skipIgnoredNodes(s,c)}else if(o==39||mac$2&&o==70&&a=="c"){let c=o==39?findDirection(s,s.state.selection.from)=="ltr"?1:-1:1;return selectHorizontally(s,c,a)||skipIgnoredNodes(s,c)}else{if(o==38||mac$2&&o==80&&a=="c")return selectVertically(s,-1,a)||skipIgnoredNodes(s,-1);if(o==40||mac$2&&o==78&&a=="c")return safariDownArrowBug(s)||selectVertically(s,1,a)||skipIgnoredNodes(s,1);if(a==(mac$2?"m":"c")&&(o==66||o==73||o==89||o==90))return!0}return!1}function serializeForClipboard(s,e){s.someProp("transformCopied",et=>{e=et(e,s)});let o=[],{content:a,openStart:c,openEnd:d}=e;for(;c>1&&d>1&&a.childCount==1&&a.firstChild.childCount==1;){c--,d--;let et=a.firstChild;o.push(et.type.name,et.attrs!=et.type.defaultAttrs?et.attrs:null),a=et.content}let h=s.someProp("clipboardSerializer")||DOMSerializer.fromSchema(s.state.schema),g=detachedDoc(),b=g.createElement("div");b.appendChild(h.serializeFragment(a,{document:g}));let j=b.firstChild,$,_=0;for(;j&&j.nodeType==1&&($=wrapMap[j.nodeName.toLowerCase()]);){for(let et=$.length-1;et>=0;et--){let nt=g.createElement($[et]);for(;b.firstChild;)nt.appendChild(b.firstChild);b.appendChild(nt),_++}j=b.firstChild}j&&j.nodeType==1&&j.setAttribute("data-pm-slice",`${c} ${d}${_?` -${_}`:""} ${JSON.stringify(o)}`);let _e=s.someProp("clipboardTextSerializer",et=>et(e,s))||e.content.textBetween(0,e.content.size,`

`);return{dom:b,text:_e,slice:e}}function parseFromClipboard(s,e,o,a,c){let d=c.parent.type.spec.code,h,g;if(!o&&!e)return null;let b=!!e&&(a||d||!o);if(b){if(s.someProp("transformPastedText",_e=>{e=_e(e,d||a,s)}),d)return g=new Slice(Fragment.from(s.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),s.someProp("transformPasted",_e=>{g=_e(g,s,!0)}),g;let _=s.someProp("clipboardTextParser",_e=>_e(e,c,a,s));if(_)g=_;else{let _e=c.marks(),{schema:et}=s.state,nt=DOMSerializer.fromSchema(et);h=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(rt=>{let it=h.appendChild(document.createElement("p"));rt&&it.appendChild(nt.serializeNode(et.text(rt,_e)))})}}else s.someProp("transformPastedHTML",_=>{o=_(o,s)}),h=readHTML(o),webkit$1&&restoreReplacedSpaces(h);let j=h&&h.querySelector("[data-pm-slice]"),$=j&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(j.getAttribute("data-pm-slice")||"");if($&&$[3])for(let _=+$[3];_>0;_--){let _e=h.firstChild;for(;_e&&_e.nodeType!=1;)_e=_e.nextSibling;if(!_e)break;h=_e}if(g||(g=(s.someProp("clipboardParser")||s.someProp("domParser")||DOMParser.fromSchema(s.state.schema)).parseSlice(h,{preserveWhitespace:!!(b||$),context:c,ruleFromNode(_e){return _e.nodeName=="BR"&&!_e.nextSibling&&_e.parentNode&&!inlineParents.test(_e.parentNode.nodeName)?{ignore:!0}:null}})),$)g=addContext(closeSlice(g,+$[1],+$[2]),$[4]);else if(g=Slice.maxOpen(normalizeSiblings(g.content,c),!0),g.openStart||g.openEnd){let _=0,_e=0;for(let et=g.content.firstChild;_<g.openStart&&!et.type.spec.isolating;_++,et=et.firstChild);for(let et=g.content.lastChild;_e<g.openEnd&&!et.type.spec.isolating;_e++,et=et.lastChild);g=closeSlice(g,_,_e)}return s.someProp("transformPasted",_=>{g=_(g,s,b)}),g}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function normalizeSiblings(s,e){if(s.childCount<2)return s;for(let o=e.depth;o>=0;o--){let c=e.node(o).contentMatchAt(e.index(o)),d,h=[];if(s.forEach(g=>{if(!h)return;let b=c.findWrapping(g.type),j;if(!b)return h=null;if(j=h.length&&d.length&&addToSibling(b,d,g,h[h.length-1],0))h[h.length-1]=j;else{h.length&&(h[h.length-1]=closeRight(h[h.length-1],d.length));let $=withWrappers(g,b);h.push($),c=c.matchType($.type),d=b}}),h)return Fragment.from(h)}return s}function withWrappers(s,e,o=0){for(let a=e.length-1;a>=o;a--)s=e[a].create(null,Fragment.from(s));return s}function addToSibling(s,e,o,a,c){if(c<s.length&&c<e.length&&s[c]==e[c]){let d=addToSibling(s,e,o,a.lastChild,c+1);if(d)return a.copy(a.content.replaceChild(a.childCount-1,d));if(a.contentMatchAt(a.childCount).matchType(c==s.length-1?o.type:s[c+1]))return a.copy(a.content.append(Fragment.from(withWrappers(o,s,c+1))))}}function closeRight(s,e){if(e==0)return s;let o=s.content.replaceChild(s.childCount-1,closeRight(s.lastChild,e-1)),a=s.contentMatchAt(s.childCount).fillBefore(Fragment.empty,!0);return s.copy(o.append(a))}function closeRange(s,e,o,a,c,d){let h=e<0?s.firstChild:s.lastChild,g=h.content;return s.childCount>1&&(d=0),c<a-1&&(g=closeRange(g,e,o,a,c+1,d)),c>=o&&(g=e<0?h.contentMatchAt(0).fillBefore(g,d<=c).append(g):g.append(h.contentMatchAt(h.childCount).fillBefore(Fragment.empty,!0))),s.replaceChild(e<0?0:s.childCount-1,h.copy(g))}function closeSlice(s,e,o){return e<s.openStart&&(s=new Slice(closeRange(s.content,-1,e,s.openStart,0,s.openEnd),e,s.openEnd)),o<s.openEnd&&(s=new Slice(closeRange(s.content,1,o,s.openEnd,0,0),s.openStart,o)),s}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let _policy=null;function maybeWrapTrusted(s){let e=window.trustedTypes;return e?(_policy||(_policy=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:o=>o})),_policy.createHTML(s)):s}function readHTML(s){let e=/^(\s*<meta [^>]*>)*/.exec(s);e&&(s=s.slice(e[0].length));let o=detachedDoc().createElement("div"),a=/<([a-z][^>\s]+)/i.exec(s),c;if((c=a&&wrapMap[a[1].toLowerCase()])&&(s=c.map(d=>"<"+d+">").join("")+s+c.map(d=>"</"+d+">").reverse().join("")),o.innerHTML=maybeWrapTrusted(s),c)for(let d=0;d<c.length;d++)o=o.querySelector(c[d])||o;return o}function restoreReplacedSpaces(s){let e=s.querySelectorAll(chrome$1?"span:not([class]):not([style])":"span.Apple-converted-space");for(let o=0;o<e.length;o++){let a=e[o];a.childNodes.length==1&&a.textContent==""&&a.parentNode&&a.parentNode.replaceChild(s.ownerDocument.createTextNode(" "),a)}}function addContext(s,e){if(!s.size)return s;let o=s.content.firstChild.type.schema,a;try{a=JSON.parse(e)}catch{return s}let{content:c,openStart:d,openEnd:h}=s;for(let g=a.length-2;g>=0;g-=2){let b=o.nodes[a[g]];if(!b||b.hasRequiredAttrs())break;c=Fragment.from(b.create(a[g+1],c)),d++,h++}return new Slice(c,d,h)}const handlers$1={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};let InputState$1=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function initInput(s){for(let e in handlers$1){let o=handlers$1[e];s.dom.addEventListener(e,s.input.eventHandlers[e]=a=>{eventBelongsToView(s,a)&&!runCustomHandler(s,a)&&(s.editable||!(a.type in editHandlers))&&o(s,a)},passiveHandlers[e]?{passive:!0}:void 0)}safari$1&&s.dom.addEventListener("input",()=>null),ensureListeners(s)}function setSelectionOrigin(s,e){s.input.lastSelectionOrigin=e,s.input.lastSelectionTime=Date.now()}function destroyInput(s){s.domObserver.stop();for(let e in s.input.eventHandlers)s.dom.removeEventListener(e,s.input.eventHandlers[e]);clearTimeout(s.input.composingTimeout),clearTimeout(s.input.lastIOSEnterFallbackTimeout)}function ensureListeners(s){s.someProp("handleDOMEvents",e=>{for(let o in e)s.input.eventHandlers[o]||s.dom.addEventListener(o,s.input.eventHandlers[o]=a=>runCustomHandler(s,a))})}function runCustomHandler(s,e){return s.someProp("handleDOMEvents",o=>{let a=o[e.type];return a?a(s,e)||e.defaultPrevented:!1})}function eventBelongsToView(s,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let o=e.target;o!=s.dom;o=o.parentNode)if(!o||o.nodeType==11||o.pmViewDesc&&o.pmViewDesc.stopEvent(e))return!1;return!0}function dispatchEvent$1(s,e){!runCustomHandler(s,e)&&handlers$1[e.type]&&(s.editable||!(e.type in editHandlers))&&handlers$1[e.type](s,e)}editHandlers.keydown=(s,e)=>{let o=e;if(s.input.shiftKey=o.keyCode==16||o.shiftKey,!inOrNearComposition(s,o)&&(s.input.lastKeyCode=o.keyCode,s.input.lastKeyCodeTime=Date.now(),!(android&&chrome$1&&o.keyCode==13)))if(o.keyCode!=229&&s.domObserver.forceFlush(),ios$1&&o.keyCode==13&&!o.ctrlKey&&!o.altKey&&!o.metaKey){let a=Date.now();s.input.lastIOSEnter=a,s.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{s.input.lastIOSEnter==a&&(s.someProp("handleKeyDown",c=>c(s,keyEvent(13,"Enter"))),s.input.lastIOSEnter=0)},200)}else s.someProp("handleKeyDown",a=>a(s,o))||captureKeyDown(s,o)?o.preventDefault():setSelectionOrigin(s,"key")};editHandlers.keyup=(s,e)=>{e.keyCode==16&&(s.input.shiftKey=!1)};editHandlers.keypress=(s,e)=>{let o=e;if(inOrNearComposition(s,o)||!o.charCode||o.ctrlKey&&!o.altKey||mac$2&&o.metaKey)return;if(s.someProp("handleKeyPress",c=>c(s,o))){o.preventDefault();return}let a=s.state.selection;if(!(a instanceof TextSelection)||!a.$from.sameParent(a.$to)){let c=String.fromCharCode(o.charCode),d=()=>s.state.tr.insertText(c).scrollIntoView();!/[\r\n]/.test(c)&&!s.someProp("handleTextInput",h=>h(s,a.$from.pos,a.$to.pos,c,d))&&s.dispatch(d()),o.preventDefault()}};function eventCoords(s){return{left:s.clientX,top:s.clientY}}function isNear(s,e){let o=e.x-s.clientX,a=e.y-s.clientY;return o*o+a*a<100}function runHandlerOnContext(s,e,o,a,c){if(a==-1)return!1;let d=s.state.doc.resolve(a);for(let h=d.depth+1;h>0;h--)if(s.someProp(e,g=>h>d.depth?g(s,o,d.nodeAfter,d.before(h),c,!0):g(s,o,d.node(h),d.before(h),c,!1)))return!0;return!1}function updateSelection(s,e,o){if(s.focused||s.focus(),s.state.selection.eq(e))return;let a=s.state.tr.setSelection(e);a.setMeta("pointer",!0),s.dispatch(a)}function selectClickedLeaf(s,e){if(e==-1)return!1;let o=s.state.doc.resolve(e),a=o.nodeAfter;return a&&a.isAtom&&NodeSelection.isSelectable(a)?(updateSelection(s,new NodeSelection(o)),!0):!1}function selectClickedNode(s,e){if(e==-1)return!1;let o=s.state.selection,a,c;o instanceof NodeSelection&&(a=o.node);let d=s.state.doc.resolve(e);for(let h=d.depth+1;h>0;h--){let g=h>d.depth?d.nodeAfter:d.node(h);if(NodeSelection.isSelectable(g)){a&&o.$from.depth>0&&h>=o.$from.depth&&d.before(o.$from.depth+1)==o.$from.pos?c=d.before(o.$from.depth):c=d.before(h);break}}return c!=null?(updateSelection(s,NodeSelection.create(s.state.doc,c)),!0):!1}function handleSingleClick(s,e,o,a,c){return runHandlerOnContext(s,"handleClickOn",e,o,a)||s.someProp("handleClick",d=>d(s,e,a))||(c?selectClickedNode(s,o):selectClickedLeaf(s,o))}function handleDoubleClick(s,e,o,a){return runHandlerOnContext(s,"handleDoubleClickOn",e,o,a)||s.someProp("handleDoubleClick",c=>c(s,e,a))}function handleTripleClick$1(s,e,o,a){return runHandlerOnContext(s,"handleTripleClickOn",e,o,a)||s.someProp("handleTripleClick",c=>c(s,e,a))||defaultTripleClick(s,o,a)}function defaultTripleClick(s,e,o){if(o.button!=0)return!1;let a=s.state.doc;if(e==-1)return a.inlineContent?(updateSelection(s,TextSelection.create(a,0,a.content.size)),!0):!1;let c=a.resolve(e);for(let d=c.depth+1;d>0;d--){let h=d>c.depth?c.nodeAfter:c.node(d),g=c.before(d);if(h.inlineContent)updateSelection(s,TextSelection.create(a,g+1,g+1+h.content.size));else if(NodeSelection.isSelectable(h))updateSelection(s,NodeSelection.create(a,g));else continue;return!0}}function forceDOMFlush(s){return endComposition(s)}const selectNodeModifier=mac$2?"metaKey":"ctrlKey";handlers$1.mousedown=(s,e)=>{let o=e;s.input.shiftKey=o.shiftKey;let a=forceDOMFlush(s),c=Date.now(),d="singleClick";c-s.input.lastClick.time<500&&isNear(o,s.input.lastClick)&&!o[selectNodeModifier]&&s.input.lastClick.button==o.button&&(s.input.lastClick.type=="singleClick"?d="doubleClick":s.input.lastClick.type=="doubleClick"&&(d="tripleClick")),s.input.lastClick={time:c,x:o.clientX,y:o.clientY,type:d,button:o.button};let h=s.posAtCoords(eventCoords(o));h&&(d=="singleClick"?(s.input.mouseDown&&s.input.mouseDown.done(),s.input.mouseDown=new MouseDown(s,h,o,!!a)):(d=="doubleClick"?handleDoubleClick:handleTripleClick$1)(s,h.pos,h.inside,o)?o.preventDefault():setSelectionOrigin(s,"pointer"))};class MouseDown{constructor(e,o,a,c){this.view=e,this.pos=o,this.event=a,this.flushed=c,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!a[selectNodeModifier],this.allowDefault=a.shiftKey;let d,h;if(o.inside>-1)d=e.state.doc.nodeAt(o.inside),h=o.inside;else{let $=e.state.doc.resolve(o.pos);d=$.parent,h=$.depth?$.before():0}const g=c?null:a.target,b=g?e.docView.nearestDesc(g,!0):null;this.target=b&&b.nodeDOM.nodeType==1?b.nodeDOM:null;let{selection:j}=e.state;(a.button==0&&d.type.spec.draggable&&d.type.spec.selectable!==!1||j instanceof NodeSelection&&j.from<=h&&j.to>h)&&(this.mightDrag={node:d,pos:h,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gecko$1&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>selectionToDOM(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let o=this.pos;this.view.state.doc!=this.startDoc&&(o=this.view.posAtCoords(eventCoords(e))),this.updateAllowDefault(e),this.allowDefault||!o?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,o.pos,o.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||safari$1&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome$1&&!this.view.state.selection.visible&&Math.min(Math.abs(o.pos-this.view.state.selection.from),Math.abs(o.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,Selection$2.near(this.view.state.doc.resolve(o.pos))),e.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(e){this.updateAllowDefault(e),setSelectionOrigin(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}handlers$1.touchstart=s=>{s.input.lastTouch=Date.now(),forceDOMFlush(s),setSelectionOrigin(s,"pointer")};handlers$1.touchmove=s=>{s.input.lastTouch=Date.now(),setSelectionOrigin(s,"pointer")};handlers$1.contextmenu=s=>forceDOMFlush(s);function inOrNearComposition(s,e){return s.composing?!0:safari$1&&Math.abs(e.timeStamp-s.input.compositionEndedAt)<500?(s.input.compositionEndedAt=-2e8,!0):!1}const timeoutComposition=android?5e3:-1;editHandlers.compositionstart=editHandlers.compositionupdate=s=>{if(!s.composing){s.domObserver.flush();let{state:e}=s,o=e.selection.$to;if(e.selection instanceof TextSelection&&(e.storedMarks||!o.textOffset&&o.parentOffset&&o.nodeBefore.marks.some(a=>a.type.spec.inclusive===!1)||chrome$1&&windows$2&&selectionBeforeUneditable(s)))s.markCursor=s.state.storedMarks||o.marks(),endComposition(s,!0),s.markCursor=null;else if(endComposition(s,!e.selection.empty),gecko$1&&e.selection.empty&&o.parentOffset&&!o.textOffset&&o.nodeBefore.marks.length){let a=s.domSelectionRange();for(let c=a.focusNode,d=a.focusOffset;c&&c.nodeType==1&&d!=0;){let h=d<0?c.lastChild:c.childNodes[d-1];if(!h)break;if(h.nodeType==3){let g=s.domSelection();g&&g.collapse(h,h.nodeValue.length);break}else c=h,d=-1}}s.input.composing=!0}scheduleComposeEnd(s,timeoutComposition)};function selectionBeforeUneditable(s){let{focusNode:e,focusOffset:o}=s.domSelectionRange();if(!e||e.nodeType!=1||o>=e.childNodes.length)return!1;let a=e.childNodes[o];return a.nodeType==1&&a.contentEditable=="false"}editHandlers.compositionend=(s,e)=>{s.composing&&(s.input.composing=!1,s.input.compositionEndedAt=e.timeStamp,s.input.compositionPendingChanges=s.domObserver.pendingRecords().length?s.input.compositionID:0,s.input.compositionNode=null,s.input.badSafariComposition?s.domObserver.forceFlush():s.input.compositionPendingChanges&&Promise.resolve().then(()=>s.domObserver.flush()),s.input.compositionID++,scheduleComposeEnd(s,20))};function scheduleComposeEnd(s,e){clearTimeout(s.input.composingTimeout),e>-1&&(s.input.composingTimeout=setTimeout(()=>endComposition(s),e))}function clearComposition(s){for(s.composing&&(s.input.composing=!1,s.input.compositionEndedAt=timestampFromCustomEvent());s.input.compositionNodes.length>0;)s.input.compositionNodes.pop().markParentsDirty()}function findCompositionNode$1(s){let e=s.domSelectionRange();if(!e.focusNode)return null;let o=textNodeBefore$1(e.focusNode,e.focusOffset),a=textNodeAfter$1(e.focusNode,e.focusOffset);if(o&&a&&o!=a){let c=a.pmViewDesc,d=s.domObserver.lastChangedTextNode;if(o==d||a==d)return d;if(!c||!c.isText(a.nodeValue))return a;if(s.input.compositionNode==a){let h=o.pmViewDesc;if(!(!h||!h.isText(o.nodeValue)))return a}}return o||a}function timestampFromCustomEvent(){let s=document.createEvent("Event");return s.initEvent("event",!0,!0),s.timeStamp}function endComposition(s,e=!1){if(!(android&&s.domObserver.flushingSoon>=0)){if(s.domObserver.forceFlush(),clearComposition(s),e||s.docView&&s.docView.dirty){let o=selectionFromDOM(s),a=s.state.selection;return o&&!o.eq(a)?s.dispatch(s.state.tr.setSelection(o)):(s.markCursor||e)&&!a.$from.node(a.$from.sharedDepth(a.to)).inlineContent?s.dispatch(s.state.tr.deleteSelection()):s.updateState(s.state),!0}return!1}}function captureCopy$1(s,e){if(!s.dom.parentNode)return;let o=s.dom.parentNode.appendChild(document.createElement("div"));o.appendChild(e),o.style.cssText="position: fixed; left: -10000px; top: 10px";let a=getSelection(),c=document.createRange();c.selectNodeContents(e),s.dom.blur(),a.removeAllRanges(),a.addRange(c),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),s.focus()},50)}const brokenClipboardAPI$1=ie$2&&ie_version<15||ios$1&&webkit_version<604;handlers$1.copy=editHandlers.cut=(s,e)=>{let o=e,a=s.state.selection,c=o.type=="cut";if(a.empty)return;let d=brokenClipboardAPI$1?null:o.clipboardData,h=a.content(),{dom:g,text:b}=serializeForClipboard(s,h);d?(o.preventDefault(),d.clearData(),d.setData("text/html",g.innerHTML),d.setData("text/plain",b)):captureCopy$1(s,g),c&&s.dispatch(s.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function sliceSingleNode(s){return s.openStart==0&&s.openEnd==0&&s.content.childCount==1?s.content.firstChild:null}function capturePaste$1(s,e){if(!s.dom.parentNode)return;let o=s.input.shiftKey||s.state.selection.$from.parent.type.spec.code,a=s.dom.parentNode.appendChild(document.createElement(o?"textarea":"div"));o||(a.contentEditable="true"),a.style.cssText="position: fixed; left: -10000px; top: 10px",a.focus();let c=s.input.shiftKey&&s.input.lastKeyCode!=45;setTimeout(()=>{s.focus(),a.parentNode&&a.parentNode.removeChild(a),o?doPaste$1(s,a.value,null,c,e):doPaste$1(s,a.textContent,a.innerHTML,c,e)},50)}function doPaste$1(s,e,o,a,c){let d=parseFromClipboard(s,e,o,a,s.state.selection.$from);if(s.someProp("handlePaste",b=>b(s,c,d||Slice.empty)))return!0;if(!d)return!1;let h=sliceSingleNode(d),g=h?s.state.tr.replaceSelectionWith(h,a):s.state.tr.replaceSelection(d);return s.dispatch(g.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText$1(s){let e=s.getData("text/plain")||s.getData("Text");if(e)return e;let o=s.getData("text/uri-list");return o?o.replace(/\r?\n/g," "):""}editHandlers.paste=(s,e)=>{let o=e;if(s.composing&&!android)return;let a=brokenClipboardAPI$1?null:o.clipboardData,c=s.input.shiftKey&&s.input.lastKeyCode!=45;a&&doPaste$1(s,getText$1(a),a.getData("text/html"),c,o)?o.preventDefault():capturePaste$1(s,o)};class Dragging{constructor(e,o,a){this.slice=e,this.move=o,this.node=a}}const dragCopyModifier=mac$2?"altKey":"ctrlKey";function dragMoves(s,e){let o=s.someProp("dragCopies",a=>!a(e));return o??!e[dragCopyModifier]}handlers$1.dragstart=(s,e)=>{let o=e,a=s.input.mouseDown;if(a&&a.done(),!o.dataTransfer)return;let c=s.state.selection,d=c.empty?null:s.posAtCoords(eventCoords(o)),h;if(!(d&&d.pos>=c.from&&d.pos<=(c instanceof NodeSelection?c.to-1:c.to))){if(a&&a.mightDrag)h=NodeSelection.create(s.state.doc,a.mightDrag.pos);else if(o.target&&o.target.nodeType==1){let _=s.docView.nearestDesc(o.target,!0);_&&_.node.type.spec.draggable&&_!=s.docView&&(h=NodeSelection.create(s.state.doc,_.posBefore))}}let g=(h||s.state.selection).content(),{dom:b,text:j,slice:$}=serializeForClipboard(s,g);(!o.dataTransfer.files.length||!chrome$1||chrome_version>120)&&o.dataTransfer.clearData(),o.dataTransfer.setData(brokenClipboardAPI$1?"Text":"text/html",b.innerHTML),o.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI$1||o.dataTransfer.setData("text/plain",j),s.dragging=new Dragging($,dragMoves(s,o),h)};handlers$1.dragend=s=>{let e=s.dragging;window.setTimeout(()=>{s.dragging==e&&(s.dragging=null)},50)};editHandlers.dragover=editHandlers.dragenter=(s,e)=>e.preventDefault();editHandlers.drop=(s,e)=>{try{handleDrop(s,e,s.dragging)}finally{s.dragging=null}};function handleDrop(s,e,o){if(!e.dataTransfer)return;let a=s.posAtCoords(eventCoords(e));if(!a)return;let c=s.state.doc.resolve(a.pos),d=o&&o.slice;d?s.someProp("transformPasted",et=>{d=et(d,s,!1)}):d=parseFromClipboard(s,getText$1(e.dataTransfer),brokenClipboardAPI$1?null:e.dataTransfer.getData("text/html"),!1,c);let h=!!(o&&dragMoves(s,e));if(s.someProp("handleDrop",et=>et(s,e,d||Slice.empty,h))){e.preventDefault();return}if(!d)return;e.preventDefault();let g=d?dropPoint(s.state.doc,c.pos,d):c.pos;g==null&&(g=c.pos);let b=s.state.tr;if(h){let{node:et}=o;et?et.replace(b):b.deleteSelection()}let j=b.mapping.map(g),$=d.openStart==0&&d.openEnd==0&&d.content.childCount==1,_=b.doc;if($?b.replaceRangeWith(j,j,d.content.firstChild):b.replaceRange(j,j,d),b.doc.eq(_))return;let _e=b.doc.resolve(j);if($&&NodeSelection.isSelectable(d.content.firstChild)&&_e.nodeAfter&&_e.nodeAfter.sameMarkup(d.content.firstChild))b.setSelection(new NodeSelection(_e));else{let et=b.mapping.map(g);b.mapping.maps[b.mapping.maps.length-1].forEach((nt,rt,it,st)=>et=st),b.setSelection(selectionBetween(s,_e,b.doc.resolve(et)))}s.focus(),s.dispatch(b.setMeta("uiEvent","drop"))}handlers$1.focus=s=>{s.input.lastFocus=Date.now(),s.focused||(s.domObserver.stop(),s.dom.classList.add("ProseMirror-focused"),s.domObserver.start(),s.focused=!0,setTimeout(()=>{s.docView&&s.hasFocus()&&!s.domObserver.currentSelection.eq(s.domSelectionRange())&&selectionToDOM(s)},20))};handlers$1.blur=(s,e)=>{let o=e;s.focused&&(s.domObserver.stop(),s.dom.classList.remove("ProseMirror-focused"),s.domObserver.start(),o.relatedTarget&&s.dom.contains(o.relatedTarget)&&s.domObserver.currentSelection.clear(),s.focused=!1)};handlers$1.beforeinput=(s,e)=>{if(chrome$1&&android&&e.inputType=="deleteContentBackward"){s.domObserver.flushSoon();let{domChangeCount:a}=s.input;setTimeout(()=>{if(s.input.domChangeCount!=a||(s.dom.blur(),s.focus(),s.someProp("handleKeyDown",d=>d(s,keyEvent(8,"Backspace")))))return;let{$cursor:c}=s.state.selection;c&&c.pos>0&&s.dispatch(s.state.tr.delete(c.pos-1,c.pos).scrollIntoView())},50)}};for(let s in editHandlers)handlers$1[s]=editHandlers[s];function compareObjs(s,e){if(s==e)return!0;for(let o in s)if(s[o]!==e[o])return!1;for(let o in e)if(!(o in s))return!1;return!0}let WidgetType$1=class hr{constructor(e,o){this.toDOM=e,this.spec=o||noSpec,this.side=this.spec.side||0}map(e,o,a,c){let{pos:d,deleted:h}=e.mapResult(o.from+c,this.side<0?-1:1);return h?null:new Decoration$1(d-a,d-a,this)}valid(){return!0}eq(e){return this==e||e instanceof hr&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&compareObjs(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}};class InlineType{constructor(e,o){this.attrs=e,this.spec=o||noSpec}map(e,o,a,c){let d=e.map(o.from+c,this.spec.inclusiveStart?-1:1)-a,h=e.map(o.to+c,this.spec.inclusiveEnd?1:-1)-a;return d>=h?null:new Decoration$1(d,h,this)}valid(e,o){return o.from<o.to}eq(e){return this==e||e instanceof InlineType&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}static is(e){return e.type instanceof InlineType}destroy(){}}let NodeType$1=class pr{constructor(e,o){this.attrs=e,this.spec=o||noSpec}map(e,o,a,c){let d=e.mapResult(o.from+c,1);if(d.deleted)return null;let h=e.mapResult(o.to+c,-1);return h.deleted||h.pos<=d.pos?null:new Decoration$1(d.pos-a,h.pos-a,this)}valid(e,o){let{index:a,offset:c}=e.content.findIndex(o.from),d;return c==o.from&&!(d=e.child(a)).isText&&c+d.nodeSize==o.to}eq(e){return this==e||e instanceof pr&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}destroy(){}},Decoration$1=class Fn{constructor(e,o,a){this.from=e,this.to=o,this.type=a}copy(e,o){return new Fn(e,o,this.type)}eq(e,o=0){return this.type.eq(e.type)&&this.from+o==e.from&&this.to+o==e.to}map(e,o,a){return this.type.map(e,this,o,a)}static widget(e,o,a){return new Fn(e,e,new WidgetType$1(o,a))}static inline(e,o,a,c){return new Fn(e,o,new InlineType(a,c))}static node(e,o,a,c){return new Fn(e,o,new NodeType$1(a,c))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType$1}};const none$4=[],noSpec={};class DecorationSet{constructor(e,o){this.local=e.length?e:none$4,this.children=o.length?o:none$4}static create(e,o){return o.length?buildTree$1(o,e,0,noSpec):empty$2}find(e,o,a){let c=[];return this.findInner(e??0,o??1e9,c,0,a),c}findInner(e,o,a,c,d){for(let h=0;h<this.local.length;h++){let g=this.local[h];g.from<=o&&g.to>=e&&(!d||d(g.spec))&&a.push(g.copy(g.from+c,g.to+c))}for(let h=0;h<this.children.length;h+=3)if(this.children[h]<o&&this.children[h+1]>e){let g=this.children[h]+1;this.children[h+2].findInner(e-g,o-g,a,c+g,d)}}map(e,o,a){return this==empty$2||e.maps.length==0?this:this.mapInner(e,o,0,0,a||noSpec)}mapInner(e,o,a,c,d){let h;for(let g=0;g<this.local.length;g++){let b=this.local[g].map(e,a,c);b&&b.type.valid(o,b)?(h||(h=[])).push(b):d.onRemove&&d.onRemove(this.local[g].spec)}return this.children.length?mapChildren(this.children,h||[],e,o,a,c,d):h?new DecorationSet(h.sort(byPos),none$4):empty$2}add(e,o){return o.length?this==empty$2?DecorationSet.create(e,o):this.addInner(e,o,0):this}addInner(e,o,a){let c,d=0;e.forEach((g,b)=>{let j=b+a,$;if($=takeSpansForNode(o,g,j)){for(c||(c=this.children.slice());d<c.length&&c[d]<b;)d+=3;c[d]==b?c[d+2]=c[d+2].addInner(g,$,j+1):c.splice(d,0,b,b+g.nodeSize,buildTree$1($,g,j+1,noSpec)),d+=3}});let h=moveSpans(d?withoutNulls(o):o,-a);for(let g=0;g<h.length;g++)h[g].type.valid(e,h[g])||h.splice(g--,1);return new DecorationSet(h.length?this.local.concat(h).sort(byPos):this.local,c||this.children)}remove(e){return e.length==0||this==empty$2?this:this.removeInner(e,0)}removeInner(e,o){let a=this.children,c=this.local;for(let d=0;d<a.length;d+=3){let h,g=a[d]+o,b=a[d+1]+o;for(let $=0,_;$<e.length;$++)(_=e[$])&&_.from>g&&_.to<b&&(e[$]=null,(h||(h=[])).push(_));if(!h)continue;a==this.children&&(a=this.children.slice());let j=a[d+2].removeInner(h,g+1);j!=empty$2?a[d+2]=j:(a.splice(d,3),d-=3)}if(c.length){for(let d=0,h;d<e.length;d++)if(h=e[d])for(let g=0;g<c.length;g++)c[g].eq(h,o)&&(c==this.local&&(c=this.local.slice()),c.splice(g--,1))}return a==this.children&&c==this.local?this:c.length||a.length?new DecorationSet(c,a):empty$2}forChild(e,o){if(this==empty$2)return this;if(o.isLeaf)return DecorationSet.empty;let a,c;for(let g=0;g<this.children.length;g+=3)if(this.children[g]>=e){this.children[g]==e&&(a=this.children[g+2]);break}let d=e+1,h=d+o.content.size;for(let g=0;g<this.local.length;g++){let b=this.local[g];if(b.from<h&&b.to>d&&b.type instanceof InlineType){let j=Math.max(d,b.from)-d,$=Math.min(h,b.to)-d;j<$&&(c||(c=[])).push(b.copy(j,$))}}if(c){let g=new DecorationSet(c.sort(byPos),none$4);return a?new DecorationGroup([g,a]):g}return a||empty$2}eq(e){if(this==e)return!0;if(!(e instanceof DecorationSet)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let o=0;o<this.local.length;o++)if(!this.local[o].eq(e.local[o]))return!1;for(let o=0;o<this.children.length;o+=3)if(this.children[o]!=e.children[o]||this.children[o+1]!=e.children[o+1]||!this.children[o+2].eq(e.children[o+2]))return!1;return!0}locals(e){return removeOverlap(this.localsInner(e))}localsInner(e){if(this==empty$2)return none$4;if(e.inlineContent||!this.local.some(InlineType.is))return this.local;let o=[];for(let a=0;a<this.local.length;a++)this.local[a].type instanceof InlineType||o.push(this.local[a]);return o}forEachSet(e){e(this)}}DecorationSet.empty=new DecorationSet([],[]);DecorationSet.removeOverlap=removeOverlap;const empty$2=DecorationSet.empty;class DecorationGroup{constructor(e){this.members=e}map(e,o){const a=this.members.map(c=>c.map(e,o,noSpec));return DecorationGroup.from(a)}forChild(e,o){if(o.isLeaf)return DecorationSet.empty;let a=[];for(let c=0;c<this.members.length;c++){let d=this.members[c].forChild(e,o);d!=empty$2&&(d instanceof DecorationGroup?a=a.concat(d.members):a.push(d))}return DecorationGroup.from(a)}eq(e){if(!(e instanceof DecorationGroup)||e.members.length!=this.members.length)return!1;for(let o=0;o<this.members.length;o++)if(!this.members[o].eq(e.members[o]))return!1;return!0}locals(e){let o,a=!0;for(let c=0;c<this.members.length;c++){let d=this.members[c].localsInner(e);if(d.length)if(!o)o=d;else{a&&(o=o.slice(),a=!1);for(let h=0;h<d.length;h++)o.push(d[h])}}return o?removeOverlap(a?o:o.sort(byPos)):none$4}static from(e){switch(e.length){case 0:return empty$2;case 1:return e[0];default:return new DecorationGroup(e.every(o=>o instanceof DecorationSet)?e:e.reduce((o,a)=>o.concat(a instanceof DecorationSet?a:a.members),[]))}}forEachSet(e){for(let o=0;o<this.members.length;o++)this.members[o].forEachSet(e)}}function mapChildren(s,e,o,a,c,d,h){let g=s.slice();for(let j=0,$=d;j<o.maps.length;j++){let _=0;o.maps[j].forEach((_e,et,nt,rt)=>{let it=rt-nt-(et-_e);for(let st=0;st<g.length;st+=3){let lt=g[st+1];if(lt<0||_e>lt+$-_)continue;let ot=g[st]+$-_;et>=ot?g[st+1]=_e<=ot?-2:-1:_e>=$&&it&&(g[st]+=it,g[st+1]+=it)}_+=it}),$=o.maps[j].map($,-1)}let b=!1;for(let j=0;j<g.length;j+=3)if(g[j+1]<0){if(g[j+1]==-2){b=!0,g[j+1]=-1;continue}let $=o.map(s[j]+d),_=$-c;if(_<0||_>=a.content.size){b=!0;continue}let _e=o.map(s[j+1]+d,-1),et=_e-c,{index:nt,offset:rt}=a.content.findIndex(_),it=a.maybeChild(nt);if(it&&rt==_&&rt+it.nodeSize==et){let st=g[j+2].mapInner(o,it,$+1,s[j]+d+1,h);st!=empty$2?(g[j]=_,g[j+1]=et,g[j+2]=st):(g[j+1]=-2,b=!0)}else b=!0}if(b){let j=mapAndGatherRemainingDecorations(g,s,e,o,c,d,h),$=buildTree$1(j,a,0,h);e=$.local;for(let _=0;_<g.length;_+=3)g[_+1]<0&&(g.splice(_,3),_-=3);for(let _=0,_e=0;_<$.children.length;_+=3){let et=$.children[_];for(;_e<g.length&&g[_e]<et;)_e+=3;g.splice(_e,0,$.children[_],$.children[_+1],$.children[_+2])}}return new DecorationSet(e.sort(byPos),g)}function moveSpans(s,e){if(!e||!s.length)return s;let o=[];for(let a=0;a<s.length;a++){let c=s[a];o.push(new Decoration$1(c.from+e,c.to+e,c.type))}return o}function mapAndGatherRemainingDecorations(s,e,o,a,c,d,h){function g(b,j){for(let $=0;$<b.local.length;$++){let _=b.local[$].map(a,c,j);_?o.push(_):h.onRemove&&h.onRemove(b.local[$].spec)}for(let $=0;$<b.children.length;$+=3)g(b.children[$+2],b.children[$]+j+1)}for(let b=0;b<s.length;b+=3)s[b+1]==-1&&g(s[b+2],e[b]+d+1);return o}function takeSpansForNode(s,e,o){if(e.isLeaf)return null;let a=o+e.nodeSize,c=null;for(let d=0,h;d<s.length;d++)(h=s[d])&&h.from>o&&h.to<a&&((c||(c=[])).push(h),s[d]=null);return c}function withoutNulls(s){let e=[];for(let o=0;o<s.length;o++)s[o]!=null&&e.push(s[o]);return e}function buildTree$1(s,e,o,a){let c=[],d=!1;e.forEach((g,b)=>{let j=takeSpansForNode(s,g,b+o);if(j){d=!0;let $=buildTree$1(j,g,o+b+1,a);$!=empty$2&&c.push(b,b+g.nodeSize,$)}});let h=moveSpans(d?withoutNulls(s):s,-o).sort(byPos);for(let g=0;g<h.length;g++)h[g].type.valid(e,h[g])||(a.onRemove&&a.onRemove(h[g].spec),h.splice(g--,1));return h.length||c.length?new DecorationSet(h,c):empty$2}function byPos(s,e){return s.from-e.from||s.to-e.to}function removeOverlap(s){let e=s;for(let o=0;o<e.length-1;o++){let a=e[o];if(a.from!=a.to)for(let c=o+1;c<e.length;c++){let d=e[c];if(d.from==a.from){d.to!=a.to&&(e==s&&(e=s.slice()),e[c]=d.copy(d.from,a.to),insertAhead(e,c+1,d.copy(a.to,d.to)));continue}else{d.from<a.to&&(e==s&&(e=s.slice()),e[o]=a.copy(a.from,d.from),insertAhead(e,c,a.copy(d.from,a.to)));break}}}return e}function insertAhead(s,e,o){for(;e<s.length&&byPos(o,s[e])>0;)e++;s.splice(e,0,o)}function viewDecorations(s){let e=[];return s.someProp("decorations",o=>{let a=o(s.state);a&&a!=empty$2&&e.push(a)}),s.cursorWrapper&&e.push(DecorationSet.create(s.state.doc,[s.cursorWrapper.deco])),DecorationGroup.from(e)}const observeOptions$1={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData$1=ie$2&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}let DOMObserver$1=class{constructor(e,o){this.view=e,this.handleDOMChange=o,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(a=>{for(let c=0;c<a.length;c++)this.queue.push(a[c]);ie$2&&ie_version<=11&&a.some(c=>c.type=="childList"&&c.removedNodes.length||c.type=="characterData"&&c.oldValue.length>c.target.nodeValue.length)?this.flushSoon():safari$1&&e.composing&&a.some(c=>c.type=="childList"&&c.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),useCharData$1&&(this.onCharData=a=>{this.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions$1)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let o=0;o<e.length;o++)this.queue.push(e[o]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie$2&&ie_version<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&isEquivalentPosition$1(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let o=new Set,a;for(let d=e.focusNode;d;d=parentNode(d))o.add(d);for(let d=e.anchorNode;d;d=parentNode(d))if(o.has(d)){a=d;break}let c=a&&this.view.docView.nearestDesc(a);if(c&&c.ignoreMutation({type:"selection",target:a.nodeType==3?a.parentNode:a}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let o=this.pendingRecords();o.length&&(this.queue=[]);let a=e.domSelectionRange(),c=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(a)&&hasFocusAndSelection(e)&&!this.ignoreSelectionChange(a),d=-1,h=-1,g=!1,b=[];if(e.editable)for(let $=0;$<o.length;$++){let _=this.registerMutation(o[$],b);_&&(d=d<0?_.from:Math.min(_.from,d),h=h<0?_.to:Math.max(_.to,h),_.typeOver&&(g=!0))}if(gecko$1&&b.length){let $=b.filter(_=>_.nodeName=="BR");if($.length==2){let[_,_e]=$;_.parentNode&&_.parentNode.parentNode==_e.parentNode?_e.remove():_.remove()}else{let{focusNode:_}=this.currentSelection;for(let _e of $){let et=_e.parentNode;et&&et.nodeName=="LI"&&(!_||blockParent(e,_)!=et)&&_e.remove()}}}else if((chrome$1||safari$1)&&b.some($=>$.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let $ of b)if($.nodeName=="BR"&&$.parentNode){let _=$.nextSibling;_&&_.nodeType==1&&_.contentEditable=="false"&&$.parentNode.removeChild($)}}let j=null;d<0&&c&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&selectionCollapsed(a)&&(j=selectionFromDOM(e))&&j.eq(Selection$2.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,selectionToDOM(e),this.currentSelection.set(a),e.scrollToSelection()):(d>-1||c)&&(d>-1&&(e.docView.markDirty(d,h),checkCSS(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,fixUpBadSafariComposition(e,b)),this.handleDOMChange(d,h,g,b),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(a)||selectionToDOM(e),this.currentSelection.set(a))}registerMutation(e,o){if(o.indexOf(e.target)>-1)return null;let a=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(a==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!a||a.ignoreMutation(e))return null;if(e.type=="childList"){for(let $=0;$<e.addedNodes.length;$++){let _=e.addedNodes[$];o.push(_),_.nodeType==3&&(this.lastChangedTextNode=_)}if(a.contentDOM&&a.contentDOM!=a.dom&&!a.contentDOM.contains(e.target))return{from:a.posBefore,to:a.posAfter};let c=e.previousSibling,d=e.nextSibling;if(ie$2&&ie_version<=11&&e.addedNodes.length)for(let $=0;$<e.addedNodes.length;$++){let{previousSibling:_,nextSibling:_e}=e.addedNodes[$];(!_||Array.prototype.indexOf.call(e.addedNodes,_)<0)&&(c=_),(!_e||Array.prototype.indexOf.call(e.addedNodes,_e)<0)&&(d=_e)}let h=c&&c.parentNode==e.target?domIndex$1(c)+1:0,g=a.localPosFromDOM(e.target,h,-1),b=d&&d.parentNode==e.target?domIndex$1(d):e.target.childNodes.length,j=a.localPosFromDOM(e.target,b,1);return{from:g,to:j}}else return e.type=="attributes"?{from:a.posAtStart-a.border,to:a.posAtEnd+a.border}:(this.lastChangedTextNode=e.target,{from:a.posAtStart,to:a.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}},cssChecked=new WeakMap,cssCheckWarned=!1;function checkCSS(s){if(!cssChecked.has(s)&&(cssChecked.set(s,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(s.dom).whiteSpace)!==-1)){if(s.requiresGeckoHackNode=gecko$1,cssCheckWarned)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0}}function rangeToSelectionRange(s,e){let o=e.startContainer,a=e.startOffset,c=e.endContainer,d=e.endOffset,h=s.domAtPos(s.state.selection.anchor);return isEquivalentPosition$1(h.node,h.offset,c,d)&&([o,a,c,d]=[c,d,o,a]),{anchorNode:o,anchorOffset:a,focusNode:c,focusOffset:d}}function safariShadowSelectionRange(s,e){if(e.getComposedRanges){let c=e.getComposedRanges(s.root)[0];if(c)return rangeToSelectionRange(s,c)}let o;function a(c){c.preventDefault(),c.stopImmediatePropagation(),o=c.getTargetRanges()[0]}return s.dom.addEventListener("beforeinput",a,!0),document.execCommand("indent"),s.dom.removeEventListener("beforeinput",a,!0),o?rangeToSelectionRange(s,o):null}function blockParent(s,e){for(let o=e.parentNode;o&&o!=s.dom;o=o.parentNode){let a=s.docView.nearestDesc(o,!0);if(a&&a.node.isBlock)return o}return null}function fixUpBadSafariComposition(s,e){var o;let{focusNode:a,focusOffset:c}=s.domSelectionRange();for(let d of e)if(((o=d.parentNode)===null||o===void 0?void 0:o.nodeName)=="TR"){let h=d.nextSibling;for(;h&&h.nodeName!="TD"&&h.nodeName!="TH";)h=h.nextSibling;if(h){let g=h;for(;;){let b=g.firstChild;if(!b||b.nodeType!=1||b.contentEditable=="false"||/^(BR|IMG)$/.test(b.nodeName))break;g=b}g.insertBefore(d,g.firstChild),a==d&&s.domSelection().collapse(d,c)}else d.parentNode.removeChild(d)}}function parseBetween(s,e,o){let{node:a,fromOffset:c,toOffset:d,from:h,to:g}=s.docView.parseRange(e,o),b=s.domSelectionRange(),j,$=b.anchorNode;if($&&s.dom.contains($.nodeType==1?$:$.parentNode)&&(j=[{node:$,offset:b.anchorOffset}],selectionCollapsed(b)||j.push({node:b.focusNode,offset:b.focusOffset})),chrome$1&&s.input.lastKeyCode===8)for(let it=d;it>c;it--){let st=a.childNodes[it-1],lt=st.pmViewDesc;if(st.nodeName=="BR"&&!lt){d=it;break}if(!lt||lt.size)break}let _=s.state.doc,_e=s.someProp("domParser")||DOMParser.fromSchema(s.state.schema),et=_.resolve(h),nt=null,rt=_e.parse(a,{topNode:et.parent,topMatch:et.parent.contentMatchAt(et.index()),topOpen:!0,from:c,to:d,preserveWhitespace:et.parent.type.whitespace=="pre"?"full":!0,findPositions:j,ruleFromNode,context:et});if(j&&j[0].pos!=null){let it=j[0].pos,st=j[1]&&j[1].pos;st==null&&(st=it),nt={anchor:it+h,head:st+h}}return{doc:rt,sel:nt,from:h,to:g}}function ruleFromNode(s){let e=s.pmViewDesc;if(e)return e.parseRule();if(s.nodeName=="BR"&&s.parentNode){if(safari$1&&/^(ul|ol)$/i.test(s.parentNode.nodeName)){let o=document.createElement("div");return o.appendChild(document.createElement("li")),{skip:o}}else if(s.parentNode.lastChild==s||safari$1&&/^(tr|table)$/i.test(s.parentNode.nodeName))return{ignore:!0}}else if(s.nodeName=="IMG"&&s.getAttribute("mark-placeholder"))return{ignore:!0};return null}const isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function readDOMChange(s,e,o,a,c){let d=s.input.compositionPendingChanges||(s.composing?s.input.compositionID:0);if(s.input.compositionPendingChanges=0,e<0){let dt=s.input.lastSelectionTime>Date.now()-50?s.input.lastSelectionOrigin:null,ft=selectionFromDOM(s,dt);if(ft&&!s.state.selection.eq(ft)){if(chrome$1&&android&&s.input.lastKeyCode===13&&Date.now()-100<s.input.lastKeyCodeTime&&s.someProp("handleKeyDown",Ct=>Ct(s,keyEvent(13,"Enter"))))return;let xt=s.state.tr.setSelection(ft);dt=="pointer"?xt.setMeta("pointer",!0):dt=="key"&&xt.scrollIntoView(),d&&xt.setMeta("composition",d),s.dispatch(xt)}return}let h=s.state.doc.resolve(e),g=h.sharedDepth(o);e=h.before(g+1),o=s.state.doc.resolve(o).after(g+1);let b=s.state.selection,j=parseBetween(s,e,o),$=s.state.doc,_=$.slice(j.from,j.to),_e,et;s.input.lastKeyCode===8&&Date.now()-100<s.input.lastKeyCodeTime?(_e=s.state.selection.to,et="end"):(_e=s.state.selection.from,et="start"),s.input.lastKeyCode=null;let nt=findDiff$1(_.content,j.doc.content,j.from,_e,et);if(nt&&s.input.domChangeCount++,(ios$1&&s.input.lastIOSEnter>Date.now()-225||android)&&c.some(dt=>dt.nodeType==1&&!isInline.test(dt.nodeName))&&(!nt||nt.endA>=nt.endB)&&s.someProp("handleKeyDown",dt=>dt(s,keyEvent(13,"Enter")))){s.input.lastIOSEnter=0;return}if(!nt)if(a&&b instanceof TextSelection&&!b.empty&&b.$head.sameParent(b.$anchor)&&!s.composing&&!(j.sel&&j.sel.anchor!=j.sel.head))nt={start:b.from,endA:b.to,endB:b.to};else{if(j.sel){let dt=resolveSelection(s,s.state.doc,j.sel);if(dt&&!dt.eq(s.state.selection)){let ft=s.state.tr.setSelection(dt);d&&ft.setMeta("composition",d),s.dispatch(ft)}}return}s.state.selection.from<s.state.selection.to&&nt.start==nt.endB&&s.state.selection instanceof TextSelection&&(nt.start>s.state.selection.from&&nt.start<=s.state.selection.from+2&&s.state.selection.from>=j.from?nt.start=s.state.selection.from:nt.endA<s.state.selection.to&&nt.endA>=s.state.selection.to-2&&s.state.selection.to<=j.to&&(nt.endB+=s.state.selection.to-nt.endA,nt.endA=s.state.selection.to)),ie$2&&ie_version<=11&&nt.endB==nt.start+1&&nt.endA==nt.start&&nt.start>j.from&&j.doc.textBetween(nt.start-j.from-1,nt.start-j.from+1)==" "&&(nt.start--,nt.endA--,nt.endB--);let rt=j.doc.resolveNoCache(nt.start-j.from),it=j.doc.resolveNoCache(nt.endB-j.from),st=$.resolve(nt.start),lt=rt.sameParent(it)&&rt.parent.inlineContent&&st.end()>=nt.endA;if((ios$1&&s.input.lastIOSEnter>Date.now()-225&&(!lt||c.some(dt=>dt.nodeName=="DIV"||dt.nodeName=="P"))||!lt&&rt.pos<j.doc.content.size&&(!rt.sameParent(it)||!rt.parent.inlineContent)&&rt.pos<it.pos&&!/\S/.test(j.doc.textBetween(rt.pos,it.pos,"","")))&&s.someProp("handleKeyDown",dt=>dt(s,keyEvent(13,"Enter")))){s.input.lastIOSEnter=0;return}if(s.state.selection.anchor>nt.start&&looksLikeBackspace($,nt.start,nt.endA,rt,it)&&s.someProp("handleKeyDown",dt=>dt(s,keyEvent(8,"Backspace")))){android&&chrome$1&&s.domObserver.suppressSelectionUpdates();return}chrome$1&&nt.endB==nt.start&&(s.input.lastChromeDelete=Date.now()),android&&!lt&&rt.start()!=it.start()&&it.parentOffset==0&&rt.depth==it.depth&&j.sel&&j.sel.anchor==j.sel.head&&j.sel.head==nt.endA&&(nt.endB-=2,it=j.doc.resolveNoCache(nt.endB-j.from),setTimeout(()=>{s.someProp("handleKeyDown",function(dt){return dt(s,keyEvent(13,"Enter"))})},20));let ot=nt.start,ct=nt.endA,ut=dt=>{let ft=dt||s.state.tr.replace(ot,ct,j.doc.slice(nt.start-j.from,nt.endB-j.from));if(j.sel){let xt=resolveSelection(s,ft.doc,j.sel);xt&&!(chrome$1&&s.composing&&xt.empty&&(nt.start!=nt.endB||s.input.lastChromeDelete<Date.now()-100)&&(xt.head==ot||xt.head==ft.mapping.map(ct)-1)||ie$2&&xt.empty&&xt.head==ot)&&ft.setSelection(xt)}return d&&ft.setMeta("composition",d),ft.scrollIntoView()},at;if(lt)if(rt.pos==it.pos){ie$2&&ie_version<=11&&rt.parentOffset==0&&(s.domObserver.suppressSelectionUpdates(),setTimeout(()=>selectionToDOM(s),20));let dt=ut(s.state.tr.delete(ot,ct)),ft=$.resolve(nt.start).marksAcross($.resolve(nt.endA));ft&&dt.ensureMarks(ft),s.dispatch(dt)}else if(nt.endA==nt.endB&&(at=isMarkChange(rt.parent.content.cut(rt.parentOffset,it.parentOffset),st.parent.content.cut(st.parentOffset,nt.endA-st.start())))){let dt=ut(s.state.tr);at.type=="add"?dt.addMark(ot,ct,at.mark):dt.removeMark(ot,ct,at.mark),s.dispatch(dt)}else if(rt.parent.child(rt.index()).isText&&rt.index()==it.index()-(it.textOffset?0:1)){let dt=rt.parent.textBetween(rt.parentOffset,it.parentOffset),ft=()=>ut(s.state.tr.insertText(dt,ot,ct));s.someProp("handleTextInput",xt=>xt(s,ot,ct,dt,ft))||s.dispatch(ft())}else s.dispatch(ut());else s.dispatch(ut())}function resolveSelection(s,e,o){return Math.max(o.anchor,o.head)>e.content.size?null:selectionBetween(s,e.resolve(o.anchor),e.resolve(o.head))}function isMarkChange(s,e){let o=s.firstChild.marks,a=e.firstChild.marks,c=o,d=a,h,g,b;for(let $=0;$<a.length;$++)c=a[$].removeFromSet(c);for(let $=0;$<o.length;$++)d=o[$].removeFromSet(d);if(c.length==1&&d.length==0)g=c[0],h="add",b=$=>$.mark(g.addToSet($.marks));else if(c.length==0&&d.length==1)g=d[0],h="remove",b=$=>$.mark(g.removeFromSet($.marks));else return null;let j=[];for(let $=0;$<e.childCount;$++)j.push(b(e.child($)));if(Fragment.from(j).eq(s))return{mark:g,type:h}}function looksLikeBackspace(s,e,o,a,c){if(o-e<=c.pos-a.pos||skipClosingAndOpening(a,!0,!1)<c.pos)return!1;let d=s.resolve(e);if(!a.parent.isTextblock){let g=d.nodeAfter;return g!=null&&o==e+g.nodeSize}if(d.parentOffset<d.parent.content.size||!d.parent.isTextblock)return!1;let h=s.resolve(skipClosingAndOpening(d,!0,!0));return!h.parent.isTextblock||h.pos>o||skipClosingAndOpening(h,!0,!1)<o?!1:a.parent.content.cut(a.parentOffset).eq(h.parent.content)}function skipClosingAndOpening(s,e,o){let a=s.depth,c=e?s.end():s.pos;for(;a>0&&(e||s.indexAfter(a)==s.node(a).childCount);)a--,c++,e=!1;if(o){let d=s.node(a).maybeChild(s.indexAfter(a));for(;d&&!d.isLeaf;)d=d.firstChild,c++}return c}function findDiff$1(s,e,o,a,c){let d=s.findDiffStart(e,o);if(d==null)return null;let{a:h,b:g}=s.findDiffEnd(e,o+s.size,o+e.size);if(c=="end"){let b=Math.max(0,d-Math.min(h,g));a-=h+b-d}if(h<d&&s.size<e.size){let b=a<=d&&a>=h?d-a:0;d-=b,d&&d<e.size&&isSurrogatePair(e.textBetween(d-1,d+1))&&(d+=b?1:-1),g=d+(g-h),h=d}else if(g<d){let b=a<=d&&a>=g?d-a:0;d-=b,d&&d<s.size&&isSurrogatePair(s.textBetween(d-1,d+1))&&(d+=b?1:-1),h=d+(h-g),g=d}return{start:d,endA:h,endB:g}}function isSurrogatePair(s){if(s.length!=2)return!1;let e=s.charCodeAt(0),o=s.charCodeAt(1);return e>=56320&&e<=57343&&o>=55296&&o<=56319}let EditorView$1=class{constructor(e,o){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState$1,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=o,this.state=o.state,this.directPlugins=o.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver$1(this,(a,c,d,h)=>readDOMChange(this,a,c,d,h)),this.domObserver.start(),initInput(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let o in e)this._props[o]=e[o];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let o=this._props;this._props=e,e.plugins&&(e.plugins.forEach(checkStateComponent),this.directPlugins=e.plugins),this.updateStateInner(e.state,o)}setProps(e){let o={};for(let a in this._props)o[a]=this._props[a];o.state=this.state;for(let a in e)o[a]=e[a];this.update(o)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,o){var a;let c=this.state,d=!1,h=!1;e.storedMarks&&this.composing&&(clearComposition(this),h=!0),this.state=e;let g=c.plugins!=e.plugins||this._props.plugins!=o.plugins;if(g||this._props.plugins!=o.plugins||this._props.nodeViews!=o.nodeViews){let et=buildNodeViews(this);changedNodeViews(et,this.nodeViews)&&(this.nodeViews=et,d=!0)}(g||o.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let b=viewDecorations(this),j=computeDocDeco(this),$=c.plugins!=e.plugins&&!c.doc.eq(e.doc)?"reset":e.scrollToSelection>c.scrollToSelection?"to selection":"preserve",_=d||!this.docView.matchesNode(e.doc,j,b);(_||!e.selection.eq(c.selection))&&(h=!0);let _e=$=="preserve"&&h&&this.dom.style.overflowAnchor==null&&storeScrollPos(this);if(h){this.domObserver.stop();let et=_&&(ie$2||chrome$1)&&!this.composing&&!c.selection.empty&&!e.selection.empty&&selectionContextChanged(c.selection,e.selection);if(_){let nt=chrome$1?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=findCompositionNode$1(this)),(d||!this.docView.update(e.doc,j,b,this))&&(this.docView.updateOuterDeco(j),this.docView.destroy(),this.docView=docViewDesc(e.doc,j,b,this.dom,this)),nt&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(et=!0)}et||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&anchorInRightPlace(this))?selectionToDOM(this,et):(syncNodeSelection(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(c),!((a=this.dragging)===null||a===void 0)&&a.node&&!c.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,c),$=="reset"?this.dom.scrollTop=0:$=="to selection"?this.scrollToSelection():_e&&resetScrollPos(_e)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",o=>o(this)))if(this.state.selection instanceof NodeSelection){let o=this.docView.domAfterPos(this.state.selection.from);o.nodeType==1&&scrollRectIntoView$1(this,o.getBoundingClientRect(),e)}else scrollRectIntoView$1(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o];a.spec.view&&this.pluginViews.push(a.spec.view(this))}for(let o=0;o<this.state.plugins.length;o++){let a=this.state.plugins[o];a.spec.view&&this.pluginViews.push(a.spec.view(this))}}else for(let o=0;o<this.pluginViews.length;o++){let a=this.pluginViews[o];a.update&&a.update(this,e)}}updateDraggedNode(e,o){let a=e.node,c=-1;if(this.state.doc.nodeAt(a.from)==a.node)c=a.from;else{let d=a.from+(this.state.doc.content.size-o.doc.content.size);(d>0&&this.state.doc.nodeAt(d))==a.node&&(c=d)}this.dragging=new Dragging(e.slice,e.move,c<0?void 0:NodeSelection.create(this.state.doc,c))}someProp(e,o){let a=this._props&&this._props[e],c;if(a!=null&&(c=o?o(a):a))return c;for(let h=0;h<this.directPlugins.length;h++){let g=this.directPlugins[h].props[e];if(g!=null&&(c=o?o(g):g))return c}let d=this.state.plugins;if(d)for(let h=0;h<d.length;h++){let g=d[h].props[e];if(g!=null&&(c=o?o(g):g))return c}}hasFocus(){if(ie$2){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&focusPreventScroll$1(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let o=this.dom.parentNode;o;o=o.parentNode)if(o.nodeType==9||o.nodeType==11&&o.host)return o.getSelection||(Object.getPrototypeOf(o).getSelection=()=>o.ownerDocument.getSelection()),this._root=o}return e||document}updateRoot(){this._root=null}posAtCoords(e){return posAtCoords$1(this,e)}coordsAtPos(e,o=1){return coordsAtPos(this,e,o)}domAtPos(e,o=0){return this.docView.domFromPos(e,o)}nodeDOM(e){let o=this.docView.descAt(e);return o?o.nodeDOM:null}posAtDOM(e,o,a=-1){let c=this.docView.posFromDOM(e,o,a);if(c==null)throw new RangeError("DOM position not inside the editor");return c}endOfTextblock(e,o){return endOfTextblock(this,o||this.state,e)}pasteHTML(e,o){return doPaste$1(this,"",e,!1,o||new ClipboardEvent("paste"))}pasteText(e,o){return doPaste$1(this,e,null,!0,o||new ClipboardEvent("paste"))}serializeForClipboard(e){return serializeForClipboard(this,e)}destroy(){this.docView&&(destroyInput(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,clearReusedRange())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return dispatchEvent$1(this,e)}domSelectionRange(){let e=this.domSelection();return e?safari$1&&this.root.nodeType===11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariShadowSelectionRange(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};EditorView$1.prototype.dispatch=function(s){let e=this._props.dispatchTransaction;e?e.call(this,s):this.updateState(this.state.apply(s))};function computeDocDeco(s){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(s.editable),s.someProp("attributes",o=>{if(typeof o=="function"&&(o=o(s.state)),o)for(let a in o)a=="class"?e.class+=" "+o[a]:a=="style"?e.style=(e.style?e.style+";":"")+o[a]:!e[a]&&a!="contenteditable"&&a!="nodeName"&&(e[a]=String(o[a]))}),e.translate||(e.translate="no"),[Decoration$1.node(0,s.state.doc.content.size,e)]}function updateCursorWrapper(s){if(s.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),s.cursorWrapper={dom:e,deco:Decoration$1.widget(s.state.selection.from,e,{raw:!0,marks:s.markCursor})}}else s.cursorWrapper=null}function getEditable(s){return!s.someProp("editable",e=>e(s.state)===!1)}function selectionContextChanged(s,e){let o=Math.min(s.$anchor.sharedDepth(s.head),e.$anchor.sharedDepth(e.head));return s.$anchor.start(o)!=e.$anchor.start(o)}function buildNodeViews(s){let e=Object.create(null);function o(a){for(let c in a)Object.prototype.hasOwnProperty.call(e,c)||(e[c]=a[c])}return s.someProp("nodeViews",o),s.someProp("markViews",o),e}function changedNodeViews(s,e){let o=0,a=0;for(let c in s){if(s[c]!=e[c])return!0;o++}for(let c in e)a++;return o!=a}function checkStateComponent(s){if(s.spec.state||s.spec.filterTransaction||s.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(s){var e=mac$1&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||ie$1&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",o=!e&&s.key||(s.shiftKey?shift:base)[s.keyCode]||s.key||"Unidentified";return o=="Esc"&&(o="Escape"),o=="Del"&&(o="Delete"),o=="Left"&&(o="ArrowLeft"),o=="Up"&&(o="ArrowUp"),o=="Right"&&(o="ArrowRight"),o=="Down"&&(o="ArrowDown"),o}const mac=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),windows$1=typeof navigator<"u"&&/Win/.test(navigator.platform);function normalizeKeyName$2(s){let e=s.split(/-(?!$)/),o=e[e.length-1];o=="Space"&&(o=" ");let a,c,d,h;for(let g=0;g<e.length-1;g++){let b=e[g];if(/^(cmd|meta|m)$/i.test(b))h=!0;else if(/^a(lt)?$/i.test(b))a=!0;else if(/^(c|ctrl|control)$/i.test(b))c=!0;else if(/^s(hift)?$/i.test(b))d=!0;else if(/^mod$/i.test(b))mac?h=!0:c=!0;else throw new Error("Unrecognized modifier name: "+b)}return a&&(o="Alt-"+o),c&&(o="Ctrl-"+o),h&&(o="Meta-"+o),d&&(o="Shift-"+o),o}function normalize(s){let e=Object.create(null);for(let o in s)e[normalizeKeyName$2(o)]=s[o];return e}function modifiers$1(s,e,o=!0){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),o&&e.shiftKey&&(s="Shift-"+s),s}function keymap$1(s){return new Plugin({props:{handleKeyDown:keydownHandler(s)}})}function keydownHandler(s){let e=normalize(s);return function(o,a){let c=keyName(a),d,h=e[modifiers$1(c,a)];if(h&&h(o.state,o.dispatch,o))return!0;if(c.length==1&&c!=" "){if(a.shiftKey){let g=e[modifiers$1(c,a,!1)];if(g&&g(o.state,o.dispatch,o))return!0}if((a.altKey||a.metaKey||a.ctrlKey)&&!(windows$1&&a.ctrlKey&&a.altKey)&&(d=base[a.keyCode])&&d!=c){let g=e[modifiers$1(d,a)];if(g&&g(o.state,o.dispatch,o))return!0}}return!1}}const deleteSelection$1=(s,e)=>s.selection.empty?!1:(e&&e(s.tr.deleteSelection().scrollIntoView()),!0);function atBlockStart(s,e){let{$cursor:o}=s.selection;return!o||(e?!e.endOfTextblock("backward",s):o.parentOffset>0)?null:o}const joinBackward$1=(s,e,o)=>{let a=atBlockStart(s,o);if(!a)return!1;let c=findCutBefore(a);if(!c){let h=a.blockRange(),g=h&&liftTarget(h);return g==null?!1:(e&&e(s.tr.lift(h,g).scrollIntoView()),!0)}let d=c.nodeBefore;if(deleteBarrier(s,c,e,-1))return!0;if(a.parent.content.size==0&&(textblockAt(d,"end")||NodeSelection.isSelectable(d)))for(let h=a.depth;;h--){let g=replaceStep(s.doc,a.before(h),a.after(h),Slice.empty);if(g&&g.slice.size<g.to-g.from){if(e){let b=s.tr.step(g);b.setSelection(textblockAt(d,"end")?Selection$2.findFrom(b.doc.resolve(b.mapping.map(c.pos,-1)),-1):NodeSelection.create(b.doc,c.pos-d.nodeSize)),e(b.scrollIntoView())}return!0}if(h==1||a.node(h-1).childCount>1)break}return d.isAtom&&c.depth==a.depth-1?(e&&e(s.tr.delete(c.pos-d.nodeSize,c.pos).scrollIntoView()),!0):!1},joinTextblockBackward$1=(s,e,o)=>{let a=atBlockStart(s,o);if(!a)return!1;let c=findCutBefore(a);return c?joinTextblocksAround(s,c,e):!1},joinTextblockForward$1=(s,e,o)=>{let a=atBlockEnd(s,o);if(!a)return!1;let c=findCutAfter(a);return c?joinTextblocksAround(s,c,e):!1};function joinTextblocksAround(s,e,o){let a=e.nodeBefore,c=a,d=e.pos-1;for(;!c.isTextblock;d--){if(c.type.spec.isolating)return!1;let $=c.lastChild;if(!$)return!1;c=$}let h=e.nodeAfter,g=h,b=e.pos+1;for(;!g.isTextblock;b++){if(g.type.spec.isolating)return!1;let $=g.firstChild;if(!$)return!1;g=$}let j=replaceStep(s.doc,d,b,Slice.empty);if(!j||j.from!=d||j instanceof ReplaceStep&&j.slice.size>=b-d)return!1;if(o){let $=s.tr.step(j);$.setSelection(TextSelection.create($.doc,d)),o($.scrollIntoView())}return!0}function textblockAt(s,e,o=!1){for(let a=s;a;a=e=="start"?a.firstChild:a.lastChild){if(a.isTextblock)return!0;if(o&&a.childCount!=1)return!1}return!1}const selectNodeBackward$1=(s,e,o)=>{let{$head:a,empty:c}=s.selection,d=a;if(!c)return!1;if(a.parent.isTextblock){if(o?!o.endOfTextblock("backward",s):a.parentOffset>0)return!1;d=findCutBefore(a)}let h=d&&d.nodeBefore;return!h||!NodeSelection.isSelectable(h)?!1:(e&&e(s.tr.setSelection(NodeSelection.create(s.doc,d.pos-h.nodeSize)).scrollIntoView()),!0)};function findCutBefore(s){if(!s.parent.type.spec.isolating)for(let e=s.depth-1;e>=0;e--){if(s.index(e)>0)return s.doc.resolve(s.before(e+1));if(s.node(e).type.spec.isolating)break}return null}function atBlockEnd(s,e){let{$cursor:o}=s.selection;return!o||(e?!e.endOfTextblock("forward",s):o.parentOffset<o.parent.content.size)?null:o}const joinForward$1=(s,e,o)=>{let a=atBlockEnd(s,o);if(!a)return!1;let c=findCutAfter(a);if(!c)return!1;let d=c.nodeAfter;if(deleteBarrier(s,c,e,1))return!0;if(a.parent.content.size==0&&(textblockAt(d,"start")||NodeSelection.isSelectable(d))){let h=replaceStep(s.doc,a.before(),a.after(),Slice.empty);if(h&&h.slice.size<h.to-h.from){if(e){let g=s.tr.step(h);g.setSelection(textblockAt(d,"start")?Selection$2.findFrom(g.doc.resolve(g.mapping.map(c.pos)),1):NodeSelection.create(g.doc,g.mapping.map(c.pos))),e(g.scrollIntoView())}return!0}}return d.isAtom&&c.depth==a.depth-1?(e&&e(s.tr.delete(c.pos,c.pos+d.nodeSize).scrollIntoView()),!0):!1},selectNodeForward$1=(s,e,o)=>{let{$head:a,empty:c}=s.selection,d=a;if(!c)return!1;if(a.parent.isTextblock){if(o?!o.endOfTextblock("forward",s):a.parentOffset<a.parent.content.size)return!1;d=findCutAfter(a)}let h=d&&d.nodeAfter;return!h||!NodeSelection.isSelectable(h)?!1:(e&&e(s.tr.setSelection(NodeSelection.create(s.doc,d.pos)).scrollIntoView()),!0)};function findCutAfter(s){if(!s.parent.type.spec.isolating)for(let e=s.depth-1;e>=0;e--){let o=s.node(e);if(s.index(e)+1<o.childCount)return s.doc.resolve(s.after(e+1));if(o.type.spec.isolating)break}return null}const joinUp$1=(s,e)=>{let o=s.selection,a=o instanceof NodeSelection,c;if(a){if(o.node.isTextblock||!canJoin(s.doc,o.from))return!1;c=o.from}else if(c=joinPoint(s.doc,o.from,-1),c==null)return!1;if(e){let d=s.tr.join(c);a&&d.setSelection(NodeSelection.create(d.doc,c-s.doc.resolve(c).nodeBefore.nodeSize)),e(d.scrollIntoView())}return!0},joinDown$1=(s,e)=>{let o=s.selection,a;if(o instanceof NodeSelection){if(o.node.isTextblock||!canJoin(s.doc,o.to))return!1;a=o.to}else if(a=joinPoint(s.doc,o.to,1),a==null)return!1;return e&&e(s.tr.join(a).scrollIntoView()),!0},lift$1=(s,e)=>{let{$from:o,$to:a}=s.selection,c=o.blockRange(a),d=c&&liftTarget(c);return d==null?!1:(e&&e(s.tr.lift(c,d).scrollIntoView()),!0)},newlineInCode$1=(s,e)=>{let{$head:o,$anchor:a}=s.selection;return!o.parent.type.spec.code||!o.sameParent(a)?!1:(e&&e(s.tr.insertText(`
`).scrollIntoView()),!0)};function defaultBlockAt$1(s){for(let e=0;e<s.edgeCount;e++){let{type:o}=s.edge(e);if(o.isTextblock&&!o.hasRequiredAttrs())return o}return null}const exitCode$1=(s,e)=>{let{$head:o,$anchor:a}=s.selection;if(!o.parent.type.spec.code||!o.sameParent(a))return!1;let c=o.node(-1),d=o.indexAfter(-1),h=defaultBlockAt$1(c.contentMatchAt(d));if(!h||!c.canReplaceWith(d,d,h))return!1;if(e){let g=o.after(),b=s.tr.replaceWith(g,g,h.createAndFill());b.setSelection(Selection$2.near(b.doc.resolve(g),1)),e(b.scrollIntoView())}return!0},createParagraphNear$1=(s,e)=>{let o=s.selection,{$from:a,$to:c}=o;if(o instanceof AllSelection||a.parent.inlineContent||c.parent.inlineContent)return!1;let d=defaultBlockAt$1(c.parent.contentMatchAt(c.indexAfter()));if(!d||!d.isTextblock)return!1;if(e){let h=(!a.parentOffset&&c.index()<c.parent.childCount?a:c).pos,g=s.tr.insert(h,d.createAndFill());g.setSelection(TextSelection.create(g.doc,h+1)),e(g.scrollIntoView())}return!0},liftEmptyBlock$1=(s,e)=>{let{$cursor:o}=s.selection;if(!o||o.parent.content.size)return!1;if(o.depth>1&&o.after()!=o.end(-1)){let d=o.before();if(canSplit(s.doc,d))return e&&e(s.tr.split(d).scrollIntoView()),!0}let a=o.blockRange(),c=a&&liftTarget(a);return c==null?!1:(e&&e(s.tr.lift(a,c).scrollIntoView()),!0)};function splitBlockAs(s){return(e,o)=>{let{$from:a,$to:c}=e.selection;if(e.selection instanceof NodeSelection&&e.selection.node.isBlock)return!a.parentOffset||!canSplit(e.doc,a.pos)?!1:(o&&o(e.tr.split(a.pos).scrollIntoView()),!0);if(!a.depth)return!1;let d=[],h,g,b=!1,j=!1;for(let et=a.depth;;et--)if(a.node(et).isBlock){b=a.end(et)==a.pos+(a.depth-et),j=a.start(et)==a.pos-(a.depth-et),g=defaultBlockAt$1(a.node(et-1).contentMatchAt(a.indexAfter(et-1))),d.unshift(b&&g?{type:g}:null),h=et;break}else{if(et==1)return!1;d.unshift(null)}let $=e.tr;(e.selection instanceof TextSelection||e.selection instanceof AllSelection)&&$.deleteSelection();let _=$.mapping.map(a.pos),_e=canSplit($.doc,_,d.length,d);if(_e||(d[0]=g?{type:g}:null,_e=canSplit($.doc,_,d.length,d)),!_e)return!1;if($.split(_,d.length,d),!b&&j&&a.node(h).type!=g){let et=$.mapping.map(a.before(h)),nt=$.doc.resolve(et);g&&a.node(h-1).canReplaceWith(nt.index(),nt.index()+1,g)&&$.setNodeMarkup($.mapping.map(a.before(h)),g)}return o&&o($.scrollIntoView()),!0}}const splitBlock$1=splitBlockAs(),selectParentNode$1=(s,e)=>{let{$from:o,to:a}=s.selection,c,d=o.sharedDepth(a);return d==0?!1:(c=o.before(d),e&&e(s.tr.setSelection(NodeSelection.create(s.doc,c))),!0)};function joinMaybeClear(s,e,o){let a=e.nodeBefore,c=e.nodeAfter,d=e.index();return!a||!c||!a.type.compatibleContent(c.type)?!1:!a.content.size&&e.parent.canReplace(d-1,d)?(o&&o(s.tr.delete(e.pos-a.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(d,d+1)||!(c.isTextblock||canJoin(s.doc,e.pos))?!1:(o&&o(s.tr.join(e.pos).scrollIntoView()),!0)}function deleteBarrier(s,e,o,a){let c=e.nodeBefore,d=e.nodeAfter,h,g,b=c.type.spec.isolating||d.type.spec.isolating;if(!b&&joinMaybeClear(s,e,o))return!0;let j=!b&&e.parent.canReplace(e.index(),e.index()+1);if(j&&(h=(g=c.contentMatchAt(c.childCount)).findWrapping(d.type))&&g.matchType(h[0]||d.type).validEnd){if(o){let et=e.pos+d.nodeSize,nt=Fragment.empty;for(let st=h.length-1;st>=0;st--)nt=Fragment.from(h[st].create(null,nt));nt=Fragment.from(c.copy(nt));let rt=s.tr.step(new ReplaceAroundStep(e.pos-1,et,e.pos,et,new Slice(nt,1,0),h.length,!0)),it=rt.doc.resolve(et+2*h.length);it.nodeAfter&&it.nodeAfter.type==c.type&&canJoin(rt.doc,it.pos)&&rt.join(it.pos),o(rt.scrollIntoView())}return!0}let $=d.type.spec.isolating||a>0&&b?null:Selection$2.findFrom(e,1),_=$&&$.$from.blockRange($.$to),_e=_&&liftTarget(_);if(_e!=null&&_e>=e.depth)return o&&o(s.tr.lift(_,_e).scrollIntoView()),!0;if(j&&textblockAt(d,"start",!0)&&textblockAt(c,"end")){let et=c,nt=[];for(;nt.push(et),!et.isTextblock;)et=et.lastChild;let rt=d,it=1;for(;!rt.isTextblock;rt=rt.firstChild)it++;if(et.canReplace(et.childCount,et.childCount,rt.content)){if(o){let st=Fragment.empty;for(let ot=nt.length-1;ot>=0;ot--)st=Fragment.from(nt[ot].copy(st));let lt=s.tr.step(new ReplaceAroundStep(e.pos-nt.length,e.pos+d.nodeSize,e.pos+it,e.pos+d.nodeSize-it,new Slice(st,nt.length,0),0,!0));o(lt.scrollIntoView())}return!0}}return!1}function selectTextblockSide(s){return function(e,o){let a=e.selection,c=s<0?a.$from:a.$to,d=c.depth;for(;c.node(d).isInline;){if(!d)return!1;d--}return c.node(d).isTextblock?(o&&o(e.tr.setSelection(TextSelection.create(e.doc,s<0?c.start(d):c.end(d)))),!0):!1}}const selectTextblockStart$1=selectTextblockSide(-1),selectTextblockEnd$1=selectTextblockSide(1);function wrapIn$1(s,e=null){return function(o,a){let{$from:c,$to:d}=o.selection,h=c.blockRange(d),g=h&&findWrapping(h,s,e);return g?(a&&a(o.tr.wrap(h,g).scrollIntoView()),!0):!1}}function setBlockType(s,e=null){return function(o,a){let c=!1;for(let d=0;d<o.selection.ranges.length&&!c;d++){let{$from:{pos:h},$to:{pos:g}}=o.selection.ranges[d];o.doc.nodesBetween(h,g,(b,j)=>{if(c)return!1;if(!(!b.isTextblock||b.hasMarkup(s,e)))if(b.type==s)c=!0;else{let $=o.doc.resolve(j),_=$.index();c=$.parent.canReplaceWith(_,_+1,s)}})}if(!c)return!1;if(a){let d=o.tr;for(let h=0;h<o.selection.ranges.length;h++){let{$from:{pos:g},$to:{pos:b}}=o.selection.ranges[h];d.setBlockType(g,b,s,e)}a(d.scrollIntoView())}return!0}}function chainCommands(...s){return function(e,o,a){for(let c=0;c<s.length;c++)if(s[c](e,o,a))return!0;return!1}}chainCommands(deleteSelection$1,joinBackward$1,selectNodeBackward$1);chainCommands(deleteSelection$1,joinForward$1,selectNodeForward$1);chainCommands(newlineInCode$1,createParagraphNear$1,liftEmptyBlock$1,splitBlock$1);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function wrapInList$1(s,e=null){return function(o,a){let{$from:c,$to:d}=o.selection,h=c.blockRange(d);if(!h)return!1;let g=a?o.tr:null;return wrapRangeInList(g,h,s,e)?(a&&a(g.scrollIntoView()),!0):!1}}function wrapRangeInList(s,e,o,a=null){let c=!1,d=e,h=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(o)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let b=h.resolve(e.start-2);d=new NodeRange(b,b,e.depth),e.endIndex<e.parent.childCount&&(e=new NodeRange(e.$from,h.resolve(e.$to.end(e.depth)),e.depth)),c=!0}let g=findWrapping(d,o,a,e);return g?(s&&doWrapInList(s,e,g,c,o),!0):!1}function doWrapInList(s,e,o,a,c){let d=Fragment.empty;for(let $=o.length-1;$>=0;$--)d=Fragment.from(o[$].type.create(o[$].attrs,d));s.step(new ReplaceAroundStep(e.start-(a?2:0),e.end,e.start,e.end,new Slice(d,0,0),o.length,!0));let h=0;for(let $=0;$<o.length;$++)o[$].type==c&&(h=$+1);let g=o.length-h,b=e.start+o.length-(a?2:0),j=e.parent;for(let $=e.startIndex,_=e.endIndex,_e=!0;$<_;$++,_e=!1)!_e&&canSplit(s.doc,b,g)&&(s.split(b,g),b+=2*g),b+=j.child($).nodeSize;return s}function liftListItem$1(s){return function(e,o){let{$from:a,$to:c}=e.selection,d=a.blockRange(c,h=>h.childCount>0&&h.firstChild.type==s);return d?o?a.node(d.depth-1).type==s?liftToOuterList(e,o,s,d):liftOutOfList(e,o,d):!0:!1}}function liftToOuterList(s,e,o,a){let c=s.tr,d=a.end,h=a.$to.end(a.depth);d<h&&(c.step(new ReplaceAroundStep(d-1,h,d,h,new Slice(Fragment.from(o.create(null,a.parent.copy())),1,0),1,!0)),a=new NodeRange(c.doc.resolve(a.$from.pos),c.doc.resolve(h),a.depth));const g=liftTarget(a);if(g==null)return!1;c.lift(a,g);let b=c.doc.resolve(c.mapping.map(d,-1)-1);return canJoin(c.doc,b.pos)&&b.nodeBefore.type==b.nodeAfter.type&&c.join(b.pos),e(c.scrollIntoView()),!0}function liftOutOfList(s,e,o){let a=s.tr,c=o.parent;for(let et=o.end,nt=o.endIndex-1,rt=o.startIndex;nt>rt;nt--)et-=c.child(nt).nodeSize,a.delete(et-1,et+1);let d=a.doc.resolve(o.start),h=d.nodeAfter;if(a.mapping.map(o.end)!=o.start+d.nodeAfter.nodeSize)return!1;let g=o.startIndex==0,b=o.endIndex==c.childCount,j=d.node(-1),$=d.index(-1);if(!j.canReplace($+(g?0:1),$+1,h.content.append(b?Fragment.empty:Fragment.from(c))))return!1;let _=d.pos,_e=_+h.nodeSize;return a.step(new ReplaceAroundStep(_-(g?1:0),_e+(b?1:0),_+1,_e-1,new Slice((g?Fragment.empty:Fragment.from(c.copy(Fragment.empty))).append(b?Fragment.empty:Fragment.from(c.copy(Fragment.empty))),g?0:1,b?0:1),g?0:1)),e(a.scrollIntoView()),!0}function sinkListItem$1(s){return function(e,o){let{$from:a,$to:c}=e.selection,d=a.blockRange(c,j=>j.childCount>0&&j.firstChild.type==s);if(!d)return!1;let h=d.startIndex;if(h==0)return!1;let g=d.parent,b=g.child(h-1);if(b.type!=s)return!1;if(o){let j=b.lastChild&&b.lastChild.type==g.type,$=Fragment.from(j?s.create():null),_=new Slice(Fragment.from(s.create(null,Fragment.from(g.type.create(null,$)))),j?3:1,0),_e=d.start,et=d.end;o(e.tr.step(new ReplaceAroundStep(_e-(j?3:1),et,_e,et,_,1,!0)).scrollIntoView())}return!0}}function createChainableState(s){const{state:e,transaction:o}=s;let{selection:a}=o,{doc:c}=o,{storedMarks:d}=o;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return d},get selection(){return a},get doc(){return c},get tr(){return a=o.selection,c=o.doc,d=o.storedMarks,o}}}class CommandManager{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:o,state:a}=this,{view:c}=o,{tr:d}=a,h=this.buildProps(d);return Object.fromEntries(Object.entries(e).map(([g,b])=>[g,(...$)=>{const _=b(...$)(h);return!d.getMeta("preventDispatch")&&!this.hasCustomState&&c.dispatch(d),_}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,o=!0){const{rawCommands:a,editor:c,state:d}=this,{view:h}=c,g=[],b=!!e,j=e||d.tr,$=()=>(!b&&o&&!j.getMeta("preventDispatch")&&!this.hasCustomState&&h.dispatch(j),g.every(_e=>_e===!0)),_={...Object.fromEntries(Object.entries(a).map(([_e,et])=>[_e,(...rt)=>{const it=this.buildProps(j,o),st=et(...rt)(it);return g.push(st),_}])),run:$};return _}createCan(e){const{rawCommands:o,state:a}=this,c=!1,d=e||a.tr,h=this.buildProps(d,c);return{...Object.fromEntries(Object.entries(o).map(([b,j])=>[b,(...$)=>j(...$)({...h,dispatch:void 0})])),chain:()=>this.createChain(d,c)}}buildProps(e,o=!0){const{rawCommands:a,editor:c,state:d}=this,{view:h}=c,g={tr:e,editor:c,view:h,state:createChainableState({state:d,transaction:e}),dispatch:o?()=>{}:void 0,chain:()=>this.createChain(e,o),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(a).map(([b,j])=>[b,(...$)=>j(...$)(g)]))}};return g}}class EventEmitter{constructor(){this.callbacks={}}on(e,o){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(o),this}emit(e,...o){const a=this.callbacks[e];return a&&a.forEach(c=>c.apply(this,o)),this}off(e,o){const a=this.callbacks[e];return a&&(o?this.callbacks[e]=a.filter(c=>c!==o):delete this.callbacks[e]),this}once(e,o){const a=(...c)=>{this.off(e,a),o.apply(this,c)};return this.on(e,a)}removeAllListeners(){this.callbacks={}}}function getExtensionField(s,e,o){return s.config[e]===void 0&&s.parent?getExtensionField(s.parent,e,o):typeof s.config[e]=="function"?s.config[e].bind({...o,parent:s.parent?getExtensionField(s.parent,e,o):null}):s.config[e]}function splitExtensions(s){const e=s.filter(c=>c.type==="extension"),o=s.filter(c=>c.type==="node"),a=s.filter(c=>c.type==="mark");return{baseExtensions:e,nodeExtensions:o,markExtensions:a}}function getAttributesFromExtensions(s){const e=[],{nodeExtensions:o,markExtensions:a}=splitExtensions(s),c=[...o,...a],d={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return s.forEach(h=>{const g={name:h.name,options:h.options,storage:h.storage,extensions:c},b=getExtensionField(h,"addGlobalAttributes",g);if(!b)return;b().forEach($=>{$.types.forEach(_=>{Object.entries($.attributes).forEach(([_e,et])=>{e.push({type:_,name:_e,attribute:{...d,...et}})})})})}),c.forEach(h=>{const g={name:h.name,options:h.options,storage:h.storage},b=getExtensionField(h,"addAttributes",g);if(!b)return;const j=b();Object.entries(j).forEach(([$,_])=>{const _e={...d,..._};typeof(_e==null?void 0:_e.default)=="function"&&(_e.default=_e.default()),_e!=null&&_e.isRequired&&(_e==null?void 0:_e.default)===void 0&&delete _e.default,e.push({type:h.name,name:$,attribute:_e})})}),e}function getNodeType(s,e){if(typeof s=="string"){if(!e.nodes[s])throw Error(`There is no node type named '${s}'. Maybe you forgot to add the extension?`);return e.nodes[s]}return s}function mergeAttributes(...s){return s.filter(e=>!!e).reduce((e,o)=>{const a={...e};return Object.entries(o).forEach(([c,d])=>{if(!a[c]){a[c]=d;return}if(c==="class"){const g=d?String(d).split(" "):[],b=a[c]?a[c].split(" "):[],j=g.filter($=>!b.includes($));a[c]=[...b,...j].join(" ")}else if(c==="style"){const g=d?d.split(";").map($=>$.trim()).filter(Boolean):[],b=a[c]?a[c].split(";").map($=>$.trim()).filter(Boolean):[],j=new Map;b.forEach($=>{const[_,_e]=$.split(":").map(et=>et.trim());j.set(_,_e)}),g.forEach($=>{const[_,_e]=$.split(":").map(et=>et.trim());j.set(_,_e)}),a[c]=Array.from(j.entries()).map(([$,_])=>`${$}: ${_}`).join("; ")}else a[c]=d}),a},{})}function getRenderedAttributes(s,e){return e.filter(o=>o.type===s.type.name).filter(o=>o.attribute.rendered).map(o=>o.attribute.renderHTML?o.attribute.renderHTML(s.attrs)||{}:{[o.name]:s.attrs[o.name]}).reduce((o,a)=>mergeAttributes(o,a),{})}function isFunction(s){return typeof s=="function"}function callOrReturn(s,e=void 0,...o){return isFunction(s)?e?s.bind(e)(...o):s(...o):s}function isEmptyObject(s={}){return Object.keys(s).length===0&&s.constructor===Object}function fromString(s){return typeof s!="string"?s:s.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(s):s==="true"?!0:s==="false"?!1:s}function injectExtensionAttributesToParseRule(s,e){return"style"in s?s:{...s,getAttrs:o=>{const a=s.getAttrs?s.getAttrs(o):s.attrs;if(a===!1)return!1;const c=e.reduce((d,h)=>{const g=h.attribute.parseHTML?h.attribute.parseHTML(o):fromString(o.getAttribute(h.name));return g==null?d:{...d,[h.name]:g}},{});return{...a,...c}}}}function cleanUpSchemaItem(s){return Object.fromEntries(Object.entries(s).filter(([e,o])=>e==="attrs"&&isEmptyObject(o)?!1:o!=null))}function getSchemaByResolvedExtensions(s,e){var o;const a=getAttributesFromExtensions(s),{nodeExtensions:c,markExtensions:d}=splitExtensions(s),h=(o=c.find(j=>getExtensionField(j,"topNode")))===null||o===void 0?void 0:o.name,g=Object.fromEntries(c.map(j=>{const $=a.filter(st=>st.type===j.name),_={name:j.name,options:j.options,storage:j.storage,editor:e},_e=s.reduce((st,lt)=>{const ot=getExtensionField(lt,"extendNodeSchema",_);return{...st,...ot?ot(j):{}}},{}),et=cleanUpSchemaItem({..._e,content:callOrReturn(getExtensionField(j,"content",_)),marks:callOrReturn(getExtensionField(j,"marks",_)),group:callOrReturn(getExtensionField(j,"group",_)),inline:callOrReturn(getExtensionField(j,"inline",_)),atom:callOrReturn(getExtensionField(j,"atom",_)),selectable:callOrReturn(getExtensionField(j,"selectable",_)),draggable:callOrReturn(getExtensionField(j,"draggable",_)),code:callOrReturn(getExtensionField(j,"code",_)),whitespace:callOrReturn(getExtensionField(j,"whitespace",_)),linebreakReplacement:callOrReturn(getExtensionField(j,"linebreakReplacement",_)),defining:callOrReturn(getExtensionField(j,"defining",_)),isolating:callOrReturn(getExtensionField(j,"isolating",_)),attrs:Object.fromEntries($.map(st=>{var lt;return[st.name,{default:(lt=st==null?void 0:st.attribute)===null||lt===void 0?void 0:lt.default}]}))}),nt=callOrReturn(getExtensionField(j,"parseHTML",_));nt&&(et.parseDOM=nt.map(st=>injectExtensionAttributesToParseRule(st,$)));const rt=getExtensionField(j,"renderHTML",_);rt&&(et.toDOM=st=>rt({node:st,HTMLAttributes:getRenderedAttributes(st,$)}));const it=getExtensionField(j,"renderText",_);return it&&(et.toText=it),[j.name,et]})),b=Object.fromEntries(d.map(j=>{const $=a.filter(it=>it.type===j.name),_={name:j.name,options:j.options,storage:j.storage,editor:e},_e=s.reduce((it,st)=>{const lt=getExtensionField(st,"extendMarkSchema",_);return{...it,...lt?lt(j):{}}},{}),et=cleanUpSchemaItem({..._e,inclusive:callOrReturn(getExtensionField(j,"inclusive",_)),excludes:callOrReturn(getExtensionField(j,"excludes",_)),group:callOrReturn(getExtensionField(j,"group",_)),spanning:callOrReturn(getExtensionField(j,"spanning",_)),code:callOrReturn(getExtensionField(j,"code",_)),attrs:Object.fromEntries($.map(it=>{var st;return[it.name,{default:(st=it==null?void 0:it.attribute)===null||st===void 0?void 0:st.default}]}))}),nt=callOrReturn(getExtensionField(j,"parseHTML",_));nt&&(et.parseDOM=nt.map(it=>injectExtensionAttributesToParseRule(it,$)));const rt=getExtensionField(j,"renderHTML",_);return rt&&(et.toDOM=it=>rt({mark:it,HTMLAttributes:getRenderedAttributes(it,$)})),[j.name,et]}));return new Schema({topNode:h,nodes:g,marks:b})}function getSchemaTypeByName(s,e){return e.nodes[s]||e.marks[s]||null}function isExtensionRulesEnabled(s,e){return Array.isArray(e)?e.some(o=>(typeof o=="string"?o:o.name)===s.name):e}function getHTMLFromFragment(s,e){const o=DOMSerializer.fromSchema(e).serializeFragment(s),c=document.implementation.createHTMLDocument().createElement("div");return c.appendChild(o),c.innerHTML}const getTextContentFromNodes=(s,e=500)=>{let o="";const a=s.parentOffset;return s.parent.nodesBetween(Math.max(0,a-e),a,(c,d,h,g)=>{var b,j;const $=((j=(b=c.type.spec).toText)===null||j===void 0?void 0:j.call(b,{node:c,pos:d,parent:h,index:g}))||c.textContent||"%leaf%";o+=c.isAtom&&!c.isText?$:$.slice(0,Math.max(0,a-d))}),o};function isRegExp(s){return Object.prototype.toString.call(s)==="[object RegExp]"}class InputRule{constructor(e){this.find=e.find,this.handler=e.handler}}const inputRuleMatcherHandler=(s,e)=>{if(isRegExp(e))return e.exec(s);const o=e(s);if(!o)return null;const a=[o.text];return a.index=o.index,a.input=s,a.data=o.data,o.replaceWith&&(o.text.includes(o.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),a.push(o.replaceWith)),a};function run$1$1(s){var e;const{editor:o,from:a,to:c,text:d,rules:h,plugin:g}=s,{view:b}=o;if(b.composing)return!1;const j=b.state.doc.resolve(a);if(j.parent.type.spec.code||!((e=j.nodeBefore||j.nodeAfter)===null||e===void 0)&&e.marks.find(_e=>_e.type.spec.code))return!1;let $=!1;const _=getTextContentFromNodes(j)+d;return h.forEach(_e=>{if($)return;const et=inputRuleMatcherHandler(_,_e.find);if(!et)return;const nt=b.state.tr,rt=createChainableState({state:b.state,transaction:nt}),it={from:a-(et[0].length-d.length),to:c},{commands:st,chain:lt,can:ot}=new CommandManager({editor:o,state:rt});_e.handler({state:rt,range:it,match:et,commands:st,chain:lt,can:ot})===null||!nt.steps.length||(nt.setMeta(g,{transform:nt,from:a,to:c,text:d}),b.dispatch(nt),$=!0)}),$}function inputRulesPlugin(s){const{editor:e,rules:o}=s,a=new Plugin({state:{init(){return null},apply(c,d,h){const g=c.getMeta(a);if(g)return g;const b=c.getMeta("applyInputRules");return!!b&&setTimeout(()=>{let{text:$}=b;typeof $=="string"?$=$:$=getHTMLFromFragment(Fragment.from($),h.schema);const{from:_}=b,_e=_+$.length;run$1$1({editor:e,from:_,to:_e,text:$,rules:o,plugin:a})}),c.selectionSet||c.docChanged?null:d}},props:{handleTextInput(c,d,h,g){return run$1$1({editor:e,from:d,to:h,text:g,rules:o,plugin:a})},handleDOMEvents:{compositionend:c=>(setTimeout(()=>{const{$cursor:d}=c.state.selection;d&&run$1$1({editor:e,from:d.pos,to:d.pos,text:"",rules:o,plugin:a})}),!1)},handleKeyDown(c,d){if(d.key!=="Enter")return!1;const{$cursor:h}=c.state.selection;return h?run$1$1({editor:e,from:h.pos,to:h.pos,text:`
`,rules:o,plugin:a}):!1}},isInputRules:!0});return a}function getType(s){return Object.prototype.toString.call(s).slice(8,-1)}function isPlainObject(s){return getType(s)!=="Object"?!1:s.constructor===Object&&Object.getPrototypeOf(s)===Object.prototype}function mergeDeep(s,e){const o={...s};return isPlainObject(s)&&isPlainObject(e)&&Object.keys(e).forEach(a=>{isPlainObject(e[a])&&isPlainObject(s[a])?o[a]=mergeDeep(s[a],e[a]):o[a]=e[a]}),o}class Mark{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Mark(e)}configure(e={}){const o=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return o.name=this.name,o.parent=this.parent,o}extend(e={}){const o=new Mark(e);return o.parent=this,this.child=o,o.name=e.name?e.name:o.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${o.name}".`),o.options=callOrReturn(getExtensionField(o,"addOptions",{name:o.name})),o.storage=callOrReturn(getExtensionField(o,"addStorage",{name:o.name,options:o.options})),o}static handleExit({editor:e,mark:o}){const{tr:a}=e.state,c=e.state.selection.$from;if(c.pos===c.end()){const h=c.marks();if(!!!h.find(j=>(j==null?void 0:j.type.name)===o.name))return!1;const b=h.find(j=>(j==null?void 0:j.type.name)===o.name);return b&&a.removeStoredMark(b),a.insertText(" ",c.pos),e.view.dispatch(a),!0}return!1}}function isNumber(s){return typeof s=="number"}class PasteRule{constructor(e){this.find=e.find,this.handler=e.handler}}const pasteRuleMatcherHandler=(s,e,o)=>{if(isRegExp(e))return[...s.matchAll(e)];const a=e(s,o);return a?a.map(c=>{const d=[c.text];return d.index=c.index,d.input=s,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),d.push(c.replaceWith)),d}):[]};function run$2(s){const{editor:e,state:o,from:a,to:c,rule:d,pasteEvent:h,dropEvent:g}=s,{commands:b,chain:j,can:$}=new CommandManager({editor:e,state:o}),_=[];return o.doc.nodesBetween(a,c,(et,nt)=>{if(!et.isTextblock||et.type.spec.code)return;const rt=Math.max(a,nt),it=Math.min(c,nt+et.content.size),st=et.textBetween(rt-nt,it-nt,void 0,"");pasteRuleMatcherHandler(st,d.find,h).forEach(ot=>{if(ot.index===void 0)return;const ct=rt+ot.index+1,ut=ct+ot[0].length,at={from:o.tr.mapping.map(ct),to:o.tr.mapping.map(ut)},dt=d.handler({state:o,range:at,match:ot,commands:b,chain:j,can:$,pasteEvent:h,dropEvent:g});_.push(dt)})}),_.every(et=>et!==null)}let tiptapDragFromOtherEditor=null;const createClipboardPasteEvent=s=>{var e;const o=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=o.clipboardData)===null||e===void 0||e.setData("text/html",s),o};function pasteRulesPlugin(s){const{editor:e,rules:o}=s;let a=null,c=!1,d=!1,h=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g;try{g=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{g=null}const b=({state:$,from:_,to:_e,rule:et,pasteEvt:nt})=>{const rt=$.tr,it=createChainableState({state:$,transaction:rt});if(!(!run$2({editor:e,state:it,from:Math.max(_-1,0),to:_e.b-1,rule:et,pasteEvent:nt,dropEvent:g})||!rt.steps.length)){try{g=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{g=null}return h=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,rt}};return o.map($=>new Plugin({view(_){const _e=nt=>{var rt;a=!((rt=_.dom.parentElement)===null||rt===void 0)&&rt.contains(nt.target)?_.dom.parentElement:null,a&&(tiptapDragFromOtherEditor=e)},et=()=>{tiptapDragFromOtherEditor&&(tiptapDragFromOtherEditor=null)};return window.addEventListener("dragstart",_e),window.addEventListener("dragend",et),{destroy(){window.removeEventListener("dragstart",_e),window.removeEventListener("dragend",et)}}},props:{handleDOMEvents:{drop:(_,_e)=>{if(d=a===_.dom.parentElement,g=_e,!d){const et=tiptapDragFromOtherEditor;et!=null&&et.isEditable&&setTimeout(()=>{const nt=et.state.selection;nt&&et.commands.deleteRange({from:nt.from,to:nt.to})},10)}return!1},paste:(_,_e)=>{var et;const nt=(et=_e.clipboardData)===null||et===void 0?void 0:et.getData("text/html");return h=_e,c=!!(nt!=null&&nt.includes("data-pm-slice")),!1}}},appendTransaction:(_,_e,et)=>{const nt=_[0],rt=nt.getMeta("uiEvent")==="paste"&&!c,it=nt.getMeta("uiEvent")==="drop"&&!d,st=nt.getMeta("applyPasteRules"),lt=!!st;if(!rt&&!it&&!lt)return;if(lt){let{text:ut}=st;typeof ut=="string"?ut=ut:ut=getHTMLFromFragment(Fragment.from(ut),et.schema);const{from:at}=st,dt=at+ut.length,ft=createClipboardPasteEvent(ut);return b({rule:$,state:et,from:at,to:{b:dt},pasteEvt:ft})}const ot=_e.doc.content.findDiffStart(et.doc.content),ct=_e.doc.content.findDiffEnd(et.doc.content);if(!(!isNumber(ot)||!ct||ot===ct.b))return b({rule:$,state:et,from:ot,to:ct,pasteEvt:h})}}))}function findDuplicates(s){const e=s.filter((o,a)=>s.indexOf(o)!==a);return Array.from(new Set(e))}class ExtensionManager{constructor(e,o){this.splittableMarks=[],this.editor=o,this.extensions=ExtensionManager.resolve(e),this.schema=getSchemaByResolvedExtensions(this.extensions,o),this.setupExtensions()}static resolve(e){const o=ExtensionManager.sort(ExtensionManager.flatten(e)),a=findDuplicates(o.map(c=>c.name));return a.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${a.map(c=>`'${c}'`).join(", ")}]. This can lead to issues.`),o}static flatten(e){return e.map(o=>{const a={name:o.name,options:o.options,storage:o.storage},c=getExtensionField(o,"addExtensions",a);return c?[o,...this.flatten(c())]:o}).flat(10)}static sort(e){return e.sort((a,c)=>{const d=getExtensionField(a,"priority")||100,h=getExtensionField(c,"priority")||100;return d>h?-1:d<h?1:0})}get commands(){return this.extensions.reduce((e,o)=>{const a={name:o.name,options:o.options,storage:o.storage,editor:this.editor,type:getSchemaTypeByName(o.name,this.schema)},c=getExtensionField(o,"addCommands",a);return c?{...e,...c()}:e},{})}get plugins(){const{editor:e}=this,o=ExtensionManager.sort([...this.extensions].reverse()),a=[],c=[],d=o.map(h=>{const g={name:h.name,options:h.options,storage:h.storage,editor:e,type:getSchemaTypeByName(h.name,this.schema)},b=[],j=getExtensionField(h,"addKeyboardShortcuts",g);let $={};if(h.type==="mark"&&getExtensionField(h,"exitable",g)&&($.ArrowRight=()=>Mark.handleExit({editor:e,mark:h})),j){const rt=Object.fromEntries(Object.entries(j()).map(([it,st])=>[it,()=>st({editor:e})]));$={...$,...rt}}const _=keymap$1($);b.push(_);const _e=getExtensionField(h,"addInputRules",g);isExtensionRulesEnabled(h,e.options.enableInputRules)&&_e&&a.push(..._e());const et=getExtensionField(h,"addPasteRules",g);isExtensionRulesEnabled(h,e.options.enablePasteRules)&&et&&c.push(...et());const nt=getExtensionField(h,"addProseMirrorPlugins",g);if(nt){const rt=nt();b.push(...rt)}return b}).flat();return[inputRulesPlugin({editor:e,rules:a}),...pasteRulesPlugin({editor:e,rules:c}),...d]}get attributes(){return getAttributesFromExtensions(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:o}=splitExtensions(this.extensions);return Object.fromEntries(o.filter(a=>!!getExtensionField(a,"addNodeView")).map(a=>{const c=this.attributes.filter(b=>b.type===a.name),d={name:a.name,options:a.options,storage:a.storage,editor:e,type:getNodeType(a.name,this.schema)},h=getExtensionField(a,"addNodeView",d);if(!h)return[];const g=(b,j,$,_,_e)=>{const et=getRenderedAttributes(b,c);return h()({node:b,view:j,getPos:$,decorations:_,innerDecorations:_e,editor:e,extension:a,HTMLAttributes:et})};return[a.name,g]}))}setupExtensions(){this.extensions.forEach(e=>{var o;this.editor.extensionStorage[e.name]=e.storage;const a={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:getSchemaTypeByName(e.name,this.schema)};e.type==="mark"&&(!((o=callOrReturn(getExtensionField(e,"keepOnSplit",a)))!==null&&o!==void 0)||o)&&this.splittableMarks.push(e.name);const c=getExtensionField(e,"onBeforeCreate",a),d=getExtensionField(e,"onCreate",a),h=getExtensionField(e,"onUpdate",a),g=getExtensionField(e,"onSelectionUpdate",a),b=getExtensionField(e,"onTransaction",a),j=getExtensionField(e,"onFocus",a),$=getExtensionField(e,"onBlur",a),_=getExtensionField(e,"onDestroy",a);c&&this.editor.on("beforeCreate",c),d&&this.editor.on("create",d),h&&this.editor.on("update",h),g&&this.editor.on("selectionUpdate",g),b&&this.editor.on("transaction",b),j&&this.editor.on("focus",j),$&&this.editor.on("blur",$),_&&this.editor.on("destroy",_)})}}class Extension{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Extension(e)}configure(e={}){const o=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return o.name=this.name,o.parent=this.parent,o}extend(e={}){const o=new Extension({...this.config,...e});return o.parent=this,this.child=o,o.name=e.name?e.name:o.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${o.name}".`),o.options=callOrReturn(getExtensionField(o,"addOptions",{name:o.name})),o.storage=callOrReturn(getExtensionField(o,"addStorage",{name:o.name,options:o.options})),o}}function getTextBetween(s,e,o){const{from:a,to:c}=e,{blockSeparator:d=`

`,textSerializers:h={}}=o||{};let g="";return s.nodesBetween(a,c,(b,j,$,_)=>{var _e;b.isBlock&&j>a&&(g+=d);const et=h==null?void 0:h[b.type.name];if(et)return $&&(g+=et({node:b,pos:j,parent:$,index:_,range:e})),!1;b.isText&&(g+=(_e=b==null?void 0:b.text)===null||_e===void 0?void 0:_e.slice(Math.max(a,j)-j,c-j))}),g}function getTextSerializersFromSchema(s){return Object.fromEntries(Object.entries(s.nodes).filter(([,e])=>e.spec.toText).map(([e,o])=>[e,o.spec.toText]))}const ClipboardTextSerializer=Extension.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:s}=this,{state:e,schema:o}=s,{doc:a,selection:c}=e,{ranges:d}=c,h=Math.min(...d.map($=>$.$from.pos)),g=Math.max(...d.map($=>$.$to.pos)),b=getTextSerializersFromSchema(o);return getTextBetween(a,{from:h,to:g},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:b})}}})]}}),blur=()=>({editor:s,view:e})=>(requestAnimationFrame(()=>{var o;s.isDestroyed||(e.dom.blur(),(o=window==null?void 0:window.getSelection())===null||o===void 0||o.removeAllRanges())}),!0),clearContent=(s=!1)=>({commands:e})=>e.setContent("",s),clearNodes=()=>({state:s,tr:e,dispatch:o})=>{const{selection:a}=e,{ranges:c}=a;return o&&c.forEach(({$from:d,$to:h})=>{s.doc.nodesBetween(d.pos,h.pos,(g,b)=>{if(g.type.isText)return;const{doc:j,mapping:$}=e,_=j.resolve($.map(b)),_e=j.resolve($.map(b+g.nodeSize)),et=_.blockRange(_e);if(!et)return;const nt=liftTarget(et);if(g.type.isTextblock){const{defaultType:rt}=_.parent.contentMatchAt(_.index());e.setNodeMarkup(et.start,rt)}(nt||nt===0)&&e.lift(et,nt)})}),!0},command$1=s=>e=>s(e),createParagraphNear=()=>({state:s,dispatch:e})=>createParagraphNear$1(s,e),cut=(s,e)=>({editor:o,tr:a})=>{const{state:c}=o,d=c.doc.slice(s.from,s.to);a.deleteRange(s.from,s.to);const h=a.mapping.map(e);return a.insert(h,d.content),a.setSelection(new TextSelection(a.doc.resolve(Math.max(h-1,0)))),!0},deleteCurrentNode=()=>({tr:s,dispatch:e})=>{const{selection:o}=s,a=o.$anchor.node();if(a.content.size>0)return!1;const c=s.selection.$anchor;for(let d=c.depth;d>0;d-=1)if(c.node(d).type===a.type){if(e){const g=c.before(d),b=c.after(d);s.delete(g,b).scrollIntoView()}return!0}return!1},deleteNode=s=>({tr:e,state:o,dispatch:a})=>{const c=getNodeType(s,o.schema),d=e.selection.$anchor;for(let h=d.depth;h>0;h-=1)if(d.node(h).type===c){if(a){const b=d.before(h),j=d.after(h);e.delete(b,j).scrollIntoView()}return!0}return!1},deleteRange=s=>({tr:e,dispatch:o})=>{const{from:a,to:c}=s;return o&&e.delete(a,c),!0},deleteSelection=()=>({state:s,dispatch:e})=>deleteSelection$1(s,e),enter=()=>({commands:s})=>s.keyboardShortcut("Enter"),exitCode=()=>({state:s,dispatch:e})=>exitCode$1(s,e);function objectIncludes(s,e,o={strict:!0}){const a=Object.keys(e);return a.length?a.every(c=>o.strict?e[c]===s[c]:isRegExp(e[c])?e[c].test(s[c]):e[c]===s[c]):!0}function findMarkInSet(s,e,o={}){return s.find(a=>a.type===e&&objectIncludes(Object.fromEntries(Object.keys(o).map(c=>[c,a.attrs[c]])),o))}function isMarkInSet(s,e,o={}){return!!findMarkInSet(s,e,o)}function getMarkRange(s,e,o){var a;if(!s||!e)return;let c=s.parent.childAfter(s.parentOffset);if((!c.node||!c.node.marks.some($=>$.type===e))&&(c=s.parent.childBefore(s.parentOffset)),!c.node||!c.node.marks.some($=>$.type===e)||(o=o||((a=c.node.marks[0])===null||a===void 0?void 0:a.attrs),!findMarkInSet([...c.node.marks],e,o)))return;let h=c.index,g=s.start()+c.offset,b=h+1,j=g+c.node.nodeSize;for(;h>0&&isMarkInSet([...s.parent.child(h-1).marks],e,o);)h-=1,g-=s.parent.child(h).nodeSize;for(;b<s.parent.childCount&&isMarkInSet([...s.parent.child(b).marks],e,o);)j+=s.parent.child(b).nodeSize,b+=1;return{from:g,to:j}}function getMarkType(s,e){if(typeof s=="string"){if(!e.marks[s])throw Error(`There is no mark type named '${s}'. Maybe you forgot to add the extension?`);return e.marks[s]}return s}const extendMarkRange=(s,e={})=>({tr:o,state:a,dispatch:c})=>{const d=getMarkType(s,a.schema),{doc:h,selection:g}=o,{$from:b,from:j,to:$}=g;if(c){const _=getMarkRange(b,d,e);if(_&&_.from<=j&&_.to>=$){const _e=TextSelection.create(h,_.from,_.to);o.setSelection(_e)}}return!0},first=s=>e=>{const o=typeof s=="function"?s(e):s;for(let a=0;a<o.length;a+=1)if(o[a](e))return!0;return!1};function isTextSelection(s){return s instanceof TextSelection}function minMax(s=0,e=0,o=0){return Math.min(Math.max(s,e),o)}function resolveFocusPosition(s,e=null){if(!e)return null;const o=Selection$2.atStart(s),a=Selection$2.atEnd(s);if(e==="start"||e===!0)return o;if(e==="end")return a;const c=o.from,d=a.to;return e==="all"?TextSelection.create(s,minMax(0,c,d),minMax(s.content.size,c,d)):TextSelection.create(s,minMax(e,c,d),minMax(e,c,d))}function isAndroid(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isSafari(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}const focus=(s=null,e={})=>({editor:o,view:a,tr:c,dispatch:d})=>{e={scrollIntoView:!0,...e};const h=()=>{(isiOS()||isAndroid())&&a.dom.focus(),requestAnimationFrame(()=>{o.isDestroyed||(a.focus(),isSafari()&&!isiOS()&&!isAndroid()&&a.dom.focus({preventScroll:!0}))})};if(a.hasFocus()&&s===null||s===!1)return!0;if(d&&s===null&&!isTextSelection(o.state.selection))return h(),!0;const g=resolveFocusPosition(c.doc,s)||o.state.selection,b=o.state.selection.eq(g);return d&&(b||c.setSelection(g),b&&c.storedMarks&&c.setStoredMarks(c.storedMarks),h()),!0},forEach=(s,e)=>o=>s.every((a,c)=>e(a,{...o,index:c})),insertContent=(s,e)=>({tr:o,commands:a})=>a.insertContentAt({from:o.selection.from,to:o.selection.to},s,e),removeWhitespaces=s=>{const e=s.childNodes;for(let o=e.length-1;o>=0;o-=1){const a=e[o];a.nodeType===3&&a.nodeValue&&/^(\n\s\s|\n)$/.test(a.nodeValue)?s.removeChild(a):a.nodeType===1&&removeWhitespaces(a)}return s};function elementFromString(s){const e=`<body>${s}</body>`,o=new window.DOMParser().parseFromString(e,"text/html").body;return removeWhitespaces(o)}function createNodeFromContent(s,e,o){if(s instanceof Node$1||s instanceof Fragment)return s;o={slice:!0,parseOptions:{},...o};const a=typeof s=="object"&&s!==null,c=typeof s=="string";if(a)try{if(Array.isArray(s)&&s.length>0)return Fragment.fromArray(s.map(g=>e.nodeFromJSON(g)));const h=e.nodeFromJSON(s);return o.errorOnInvalidContent&&h.check(),h}catch(d){if(o.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",s,"Error:",d),createNodeFromContent("",e,o)}if(c){if(o.errorOnInvalidContent){let h=!1,g="";const b=new Schema({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:j=>(h=!0,g=typeof j=="string"?j:j.outerHTML,null)}]}})});if(o.slice?DOMParser.fromSchema(b).parseSlice(elementFromString(s),o.parseOptions):DOMParser.fromSchema(b).parse(elementFromString(s),o.parseOptions),o.errorOnInvalidContent&&h)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${g}`)})}const d=DOMParser.fromSchema(e);return o.slice?d.parseSlice(elementFromString(s),o.parseOptions).content:d.parse(elementFromString(s),o.parseOptions)}return createNodeFromContent("",e,o)}function selectionToInsertionEnd(s,e,o){const a=s.steps.length-1;if(a<e)return;const c=s.steps[a];if(!(c instanceof ReplaceStep||c instanceof ReplaceAroundStep))return;const d=s.mapping.maps[a];let h=0;d.forEach((g,b,j,$)=>{h===0&&(h=$)}),s.setSelection(Selection$2.near(s.doc.resolve(h),o))}const isFragment=s=>!("type"in s),insertContentAt=(s,e,o)=>({tr:a,dispatch:c,editor:d})=>{var h;if(c){o={parseOptions:d.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...o};let g;const b=it=>{d.emit("contentError",{editor:d,error:it,disableCollaboration:()=>{d.storage.collaboration&&(d.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...o.parseOptions};if(!o.errorOnInvalidContent&&!d.options.enableContentCheck&&d.options.emitContentError)try{createNodeFromContent(e,d.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(it){b(it)}try{g=createNodeFromContent(e,d.schema,{parseOptions:j,errorOnInvalidContent:(h=o.errorOnInvalidContent)!==null&&h!==void 0?h:d.options.enableContentCheck})}catch(it){return b(it),!1}let{from:$,to:_}=typeof s=="number"?{from:s,to:s}:{from:s.from,to:s.to},_e=!0,et=!0;if((isFragment(g)?g:[g]).forEach(it=>{it.check(),_e=_e?it.isText&&it.marks.length===0:!1,et=et?it.isBlock:!1}),$===_&&et){const{parent:it}=a.doc.resolve($);it.isTextblock&&!it.type.spec.code&&!it.childCount&&($-=1,_+=1)}let rt;if(_e){if(Array.isArray(e))rt=e.map(it=>it.text||"").join("");else if(e instanceof Fragment){let it="";e.forEach(st=>{st.text&&(it+=st.text)}),rt=it}else typeof e=="object"&&e&&e.text?rt=e.text:rt=e;a.insertText(rt,$,_)}else rt=g,a.replaceWith($,_,rt);o.updateSelection&&selectionToInsertionEnd(a,a.steps.length-1,-1),o.applyInputRules&&a.setMeta("applyInputRules",{from:$,text:rt}),o.applyPasteRules&&a.setMeta("applyPasteRules",{from:$,text:rt})}return!0},joinUp=()=>({state:s,dispatch:e})=>joinUp$1(s,e),joinDown=()=>({state:s,dispatch:e})=>joinDown$1(s,e),joinBackward=()=>({state:s,dispatch:e})=>joinBackward$1(s,e),joinForward=()=>({state:s,dispatch:e})=>joinForward$1(s,e),joinItemBackward=()=>({state:s,dispatch:e,tr:o})=>{try{const a=joinPoint(s.doc,s.selection.$from.pos,-1);return a==null?!1:(o.join(a,2),e&&e(o),!0)}catch{return!1}},joinItemForward=()=>({state:s,dispatch:e,tr:o})=>{try{const a=joinPoint(s.doc,s.selection.$from.pos,1);return a==null?!1:(o.join(a,2),e&&e(o),!0)}catch{return!1}},joinTextblockBackward=()=>({state:s,dispatch:e})=>joinTextblockBackward$1(s,e),joinTextblockForward=()=>({state:s,dispatch:e})=>joinTextblockForward$1(s,e);function isMacOS(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function normalizeKeyName$1(s){const e=s.split(/-(?!$)/);let o=e[e.length-1];o==="Space"&&(o=" ");let a,c,d,h;for(let g=0;g<e.length-1;g+=1){const b=e[g];if(/^(cmd|meta|m)$/i.test(b))h=!0;else if(/^a(lt)?$/i.test(b))a=!0;else if(/^(c|ctrl|control)$/i.test(b))c=!0;else if(/^s(hift)?$/i.test(b))d=!0;else if(/^mod$/i.test(b))isiOS()||isMacOS()?h=!0:c=!0;else throw new Error(`Unrecognized modifier name: ${b}`)}return a&&(o=`Alt-${o}`),c&&(o=`Ctrl-${o}`),h&&(o=`Meta-${o}`),d&&(o=`Shift-${o}`),o}const keyboardShortcut=s=>({editor:e,view:o,tr:a,dispatch:c})=>{const d=normalizeKeyName$1(s).split(/-(?!$)/),h=d.find(j=>!["Alt","Ctrl","Meta","Shift"].includes(j)),g=new KeyboardEvent("keydown",{key:h==="Space"?" ":h,altKey:d.includes("Alt"),ctrlKey:d.includes("Ctrl"),metaKey:d.includes("Meta"),shiftKey:d.includes("Shift"),bubbles:!0,cancelable:!0}),b=e.captureTransaction(()=>{o.someProp("handleKeyDown",j=>j(o,g))});return b==null||b.steps.forEach(j=>{const $=j.map(a.mapping);$&&c&&a.maybeStep($)}),!0};function isNodeActive(s,e,o={}){const{from:a,to:c,empty:d}=s.selection,h=e?getNodeType(e,s.schema):null,g=[];s.doc.nodesBetween(a,c,(_,_e)=>{if(_.isText)return;const et=Math.max(a,_e),nt=Math.min(c,_e+_.nodeSize);g.push({node:_,from:et,to:nt})});const b=c-a,j=g.filter(_=>h?h.name===_.node.type.name:!0).filter(_=>objectIncludes(_.node.attrs,o,{strict:!1}));return d?!!j.length:j.reduce((_,_e)=>_+_e.to-_e.from,0)>=b}const lift=(s,e={})=>({state:o,dispatch:a})=>{const c=getNodeType(s,o.schema);return isNodeActive(o,c,e)?lift$1(o,a):!1},liftEmptyBlock=()=>({state:s,dispatch:e})=>liftEmptyBlock$1(s,e),liftListItem=s=>({state:e,dispatch:o})=>{const a=getNodeType(s,e.schema);return liftListItem$1(a)(e,o)},newlineInCode=()=>({state:s,dispatch:e})=>newlineInCode$1(s,e);function getSchemaTypeNameByName(s,e){return e.nodes[s]?"node":e.marks[s]?"mark":null}function deleteProps(s,e){const o=typeof e=="string"?[e]:e;return Object.keys(s).reduce((a,c)=>(o.includes(c)||(a[c]=s[c]),a),{})}const resetAttributes=(s,e)=>({tr:o,state:a,dispatch:c})=>{let d=null,h=null;const g=getSchemaTypeNameByName(typeof s=="string"?s:s.name,a.schema);return g?(g==="node"&&(d=getNodeType(s,a.schema)),g==="mark"&&(h=getMarkType(s,a.schema)),c&&o.selection.ranges.forEach(b=>{a.doc.nodesBetween(b.$from.pos,b.$to.pos,(j,$)=>{d&&d===j.type&&o.setNodeMarkup($,void 0,deleteProps(j.attrs,e)),h&&j.marks.length&&j.marks.forEach(_=>{h===_.type&&o.addMark($,$+j.nodeSize,h.create(deleteProps(_.attrs,e)))})})}),!0):!1},scrollIntoView$2=()=>({tr:s,dispatch:e})=>(e&&s.scrollIntoView(),!0),selectAll$1=()=>({tr:s,dispatch:e})=>{if(e){const o=new AllSelection(s.doc);s.setSelection(o)}return!0},selectNodeBackward=()=>({state:s,dispatch:e})=>selectNodeBackward$1(s,e),selectNodeForward=()=>({state:s,dispatch:e})=>selectNodeForward$1(s,e),selectParentNode=()=>({state:s,dispatch:e})=>selectParentNode$1(s,e),selectTextblockEnd=()=>({state:s,dispatch:e})=>selectTextblockEnd$1(s,e),selectTextblockStart=()=>({state:s,dispatch:e})=>selectTextblockStart$1(s,e);function createDocument(s,e,o={},a={}){return createNodeFromContent(s,e,{slice:!1,parseOptions:o,errorOnInvalidContent:a.errorOnInvalidContent})}const setContent=(s,e=!1,o={},a={})=>({editor:c,tr:d,dispatch:h,commands:g})=>{var b,j;const{doc:$}=d;if(o.preserveWhitespace!=="full"){const _=createDocument(s,c.schema,o,{errorOnInvalidContent:(b=a.errorOnInvalidContent)!==null&&b!==void 0?b:c.options.enableContentCheck});return h&&d.replaceWith(0,$.content.size,_).setMeta("preventUpdate",!e),!0}return h&&d.setMeta("preventUpdate",!e),g.insertContentAt({from:0,to:$.content.size},s,{parseOptions:o,errorOnInvalidContent:(j=a.errorOnInvalidContent)!==null&&j!==void 0?j:c.options.enableContentCheck})};function getMarkAttributes(s,e){const o=getMarkType(e,s.schema),{from:a,to:c,empty:d}=s.selection,h=[];d?(s.storedMarks&&h.push(...s.storedMarks),h.push(...s.selection.$head.marks())):s.doc.nodesBetween(a,c,b=>{h.push(...b.marks)});const g=h.find(b=>b.type.name===o.name);return g?{...g.attrs}:{}}function combineTransactionSteps(s,e){const o=new Transform$1(s);return e.forEach(a=>{a.steps.forEach(c=>{o.step(c)})}),o}function defaultBlockAt(s){for(let e=0;e<s.edgeCount;e+=1){const{type:o}=s.edge(e);if(o.isTextblock&&!o.hasRequiredAttrs())return o}return null}function findChildrenInRange(s,e,o){const a=[];return s.nodesBetween(e.from,e.to,(c,d)=>{o(c)&&a.push({node:c,pos:d})}),a}function findParentNodeClosestToPos(s,e){for(let o=s.depth;o>0;o-=1){const a=s.node(o);if(e(a))return{pos:o>0?s.before(o):0,start:s.start(o),depth:o,node:a}}}function findParentNode(s){return e=>findParentNodeClosestToPos(e.$from,s)}function getText(s,e){const o={from:0,to:s.content.size};return getTextBetween(s,o,e)}function getNodeAttributes(s,e){const o=getNodeType(e,s.schema),{from:a,to:c}=s.selection,d=[];s.doc.nodesBetween(a,c,g=>{d.push(g)});const h=d.reverse().find(g=>g.type.name===o.name);return h?{...h.attrs}:{}}function getAttributes(s,e){const o=getSchemaTypeNameByName(typeof e=="string"?e:e.name,s.schema);return o==="node"?getNodeAttributes(s,e):o==="mark"?getMarkAttributes(s,e):{}}function removeDuplicates(s,e=JSON.stringify){const o={};return s.filter(a=>{const c=e(a);return Object.prototype.hasOwnProperty.call(o,c)?!1:o[c]=!0})}function simplifyChangedRanges(s){const e=removeDuplicates(s);return e.length===1?e:e.filter((o,a)=>!e.filter((d,h)=>h!==a).some(d=>o.oldRange.from>=d.oldRange.from&&o.oldRange.to<=d.oldRange.to&&o.newRange.from>=d.newRange.from&&o.newRange.to<=d.newRange.to))}function getChangedRanges(s){const{mapping:e,steps:o}=s,a=[];return e.maps.forEach((c,d)=>{const h=[];if(c.ranges.length)c.forEach((g,b)=>{h.push({from:g,to:b})});else{const{from:g,to:b}=o[d];if(g===void 0||b===void 0)return;h.push({from:g,to:b})}h.forEach(({from:g,to:b})=>{const j=e.slice(d).map(g,-1),$=e.slice(d).map(b),_=e.invert().map(j,-1),_e=e.invert().map($);a.push({oldRange:{from:_,to:_e},newRange:{from:j,to:$}})})}),simplifyChangedRanges(a)}function getMarksBetween(s,e,o){const a=[];return s===e?o.resolve(s).marks().forEach(c=>{const d=o.resolve(s),h=getMarkRange(d,c.type);h&&a.push({mark:c,...h})}):o.nodesBetween(s,e,(c,d)=>{!c||(c==null?void 0:c.nodeSize)===void 0||a.push(...c.marks.map(h=>({from:d,to:d+c.nodeSize,mark:h})))}),a}function getSplittedAttributes(s,e,o){return Object.fromEntries(Object.entries(o).filter(([a])=>{const c=s.find(d=>d.type===e&&d.name===a);return c?c.attribute.keepOnSplit:!1}))}function isMarkActive(s,e,o={}){const{empty:a,ranges:c}=s.selection,d=e?getMarkType(e,s.schema):null;if(a)return!!(s.storedMarks||s.selection.$from.marks()).filter(_=>d?d.name===_.type.name:!0).find(_=>objectIncludes(_.attrs,o,{strict:!1}));let h=0;const g=[];if(c.forEach(({$from:_,$to:_e})=>{const et=_.pos,nt=_e.pos;s.doc.nodesBetween(et,nt,(rt,it)=>{if(!rt.isText&&!rt.marks.length)return;const st=Math.max(et,it),lt=Math.min(nt,it+rt.nodeSize),ot=lt-st;h+=ot,g.push(...rt.marks.map(ct=>({mark:ct,from:st,to:lt})))})}),h===0)return!1;const b=g.filter(_=>d?d.name===_.mark.type.name:!0).filter(_=>objectIncludes(_.mark.attrs,o,{strict:!1})).reduce((_,_e)=>_+_e.to-_e.from,0),j=g.filter(_=>d?_.mark.type!==d&&_.mark.type.excludes(d):!0).reduce((_,_e)=>_+_e.to-_e.from,0);return(b>0?b+j:b)>=h}function isActive(s,e,o={}){if(!e)return isNodeActive(s,null,o)||isMarkActive(s,null,o);const a=getSchemaTypeNameByName(e,s.schema);return a==="node"?isNodeActive(s,e,o):a==="mark"?isMarkActive(s,e,o):!1}function isList(s,e){const{nodeExtensions:o}=splitExtensions(e),a=o.find(h=>h.name===s);if(!a)return!1;const c={name:a.name,options:a.options,storage:a.storage},d=callOrReturn(getExtensionField(a,"group",c));return typeof d!="string"?!1:d.split(" ").includes("list")}function isNodeEmpty(s,{checkChildren:e=!0,ignoreWhitespace:o=!1}={}){var a;if(o){if(s.type.name==="hardBreak")return!0;if(s.isText)return/^\s*$/m.test((a=s.text)!==null&&a!==void 0?a:"")}if(s.isText)return!s.text;if(s.isAtom||s.isLeaf)return!1;if(s.content.childCount===0)return!0;if(e){let c=!0;return s.content.forEach(d=>{c!==!1&&(isNodeEmpty(d,{ignoreWhitespace:o,checkChildren:e})||(c=!1))}),c}return!1}function isNodeSelection(s){return s instanceof NodeSelection}function canSetMark(s,e,o){var a;const{selection:c}=e;let d=null;if(isTextSelection(c)&&(d=c.$cursor),d){const g=(a=s.storedMarks)!==null&&a!==void 0?a:d.marks();return!!o.isInSet(g)||!g.some(b=>b.type.excludes(o))}const{ranges:h}=c;return h.some(({$from:g,$to:b})=>{let j=g.depth===0?s.doc.inlineContent&&s.doc.type.allowsMarkType(o):!1;return s.doc.nodesBetween(g.pos,b.pos,($,_,_e)=>{if(j)return!1;if($.isInline){const et=!_e||_e.type.allowsMarkType(o),nt=!!o.isInSet($.marks)||!$.marks.some(rt=>rt.type.excludes(o));j=et&&nt}return!j}),j})}const setMark=(s,e={})=>({tr:o,state:a,dispatch:c})=>{const{selection:d}=o,{empty:h,ranges:g}=d,b=getMarkType(s,a.schema);if(c)if(h){const j=getMarkAttributes(a,b);o.addStoredMark(b.create({...j,...e}))}else g.forEach(j=>{const $=j.$from.pos,_=j.$to.pos;a.doc.nodesBetween($,_,(_e,et)=>{const nt=Math.max(et,$),rt=Math.min(et+_e.nodeSize,_);_e.marks.find(st=>st.type===b)?_e.marks.forEach(st=>{b===st.type&&o.addMark(nt,rt,b.create({...st.attrs,...e}))}):o.addMark(nt,rt,b.create(e))})});return canSetMark(a,o,b)},setMeta=(s,e)=>({tr:o})=>(o.setMeta(s,e),!0),setNode=(s,e={})=>({state:o,dispatch:a,chain:c})=>{const d=getNodeType(s,o.schema);let h;return o.selection.$anchor.sameParent(o.selection.$head)&&(h=o.selection.$anchor.parent.attrs),d.isTextblock?c().command(({commands:g})=>setBlockType(d,{...h,...e})(o)?!0:g.clearNodes()).command(({state:g})=>setBlockType(d,{...h,...e})(g,a)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection=s=>({tr:e,dispatch:o})=>{if(o){const{doc:a}=e,c=minMax(s,0,a.content.size),d=NodeSelection.create(a,c);e.setSelection(d)}return!0},setTextSelection=s=>({tr:e,dispatch:o})=>{if(o){const{doc:a}=e,{from:c,to:d}=typeof s=="number"?{from:s,to:s}:s,h=TextSelection.atStart(a).from,g=TextSelection.atEnd(a).to,b=minMax(c,h,g),j=minMax(d,h,g),$=TextSelection.create(a,b,j);e.setSelection($)}return!0},sinkListItem=s=>({state:e,dispatch:o})=>{const a=getNodeType(s,e.schema);return sinkListItem$1(a)(e,o)};function ensureMarks(s,e){const o=s.storedMarks||s.selection.$to.parentOffset&&s.selection.$from.marks();if(o){const a=o.filter(c=>e==null?void 0:e.includes(c.type.name));s.tr.ensureMarks(a)}}const splitBlock=({keepMarks:s=!0}={})=>({tr:e,state:o,dispatch:a,editor:c})=>{const{selection:d,doc:h}=e,{$from:g,$to:b}=d,j=c.extensionManager.attributes,$=getSplittedAttributes(j,g.node().type.name,g.node().attrs);if(d instanceof NodeSelection&&d.node.isBlock)return!g.parentOffset||!canSplit(h,g.pos)?!1:(a&&(s&&ensureMarks(o,c.extensionManager.splittableMarks),e.split(g.pos).scrollIntoView()),!0);if(!g.parent.isBlock)return!1;const _=b.parentOffset===b.parent.content.size,_e=g.depth===0?void 0:defaultBlockAt(g.node(-1).contentMatchAt(g.indexAfter(-1)));let et=_&&_e?[{type:_e,attrs:$}]:void 0,nt=canSplit(e.doc,e.mapping.map(g.pos),1,et);if(!et&&!nt&&canSplit(e.doc,e.mapping.map(g.pos),1,_e?[{type:_e}]:void 0)&&(nt=!0,et=_e?[{type:_e,attrs:$}]:void 0),a){if(nt&&(d instanceof TextSelection&&e.deleteSelection(),e.split(e.mapping.map(g.pos),1,et),_e&&!_&&!g.parentOffset&&g.parent.type!==_e)){const rt=e.mapping.map(g.before()),it=e.doc.resolve(rt);g.node(-1).canReplaceWith(it.index(),it.index()+1,_e)&&e.setNodeMarkup(e.mapping.map(g.before()),_e)}s&&ensureMarks(o,c.extensionManager.splittableMarks),e.scrollIntoView()}return nt},splitListItem=(s,e={})=>({tr:o,state:a,dispatch:c,editor:d})=>{var h;const g=getNodeType(s,a.schema),{$from:b,$to:j}=a.selection,$=a.selection.node;if($&&$.isBlock||b.depth<2||!b.sameParent(j))return!1;const _=b.node(-1);if(_.type!==g)return!1;const _e=d.extensionManager.attributes;if(b.parent.content.size===0&&b.node(-1).childCount===b.indexAfter(-1)){if(b.depth===2||b.node(-3).type!==g||b.index(-2)!==b.node(-2).childCount-1)return!1;if(c){let st=Fragment.empty;const lt=b.index(-1)?1:b.index(-2)?2:3;for(let ft=b.depth-lt;ft>=b.depth-3;ft-=1)st=Fragment.from(b.node(ft).copy(st));const ot=b.indexAfter(-1)<b.node(-2).childCount?1:b.indexAfter(-2)<b.node(-3).childCount?2:3,ct={...getSplittedAttributes(_e,b.node().type.name,b.node().attrs),...e},ut=((h=g.contentMatch.defaultType)===null||h===void 0?void 0:h.createAndFill(ct))||void 0;st=st.append(Fragment.from(g.createAndFill(null,ut)||void 0));const at=b.before(b.depth-(lt-1));o.replace(at,b.after(-ot),new Slice(st,4-lt,0));let dt=-1;o.doc.nodesBetween(at,o.doc.content.size,(ft,xt)=>{if(dt>-1)return!1;ft.isTextblock&&ft.content.size===0&&(dt=xt+1)}),dt>-1&&o.setSelection(TextSelection.near(o.doc.resolve(dt))),o.scrollIntoView()}return!0}const et=j.pos===b.end()?_.contentMatchAt(0).defaultType:null,nt={...getSplittedAttributes(_e,_.type.name,_.attrs),...e},rt={...getSplittedAttributes(_e,b.node().type.name,b.node().attrs),...e};o.delete(b.pos,j.pos);const it=et?[{type:g,attrs:nt},{type:et,attrs:rt}]:[{type:g,attrs:nt}];if(!canSplit(o.doc,b.pos,2))return!1;if(c){const{selection:st,storedMarks:lt}=a,{splittableMarks:ot}=d.extensionManager,ct=lt||st.$to.parentOffset&&st.$from.marks();if(o.split(b.pos,2,it).scrollIntoView(),!ct||!c)return!0;const ut=ct.filter(at=>ot.includes(at.type.name));o.ensureMarks(ut)}return!0},joinListBackwards=(s,e)=>{const o=findParentNode(h=>h.type===e)(s.selection);if(!o)return!0;const a=s.doc.resolve(Math.max(0,o.pos-1)).before(o.depth);if(a===void 0)return!0;const c=s.doc.nodeAt(a);return o.node.type===(c==null?void 0:c.type)&&canJoin(s.doc,o.pos)&&s.join(o.pos),!0},joinListForwards=(s,e)=>{const o=findParentNode(h=>h.type===e)(s.selection);if(!o)return!0;const a=s.doc.resolve(o.start).after(o.depth);if(a===void 0)return!0;const c=s.doc.nodeAt(a);return o.node.type===(c==null?void 0:c.type)&&canJoin(s.doc,a)&&s.join(a),!0},toggleList=(s,e,o,a={})=>({editor:c,tr:d,state:h,dispatch:g,chain:b,commands:j,can:$})=>{const{extensions:_,splittableMarks:_e}=c.extensionManager,et=getNodeType(s,h.schema),nt=getNodeType(e,h.schema),{selection:rt,storedMarks:it}=h,{$from:st,$to:lt}=rt,ot=st.blockRange(lt),ct=it||rt.$to.parentOffset&&rt.$from.marks();if(!ot)return!1;const ut=findParentNode(at=>isList(at.type.name,_))(rt);if(ot.depth>=1&&ut&&ot.depth-ut.depth<=1){if(ut.node.type===et)return j.liftListItem(nt);if(isList(ut.node.type.name,_)&&et.validContent(ut.node.content)&&g)return b().command(()=>(d.setNodeMarkup(ut.pos,et),!0)).command(()=>joinListBackwards(d,et)).command(()=>joinListForwards(d,et)).run()}return!o||!ct||!g?b().command(()=>$().wrapInList(et,a)?!0:j.clearNodes()).wrapInList(et,a).command(()=>joinListBackwards(d,et)).command(()=>joinListForwards(d,et)).run():b().command(()=>{const at=$().wrapInList(et,a),dt=ct.filter(ft=>_e.includes(ft.type.name));return d.ensureMarks(dt),at?!0:j.clearNodes()}).wrapInList(et,a).command(()=>joinListBackwards(d,et)).command(()=>joinListForwards(d,et)).run()},toggleMark=(s,e={},o={})=>({state:a,commands:c})=>{const{extendEmptyMarkRange:d=!1}=o,h=getMarkType(s,a.schema);return isMarkActive(a,h,e)?c.unsetMark(h,{extendEmptyMarkRange:d}):c.setMark(h,e)},toggleNode=(s,e,o={})=>({state:a,commands:c})=>{const d=getNodeType(s,a.schema),h=getNodeType(e,a.schema),g=isNodeActive(a,d,o);let b;return a.selection.$anchor.sameParent(a.selection.$head)&&(b=a.selection.$anchor.parent.attrs),g?c.setNode(h,b):c.setNode(d,{...b,...o})},toggleWrap=(s,e={})=>({state:o,commands:a})=>{const c=getNodeType(s,o.schema);return isNodeActive(o,c,e)?a.lift(c):a.wrapIn(c,e)},undoInputRule=()=>({state:s,dispatch:e})=>{const o=s.plugins;for(let a=0;a<o.length;a+=1){const c=o[a];let d;if(c.spec.isInputRules&&(d=c.getState(s))){if(e){const h=s.tr,g=d.transform;for(let b=g.steps.length-1;b>=0;b-=1)h.step(g.steps[b].invert(g.docs[b]));if(d.text){const b=h.doc.resolve(d.from).marks();h.replaceWith(d.from,d.to,s.schema.text(d.text,b))}else h.delete(d.from,d.to)}return!0}}return!1},unsetAllMarks=()=>({tr:s,dispatch:e})=>{const{selection:o}=s,{empty:a,ranges:c}=o;return a||e&&c.forEach(d=>{s.removeMark(d.$from.pos,d.$to.pos)}),!0},unsetMark=(s,e={})=>({tr:o,state:a,dispatch:c})=>{var d;const{extendEmptyMarkRange:h=!1}=e,{selection:g}=o,b=getMarkType(s,a.schema),{$from:j,empty:$,ranges:_}=g;if(!c)return!0;if($&&h){let{from:_e,to:et}=g;const nt=(d=j.marks().find(it=>it.type===b))===null||d===void 0?void 0:d.attrs,rt=getMarkRange(j,b,nt);rt&&(_e=rt.from,et=rt.to),o.removeMark(_e,et,b)}else _.forEach(_e=>{o.removeMark(_e.$from.pos,_e.$to.pos,b)});return o.removeStoredMark(b),!0},updateAttributes=(s,e={})=>({tr:o,state:a,dispatch:c})=>{let d=null,h=null;const g=getSchemaTypeNameByName(typeof s=="string"?s:s.name,a.schema);return g?(g==="node"&&(d=getNodeType(s,a.schema)),g==="mark"&&(h=getMarkType(s,a.schema)),c&&o.selection.ranges.forEach(b=>{const j=b.$from.pos,$=b.$to.pos;let _,_e,et,nt;o.selection.empty?a.doc.nodesBetween(j,$,(rt,it)=>{d&&d===rt.type&&(et=Math.max(it,j),nt=Math.min(it+rt.nodeSize,$),_=it,_e=rt)}):a.doc.nodesBetween(j,$,(rt,it)=>{it<j&&d&&d===rt.type&&(et=Math.max(it,j),nt=Math.min(it+rt.nodeSize,$),_=it,_e=rt),it>=j&&it<=$&&(d&&d===rt.type&&o.setNodeMarkup(it,void 0,{...rt.attrs,...e}),h&&rt.marks.length&&rt.marks.forEach(st=>{if(h===st.type){const lt=Math.max(it,j),ot=Math.min(it+rt.nodeSize,$);o.addMark(lt,ot,h.create({...st.attrs,...e}))}}))}),_e&&(_!==void 0&&o.setNodeMarkup(_,void 0,{..._e.attrs,...e}),h&&_e.marks.length&&_e.marks.forEach(rt=>{h===rt.type&&o.addMark(et,nt,h.create({...rt.attrs,...e}))}))}),!0):!1},wrapIn=(s,e={})=>({state:o,dispatch:a})=>{const c=getNodeType(s,o.schema);return wrapIn$1(c,e)(o,a)},wrapInList=(s,e={})=>({state:o,dispatch:a})=>{const c=getNodeType(s,o.schema);return wrapInList$1(c,e)(o,a)};var commands=Object.freeze({__proto__:null,blur,clearContent,clearNodes,command:command$1,createParagraphNear,cut,deleteCurrentNode,deleteNode,deleteRange,deleteSelection,enter,exitCode,extendMarkRange,first,focus,forEach,insertContent,insertContentAt,joinBackward,joinDown,joinForward,joinItemBackward,joinItemForward,joinTextblockBackward,joinTextblockForward,joinUp,keyboardShortcut,lift,liftEmptyBlock,liftListItem,newlineInCode,resetAttributes,scrollIntoView:scrollIntoView$2,selectAll:selectAll$1,selectNodeBackward,selectNodeForward,selectParentNode,selectTextblockEnd,selectTextblockStart,setContent,setMark,setMeta,setNode,setNodeSelection,setTextSelection,sinkListItem,splitBlock,splitListItem,toggleList,toggleMark,toggleNode,toggleWrap,undoInputRule,unsetAllMarks,unsetMark,updateAttributes,wrapIn,wrapInList});const Commands=Extension.create({name:"commands",addCommands(){return{...commands}}}),Drop=Extension.create({name:"drop",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapDrop"),props:{handleDrop:(s,e,o,a)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:o,moved:a})}}})]}}),Editable=Extension.create({name:"editable",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("editable"),props:{editable:()=>this.editor.options.editable}})]}}),focusEventsPluginKey=new PluginKey("focusEvents"),FocusEvents=Extension.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:s}=this;return[new Plugin({key:focusEventsPluginKey,props:{handleDOMEvents:{focus:(e,o)=>{s.isFocused=!0;const a=s.state.tr.setMeta("focus",{event:o}).setMeta("addToHistory",!1);return e.dispatch(a),!1},blur:(e,o)=>{s.isFocused=!1;const a=s.state.tr.setMeta("blur",{event:o}).setMeta("addToHistory",!1);return e.dispatch(a),!1}}}})]}}),Keymap=Extension.create({name:"keymap",addKeyboardShortcuts(){const s=()=>this.editor.commands.first(({commands:h})=>[()=>h.undoInputRule(),()=>h.command(({tr:g})=>{const{selection:b,doc:j}=g,{empty:$,$anchor:_}=b,{pos:_e,parent:et}=_,nt=_.parent.isTextblock&&_e>0?g.doc.resolve(_e-1):_,rt=nt.parent.type.spec.isolating,it=_.pos-_.parentOffset,st=rt&&nt.parent.childCount===1?it===_.pos:Selection$2.atStart(j).from===_e;return!$||!et.type.isTextblock||et.textContent.length||!st||st&&_.parent.type.name==="paragraph"?!1:h.clearNodes()}),()=>h.deleteSelection(),()=>h.joinBackward(),()=>h.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:h})=>[()=>h.deleteSelection(),()=>h.deleteCurrentNode(),()=>h.joinForward(),()=>h.selectNodeForward()]),a={Enter:()=>this.editor.commands.first(({commands:h})=>[()=>h.newlineInCode(),()=>h.createParagraphNear(),()=>h.liftEmptyBlock(),()=>h.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:s,"Mod-Backspace":s,"Shift-Backspace":s,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},c={...a},d={...a,"Ctrl-h":s,"Alt-Backspace":s,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?d:c},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clearDocument"),appendTransaction:(s,e,o)=>{if(s.some(rt=>rt.getMeta("composition")))return;const a=s.some(rt=>rt.docChanged)&&!e.doc.eq(o.doc),c=s.some(rt=>rt.getMeta("preventClearDocument"));if(!a||c)return;const{empty:d,from:h,to:g}=e.selection,b=Selection$2.atStart(e.doc).from,j=Selection$2.atEnd(e.doc).to;if(d||!(h===b&&g===j)||!isNodeEmpty(o.doc))return;const _e=o.tr,et=createChainableState({state:o,transaction:_e}),{commands:nt}=new CommandManager({editor:this.editor,state:et});if(nt.clearNodes(),!!_e.steps.length)return _e}})]}}),Paste=Extension.create({name:"paste",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapPaste"),props:{handlePaste:(s,e,o)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:o})}}})]}}),Tabindex=Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class NodePos{get name(){return this.node.type.name}constructor(e,o,a=!1,c=null){this.currentNode=null,this.actualDepth=null,this.isBlock=a,this.resolvedPos=e,this.editor=o,this.currentNode=c}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let o=this.from,a=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}o=this.from+1,a=this.to-1}this.editor.commands.insertContentAt({from:o,to:a},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),o=this.resolvedPos.doc.resolve(e);return new NodePos(o,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new NodePos(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new NodePos(e,this.editor)}get children(){const e=[];return this.node.content.forEach((o,a)=>{const c=o.isBlock&&!o.isTextblock,d=o.isAtom&&!o.isText,h=this.pos+a+(d?0:1);if(h<0||h>this.resolvedPos.doc.nodeSize-2)return;const g=this.resolvedPos.doc.resolve(h);if(!c&&g.depth<=this.depth)return;const b=new NodePos(g,this.editor,c,c?o:null);c&&(b.actualDepth=this.depth+1),e.push(new NodePos(g,this.editor,c,c?o:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,o={}){let a=null,c=this.parent;for(;c&&!a;){if(c.node.type.name===e)if(Object.keys(o).length>0){const d=c.node.attrs,h=Object.keys(o);for(let g=0;g<h.length;g+=1){const b=h[g];if(d[b]!==o[b])break}}else a=c;c=c.parent}return a}querySelector(e,o={}){return this.querySelectorAll(e,o,!0)[0]||null}querySelectorAll(e,o={},a=!1){let c=[];if(!this.children||this.children.length===0)return c;const d=Object.keys(o);return this.children.forEach(h=>{a&&c.length>0||(h.node.type.name===e&&d.every(b=>o[b]===h.node.attrs[b])&&c.push(h),!(a&&c.length>0)&&(c=c.concat(h.querySelectorAll(e,o,a))))}),c}setAttribute(e){const{tr:o}=this.editor.state;o.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(o)}}const style$1=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function createStyleTag(s,e,o){const a=document.querySelector("style[data-tiptap-style]");if(a!==null)return a;const c=document.createElement("style");return e&&c.setAttribute("nonce",e),c.setAttribute("data-tiptap-style",""),c.innerHTML=s,document.getElementsByTagName("head")[0].appendChild(c),c}class Editor extends EventEmitter{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:o})=>{throw o},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:o,slice:a,moved:c})=>this.options.onDrop(o,a,c)),this.on("paste",({event:o,slice:a})=>this.options.onPaste(o,a)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=createStyleTag(style$1,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,o=!0){this.setOptions({editable:e}),o&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,o){const a=isFunction(o)?o(e,[...this.state.plugins]):[...this.state.plugins,e],c=this.state.reconfigure({plugins:a});return this.view.updateState(c),c}unregisterPlugin(e){if(this.isDestroyed)return;const o=this.state.plugins;let a=o;if([].concat(e).forEach(d=>{const h=typeof d=="string"?`${d}$`:d.key;a=a.filter(g=>!g.key.startsWith(h))}),o.length===a.length)return;const c=this.state.reconfigure({plugins:a});return this.view.updateState(c),c}createExtensionManager(){var e,o;const c=[...this.options.enableCoreExtensions?[Editable,ClipboardTextSerializer.configure({blockSeparator:(o=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||o===void 0?void 0:o.blockSeparator}),Commands,FocusEvents,Keymap,Tabindex,Drop,Paste].filter(d=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[d.name]!==!1:!0):[],...this.options.extensions].filter(d=>["extension","node","mark"].includes(d==null?void 0:d.type));this.extensionManager=new ExtensionManager(c,this)}createCommandManager(){this.commandManager=new CommandManager({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let o;try{o=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(h){if(!(h instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(h.message))throw h;this.emit("contentError",{editor:this,error:h,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(g=>g.name!=="collaboration"),this.createExtensionManager()}}),o=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const a=resolveFocusPosition(o,this.options.autofocus);this.view=new EditorView$1(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:EditorState$1.create({doc:o,selection:a||void 0})});const c=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(c),this.createNodeViews(),this.prependClass();const d=this.view.dom;d.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const o=this.capturedTransaction;return this.capturedTransaction=null,o}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(h=>{var g;return(g=this.capturedTransaction)===null||g===void 0?void 0:g.step(h)});return}const o=this.state.apply(e),a=!this.state.selection.eq(o.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:o}),this.view.updateState(o),this.emit("transaction",{editor:this,transaction:e}),a&&this.emit("selectionUpdate",{editor:this,transaction:e});const c=e.getMeta("focus"),d=e.getMeta("blur");c&&this.emit("focus",{editor:this,event:c.event,transaction:e}),d&&this.emit("blur",{editor:this,event:d.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return getAttributes(this.state,e)}isActive(e,o){const a=typeof e=="string"?e:null,c=typeof e=="string"?o:e;return isActive(this.state,a,c)}getJSON(){return this.state.doc.toJSON()}getHTML(){return getHTMLFromFragment(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:o=`

`,textSerializers:a={}}=e||{};return getText(this.state.doc,{blockSeparator:o,textSerializers:{...getTextSerializersFromSchema(this.schema),...a}})}get isEmpty(){return isNodeEmpty(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,o){var a;return((a=this.$doc)===null||a===void 0?void 0:a.querySelector(e,o))||null}$nodes(e,o){var a;return((a=this.$doc)===null||a===void 0?void 0:a.querySelectorAll(e,o))||null}$pos(e){const o=this.state.doc.resolve(e);return new NodePos(o,this)}get $doc(){return this.$pos(0)}}function markInputRule(s){return new InputRule({find:s.find,handler:({state:e,range:o,match:a})=>{const c=callOrReturn(s.getAttributes,void 0,a);if(c===!1||c===null)return null;const{tr:d}=e,h=a[a.length-1],g=a[0];if(h){const b=g.search(/\S/),j=o.from+g.indexOf(h),$=j+h.length;if(getMarksBetween(o.from,o.to,e.doc).filter(et=>et.mark.type.excluded.find(rt=>rt===s.type&&rt!==et.mark.type)).filter(et=>et.to>j).length)return null;$<o.to&&d.delete($,o.to),j>o.from&&d.delete(o.from+b,j);const _e=o.from+b+h.length;d.addMark(o.from+b,_e,s.type.create(c||{})),d.removeStoredMark(s.type)}}})}function nodeInputRule(s){return new InputRule({find:s.find,handler:({state:e,range:o,match:a})=>{const c=callOrReturn(s.getAttributes,void 0,a)||{},{tr:d}=e,h=o.from;let g=o.to;const b=s.type.create(c);if(a[1]){const j=a[0].lastIndexOf(a[1]);let $=h+j;$>g?$=g:g=$+a[1].length;const _=a[0][a[0].length-1];d.insertText(_,h+a[0].length-1),d.replaceWith($,g,b)}else if(a[0]){const j=s.type.isInline?h:h-1;d.insert(j,s.type.create(c)).delete(d.mapping.map(h),d.mapping.map(g))}d.scrollIntoView()}})}function textblockTypeInputRule(s){return new InputRule({find:s.find,handler:({state:e,range:o,match:a})=>{const c=e.doc.resolve(o.from),d=callOrReturn(s.getAttributes,void 0,a)||{};if(!c.node(-1).canReplaceWith(c.index(-1),c.indexAfter(-1),s.type))return null;e.tr.delete(o.from,o.to).setBlockType(o.from,o.from,s.type,d)}})}function wrappingInputRule(s){return new InputRule({find:s.find,handler:({state:e,range:o,match:a,chain:c})=>{const d=callOrReturn(s.getAttributes,void 0,a)||{},h=e.tr.delete(o.from,o.to),b=h.doc.resolve(o.from).blockRange(),j=b&&findWrapping(b,s.type,d);if(!j)return null;if(h.wrap(b,j),s.keepMarks&&s.editor){const{selection:_,storedMarks:_e}=e,{splittableMarks:et}=s.editor.extensionManager,nt=_e||_.$to.parentOffset&&_.$from.marks();if(nt){const rt=nt.filter(it=>et.includes(it.type.name));h.ensureMarks(rt)}}if(s.keepAttributes){const _=s.type.name==="bulletList"||s.type.name==="orderedList"?"listItem":"taskList";c().updateAttributes(_,d).run()}const $=h.doc.resolve(o.from-1).nodeBefore;$&&$.type===s.type&&canJoin(h.doc,o.from-1)&&(!s.joinPredicate||s.joinPredicate(a,$))&&h.join(o.from-1)}})}class Node{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Node(e)}configure(e={}){const o=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,e)});return o.name=this.name,o.parent=this.parent,o}extend(e={}){const o=new Node(e);return o.parent=this,this.child=o,o.name=e.name?e.name:o.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${o.name}".`),o.options=callOrReturn(getExtensionField(o,"addOptions",{name:o.name})),o.storage=callOrReturn(getExtensionField(o,"addStorage",{name:o.name,options:o.options})),o}}function markPasteRule(s){return new PasteRule({find:s.find,handler:({state:e,range:o,match:a,pasteEvent:c})=>{const d=callOrReturn(s.getAttributes,void 0,a,c);if(d===!1||d===null)return null;const{tr:h}=e,g=a[a.length-1],b=a[0];let j=o.to;if(g){const $=b.search(/\S/),_=o.from+b.indexOf(g),_e=_+g.length;if(getMarksBetween(o.from,o.to,e.doc).filter(nt=>nt.mark.type.excluded.find(it=>it===s.type&&it!==nt.mark.type)).filter(nt=>nt.to>_).length)return null;_e<o.to&&h.delete(_e,o.to),_>o.from&&h.delete(o.from+$,_),j=o.from+$+g.length,h.addMark(o.from+$,j,s.type.create(d||{})),h.removeStoredMark(s.type)}}})}function canInsertNode(s,e){const{selection:o}=s,{$from:a}=o;if(o instanceof NodeSelection){const d=a.index();return a.parent.canReplaceWith(d,d+1,e)}let c=a.depth;for(;c>=0;){const d=a.index(c);if(a.node(c).contentMatchAt(d).matchType(e))return!0;c-=1}return!1}function getDefaultExportFromCjs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var shim={exports:{}},useSyncExternalStoreShim_production_min={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production_min;function requireUseSyncExternalStoreShim_production_min(){if(hasRequiredUseSyncExternalStoreShim_production_min)return useSyncExternalStoreShim_production_min;hasRequiredUseSyncExternalStoreShim_production_min=1;var s=React$2;function e(_,_e){return _===_e&&(_!==0||1/_===1/_e)||_!==_&&_e!==_e}var o=typeof Object.is=="function"?Object.is:e,a=s.useState,c=s.useEffect,d=s.useLayoutEffect,h=s.useDebugValue;function g(_,_e){var et=_e(),nt=a({inst:{value:et,getSnapshot:_e}}),rt=nt[0].inst,it=nt[1];return d(function(){rt.value=et,rt.getSnapshot=_e,b(rt)&&it({inst:rt})},[_,et,_e]),c(function(){return b(rt)&&it({inst:rt}),_(function(){b(rt)&&it({inst:rt})})},[_]),h(et),et}function b(_){var _e=_.getSnapshot;_=_.value;try{var et=_e();return!o(_,et)}catch{return!0}}function j(_,_e){return _e()}var $=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?j:g;return useSyncExternalStoreShim_production_min.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:$,useSyncExternalStoreShim_production_min}shim.exports=requireUseSyncExternalStoreShim_production_min();var shimExports=shim.exports;const mergeRefs=(...s)=>e=>{s.forEach(o=>{typeof o=="function"?o(e):o&&(o.current=e)})},Portals=({contentComponent:s})=>{const e=shimExports.useSyncExternalStore(s.subscribe,s.getSnapshot,s.getServerSnapshot);return React$2.createElement(React$2.Fragment,null,Object.values(e))};function getInstance(){const s=new Set;let e={};return{subscribe(o){return s.add(o),()=>{s.delete(o)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(o,a){e={...e,[o]:ReactDOM.createPortal(a.reactElement,a.element,o)},s.forEach(c=>c())},removeRenderer(o){const a={...e};delete a[o],e=a,s.forEach(c=>c())}}}class PureEditorContent extends React$2.Component{constructor(e){var o;super(e),this.editorContentRef=React$2.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((o=e.editor)===null||o===void 0)&&o.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const o=this.editorContentRef.current;o.append(...e.options.element.childNodes),e.setOptions({element:o}),e.contentComponent=getInstance(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(a=>a.hasContentComponentInitialized?a:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const o=document.createElement("div");o.append(...e.options.element.childNodes),e.setOptions({element:o})}render(){const{editor:e,innerRef:o,...a}=this.props;return React$2.createElement(React$2.Fragment,null,React$2.createElement("div",{ref:mergeRefs(o,this.editorContentRef),...a}),(e==null?void 0:e.contentComponent)&&React$2.createElement(Portals,{contentComponent:e.contentComponent}))}}const EditorContentWithKey=reactExports.forwardRef((s,e)=>{const o=React$2.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[s.editor]);return React$2.createElement(PureEditorContent,{key:o,innerRef:e,...s})}),EditorContent=React$2.memo(EditorContentWithKey);var react=function s(e,o){if(e===o)return!0;if(e&&o&&typeof e=="object"&&typeof o=="object"){if(e.constructor!==o.constructor)return!1;var a,c,d;if(Array.isArray(e)){if(a=e.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!s(e[c],o[c]))return!1;return!0}if(e instanceof Map&&o instanceof Map){if(e.size!==o.size)return!1;for(c of e.entries())if(!o.has(c[0]))return!1;for(c of e.entries())if(!s(c[1],o.get(c[0])))return!1;return!0}if(e instanceof Set&&o instanceof Set){if(e.size!==o.size)return!1;for(c of e.entries())if(!o.has(c[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(o)){if(a=e.length,a!=o.length)return!1;for(c=a;c--!==0;)if(e[c]!==o[c])return!1;return!0}if(e.constructor===RegExp)return e.source===o.source&&e.flags===o.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===o.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===o.toString();if(d=Object.keys(e),a=d.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,d[c]))return!1;for(c=a;c--!==0;){var h=d[c];if(!(h==="_owner"&&e.$$typeof)&&!s(e[h],o[h]))return!1}return!0}return e!==e&&o!==o},deepEqual=getDefaultExportFromCjs(react),withSelector={exports:{}},withSelector_production_min={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredWithSelector_production_min;function requireWithSelector_production_min(){if(hasRequiredWithSelector_production_min)return withSelector_production_min;hasRequiredWithSelector_production_min=1;var s=React$2,e=shimExports;function o(j,$){return j===$&&(j!==0||1/j===1/$)||j!==j&&$!==$}var a=typeof Object.is=="function"?Object.is:o,c=e.useSyncExternalStore,d=s.useRef,h=s.useEffect,g=s.useMemo,b=s.useDebugValue;return withSelector_production_min.useSyncExternalStoreWithSelector=function(j,$,_,_e,et){var nt=d(null);if(nt.current===null){var rt={hasValue:!1,value:null};nt.current=rt}else rt=nt.current;nt=g(function(){function st(at){if(!lt){if(lt=!0,ot=at,at=_e(at),et!==void 0&&rt.hasValue){var dt=rt.value;if(et(dt,at))return ct=dt}return ct=at}if(dt=ct,a(ot,at))return dt;var ft=_e(at);return et!==void 0&&et(dt,ft)?dt:(ot=at,ct=ft)}var lt=!1,ot,ct,ut=_===void 0?null:_;return[function(){return st($())},ut===null?void 0:function(){return st(ut())}]},[$,_,_e,et]);var it=c(j,nt[0],nt[1]);return h(function(){rt.hasValue=!0,rt.value=it},[it]),b(it),it},withSelector_production_min}withSelector.exports=requireWithSelector_production_min();var withSelectorExports=withSelector.exports;const useIsomorphicLayoutEffect$1=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect;class EditorStateManager{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const o=()=>{this.transactionNumber+=1,this.subscribers.forEach(c=>c())},a=this.editor;return a.on("transaction",o),()=>{a.off("transaction",o)}}}}function useEditorState(s){var e;const[o]=reactExports.useState(()=>new EditorStateManager(s.editor)),a=withSelectorExports.useSyncExternalStoreWithSelector(o.subscribe,o.getSnapshot,o.getServerSnapshot,s.selector,(e=s.equalityFn)!==null&&e!==void 0?e:deepEqual);return useIsomorphicLayoutEffect$1(()=>o.watch(s.editor),[s.editor,o]),reactExports.useDebugValue(a),a}const isDev=!1,isSSR=typeof window>"u",isNext=isSSR||!!(typeof window<"u"&&window.next);class EditorInstanceManager{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(o=>o())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?isSSR||isNext?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...a)=>{var c,d;return(d=(c=this.options.current).onBeforeCreate)===null||d===void 0?void 0:d.call(c,...a)},onBlur:(...a)=>{var c,d;return(d=(c=this.options.current).onBlur)===null||d===void 0?void 0:d.call(c,...a)},onCreate:(...a)=>{var c,d;return(d=(c=this.options.current).onCreate)===null||d===void 0?void 0:d.call(c,...a)},onDestroy:(...a)=>{var c,d;return(d=(c=this.options.current).onDestroy)===null||d===void 0?void 0:d.call(c,...a)},onFocus:(...a)=>{var c,d;return(d=(c=this.options.current).onFocus)===null||d===void 0?void 0:d.call(c,...a)},onSelectionUpdate:(...a)=>{var c,d;return(d=(c=this.options.current).onSelectionUpdate)===null||d===void 0?void 0:d.call(c,...a)},onTransaction:(...a)=>{var c,d;return(d=(c=this.options.current).onTransaction)===null||d===void 0?void 0:d.call(c,...a)},onUpdate:(...a)=>{var c,d;return(d=(c=this.options.current).onUpdate)===null||d===void 0?void 0:d.call(c,...a)},onContentError:(...a)=>{var c,d;return(d=(c=this.options.current).onContentError)===null||d===void 0?void 0:d.call(c,...a)},onDrop:(...a)=>{var c,d;return(d=(c=this.options.current).onDrop)===null||d===void 0?void 0:d.call(c,...a)},onPaste:(...a)=>{var c,d;return(d=(c=this.options.current).onPaste)===null||d===void 0?void 0:d.call(c,...a)}};return new Editor(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,o){return Object.keys(e).every(a=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(a)?!0:a==="extensions"&&e.extensions&&o.extensions?e.extensions.length!==o.extensions.length?!1:e.extensions.every((c,d)=>{var h;return c===((h=o.extensions)===null||h===void 0?void 0:h[d])}):e[a]===o[a])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?EditorInstanceManager.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((a,c)=>a===e[c]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,o=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){o&&o.setOptions(this.options.current);return}o&&!o.isDestroyed&&(o.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function useEditor(s={},e=[]){const o=reactExports.useRef(s);o.current=s;const[a]=reactExports.useState(()=>new EditorInstanceManager(o)),c=shimExports.useSyncExternalStore(a.subscribe,a.getEditor,a.getServerSnapshot);return reactExports.useDebugValue(c),reactExports.useEffect(a.onRender(e)),useEditorState({editor:c,selector:({transactionNumber:d})=>s.shouldRerenderOnTransaction===!1?null:s.immediatelyRender&&d===0?0:d+1}),c}const EditorContext=reactExports.createContext({editor:null});EditorContext.Consumer;const ReactNodeViewContext=reactExports.createContext({onDragStart:void 0}),useReactNodeView=()=>reactExports.useContext(ReactNodeViewContext);React$2.forwardRef((s,e)=>{const{onDragStart:o}=useReactNodeView(),a=s.as||"div";return React$2.createElement(a,{...s,ref:e,"data-node-view-wrapper":"",onDragStart:o,style:{whiteSpace:"normal",...s.style}})});const inputRegex$6=/^\s*>\s$/,Blockquote=Node.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:s}){return["blockquote",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setBlockquote:()=>({commands:s})=>s.wrapIn(this.name),toggleBlockquote:()=>({commands:s})=>s.toggleWrap(this.name),unsetBlockquote:()=>({commands:s})=>s.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[wrappingInputRule({find:inputRegex$6,type:this.type})]}}),starInputRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,starPasteRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,underscoreInputRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,underscorePasteRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Bold=Mark.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:s=>s.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:s=>s.type.name===this.name},{style:"font-weight",getAttrs:s=>/^(bold(er)?|[5-9]\d{2,})$/.test(s)&&null}]},renderHTML({HTMLAttributes:s}){return["strong",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setBold:()=>({commands:s})=>s.setMark(this.name),toggleBold:()=>({commands:s})=>s.toggleMark(this.name),unsetBold:()=>({commands:s})=>s.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[markInputRule({find:starInputRegex$1,type:this.type}),markInputRule({find:underscoreInputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex$1,type:this.type}),markPasteRule({find:underscorePasteRegex$1,type:this.type})]}}),ListItemName$1="listItem",TextStyleName$1="textStyle",inputRegex$5=/^\s*([-+*])\s$/,BulletList=Node.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:s}){return["ul",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{toggleBulletList:()=>({commands:s,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName$1,this.editor.getAttributes(TextStyleName$1)).run():s.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let s=wrappingInputRule({find:inputRegex$5,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(s=wrappingInputRule({find:inputRegex$5,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(TextStyleName$1),editor:this.editor})),[s]}}),inputRegex$4=/(^|[^`])`([^`]+)`(?!`)/,pasteRegex$2=/(^|[^`])`([^`]+)`(?!`)/g,Code=Mark.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:s}){return["code",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setCode:()=>({commands:s})=>s.setMark(this.name),toggleCode:()=>({commands:s})=>s.toggleMark(this.name),unsetCode:()=>({commands:s})=>s.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[markInputRule({find:inputRegex$4,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex$2,type:this.type})]}}),backtickInputRegex=/^```([a-z]+)?[\s\n]$/,tildeInputRegex=/^~~~([a-z]+)?[\s\n]$/,CodeBlock=Node.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:s=>{var e;const{languageClassPrefix:o}=this.options,d=[...((e=s.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(h=>h.startsWith(o)).map(h=>h.replace(o,""))[0];return d||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:s,HTMLAttributes:e}){return["pre",mergeAttributes(this.options.HTMLAttributes,e),["code",{class:s.attrs.language?this.options.languageClassPrefix+s.attrs.language:null},0]]},addCommands(){return{setCodeBlock:s=>({commands:e})=>e.setNode(this.name,s),toggleCodeBlock:s=>({commands:e})=>e.toggleNode(this.name,"paragraph",s)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:s,$anchor:e}=this.editor.state.selection,o=e.pos===1;return!s||e.parent.type.name!==this.name?!1:o||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:s})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=s,{selection:o}=e,{$from:a,empty:c}=o;if(!c||a.parent.type!==this.type)return!1;const d=a.parentOffset===a.parent.nodeSize-2,h=a.parent.textContent.endsWith(`

`);return!d||!h?!1:s.chain().command(({tr:g})=>(g.delete(a.pos-2,a.pos),!0)).exitCode().run()},ArrowDown:({editor:s})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=s,{selection:o,doc:a}=e,{$from:c,empty:d}=o;if(!d||c.parent.type!==this.type||!(c.parentOffset===c.parent.nodeSize-2))return!1;const g=c.after();return g===void 0?!1:a.nodeAt(g)?s.commands.command(({tr:j})=>(j.setSelection(Selection$2.near(a.resolve(g))),!0)):s.commands.exitCode()}}},addInputRules(){return[textblockTypeInputRule({find:backtickInputRegex,type:this.type,getAttributes:s=>({language:s[1]})}),textblockTypeInputRule({find:tildeInputRegex,type:this.type,getAttributes:s=>({language:s[1]})})]},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("codeBlockVSCodeHandler"),props:{handlePaste:(s,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const o=e.clipboardData.getData("text/plain"),a=e.clipboardData.getData("vscode-editor-data"),c=a?JSON.parse(a):void 0,d=c==null?void 0:c.mode;if(!o||!d)return!1;const{tr:h,schema:g}=s.state,b=g.text(o.replace(/\r\n?/g,`
`));return h.replaceSelectionWith(this.type.create({language:d},b)),h.selection.$from.parent.type!==this.type&&h.setSelection(TextSelection.near(h.doc.resolve(Math.max(0,h.selection.from-2)))),h.setMeta("paste",!0),s.dispatch(h),!0}}})]}}),Document=Node.create({name:"doc",topNode:!0,content:"block+"});function dropCursor(s={}){return new Plugin({view(e){return new DropCursorView(e,s)}})}class DropCursorView{constructor(e,o){var a;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(a=o.width)!==null&&a!==void 0?a:1,this.color=o.color===!1?void 0:o.color||"black",this.class=o.class,this.handlers=["dragover","dragend","drop","dragleave"].map(c=>{let d=h=>{this[c](h)};return e.dom.addEventListener(c,d),{name:c,handler:d}})}destroy(){this.handlers.forEach(({name:e,handler:o})=>this.editorView.dom.removeEventListener(e,o))}update(e,o){this.cursorPos!=null&&o.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),o=!e.parent.inlineContent,a,c=this.editorView.dom,d=c.getBoundingClientRect(),h=d.width/c.offsetWidth,g=d.height/c.offsetHeight;if(o){let _=e.nodeBefore,_e=e.nodeAfter;if(_||_e){let et=this.editorView.nodeDOM(this.cursorPos-(_?_.nodeSize:0));if(et){let nt=et.getBoundingClientRect(),rt=_?nt.bottom:nt.top;_&&_e&&(rt=(rt+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let it=this.width/2*g;a={left:nt.left,right:nt.right,top:rt-it,bottom:rt+it}}}}if(!a){let _=this.editorView.coordsAtPos(this.cursorPos),_e=this.width/2*h;a={left:_.left-_e,right:_.left+_e,top:_.top,bottom:_.bottom}}let b=this.editorView.dom.offsetParent;this.element||(this.element=b.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",o),this.element.classList.toggle("prosemirror-dropcursor-inline",!o);let j,$;if(!b||b==document.body&&getComputedStyle(b).position=="static")j=-pageXOffset,$=-pageYOffset;else{let _=b.getBoundingClientRect(),_e=_.width/b.offsetWidth,et=_.height/b.offsetHeight;j=_.left-b.scrollLeft*_e,$=_.top-b.scrollTop*et}this.element.style.left=(a.left-j)/h+"px",this.element.style.top=(a.top-$)/g+"px",this.element.style.width=(a.right-a.left)/h+"px",this.element.style.height=(a.bottom-a.top)/g+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let o=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),a=o&&o.inside>=0&&this.editorView.state.doc.nodeAt(o.inside),c=a&&a.type.spec.disableDropCursor,d=typeof c=="function"?c(this.editorView,o,e):c;if(o&&!d){let h=o.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let g=dropPoint(this.editorView.state.doc,h,this.editorView.dragging.slice);g!=null&&(h=g)}this.setCursor(h),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Dropcursor=Extension.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[dropCursor(this.options)]}});class GapCursor extends Selection$2{constructor(e){super(e,e)}map(e,o){let a=e.resolve(o.map(this.head));return GapCursor.valid(a)?new GapCursor(a):Selection$2.near(a)}content(){return Slice.empty}eq(e){return e instanceof GapCursor&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,o){if(typeof o.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(e.resolve(o.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid(e){let o=e.parent;if(o.isTextblock||!closedBefore(e)||!closedAfter(e))return!1;let a=o.type.spec.allowGapCursor;if(a!=null)return a;let c=o.contentMatchAt(e.index()).defaultType;return c&&c.isTextblock}static findGapCursorFrom(e,o,a=!1){e:for(;;){if(!a&&GapCursor.valid(e))return e;let c=e.pos,d=null;for(let h=e.depth;;h--){let g=e.node(h);if(o>0?e.indexAfter(h)<g.childCount:e.index(h)>0){d=g.child(o>0?e.indexAfter(h):e.index(h)-1);break}else if(h==0)return null;c+=o;let b=e.doc.resolve(c);if(GapCursor.valid(b))return b}for(;;){let h=o>0?d.firstChild:d.lastChild;if(!h){if(d.isAtom&&!d.isText&&!NodeSelection.isSelectable(d)){e=e.doc.resolve(c+d.nodeSize*o),a=!1;continue e}break}d=h,c+=o;let g=e.doc.resolve(c);if(GapCursor.valid(g))return g}return null}}}GapCursor.prototype.visible=!1;GapCursor.findFrom=GapCursor.findGapCursorFrom;Selection$2.jsonID("gapcursor",GapCursor);class GapBookmark{constructor(e){this.pos=e}map(e){return new GapBookmark(e.map(this.pos))}resolve(e){let o=e.resolve(this.pos);return GapCursor.valid(o)?new GapCursor(o):Selection$2.near(o)}}function needsGap(s){return s.isAtom||s.spec.isolating||s.spec.createGapCursor}function closedBefore(s){for(let e=s.depth;e>=0;e--){let o=s.index(e),a=s.node(e);if(o==0){if(a.type.spec.isolating)return!0;continue}for(let c=a.child(o-1);;c=c.lastChild){if(c.childCount==0&&!c.inlineContent||needsGap(c.type))return!0;if(c.inlineContent)return!1}}return!0}function closedAfter(s){for(let e=s.depth;e>=0;e--){let o=s.indexAfter(e),a=s.node(e);if(o==a.childCount){if(a.type.spec.isolating)return!0;continue}for(let c=a.child(o);;c=c.firstChild){if(c.childCount==0&&!c.inlineContent||needsGap(c.type))return!0;if(c.inlineContent)return!1}}return!0}function gapCursor(){return new Plugin({props:{decorations:drawGapCursor,createSelectionBetween(s,e,o){return e.pos==o.pos&&GapCursor.valid(o)?new GapCursor(o):null},handleClick,handleKeyDown:handleKeyDown$1,handleDOMEvents:{beforeinput}}})}const handleKeyDown$1=keydownHandler({ArrowLeft:arrow$1("horiz",-1),ArrowRight:arrow$1("horiz",1),ArrowUp:arrow$1("vert",-1),ArrowDown:arrow$1("vert",1)});function arrow$1(s,e){const o=s=="vert"?e>0?"down":"up":e>0?"right":"left";return function(a,c,d){let h=a.selection,g=e>0?h.$to:h.$from,b=h.empty;if(h instanceof TextSelection){if(!d.endOfTextblock(o)||g.depth==0)return!1;b=!1,g=a.doc.resolve(e>0?g.after():g.before())}let j=GapCursor.findGapCursorFrom(g,e,b);return j?(c&&c(a.tr.setSelection(new GapCursor(j))),!0):!1}}function handleClick(s,e,o){if(!s||!s.editable)return!1;let a=s.state.doc.resolve(e);if(!GapCursor.valid(a))return!1;let c=s.posAtCoords({left:o.clientX,top:o.clientY});return c&&c.inside>-1&&NodeSelection.isSelectable(s.state.doc.nodeAt(c.inside))?!1:(s.dispatch(s.state.tr.setSelection(new GapCursor(a))),!0)}function beforeinput(s,e){if(e.inputType!="insertCompositionText"||!(s.state.selection instanceof GapCursor))return!1;let{$from:o}=s.state.selection,a=o.parent.contentMatchAt(o.index()).findWrapping(s.state.schema.nodes.text);if(!a)return!1;let c=Fragment.empty;for(let h=a.length-1;h>=0;h--)c=Fragment.from(a[h].createAndFill(null,c));let d=s.state.tr.replace(o.pos,o.pos,new Slice(c,0,0));return d.setSelection(TextSelection.near(d.doc.resolve(o.pos+1))),s.dispatch(d),!1}function drawGapCursor(s){if(!(s.selection instanceof GapCursor))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",DecorationSet.create(s.doc,[Decoration$1.widget(s.selection.head,e,{key:"gapcursor"})])}const Gapcursor=Extension.create({name:"gapCursor",addProseMirrorPlugins(){return[gapCursor()]},extendNodeSchema(s){var e;const o={name:s.name,options:s.options,storage:s.storage};return{allowGapCursor:(e=callOrReturn(getExtensionField(s,"allowGapCursor",o)))!==null&&e!==void 0?e:null}}}),HardBreak=Node.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:s}){return["br",mergeAttributes(this.options.HTMLAttributes,s)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:s,chain:e,state:o,editor:a})=>s.first([()=>s.exitCode(),()=>s.command(()=>{const{selection:c,storedMarks:d}=o;if(c.$from.parent.type.spec.isolating)return!1;const{keepMarks:h}=this.options,{splittableMarks:g}=a.extensionManager,b=d||c.$to.parentOffset&&c.$from.marks();return e().insertContent({type:this.name}).command(({tr:j,dispatch:$})=>{if($&&b&&h){const _=b.filter(_e=>g.includes(_e.type.name));j.ensureMarks(_)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Heading=Node.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(s=>({tag:`h${s}`,attrs:{level:s}}))},renderHTML({node:s,HTMLAttributes:e}){return[`h${this.options.levels.includes(s.attrs.level)?s.attrs.level:this.options.levels[0]}`,mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:s=>({commands:e})=>this.options.levels.includes(s.level)?e.setNode(this.name,s):!1,toggleHeading:s=>({commands:e})=>this.options.levels.includes(s.level)?e.toggleNode(this.name,"paragraph",s):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((s,e)=>({...s,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(s=>textblockTypeInputRule({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${s}})\\s$`),type:this.type,getAttributes:{level:s}}))}});var GOOD_LEAF_SIZE=200,RopeSequence=function s(){};RopeSequence.prototype.append=function s(e){return e.length?(e=RopeSequence.from(e),!this.length&&e||e.length<GOOD_LEAF_SIZE&&this.leafAppend(e)||this.length<GOOD_LEAF_SIZE&&e.leafPrepend(this)||this.appendInner(e)):this};RopeSequence.prototype.prepend=function s(e){return e.length?RopeSequence.from(e).append(this):this};RopeSequence.prototype.appendInner=function s(e){return new Append(this,e)};RopeSequence.prototype.slice=function s(e,o){return e===void 0&&(e=0),o===void 0&&(o=this.length),e>=o?RopeSequence.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,o))};RopeSequence.prototype.get=function s(e){if(!(e<0||e>=this.length))return this.getInner(e)};RopeSequence.prototype.forEach=function s(e,o,a){o===void 0&&(o=0),a===void 0&&(a=this.length),o<=a?this.forEachInner(e,o,a,0):this.forEachInvertedInner(e,o,a,0)};RopeSequence.prototype.map=function s(e,o,a){o===void 0&&(o=0),a===void 0&&(a=this.length);var c=[];return this.forEach(function(d,h){return c.push(e(d,h))},o,a),c};RopeSequence.from=function s(e){return e instanceof RopeSequence?e:e&&e.length?new Leaf(e):RopeSequence.empty};var Leaf=function(s){function e(a){s.call(this),this.values=a}s&&(e.__proto__=s),e.prototype=Object.create(s&&s.prototype),e.prototype.constructor=e;var o={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(c,d){return c==0&&d==this.length?this:new e(this.values.slice(c,d))},e.prototype.getInner=function(c){return this.values[c]},e.prototype.forEachInner=function(c,d,h,g){for(var b=d;b<h;b++)if(c(this.values[b],g+b)===!1)return!1},e.prototype.forEachInvertedInner=function(c,d,h,g){for(var b=d-1;b>=h;b--)if(c(this.values[b],g+b)===!1)return!1},e.prototype.leafAppend=function(c){if(this.length+c.length<=GOOD_LEAF_SIZE)return new e(this.values.concat(c.flatten()))},e.prototype.leafPrepend=function(c){if(this.length+c.length<=GOOD_LEAF_SIZE)return new e(c.flatten().concat(this.values))},o.length.get=function(){return this.values.length},o.depth.get=function(){return 0},Object.defineProperties(e.prototype,o),e}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(s){function e(o,a){s.call(this),this.left=o,this.right=a,this.length=o.length+a.length,this.depth=Math.max(o.depth,a.depth)+1}return s&&(e.__proto__=s),e.prototype=Object.create(s&&s.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},e.prototype.forEachInner=function(a,c,d,h){var g=this.left.length;if(c<g&&this.left.forEachInner(a,c,Math.min(d,g),h)===!1||d>g&&this.right.forEachInner(a,Math.max(c-g,0),Math.min(this.length,d)-g,h+g)===!1)return!1},e.prototype.forEachInvertedInner=function(a,c,d,h){var g=this.left.length;if(c>g&&this.right.forEachInvertedInner(a,c-g,Math.max(d,g)-g,h+g)===!1||d<g&&this.left.forEachInvertedInner(a,Math.min(c,g),d,h)===!1)return!1},e.prototype.sliceInner=function(a,c){if(a==0&&c==this.length)return this;var d=this.left.length;return c<=d?this.left.slice(a,c):a>=d?this.right.slice(a-d,c-d):this.left.slice(a,d).append(this.right.slice(0,c-d))},e.prototype.leafAppend=function(a){var c=this.right.leafAppend(a);if(c)return new e(this.left,c)},e.prototype.leafPrepend=function(a){var c=this.left.leafPrepend(a);if(c)return new e(c,this.right)},e.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new e(this.left,new e(this.right,a)):new e(this,a)},e}(RopeSequence);const max_empty_items=500;class Branch{constructor(e,o){this.items=e,this.eventCount=o}popEvent(e,o){if(this.eventCount==0)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}let c,d;o&&(c=this.remapping(a,this.items.length),d=c.maps.length);let h=e.tr,g,b,j=[],$=[];return this.items.forEach((_,_e)=>{if(!_.step){c||(c=this.remapping(a,_e+1),d=c.maps.length),d--,$.push(_);return}if(c){$.push(new Item(_.map));let et=_.step.map(c.slice(d)),nt;et&&h.maybeStep(et).doc&&(nt=h.mapping.maps[h.mapping.maps.length-1],j.push(new Item(nt,void 0,void 0,j.length+$.length))),d--,nt&&c.appendMap(nt,d)}else h.maybeStep(_.step);if(_.selection)return g=c?_.selection.map(c.slice(d)):_.selection,b=new Branch(this.items.slice(0,a).append($.reverse().concat(j)),this.eventCount-1),!1},this.items.length,0),{remaining:b,transform:h,selection:g}}addTransform(e,o,a,c){let d=[],h=this.eventCount,g=this.items,b=!c&&g.length?g.get(g.length-1):null;for(let $=0;$<e.steps.length;$++){let _=e.steps[$].invert(e.docs[$]),_e=new Item(e.mapping.maps[$],_,o),et;(et=b&&b.merge(_e))&&(_e=et,$?d.pop():g=g.slice(0,g.length-1)),d.push(_e),o&&(h++,o=void 0),c||(b=_e)}let j=h-a.depth;return j>DEPTH_OVERFLOW&&(g=cutOffEvents(g,j),h-=j),new Branch(g.append(d),h)}remapping(e,o){let a=new Mapping;return this.items.forEach((c,d)=>{let h=c.mirrorOffset!=null&&d-c.mirrorOffset>=e?a.maps.length-c.mirrorOffset:void 0;a.appendMap(c.map,h)},e,o),a}addMaps(e){return this.eventCount==0?this:new Branch(this.items.append(e.map(o=>new Item(o))),this.eventCount)}rebased(e,o){if(!this.eventCount)return this;let a=[],c=Math.max(0,this.items.length-o),d=e.mapping,h=e.steps.length,g=this.eventCount;this.items.forEach(_e=>{_e.selection&&g--},c);let b=o;this.items.forEach(_e=>{let et=d.getMirror(--b);if(et==null)return;h=Math.min(h,et);let nt=d.maps[et];if(_e.step){let rt=e.steps[et].invert(e.docs[et]),it=_e.selection&&_e.selection.map(d.slice(b+1,et));it&&g++,a.push(new Item(nt,rt,it))}else a.push(new Item(nt))},c);let j=[];for(let _e=o;_e<h;_e++)j.push(new Item(d.maps[_e]));let $=this.items.slice(0,c).append(j).append(a),_=new Branch($,g);return _.emptyItemCount()>max_empty_items&&(_=_.compress(this.items.length-a.length)),_}emptyItemCount(){let e=0;return this.items.forEach(o=>{o.step||e++}),e}compress(e=this.items.length){let o=this.remapping(0,e),a=o.maps.length,c=[],d=0;return this.items.forEach((h,g)=>{if(g>=e)c.push(h),h.selection&&d++;else if(h.step){let b=h.step.map(o.slice(a)),j=b&&b.getMap();if(a--,j&&o.appendMap(j,a),b){let $=h.selection&&h.selection.map(o.slice(a));$&&d++;let _=new Item(j.invert(),b,$),_e,et=c.length-1;(_e=c.length&&c[et].merge(_))?c[et]=_e:c.push(_)}}else h.map&&a--},this.items.length,0),new Branch(RopeSequence.from(c.reverse()),d)}}Branch.empty=new Branch(RopeSequence.empty,0);function cutOffEvents(s,e){let o;return s.forEach((a,c)=>{if(a.selection&&e--==0)return o=c,!1}),s.slice(o)}class Item{constructor(e,o,a,c){this.map=e,this.step=o,this.selection=a,this.mirrorOffset=c}merge(e){if(this.step&&e.step&&!e.selection){let o=e.step.merge(this.step);if(o)return new Item(o.getMap().invert(),o,this.selection)}}}let HistoryState$1=class{constructor(e,o,a,c,d){this.done=e,this.undone=o,this.prevRanges=a,this.prevTime=c,this.prevComposition=d}};const DEPTH_OVERFLOW=20;function applyTransaction(s,e,o,a){let c=o.getMeta(historyKey),d;if(c)return c.historyState;o.getMeta(closeHistoryKey)&&(s=new HistoryState$1(s.done,s.undone,null,0,-1));let h=o.getMeta("appendedTransaction");if(o.steps.length==0)return s;if(h&&h.getMeta(historyKey))return h.getMeta(historyKey).redo?new HistoryState$1(s.done.addTransform(o,void 0,a,mustPreserveItems(e)),s.undone,rangesFor(o.mapping.maps),s.prevTime,s.prevComposition):new HistoryState$1(s.done,s.undone.addTransform(o,void 0,a,mustPreserveItems(e)),null,s.prevTime,s.prevComposition);if(o.getMeta("addToHistory")!==!1&&!(h&&h.getMeta("addToHistory")===!1)){let g=o.getMeta("composition"),b=s.prevTime==0||!h&&s.prevComposition!=g&&(s.prevTime<(o.time||0)-a.newGroupDelay||!isAdjacentTo(o,s.prevRanges)),j=h?mapRanges(s.prevRanges,o.mapping):rangesFor(o.mapping.maps);return new HistoryState$1(s.done.addTransform(o,b?e.selection.getBookmark():void 0,a,mustPreserveItems(e)),Branch.empty,j,o.time,g??s.prevComposition)}else return(d=o.getMeta("rebased"))?new HistoryState$1(s.done.rebased(o,d),s.undone.rebased(o,d),mapRanges(s.prevRanges,o.mapping),s.prevTime,s.prevComposition):new HistoryState$1(s.done.addMaps(o.mapping.maps),s.undone.addMaps(o.mapping.maps),mapRanges(s.prevRanges,o.mapping),s.prevTime,s.prevComposition)}function isAdjacentTo(s,e){if(!e)return!1;if(!s.docChanged)return!0;let o=!1;return s.mapping.maps[0].forEach((a,c)=>{for(let d=0;d<e.length;d+=2)a<=e[d+1]&&c>=e[d]&&(o=!0)}),o}function rangesFor(s){let e=[];for(let o=s.length-1;o>=0&&e.length==0;o--)s[o].forEach((a,c,d,h)=>e.push(d,h));return e}function mapRanges(s,e){if(!s)return null;let o=[];for(let a=0;a<s.length;a+=2){let c=e.map(s[a],1),d=e.map(s[a+1],-1);c<=d&&o.push(c,d)}return o}function histTransaction(s,e,o){let a=mustPreserveItems(e),c=historyKey.get(e).spec.config,d=(o?s.undone:s.done).popEvent(e,a);if(!d)return null;let h=d.selection.resolve(d.transform.doc),g=(o?s.done:s.undone).addTransform(d.transform,e.selection.getBookmark(),c,a),b=new HistoryState$1(o?g:d.remaining,o?d.remaining:g,null,0,-1);return d.transform.setSelection(h).setMeta(historyKey,{redo:o,historyState:b})}let cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(s){let e=s.plugins;if(cachedPreserveItemsPlugins!=e){cachedPreserveItems=!1,cachedPreserveItemsPlugins=e;for(let o=0;o<e.length;o++)if(e[o].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}const historyKey=new PluginKey("history"),closeHistoryKey=new PluginKey("closeHistory");function history$1(s={}){return s={depth:s.depth||100,newGroupDelay:s.newGroupDelay||500},new Plugin({key:historyKey,state:{init(){return new HistoryState$1(Branch.empty,Branch.empty,null,0,-1)},apply(e,o,a){return applyTransaction(o,a,e,s)}},config:s,props:{handleDOMEvents:{beforeinput(e,o){let a=o.inputType,c=a=="historyUndo"?undo$1:a=="historyRedo"?redo$1:null;return!c||!e.editable?!1:(o.preventDefault(),c(e.state,e.dispatch))}}}})}function buildCommand(s,e){return(o,a)=>{let c=historyKey.getState(o);if(!c||(s?c.undone:c.done).eventCount==0)return!1;if(a){let d=histTransaction(c,o,s);d&&a(e?d.scrollIntoView():d)}return!0}}const undo$1=buildCommand(!1,!0),redo$1=buildCommand(!0,!0),History=Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:s,dispatch:e})=>undo$1(s,e),redo:()=>({state:s,dispatch:e})=>redo$1(s,e)}},addProseMirrorPlugins(){return[history$1(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),HorizontalRule=Node.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:s}){return["hr",mergeAttributes(this.options.HTMLAttributes,s)]},addCommands(){return{setHorizontalRule:()=>({chain:s,state:e})=>{if(!canInsertNode(e,e.schema.nodes[this.name]))return!1;const{selection:o}=e,{$from:a,$to:c}=o,d=s();return a.parentOffset===0?d.insertContentAt({from:Math.max(a.pos-1,0),to:c.pos},{type:this.name}):isNodeSelection(o)?d.insertContentAt(c.pos,{type:this.name}):d.insertContent({type:this.name}),d.command(({tr:h,dispatch:g})=>{var b;if(g){const{$to:j}=h.selection,$=j.end();if(j.nodeAfter)j.nodeAfter.isTextblock?h.setSelection(TextSelection.create(h.doc,j.pos+1)):j.nodeAfter.isBlock?h.setSelection(NodeSelection.create(h.doc,j.pos)):h.setSelection(TextSelection.create(h.doc,j.pos));else{const _=(b=j.parent.type.contentMatch.defaultType)===null||b===void 0?void 0:b.create();_&&(h.insert($,_),h.setSelection(TextSelection.create(h.doc,$+1)))}h.scrollIntoView()}return!0}).run()}}},addInputRules(){return[nodeInputRule({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),starInputRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,starPasteRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,underscoreInputRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,underscorePasteRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Italic=Mark.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:s=>s.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:s=>s.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:s}){return["em",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setItalic:()=>({commands:s})=>s.setMark(this.name),toggleItalic:()=>({commands:s})=>s.toggleMark(this.name),unsetItalic:()=>({commands:s})=>s.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[markInputRule({find:starInputRegex,type:this.type}),markInputRule({find:underscoreInputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex,type:this.type}),markPasteRule({find:underscorePasteRegex,type:this.type})]}}),ListItem=Node.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:s}){return["li",mergeAttributes(this.options.HTMLAttributes,s),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ListItemName="listItem",TextStyleName="textStyle",inputRegex$3=/^(\d+)\.\s$/,OrderedList=Node.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:s=>s.hasAttribute("start")?parseInt(s.getAttribute("start")||"",10):1},type:{default:null,parseHTML:s=>s.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:s}){const{start:e,...o}=s;return e===1?["ol",mergeAttributes(this.options.HTMLAttributes,o),0]:["ol",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{toggleOrderedList:()=>({commands:s,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName,this.editor.getAttributes(TextStyleName)).run():s.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let s=wrappingInputRule({find:inputRegex$3,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,o)=>o.childCount+o.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(s=wrappingInputRule({find:inputRegex$3,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(TextStyleName)}),joinPredicate:(e,o)=>o.childCount+o.attrs.start===+e[1],editor:this.editor})),[s]}}),Paragraph=Node.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:s}){return["p",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setParagraph:()=>({commands:s})=>s.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),inputRegex$2=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,pasteRegex$1=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Strike=Mark.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:s=>s.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:s}){return["s",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setStrike:()=>({commands:s})=>s.setMark(this.name),toggleStrike:()=>({commands:s})=>s.toggleMark(this.name),unsetStrike:()=>({commands:s})=>s.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[markInputRule({find:inputRegex$2,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex$1,type:this.type})]}}),Text$2=Node.create({name:"text",group:"inline"}),StarterKit=Extension.create({name:"starterKit",addExtensions(){const s=[];return this.options.bold!==!1&&s.push(Bold.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(Blockquote.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(BulletList.configure(this.options.bulletList)),this.options.code!==!1&&s.push(Code.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(CodeBlock.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(Document.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(Dropcursor.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(Gapcursor.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(HardBreak.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(Heading.configure(this.options.heading)),this.options.history!==!1&&s.push(History.configure(this.options.history)),this.options.horizontalRule!==!1&&s.push(HorizontalRule.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(Italic.configure(this.options.italic)),this.options.listItem!==!1&&s.push(ListItem.configure(this.options.listItem)),this.options.orderedList!==!1&&s.push(OrderedList.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(Paragraph.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(Strike.configure(this.options.strike)),this.options.text!==!1&&s.push(Text$2.configure(this.options.text)),s}}),inputRegex$1=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Image=Node.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:s}){return["img",mergeAttributes(this.options.HTMLAttributes,s)]},addCommands(){return{setImage:s=>({commands:e})=>e.insertContent({type:this.name,attrs:s})}},addInputRules(){return[nodeInputRule({find:inputRegex$1,type:this.type,getAttributes:s=>{const[,,e,o,a]=s;return{src:o,alt:e,title:a}}})]}}),encodedTlds="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",encodedUtlds="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",numeric="numeric",ascii="ascii",alpha="alpha",asciinumeric="asciinumeric",alphanumeric="alphanumeric",domain="domain",emoji="emoji",scheme="scheme",slashscheme="slashscheme",whitespace="whitespace";function registerGroup(s,e){return s in e||(e[s]=[]),e[s]}function addToGroups(s,e,o){e[numeric]&&(e[asciinumeric]=!0,e[alphanumeric]=!0),e[ascii]&&(e[asciinumeric]=!0,e[alpha]=!0),e[asciinumeric]&&(e[alphanumeric]=!0),e[alpha]&&(e[alphanumeric]=!0),e[alphanumeric]&&(e[domain]=!0),e[emoji]&&(e[domain]=!0);for(const a in e){const c=registerGroup(a,o);c.indexOf(s)<0&&c.push(s)}}function flagsForToken(s,e){const o={};for(const a in e)e[a].indexOf(s)>=0&&(o[a]=!0);return o}function State(s=null){this.j={},this.jr=[],this.jd=null,this.t=s}State.groups={};State.prototype={accepts(){return!!this.t},go(s){const e=this,o=e.j[s];if(o)return o;for(let a=0;a<e.jr.length;a++){const c=e.jr[a][0],d=e.jr[a][1];if(d&&c.test(s))return d}return e.jd},has(s,e=!1){return e?s in this.j:!!this.go(s)},ta(s,e,o,a){for(let c=0;c<s.length;c++)this.tt(s[c],e,o,a)},tr(s,e,o,a){a=a||State.groups;let c;return e&&e.j?c=e:(c=new State(e),o&&a&&addToGroups(e,o,a)),this.jr.push([s,c]),c},ts(s,e,o,a){let c=this;const d=s.length;if(!d)return c;for(let h=0;h<d-1;h++)c=c.tt(s[h]);return c.tt(s[d-1],e,o,a)},tt(s,e,o,a){a=a||State.groups;const c=this;if(e&&e.j)return c.j[s]=e,e;const d=e;let h,g=c.go(s);if(g?(h=new State,Object.assign(h.j,g.j),h.jr.push.apply(h.jr,g.jr),h.jd=g.jd,h.t=g.t):h=new State,d){if(a)if(h.t&&typeof h.t=="string"){const b=Object.assign(flagsForToken(h.t,a),o);addToGroups(d,b,a)}else o&&addToGroups(d,o,a);h.t=d}return c.j[s]=h,h}};const ta=(s,e,o,a,c)=>s.ta(e,o,a,c),tr=(s,e,o,a,c)=>s.tr(e,o,a,c),ts=(s,e,o,a,c)=>s.ts(e,o,a,c),tt=(s,e,o,a,c)=>s.tt(e,o,a,c),WORD="WORD",UWORD="UWORD",ASCIINUMERICAL="ASCIINUMERICAL",ALPHANUMERICAL="ALPHANUMERICAL",LOCALHOST="LOCALHOST",TLD="TLD",UTLD="UTLD",SCHEME="SCHEME",SLASH_SCHEME="SLASH_SCHEME",NUM="NUM",WS="WS",NL="NL",OPENBRACE="OPENBRACE",CLOSEBRACE="CLOSEBRACE",OPENBRACKET="OPENBRACKET",CLOSEBRACKET="CLOSEBRACKET",OPENPAREN="OPENPAREN",CLOSEPAREN="CLOSEPAREN",OPENANGLEBRACKET="OPENANGLEBRACKET",CLOSEANGLEBRACKET="CLOSEANGLEBRACKET",FULLWIDTHLEFTPAREN="FULLWIDTHLEFTPAREN",FULLWIDTHRIGHTPAREN="FULLWIDTHRIGHTPAREN",LEFTCORNERBRACKET="LEFTCORNERBRACKET",RIGHTCORNERBRACKET="RIGHTCORNERBRACKET",LEFTWHITECORNERBRACKET="LEFTWHITECORNERBRACKET",RIGHTWHITECORNERBRACKET="RIGHTWHITECORNERBRACKET",FULLWIDTHLESSTHAN="FULLWIDTHLESSTHAN",FULLWIDTHGREATERTHAN="FULLWIDTHGREATERTHAN",AMPERSAND="AMPERSAND",APOSTROPHE="APOSTROPHE",ASTERISK="ASTERISK",AT="AT",BACKSLASH="BACKSLASH",BACKTICK="BACKTICK",CARET="CARET",COLON="COLON",COMMA="COMMA",DOLLAR="DOLLAR",DOT="DOT",EQUALS="EQUALS",EXCLAMATION="EXCLAMATION",HYPHEN="HYPHEN",PERCENT="PERCENT",PIPE="PIPE",PLUS="PLUS",POUND="POUND",QUERY="QUERY",QUOTE="QUOTE",FULLWIDTHMIDDLEDOT="FULLWIDTHMIDDLEDOT",SEMI="SEMI",SLASH="SLASH",TILDE="TILDE",UNDERSCORE="UNDERSCORE",EMOJI$1="EMOJI",SYM="SYM";var tk=Object.freeze({__proto__:null,ALPHANUMERICAL,AMPERSAND,APOSTROPHE,ASCIINUMERICAL,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,CLOSEANGLEBRACKET,CLOSEBRACE,CLOSEBRACKET,CLOSEPAREN,COLON,COMMA,DOLLAR,DOT,EMOJI:EMOJI$1,EQUALS,EXCLAMATION,FULLWIDTHGREATERTHAN,FULLWIDTHLEFTPAREN,FULLWIDTHLESSTHAN,FULLWIDTHMIDDLEDOT,FULLWIDTHRIGHTPAREN,HYPHEN,LEFTCORNERBRACKET,LEFTWHITECORNERBRACKET,LOCALHOST,NL,NUM,OPENANGLEBRACKET,OPENBRACE,OPENBRACKET,OPENPAREN,PERCENT,PIPE,PLUS,POUND,QUERY,QUOTE,RIGHTCORNERBRACKET,RIGHTWHITECORNERBRACKET,SCHEME,SEMI,SLASH,SLASH_SCHEME,SYM,TILDE,TLD,UNDERSCORE,UTLD,UWORD,WORD,WS});const ASCII_LETTER=/[a-z]/,LETTER=new RegExp("\\p{L}","u"),EMOJI=new RegExp("\\p{Emoji}","u"),DIGIT=/\d/,SPACE=/\s/,CR="\r",LF=`
`,EMOJI_VARIATION="",EMOJI_JOINER="",OBJECT_REPLACEMENT="";let tlds=null,utlds=null;function init$2(s=[]){const e={};State.groups=e;const o=new State;tlds==null&&(tlds=decodeTlds(encodedTlds)),utlds==null&&(utlds=decodeTlds(encodedUtlds)),tt(o,"'",APOSTROPHE),tt(o,"{",OPENBRACE),tt(o,"}",CLOSEBRACE),tt(o,"[",OPENBRACKET),tt(o,"]",CLOSEBRACKET),tt(o,"(",OPENPAREN),tt(o,")",CLOSEPAREN),tt(o,"<",OPENANGLEBRACKET),tt(o,">",CLOSEANGLEBRACKET),tt(o,"",FULLWIDTHLEFTPAREN),tt(o,"",FULLWIDTHRIGHTPAREN),tt(o,"",LEFTCORNERBRACKET),tt(o,"",RIGHTCORNERBRACKET),tt(o,"",LEFTWHITECORNERBRACKET),tt(o,"",RIGHTWHITECORNERBRACKET),tt(o,"",FULLWIDTHLESSTHAN),tt(o,"",FULLWIDTHGREATERTHAN),tt(o,"&",AMPERSAND),tt(o,"*",ASTERISK),tt(o,"@",AT),tt(o,"`",BACKTICK),tt(o,"^",CARET),tt(o,":",COLON),tt(o,",",COMMA),tt(o,"$",DOLLAR),tt(o,".",DOT),tt(o,"=",EQUALS),tt(o,"!",EXCLAMATION),tt(o,"-",HYPHEN),tt(o,"%",PERCENT),tt(o,"|",PIPE),tt(o,"+",PLUS),tt(o,"#",POUND),tt(o,"?",QUERY),tt(o,'"',QUOTE),tt(o,"/",SLASH),tt(o,";",SEMI),tt(o,"~",TILDE),tt(o,"_",UNDERSCORE),tt(o,"\\",BACKSLASH),tt(o,"",FULLWIDTHMIDDLEDOT);const a=tr(o,DIGIT,NUM,{[numeric]:!0});tr(a,DIGIT,a);const c=tr(a,ASCII_LETTER,ASCIINUMERICAL,{[asciinumeric]:!0}),d=tr(a,LETTER,ALPHANUMERICAL,{[alphanumeric]:!0}),h=tr(o,ASCII_LETTER,WORD,{[ascii]:!0});tr(h,DIGIT,c),tr(h,ASCII_LETTER,h),tr(c,DIGIT,c),tr(c,ASCII_LETTER,c);const g=tr(o,LETTER,UWORD,{[alpha]:!0});tr(g,ASCII_LETTER),tr(g,DIGIT,d),tr(g,LETTER,g),tr(d,DIGIT,d),tr(d,ASCII_LETTER),tr(d,LETTER,d);const b=tt(o,LF,NL,{[whitespace]:!0}),j=tt(o,CR,WS,{[whitespace]:!0}),$=tr(o,SPACE,WS,{[whitespace]:!0});tt(o,OBJECT_REPLACEMENT,$),tt(j,LF,b),tt(j,OBJECT_REPLACEMENT,$),tr(j,SPACE,$),tt($,CR),tt($,LF),tr($,SPACE,$),tt($,OBJECT_REPLACEMENT,$);const _=tr(o,EMOJI,EMOJI$1,{[emoji]:!0});tt(_,"#"),tr(_,EMOJI,_),tt(_,EMOJI_VARIATION,_);const _e=tt(_,EMOJI_JOINER);tt(_e,"#"),tr(_e,EMOJI,_);const et=[[ASCII_LETTER,h],[DIGIT,c]],nt=[[ASCII_LETTER,null],[LETTER,g],[DIGIT,d]];for(let rt=0;rt<tlds.length;rt++)fastts(o,tlds[rt],TLD,WORD,et);for(let rt=0;rt<utlds.length;rt++)fastts(o,utlds[rt],UTLD,UWORD,nt);addToGroups(TLD,{tld:!0,ascii:!0},e),addToGroups(UTLD,{utld:!0,alpha:!0},e),fastts(o,"file",SCHEME,WORD,et),fastts(o,"mailto",SCHEME,WORD,et),fastts(o,"http",SLASH_SCHEME,WORD,et),fastts(o,"https",SLASH_SCHEME,WORD,et),fastts(o,"ftp",SLASH_SCHEME,WORD,et),fastts(o,"ftps",SLASH_SCHEME,WORD,et),addToGroups(SCHEME,{scheme:!0,ascii:!0},e),addToGroups(SLASH_SCHEME,{slashscheme:!0,ascii:!0},e),s=s.sort((rt,it)=>rt[0]>it[0]?1:-1);for(let rt=0;rt<s.length;rt++){const it=s[rt][0],lt=s[rt][1]?{[scheme]:!0}:{[slashscheme]:!0};it.indexOf("-")>=0?lt[domain]=!0:ASCII_LETTER.test(it)?DIGIT.test(it)?lt[asciinumeric]=!0:lt[ascii]=!0:lt[numeric]=!0,ts(o,it,it,lt)}return ts(o,"localhost",LOCALHOST,{ascii:!0}),o.jd=new State(SYM),{start:o,tokens:Object.assign({groups:e},tk)}}function run$1(s,e){const o=stringToArray(e.replace(/[A-Z]/g,g=>g.toLowerCase())),a=o.length,c=[];let d=0,h=0;for(;h<a;){let g=s,b=null,j=0,$=null,_=-1,_e=-1;for(;h<a&&(b=g.go(o[h]));)g=b,g.accepts()?(_=0,_e=0,$=g):_>=0&&(_+=o[h].length,_e++),j+=o[h].length,d+=o[h].length,h++;d-=_,h-=_e,j-=_,c.push({t:$.t,v:e.slice(d-j,d),s:d-j,e:d})}return c}function stringToArray(s){const e=[],o=s.length;let a=0;for(;a<o;){let c=s.charCodeAt(a),d,h=c<55296||c>56319||a+1===o||(d=s.charCodeAt(a+1))<56320||d>57343?s[a]:s.slice(a,a+2);e.push(h),a+=h.length}return e}function fastts(s,e,o,a,c){let d;const h=e.length;for(let g=0;g<h-1;g++){const b=e[g];s.j[b]?d=s.j[b]:(d=new State(a),d.jr=c.slice(),s.j[b]=d),s=d}return d=new State(o),d.jr=c.slice(),s.j[e[h-1]]=d,d}function decodeTlds(s){const e=[],o=[];let a=0,c="0123456789";for(;a<s.length;){let d=0;for(;c.indexOf(s[a+d])>=0;)d++;if(d>0){e.push(o.join(""));for(let h=parseInt(s.substring(a,a+d),10);h>0;h--)o.pop();a+=d}else o.push(s[a]),a++}return e}const defaults$1={defaultProtocol:"http",events:null,format:noop$1,formatHref:noop$1,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Options(s,e=null){let o=Object.assign({},defaults$1);s&&(o=Object.assign(o,s instanceof Options?s.o:s));const a=o.ignoreTags,c=[];for(let d=0;d<a.length;d++)c.push(a[d].toUpperCase());this.o=o,e&&(this.defaultRender=e),this.ignoreTags=c}Options.prototype={o:defaults$1,ignoreTags:[],defaultRender(s){return s},check(s){return this.get("validate",s.toString(),s)},get(s,e,o){const a=e!=null;let c=this.o[s];return c&&(typeof c=="object"?(c=o.t in c?c[o.t]:defaults$1[s],typeof c=="function"&&a&&(c=c(e,o))):typeof c=="function"&&a&&(c=c(e,o.t,o)),c)},getObj(s,e,o){let a=this.o[s];return typeof a=="function"&&e!=null&&(a=a(e,o.t,o)),a},render(s){const e=s.render(this);return(this.get("render",null,s)||this.defaultRender)(e,s.t,s)}};function noop$1(s){return s}function MultiToken(s,e){this.t="token",this.v=s,this.tk=e}MultiToken.prototype={isLink:!1,toString(){return this.v},toHref(s){return this.toString()},toFormattedString(s){const e=this.toString(),o=s.get("truncate",e,this),a=s.get("format",e,this);return o&&a.length>o?a.substring(0,o)+"":a},toFormattedHref(s){return s.get("formatHref",this.toHref(s.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(s=defaults$1.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(s),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(s){return{type:this.t,value:this.toFormattedString(s),isLink:this.isLink,href:this.toFormattedHref(s),start:this.startIndex(),end:this.endIndex()}},validate(s){return s.get("validate",this.toString(),this)},render(s){const e=this,o=this.toHref(s.get("defaultProtocol")),a=s.get("formatHref",o,this),c=s.get("tagName",o,e),d=this.toFormattedString(s),h={},g=s.get("className",o,e),b=s.get("target",o,e),j=s.get("rel",o,e),$=s.getObj("attributes",o,e),_=s.getObj("events",o,e);return h.href=a,g&&(h.class=g),b&&(h.target=b),j&&(h.rel=j),$&&Object.assign(h,$),{tagName:c,attributes:h,content:d,eventListeners:_}}};function createTokenClass(s,e){class o extends MultiToken{constructor(c,d){super(c,d),this.t=s}}for(const a in e)o.prototype[a]=e[a];return o.t=s,o}const Email=createTokenClass("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Text$1=createTokenClass("text"),Nl=createTokenClass("nl"),Url=createTokenClass("url",{isLink:!0,toHref(s=defaults$1.defaultProtocol){return this.hasProtocol()?this.v:`${s}://${this.v}`},hasProtocol(){const s=this.tk;return s.length>=2&&s[0].t!==LOCALHOST&&s[1].t===COLON}}),makeState=s=>new State(s);function init$1({groups:s}){const e=s.domain.concat([AMPERSAND,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,NUM,PERCENT,PIPE,PLUS,POUND,SLASH,SYM,TILDE,UNDERSCORE]),o=[APOSTROPHE,COLON,COMMA,DOT,EXCLAMATION,PERCENT,QUERY,QUOTE,SEMI,OPENANGLEBRACKET,CLOSEANGLEBRACKET,OPENBRACE,CLOSEBRACE,CLOSEBRACKET,OPENBRACKET,OPENPAREN,CLOSEPAREN,FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN,LEFTCORNERBRACKET,RIGHTCORNERBRACKET,LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET,FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN],a=[AMPERSAND,APOSTROPHE,ASTERISK,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,OPENBRACE,CLOSEBRACE,PERCENT,PIPE,PLUS,POUND,QUERY,SLASH,SYM,TILDE,UNDERSCORE],c=makeState(),d=tt(c,TILDE);ta(d,a,d),ta(d,s.domain,d);const h=makeState(),g=makeState(),b=makeState();ta(c,s.domain,h),ta(c,s.scheme,g),ta(c,s.slashscheme,b),ta(h,a,d),ta(h,s.domain,h);const j=tt(h,AT);tt(d,AT,j),tt(g,AT,j),tt(b,AT,j);const $=tt(d,DOT);ta($,a,d),ta($,s.domain,d);const _=makeState();ta(j,s.domain,_),ta(_,s.domain,_);const _e=tt(_,DOT);ta(_e,s.domain,_);const et=makeState(Email);ta(_e,s.tld,et),ta(_e,s.utld,et),tt(j,LOCALHOST,et);const nt=tt(_,HYPHEN);tt(nt,HYPHEN,nt),ta(nt,s.domain,_),ta(et,s.domain,_),tt(et,DOT,_e),tt(et,HYPHEN,nt);const rt=tt(et,COLON);ta(rt,s.numeric,Email);const it=tt(h,HYPHEN),st=tt(h,DOT);tt(it,HYPHEN,it),ta(it,s.domain,h),ta(st,a,d),ta(st,s.domain,h);const lt=makeState(Url);ta(st,s.tld,lt),ta(st,s.utld,lt),ta(lt,s.domain,h),ta(lt,a,d),tt(lt,DOT,st),tt(lt,HYPHEN,it),tt(lt,AT,j);const ot=tt(lt,COLON),ct=makeState(Url);ta(ot,s.numeric,ct);const ut=makeState(Url),at=makeState();ta(ut,e,ut),ta(ut,o,at),ta(at,e,ut),ta(at,o,at),tt(lt,SLASH,ut),tt(ct,SLASH,ut);const dt=tt(g,COLON),ft=tt(b,COLON),xt=tt(ft,SLASH),Ct=tt(xt,SLASH);ta(g,s.domain,h),tt(g,DOT,st),tt(g,HYPHEN,it),ta(b,s.domain,h),tt(b,DOT,st),tt(b,HYPHEN,it),ta(dt,s.domain,ut),tt(dt,SLASH,ut),tt(dt,QUERY,ut),ta(Ct,s.domain,ut),ta(Ct,e,ut),tt(Ct,SLASH,ut);const yt=[[OPENBRACE,CLOSEBRACE],[OPENBRACKET,CLOSEBRACKET],[OPENPAREN,CLOSEPAREN],[OPENANGLEBRACKET,CLOSEANGLEBRACKET],[FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN],[LEFTCORNERBRACKET,RIGHTCORNERBRACKET],[LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET],[FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN]];for(let Et=0;Et<yt.length;Et++){const[Tt,ht]=yt[Et],wt=tt(ut,Tt);tt(at,Tt,wt),tt(wt,ht,ut);const St=makeState(Url);ta(wt,e,St);const bt=makeState();ta(wt,o),ta(St,e,St),ta(St,o,bt),ta(bt,e,St),ta(bt,o,bt),tt(St,ht,ut),tt(bt,ht,ut)}return tt(c,LOCALHOST,lt),tt(c,NL,Nl),{start:c,tokens:tk}}function run(s,e,o){let a=o.length,c=0,d=[],h=[];for(;c<a;){let g=s,b=null,j=null,$=0,_=null,_e=-1;for(;c<a&&!(b=g.go(o[c].t));)h.push(o[c++]);for(;c<a&&(j=b||g.go(o[c].t));)b=null,g=j,g.accepts()?(_e=0,_=g):_e>=0&&_e++,c++,$++;if(_e<0)c-=$,c<a&&(h.push(o[c]),c++);else{h.length>0&&(d.push(initMultiToken(Text$1,e,h)),h=[]),c-=_e,$-=_e;const et=_.t,nt=o.slice(c-$,c);d.push(initMultiToken(et,e,nt))}}return h.length>0&&d.push(initMultiToken(Text$1,e,h)),d}function initMultiToken(s,e,o){const a=o[0].s,c=o[o.length-1].e,d=e.slice(a,c);return new s(d,o)}const warn=typeof console<"u"&&console&&console.warn||(()=>{}),warnAdvice="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",INIT={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function reset(){return State.groups={},INIT.scanner=null,INIT.parser=null,INIT.tokenQueue=[],INIT.pluginQueue=[],INIT.customSchemes=[],INIT.initialized=!1,INIT}function registerCustomProtocol(s,e=!1){if(INIT.initialized&&warn(`linkifyjs: already initialized - will not register custom scheme "${s}" ${warnAdvice}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(s))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);INIT.customSchemes.push([s,e])}function init$3(){INIT.scanner=init$2(INIT.customSchemes);for(let s=0;s<INIT.tokenQueue.length;s++)INIT.tokenQueue[s][1]({scanner:INIT.scanner});INIT.parser=init$1(INIT.scanner.tokens);for(let s=0;s<INIT.pluginQueue.length;s++)INIT.pluginQueue[s][1]({scanner:INIT.scanner,parser:INIT.parser});return INIT.initialized=!0,INIT}function tokenize(s){return INIT.initialized||init$3(),run(INIT.parser.start,s,run$1(INIT.scanner.start,s))}tokenize.scan=run$1;function find$2(s,e=null,o=null){if(e&&typeof e=="object"){if(o)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);o=e,e=null}const a=new Options(o),c=tokenize(s),d=[];for(let h=0;h<c.length;h++){const g=c[h];g.isLink&&(!e||g.t===e)&&a.check(g)&&d.push(g.toFormattedObject(a))}return d}const UNICODE_WHITESPACE_PATTERN="[\0- -\u2029]",UNICODE_WHITESPACE_REGEX=new RegExp(UNICODE_WHITESPACE_PATTERN),UNICODE_WHITESPACE_REGEX_END=new RegExp(`${UNICODE_WHITESPACE_PATTERN}$`),UNICODE_WHITESPACE_REGEX_GLOBAL=new RegExp(UNICODE_WHITESPACE_PATTERN,"g");function isValidLinkStructure(s){return s.length===1?s[0].isLink:s.length===3&&s[1].isLink?["()","[]"].includes(s[0].value+s[2].value):!1}function autolink(s){return new Plugin({key:new PluginKey("autolink"),appendTransaction:(e,o,a)=>{const c=e.some(j=>j.docChanged)&&!o.doc.eq(a.doc),d=e.some(j=>j.getMeta("preventAutolink"));if(!c||d)return;const{tr:h}=a,g=combineTransactionSteps(o.doc,[...e]);if(getChangedRanges(g).forEach(({newRange:j})=>{const $=findChildrenInRange(a.doc,j,et=>et.isTextblock);let _,_e;if($.length>1)_=$[0],_e=a.doc.textBetween(_.pos,_.pos+_.node.nodeSize,void 0," ");else if($.length){const et=a.doc.textBetween(j.from,j.to," "," ");if(!UNICODE_WHITESPACE_REGEX_END.test(et))return;_=$[0],_e=a.doc.textBetween(_.pos,j.to,void 0," ")}if(_&&_e){const et=_e.split(UNICODE_WHITESPACE_REGEX).filter(Boolean);if(et.length<=0)return!1;const nt=et[et.length-1],rt=_.pos+_e.lastIndexOf(nt);if(!nt)return!1;const it=tokenize(nt).map(st=>st.toObject(s.defaultProtocol));if(!isValidLinkStructure(it))return!1;it.filter(st=>st.isLink).map(st=>({...st,from:rt+st.start+1,to:rt+st.end+1})).filter(st=>a.schema.marks.code?!a.doc.rangeHasMark(st.from,st.to,a.schema.marks.code):!0).filter(st=>s.validate(st.value)).filter(st=>s.shouldAutoLink(st.value)).forEach(st=>{getMarksBetween(st.from,st.to,a.doc).some(lt=>lt.mark.type===s.type)||h.addMark(st.from,st.to,s.type.create({href:st.href}))})}}),!!h.steps.length)return h}})}function clickHandler(s){return new Plugin({key:new PluginKey("handleClickLink"),props:{handleClick:(e,o,a)=>{var c,d;if(a.button!==0||!e.editable)return!1;let h=a.target;const g=[];for(;h.nodeName!=="DIV";)g.push(h),h=h.parentNode;if(!g.find(_e=>_e.nodeName==="A"))return!1;const b=getAttributes(e.state,s.type.name),j=a.target,$=(c=j==null?void 0:j.href)!==null&&c!==void 0?c:b.href,_=(d=j==null?void 0:j.target)!==null&&d!==void 0?d:b.target;return j&&$?(window.open($,_),!0):!1}}})}function pasteHandler(s){return new Plugin({key:new PluginKey("handlePasteLink"),props:{handlePaste:(e,o,a)=>{const{state:c}=e,{selection:d}=c,{empty:h}=d;if(h)return!1;let g="";a.content.forEach(j=>{g+=j.textContent});const b=find$2(g,{defaultProtocol:s.defaultProtocol}).find(j=>j.isLink&&j.value===g);return!g||!b?!1:s.editor.commands.setMark(s.type,{href:b.href})}}})}function isAllowedUri(s,e){const o=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(a=>{const c=typeof a=="string"?a:a.scheme;c&&o.push(c)}),!s||s.replace(UNICODE_WHITESPACE_REGEX_GLOBAL,"").match(new RegExp(`^(?:(?:${o.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Link=Mark.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(s=>{if(typeof s=="string"){registerCustomProtocol(s);return}registerCustomProtocol(s.scheme,s.optionalSlashes)})},onDestroy(){reset()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(s,e)=>!!isAllowedUri(s,e.protocols),validate:s=>!!s,shouldAutoLink:s=>!!s}},addAttributes(){return{href:{default:null,parseHTML(s){return s.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:s=>{const e=s.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:o=>!!isAllowedUri(o,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:s}){return this.options.isAllowedUri(s.href,{defaultValidate:e=>!!isAllowedUri(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",mergeAttributes(this.options.HTMLAttributes,s),0]:["a",mergeAttributes(this.options.HTMLAttributes,{...s,href:""}),0]},addCommands(){return{setLink:s=>({chain:e})=>{const{href:o}=s;return this.options.isAllowedUri(o,{defaultValidate:a=>!!isAllowedUri(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,s).setMeta("preventAutolink",!0).run():!1},toggleLink:s=>({chain:e})=>{const{href:o}=s;return this.options.isAllowedUri(o,{defaultValidate:a=>!!isAllowedUri(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,s,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:s})=>s().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[markPasteRule({find:s=>{const e=[];if(s){const{protocols:o,defaultProtocol:a}=this.options,c=find$2(s).filter(d=>d.isLink&&this.options.isAllowedUri(d.value,{defaultValidate:h=>!!isAllowedUri(h,o),protocols:o,defaultProtocol:a}));c.length&&c.forEach(d=>e.push({text:d.value,data:{href:d.href},index:d.start}))}return e},type:this.type,getAttributes:s=>{var e;return{href:(e=s.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const s=[],{protocols:e,defaultProtocol:o}=this.options;return this.options.autolink&&s.push(autolink({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:a=>this.options.isAllowedUri(a,{defaultValidate:c=>!!isAllowedUri(c,e),protocols:e,defaultProtocol:o}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&s.push(clickHandler({type:this.type})),this.options.linkOnPaste&&s.push(pasteHandler({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),s}});let readFromCache,addToCache;if(typeof WeakMap<"u"){let s=new WeakMap;readFromCache=e=>s.get(e),addToCache=(e,o)=>(s.set(e,o),o)}else{const s=[];let o=0;readFromCache=a=>{for(let c=0;c<s.length;c+=2)if(s[c]==a)return s[c+1]},addToCache=(a,c)=>(o==10&&(o=0),s[o++]=a,s[o++]=c)}var TableMap=class{constructor(s,e,o,a){this.width=s,this.height=e,this.map=o,this.problems=a}findCell(s){for(let e=0;e<this.map.length;e++){const o=this.map[e];if(o!=s)continue;const a=e%this.width,c=e/this.width|0;let d=a+1,h=c+1;for(let g=1;d<this.width&&this.map[e+g]==o;g++)d++;for(let g=1;h<this.height&&this.map[e+this.width*g]==o;g++)h++;return{left:a,top:c,right:d,bottom:h}}throw new RangeError(`No cell with offset ${s} found`)}colCount(s){for(let e=0;e<this.map.length;e++)if(this.map[e]==s)return e%this.width;throw new RangeError(`No cell with offset ${s} found`)}nextCell(s,e,o){const{left:a,right:c,top:d,bottom:h}=this.findCell(s);return e=="horiz"?(o<0?a==0:c==this.width)?null:this.map[d*this.width+(o<0?a-1:c)]:(o<0?d==0:h==this.height)?null:this.map[a+this.width*(o<0?d-1:h)]}rectBetween(s,e){const{left:o,right:a,top:c,bottom:d}=this.findCell(s),{left:h,right:g,top:b,bottom:j}=this.findCell(e);return{left:Math.min(o,h),top:Math.min(c,b),right:Math.max(a,g),bottom:Math.max(d,j)}}cellsInRect(s){const e=[],o={};for(let a=s.top;a<s.bottom;a++)for(let c=s.left;c<s.right;c++){const d=a*this.width+c,h=this.map[d];o[h]||(o[h]=!0,!(c==s.left&&c&&this.map[d-1]==h||a==s.top&&a&&this.map[d-this.width]==h)&&e.push(h))}return e}positionAt(s,e,o){for(let a=0,c=0;;a++){const d=c+o.child(a).nodeSize;if(a==s){let h=e+s*this.width;const g=(s+1)*this.width;for(;h<g&&this.map[h]<c;)h++;return h==g?d-1:this.map[h]}c=d}}static get(s){return readFromCache(s)||addToCache(s,computeMap(s))}};function computeMap(s){if(s.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+s.type.name);const e=findWidth(s),o=s.childCount,a=[];let c=0,d=null;const h=[];for(let j=0,$=e*o;j<$;j++)a[j]=0;for(let j=0,$=0;j<o;j++){const _=s.child(j);$++;for(let nt=0;;nt++){for(;c<a.length&&a[c]!=0;)c++;if(nt==_.childCount)break;const rt=_.child(nt),{colspan:it,rowspan:st,colwidth:lt}=rt.attrs;for(let ot=0;ot<st;ot++){if(ot+j>=o){(d||(d=[])).push({type:"overlong_rowspan",pos:$,n:st-ot});break}const ct=c+ot*e;for(let ut=0;ut<it;ut++){a[ct+ut]==0?a[ct+ut]=$:(d||(d=[])).push({type:"collision",row:j,pos:$,n:it-ut});const at=lt&&lt[ut];if(at){const dt=(ct+ut)%e*2,ft=h[dt];ft==null||ft!=at&&h[dt+1]==1?(h[dt]=at,h[dt+1]=1):ft==at&&h[dt+1]++}}}c+=it,$+=rt.nodeSize}const _e=(j+1)*e;let et=0;for(;c<_e;)a[c++]==0&&et++;et&&(d||(d=[])).push({type:"missing",row:j,n:et}),$++}(e===0||o===0)&&(d||(d=[])).push({type:"zero_sized"});const g=new TableMap(e,o,a,d);let b=!1;for(let j=0;!b&&j<h.length;j+=2)h[j]!=null&&h[j+1]<o&&(b=!0);return b&&findBadColWidths(g,h,s),g}function findWidth(s){let e=-1,o=!1;for(let a=0;a<s.childCount;a++){const c=s.child(a);let d=0;if(o)for(let h=0;h<a;h++){const g=s.child(h);for(let b=0;b<g.childCount;b++){const j=g.child(b);h+j.attrs.rowspan>a&&(d+=j.attrs.colspan)}}for(let h=0;h<c.childCount;h++){const g=c.child(h);d+=g.attrs.colspan,g.attrs.rowspan>1&&(o=!0)}e==-1?e=d:e!=d&&(e=Math.max(e,d))}return e}function findBadColWidths(s,e,o){s.problems||(s.problems=[]);const a={};for(let c=0;c<s.map.length;c++){const d=s.map[c];if(a[d])continue;a[d]=!0;const h=o.nodeAt(d);if(!h)throw new RangeError(`No cell with offset ${d} found`);let g=null;const b=h.attrs;for(let j=0;j<b.colspan;j++){const $=e[(c+j)%s.width*2];$!=null&&(!b.colwidth||b.colwidth[j]!=$)&&((g||(g=freshColWidth(b)))[j]=$)}g&&s.problems.unshift({type:"colwidth mismatch",pos:d,colwidth:g})}}function freshColWidth(s){if(s.colwidth)return s.colwidth.slice();const e=[];for(let o=0;o<s.colspan;o++)e.push(0);return e}function tableNodeTypes(s){let e=s.cached.tableNodeTypes;if(!e){e=s.cached.tableNodeTypes={};for(const o in s.nodes){const a=s.nodes[o],c=a.spec.tableRole;c&&(e[c]=a)}}return e}const tableEditingKey=new PluginKey("selectingCells");function cellAround(s){for(let e=s.depth-1;e>0;e--)if(s.node(e).type.spec.tableRole=="row")return s.node(0).resolve(s.before(e+1));return null}function cellWrapping(s){for(let e=s.depth;e>0;e--){const o=s.node(e).type.spec.tableRole;if(o==="cell"||o==="header_cell")return s.node(e)}return null}function isInTable(s){const e=s.selection.$head;for(let o=e.depth;o>0;o--)if(e.node(o).type.spec.tableRole=="row")return!0;return!1}function selectionCell(s){const e=s.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const o=cellAround(e.$head)||cellNear(e.$head);if(o)return o;throw new RangeError(`No cell found around position ${e.head}`)}function cellNear(s){for(let e=s.nodeAfter,o=s.pos;e;e=e.firstChild,o++){const a=e.type.spec.tableRole;if(a=="cell"||a=="header_cell")return s.doc.resolve(o)}for(let e=s.nodeBefore,o=s.pos;e;e=e.lastChild,o--){const a=e.type.spec.tableRole;if(a=="cell"||a=="header_cell")return s.doc.resolve(o-e.nodeSize)}}function pointsAtCell(s){return s.parent.type.spec.tableRole=="row"&&!!s.nodeAfter}function moveCellForward(s){return s.node(0).resolve(s.pos+s.nodeAfter.nodeSize)}function inSameTable(s,e){return s.depth==e.depth&&s.pos>=e.start(-1)&&s.pos<=e.end(-1)}function nextCell(s,e,o){const a=s.node(-1),c=TableMap.get(a),d=s.start(-1),h=c.nextCell(s.pos-d,e,o);return h==null?null:s.node(0).resolve(d+h)}function removeColSpan(s,e,o=1){const a={...s,colspan:s.colspan-o};return a.colwidth&&(a.colwidth=a.colwidth.slice(),a.colwidth.splice(e,o),a.colwidth.some(c=>c>0)||(a.colwidth=null)),a}function addColSpan(s,e,o=1){const a={...s,colspan:s.colspan+o};if(a.colwidth){a.colwidth=a.colwidth.slice();for(let c=0;c<o;c++)a.colwidth.splice(e,0,0)}return a}function columnIsHeader(s,e,o){const a=tableNodeTypes(e.type.schema).header_cell;for(let c=0;c<s.height;c++)if(e.nodeAt(s.map[o+c*s.width]).type!=a)return!1;return!0}var CellSelection=class Tn extends Selection$2{constructor(e,o=e){const a=e.node(-1),c=TableMap.get(a),d=e.start(-1),h=c.rectBetween(e.pos-d,o.pos-d),g=e.node(0),b=c.cellsInRect(h).filter($=>$!=o.pos-d);b.unshift(o.pos-d);const j=b.map($=>{const _=a.nodeAt($);if(!_)throw new RangeError(`No cell with offset ${$} found`);const _e=d+$+1;return new SelectionRange$1(g.resolve(_e),g.resolve(_e+_.content.size))});super(j[0].$from,j[0].$to,j),this.$anchorCell=e,this.$headCell=o}map(e,o){const a=e.resolve(o.map(this.$anchorCell.pos)),c=e.resolve(o.map(this.$headCell.pos));if(pointsAtCell(a)&&pointsAtCell(c)&&inSameTable(a,c)){const d=this.$anchorCell.node(-1)!=a.node(-1);return d&&this.isRowSelection()?Tn.rowSelection(a,c):d&&this.isColSelection()?Tn.colSelection(a,c):new Tn(a,c)}return TextSelection.between(a,c)}content(){const e=this.$anchorCell.node(-1),o=TableMap.get(e),a=this.$anchorCell.start(-1),c=o.rectBetween(this.$anchorCell.pos-a,this.$headCell.pos-a),d={},h=[];for(let b=c.top;b<c.bottom;b++){const j=[];for(let $=b*o.width+c.left,_=c.left;_<c.right;_++,$++){const _e=o.map[$];if(d[_e])continue;d[_e]=!0;const et=o.findCell(_e);let nt=e.nodeAt(_e);if(!nt)throw new RangeError(`No cell with offset ${_e} found`);const rt=c.left-et.left,it=et.right-c.right;if(rt>0||it>0){let st=nt.attrs;if(rt>0&&(st=removeColSpan(st,0,rt)),it>0&&(st=removeColSpan(st,st.colspan-it,it)),et.left<c.left){if(nt=nt.type.createAndFill(st),!nt)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(st)}`)}else nt=nt.type.create(st,nt.content)}if(et.top<c.top||et.bottom>c.bottom){const st={...nt.attrs,rowspan:Math.min(et.bottom,c.bottom)-Math.max(et.top,c.top)};et.top<c.top?nt=nt.type.createAndFill(st):nt=nt.type.create(st,nt.content)}j.push(nt)}h.push(e.child(b).copy(Fragment.from(j)))}const g=this.isColSelection()&&this.isRowSelection()?e:h;return new Slice(Fragment.from(g),1,1)}replace(e,o=Slice.empty){const a=e.steps.length,c=this.ranges;for(let h=0;h<c.length;h++){const{$from:g,$to:b}=c[h],j=e.mapping.slice(a);e.replace(j.map(g.pos),j.map(b.pos),h?Slice.empty:o)}const d=Selection$2.findFrom(e.doc.resolve(e.mapping.slice(a).map(this.to)),-1);d&&e.setSelection(d)}replaceWith(e,o){this.replace(e,new Slice(Fragment.from(o),0,0))}forEachCell(e){const o=this.$anchorCell.node(-1),a=TableMap.get(o),c=this.$anchorCell.start(-1),d=a.cellsInRect(a.rectBetween(this.$anchorCell.pos-c,this.$headCell.pos-c));for(let h=0;h<d.length;h++)e(o.nodeAt(d[h]),c+d[h])}isColSelection(){const e=this.$anchorCell.index(-1),o=this.$headCell.index(-1);if(Math.min(e,o)>0)return!1;const a=e+this.$anchorCell.nodeAfter.attrs.rowspan,c=o+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(a,c)==this.$headCell.node(-1).childCount}static colSelection(e,o=e){const a=e.node(-1),c=TableMap.get(a),d=e.start(-1),h=c.findCell(e.pos-d),g=c.findCell(o.pos-d),b=e.node(0);return h.top<=g.top?(h.top>0&&(e=b.resolve(d+c.map[h.left])),g.bottom<c.height&&(o=b.resolve(d+c.map[c.width*(c.height-1)+g.right-1]))):(g.top>0&&(o=b.resolve(d+c.map[g.left])),h.bottom<c.height&&(e=b.resolve(d+c.map[c.width*(c.height-1)+h.right-1]))),new Tn(e,o)}isRowSelection(){const e=this.$anchorCell.node(-1),o=TableMap.get(e),a=this.$anchorCell.start(-1),c=o.colCount(this.$anchorCell.pos-a),d=o.colCount(this.$headCell.pos-a);if(Math.min(c,d)>0)return!1;const h=c+this.$anchorCell.nodeAfter.attrs.colspan,g=d+this.$headCell.nodeAfter.attrs.colspan;return Math.max(h,g)==o.width}eq(e){return e instanceof Tn&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,o=e){const a=e.node(-1),c=TableMap.get(a),d=e.start(-1),h=c.findCell(e.pos-d),g=c.findCell(o.pos-d),b=e.node(0);return h.left<=g.left?(h.left>0&&(e=b.resolve(d+c.map[h.top*c.width])),g.right<c.width&&(o=b.resolve(d+c.map[c.width*(g.top+1)-1]))):(g.left>0&&(o=b.resolve(d+c.map[g.top*c.width])),h.right<c.width&&(e=b.resolve(d+c.map[c.width*(h.top+1)-1]))),new Tn(e,o)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,o){return new Tn(e.resolve(o.anchor),e.resolve(o.head))}static create(e,o,a=o){return new Tn(e.resolve(o),e.resolve(a))}getBookmark(){return new CellBookmark(this.$anchorCell.pos,this.$headCell.pos)}};CellSelection.prototype.visible=!1;Selection$2.jsonID("cell",CellSelection);var CellBookmark=class mr{constructor(e,o){this.anchor=e,this.head=o}map(e){return new mr(e.map(this.anchor),e.map(this.head))}resolve(e){const o=e.resolve(this.anchor),a=e.resolve(this.head);return o.parent.type.spec.tableRole=="row"&&a.parent.type.spec.tableRole=="row"&&o.index()<o.parent.childCount&&a.index()<a.parent.childCount&&inSameTable(o,a)?new CellSelection(o,a):Selection$2.near(a,1)}};function drawCellSelection(s){if(!(s.selection instanceof CellSelection))return null;const e=[];return s.selection.forEachCell((o,a)=>{e.push(Decoration$1.node(a,a+o.nodeSize,{class:"selectedCell"}))}),DecorationSet.create(s.doc,e)}function isCellBoundarySelection({$from:s,$to:e}){if(s.pos==e.pos||s.pos<e.pos-6)return!1;let o=s.pos,a=e.pos,c=s.depth;for(;c>=0&&!(s.after(c+1)<s.end(c));c--,o++);for(let d=e.depth;d>=0&&!(e.before(d+1)>e.start(d));d--,a--);return o==a&&/row|table/.test(s.node(c).type.spec.tableRole)}function isTextSelectionAcrossCells({$from:s,$to:e}){let o,a;for(let c=s.depth;c>0;c--){const d=s.node(c);if(d.type.spec.tableRole==="cell"||d.type.spec.tableRole==="header_cell"){o=d;break}}for(let c=e.depth;c>0;c--){const d=e.node(c);if(d.type.spec.tableRole==="cell"||d.type.spec.tableRole==="header_cell"){a=d;break}}return o!==a&&e.parentOffset===0}function normalizeSelection(s,e,o){const a=(e||s).selection,c=(e||s).doc;let d,h;if(a instanceof NodeSelection&&(h=a.node.type.spec.tableRole)){if(h=="cell"||h=="header_cell")d=CellSelection.create(c,a.from);else if(h=="row"){const g=c.resolve(a.from+1);d=CellSelection.rowSelection(g,g)}else if(!o){const g=TableMap.get(a.node),b=a.from+1,j=b+g.map[g.width*g.height-1];d=CellSelection.create(c,b+1,j)}}else a instanceof TextSelection&&isCellBoundarySelection(a)?d=TextSelection.create(c,a.from):a instanceof TextSelection&&isTextSelectionAcrossCells(a)&&(d=TextSelection.create(c,a.$from.start(),a.$from.end()));return d&&(e||(e=s.tr)).setSelection(d),e}const fixTablesKey=new PluginKey("fix-tables");function changedDescendants(s,e,o,a){const c=s.childCount,d=e.childCount;e:for(let h=0,g=0;h<d;h++){const b=e.child(h);for(let j=g,$=Math.min(c,h+3);j<$;j++)if(s.child(j)==b){g=j+1,o+=b.nodeSize;continue e}a(b,o),g<c&&s.child(g).sameMarkup(b)?changedDescendants(s.child(g),b,o+1,a):b.nodesBetween(0,b.content.size,a,o+1),o+=b.nodeSize}}function fixTables(s,e){let o;const a=(c,d)=>{c.type.spec.tableRole=="table"&&(o=fixTable(s,c,d,o))};return e?e.doc!=s.doc&&changedDescendants(e.doc,s.doc,0,a):s.doc.descendants(a),o}function fixTable(s,e,o,a){const c=TableMap.get(e);if(!c.problems)return a;a||(a=s.tr);const d=[];for(let b=0;b<c.height;b++)d.push(0);for(let b=0;b<c.problems.length;b++){const j=c.problems[b];if(j.type=="collision"){const $=e.nodeAt(j.pos);if(!$)continue;const _=$.attrs;for(let _e=0;_e<_.rowspan;_e++)d[j.row+_e]+=j.n;a.setNodeMarkup(a.mapping.map(o+1+j.pos),null,removeColSpan(_,_.colspan-j.n,j.n))}else if(j.type=="missing")d[j.row]+=j.n;else if(j.type=="overlong_rowspan"){const $=e.nodeAt(j.pos);if(!$)continue;a.setNodeMarkup(a.mapping.map(o+1+j.pos),null,{...$.attrs,rowspan:$.attrs.rowspan-j.n})}else if(j.type=="colwidth mismatch"){const $=e.nodeAt(j.pos);if(!$)continue;a.setNodeMarkup(a.mapping.map(o+1+j.pos),null,{...$.attrs,colwidth:j.colwidth})}else if(j.type=="zero_sized"){const $=a.mapping.map(o);a.delete($,$+e.nodeSize)}}let h,g;for(let b=0;b<d.length;b++)d[b]&&(h==null&&(h=b),g=b);for(let b=0,j=o+1;b<c.height;b++){const $=e.child(b),_=j+$.nodeSize,_e=d[b];if(_e>0){let et="cell";$.firstChild&&(et=$.firstChild.type.spec.tableRole);const nt=[];for(let it=0;it<_e;it++){const st=tableNodeTypes(s.schema)[et].createAndFill();st&&nt.push(st)}const rt=(b==0||h==b-1)&&g==b?j+1:_-1;a.insert(a.mapping.map(rt),nt)}j=_}return a.setMeta(fixTablesKey,{fixTables:!0})}function selectedRect(s){const e=s.selection,o=selectionCell(s),a=o.node(-1),c=o.start(-1),d=TableMap.get(a);return{...e instanceof CellSelection?d.rectBetween(e.$anchorCell.pos-c,e.$headCell.pos-c):d.findCell(o.pos-c),tableStart:c,map:d,table:a}}function addColumn(s,{map:e,tableStart:o,table:a},c){let d=c>0?-1:0;columnIsHeader(e,a,c+d)&&(d=c==0||c==e.width?null:0);for(let h=0;h<e.height;h++){const g=h*e.width+c;if(c>0&&c<e.width&&e.map[g-1]==e.map[g]){const b=e.map[g],j=a.nodeAt(b);s.setNodeMarkup(s.mapping.map(o+b),null,addColSpan(j.attrs,c-e.colCount(b))),h+=j.attrs.rowspan-1}else{const b=d==null?tableNodeTypes(a.type.schema).cell:a.nodeAt(e.map[g+d]).type,j=e.positionAt(h,c,a);s.insert(s.mapping.map(o+j),b.createAndFill())}}return s}function addColumnBefore(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s);e(addColumn(s.tr,o,o.left))}return!0}function addColumnAfter(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s);e(addColumn(s.tr,o,o.right))}return!0}function removeColumn(s,{map:e,table:o,tableStart:a},c){const d=s.mapping.maps.length;for(let h=0;h<e.height;){const g=h*e.width+c,b=e.map[g],j=o.nodeAt(b),$=j.attrs;if(c>0&&e.map[g-1]==b||c<e.width-1&&e.map[g+1]==b)s.setNodeMarkup(s.mapping.slice(d).map(a+b),null,removeColSpan($,c-e.colCount(b)));else{const _=s.mapping.slice(d).map(a+b);s.delete(_,_+j.nodeSize)}h+=$.rowspan}}function deleteColumn(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s),a=s.tr;if(o.left==0&&o.right==o.map.width)return!1;for(let c=o.right-1;removeColumn(a,o,c),c!=o.left;c--){const d=o.tableStart?a.doc.nodeAt(o.tableStart-1):a.doc;if(!d)throw new RangeError("No table found");o.table=d,o.map=TableMap.get(d)}e(a)}return!0}function rowIsHeader(s,e,o){var a;const c=tableNodeTypes(e.type.schema).header_cell;for(let d=0;d<s.width;d++)if(((a=e.nodeAt(s.map[d+o*s.width]))===null||a===void 0?void 0:a.type)!=c)return!1;return!0}function addRow(s,{map:e,tableStart:o,table:a},c){let d=o;for(let j=0;j<c;j++)d+=a.child(j).nodeSize;const h=[];let g=c>0?-1:0;rowIsHeader(e,a,c+g)&&(g=c==0||c==e.height?null:0);for(let j=0,$=e.width*c;j<e.width;j++,$++)if(c>0&&c<e.height&&e.map[$]==e.map[$-e.width]){const _=e.map[$],_e=a.nodeAt(_).attrs;s.setNodeMarkup(o+_,null,{..._e,rowspan:_e.rowspan+1}),j+=_e.colspan-1}else{var b;const _=g==null?tableNodeTypes(a.type.schema).cell:(b=a.nodeAt(e.map[$+g*e.width]))===null||b===void 0?void 0:b.type,_e=_==null?void 0:_.createAndFill();_e&&h.push(_e)}return s.insert(d,tableNodeTypes(a.type.schema).row.create(null,h)),s}function addRowBefore(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s);e(addRow(s.tr,o,o.top))}return!0}function addRowAfter(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s);e(addRow(s.tr,o,o.bottom))}return!0}function removeRow(s,{map:e,table:o,tableStart:a},c){let d=0;for(let j=0;j<c;j++)d+=o.child(j).nodeSize;const h=d+o.child(c).nodeSize,g=s.mapping.maps.length;s.delete(d+a,h+a);const b=new Set;for(let j=0,$=c*e.width;j<e.width;j++,$++){const _=e.map[$];if(!b.has(_)){if(b.add(_),c>0&&_==e.map[$-e.width]){const _e=o.nodeAt(_).attrs;s.setNodeMarkup(s.mapping.slice(g).map(_+a),null,{..._e,rowspan:_e.rowspan-1}),j+=_e.colspan-1}else if(c<e.height&&_==e.map[$+e.width]){const _e=o.nodeAt(_),et=_e.attrs,nt=_e.type.create({...et,rowspan:_e.attrs.rowspan-1},_e.content),rt=e.positionAt(c+1,j,o);s.insert(s.mapping.slice(g).map(a+rt),nt),j+=et.colspan-1}}}}function deleteRow(s,e){if(!isInTable(s))return!1;if(e){const o=selectedRect(s),a=s.tr;if(o.top==0&&o.bottom==o.map.height)return!1;for(let c=o.bottom-1;removeRow(a,o,c),c!=o.top;c--){const d=o.tableStart?a.doc.nodeAt(o.tableStart-1):a.doc;if(!d)throw new RangeError("No table found");o.table=d,o.map=TableMap.get(o.table)}e(a)}return!0}function isEmpty(s){const e=s.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function cellsOverlapRectangle({width:s,height:e,map:o},a){let c=a.top*s+a.left,d=c,h=(a.bottom-1)*s+a.left,g=c+(a.right-a.left-1);for(let b=a.top;b<a.bottom;b++){if(a.left>0&&o[d]==o[d-1]||a.right<s&&o[g]==o[g+1])return!0;d+=s,g+=s}for(let b=a.left;b<a.right;b++){if(a.top>0&&o[c]==o[c-s]||a.bottom<e&&o[h]==o[h+s])return!0;c++,h++}return!1}function mergeCells(s,e){const o=s.selection;if(!(o instanceof CellSelection)||o.$anchorCell.pos==o.$headCell.pos)return!1;const a=selectedRect(s),{map:c}=a;if(cellsOverlapRectangle(c,a))return!1;if(e){const d=s.tr,h={};let g=Fragment.empty,b,j;for(let $=a.top;$<a.bottom;$++)for(let _=a.left;_<a.right;_++){const _e=c.map[$*c.width+_],et=a.table.nodeAt(_e);if(!(h[_e]||!et))if(h[_e]=!0,b==null)b=_e,j=et;else{isEmpty(et)||(g=g.append(et.content));const nt=d.mapping.map(_e+a.tableStart);d.delete(nt,nt+et.nodeSize)}}if(b==null||j==null)return!0;if(d.setNodeMarkup(b+a.tableStart,null,{...addColSpan(j.attrs,j.attrs.colspan,a.right-a.left-j.attrs.colspan),rowspan:a.bottom-a.top}),g.size>0){const $=b+1+j.content.size,_=isEmpty(j)?b+1:$;d.replaceWith(_+a.tableStart,$+a.tableStart,g)}d.setSelection(new CellSelection(d.doc.resolve(b+a.tableStart))),e(d)}return!0}function splitCell(s,e){const o=tableNodeTypes(s.schema);return splitCellWithType(({node:a})=>o[a.type.spec.tableRole])(s,e)}function splitCellWithType(s){return(e,o)=>{const a=e.selection;let c,d;if(a instanceof CellSelection){if(a.$anchorCell.pos!=a.$headCell.pos)return!1;c=a.$anchorCell.nodeAfter,d=a.$anchorCell.pos}else{var h;if(c=cellWrapping(a.$from),!c)return!1;d=(h=cellAround(a.$from))===null||h===void 0?void 0:h.pos}if(c==null||d==null||c.attrs.colspan==1&&c.attrs.rowspan==1)return!1;if(o){let g=c.attrs;const b=[],j=g.colwidth;g.rowspan>1&&(g={...g,rowspan:1}),g.colspan>1&&(g={...g,colspan:1});const $=selectedRect(e),_=e.tr;for(let et=0;et<$.right-$.left;et++)b.push(j?{...g,colwidth:j&&j[et]?[j[et]]:null}:g);let _e;for(let et=$.top;et<$.bottom;et++){let nt=$.map.positionAt(et,$.left,$.table);et==$.top&&(nt+=c.nodeSize);for(let rt=$.left,it=0;rt<$.right;rt++,it++)rt==$.left&&et==$.top||_.insert(_e=_.mapping.map(nt+$.tableStart,1),s({node:c,row:et,col:rt}).createAndFill(b[it]))}_.setNodeMarkup(d,s({node:c,row:$.top,col:$.left}),b[0]),a instanceof CellSelection&&_.setSelection(new CellSelection(_.doc.resolve(a.$anchorCell.pos),_e?_.doc.resolve(_e):void 0)),o(_)}return!0}}function setCellAttr(s,e){return function(o,a){if(!isInTable(o))return!1;const c=selectionCell(o);if(c.nodeAfter.attrs[s]===e)return!1;if(a){const d=o.tr;o.selection instanceof CellSelection?o.selection.forEachCell((h,g)=>{h.attrs[s]!==e&&d.setNodeMarkup(g,null,{...h.attrs,[s]:e})}):d.setNodeMarkup(c.pos,null,{...c.nodeAfter.attrs,[s]:e}),a(d)}return!0}}function deprecated_toggleHeader(s){return function(e,o){if(!isInTable(e))return!1;if(o){const a=tableNodeTypes(e.schema),c=selectedRect(e),d=e.tr,h=c.map.cellsInRect(s=="column"?{left:c.left,top:0,right:c.right,bottom:c.map.height}:s=="row"?{left:0,top:c.top,right:c.map.width,bottom:c.bottom}:c),g=h.map(b=>c.table.nodeAt(b));for(let b=0;b<h.length;b++)g[b].type==a.header_cell&&d.setNodeMarkup(c.tableStart+h[b],a.cell,g[b].attrs);if(d.steps.length===0)for(let b=0;b<h.length;b++)d.setNodeMarkup(c.tableStart+h[b],a.header_cell,g[b].attrs);o(d)}return!0}}function isHeaderEnabledByType(s,e,o){const a=e.map.cellsInRect({left:0,top:0,right:s=="row"?e.map.width:1,bottom:s=="column"?e.map.height:1});for(let c=0;c<a.length;c++){const d=e.table.nodeAt(a[c]);if(d&&d.type!==o.header_cell)return!1}return!0}function toggleHeader(s,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?deprecated_toggleHeader(s):function(o,a){if(!isInTable(o))return!1;if(a){const c=tableNodeTypes(o.schema),d=selectedRect(o),h=o.tr,g=isHeaderEnabledByType("row",d,c),b=isHeaderEnabledByType("column",d,c),j=(s==="column"?g:s==="row"&&b)?1:0,$=s=="column"?{left:0,top:j,right:1,bottom:d.map.height}:s=="row"?{left:j,top:0,right:d.map.width,bottom:1}:d,_=s=="column"?b?c.cell:c.header_cell:s=="row"?g?c.cell:c.header_cell:c.cell;d.map.cellsInRect($).forEach(_e=>{const et=_e+d.tableStart,nt=h.doc.nodeAt(et);nt&&h.setNodeMarkup(et,_,nt.attrs)}),a(h)}return!0}}toggleHeader("row",{useDeprecatedLogic:!0});toggleHeader("column",{useDeprecatedLogic:!0});const toggleHeaderCell=toggleHeader("cell",{useDeprecatedLogic:!0});function findNextCell(s,e){if(e<0){const o=s.nodeBefore;if(o)return s.pos-o.nodeSize;for(let a=s.index(-1)-1,c=s.before();a>=0;a--){const d=s.node(-1).child(a),h=d.lastChild;if(h)return c-1-h.nodeSize;c-=d.nodeSize}}else{if(s.index()<s.parent.childCount-1)return s.pos+s.nodeAfter.nodeSize;const o=s.node(-1);for(let a=s.indexAfter(-1),c=s.after();a<o.childCount;a++){const d=o.child(a);if(d.childCount)return c+1;c+=d.nodeSize}}return null}function goToNextCell(s){return function(e,o){if(!isInTable(e))return!1;const a=findNextCell(selectionCell(e),s);if(a==null)return!1;if(o){const c=e.doc.resolve(a);o(e.tr.setSelection(TextSelection.between(c,moveCellForward(c))).scrollIntoView())}return!0}}function deleteTable(s,e){const o=s.selection.$anchor;for(let a=o.depth;a>0;a--)if(o.node(a).type.spec.tableRole=="table")return e&&e(s.tr.delete(o.before(a),o.after(a)).scrollIntoView()),!0;return!1}function deleteCellSelection(s,e){const o=s.selection;if(!(o instanceof CellSelection))return!1;if(e){const a=s.tr,c=tableNodeTypes(s.schema).cell.createAndFill().content;o.forEachCell((d,h)=>{d.content.eq(c)||a.replace(a.mapping.map(h+1),a.mapping.map(h+d.nodeSize-1),new Slice(c,0,0))}),a.docChanged&&e(a)}return!0}function pastedCells(s){if(s.size===0)return null;let{content:e,openStart:o,openEnd:a}=s;for(;e.childCount==1&&(o>0&&a>0||e.child(0).type.spec.tableRole=="table");)o--,a--,e=e.child(0).content;const c=e.child(0),d=c.type.spec.tableRole,h=c.type.schema,g=[];if(d=="row")for(let b=0;b<e.childCount;b++){let j=e.child(b).content;const $=b?0:Math.max(0,o-1),_=b<e.childCount-1?0:Math.max(0,a-1);($||_)&&(j=fitSlice(tableNodeTypes(h).row,new Slice(j,$,_)).content),g.push(j)}else if(d=="cell"||d=="header_cell")g.push(o||a?fitSlice(tableNodeTypes(h).row,new Slice(e,o,a)).content:e);else return null;return ensureRectangular(h,g)}function ensureRectangular(s,e){const o=[];for(let c=0;c<e.length;c++){const d=e[c];for(let h=d.childCount-1;h>=0;h--){const{rowspan:g,colspan:b}=d.child(h).attrs;for(let j=c;j<c+g;j++)o[j]=(o[j]||0)+b}}let a=0;for(let c=0;c<o.length;c++)a=Math.max(a,o[c]);for(let c=0;c<o.length;c++)if(c>=e.length&&e.push(Fragment.empty),o[c]<a){const d=tableNodeTypes(s).cell.createAndFill(),h=[];for(let g=o[c];g<a;g++)h.push(d);e[c]=e[c].append(Fragment.from(h))}return{height:e.length,width:a,rows:e}}function fitSlice(s,e){const o=s.createAndFill();return new Transform$1(o).replace(0,o.content.size,e).doc}function clipCells({width:s,height:e,rows:o},a,c){if(s!=a){const d=[],h=[];for(let g=0;g<o.length;g++){const b=o[g],j=[];for(let $=d[g]||0,_=0;$<a;_++){let _e=b.child(_%b.childCount);$+_e.attrs.colspan>a&&(_e=_e.type.createChecked(removeColSpan(_e.attrs,_e.attrs.colspan,$+_e.attrs.colspan-a),_e.content)),j.push(_e),$+=_e.attrs.colspan;for(let et=1;et<_e.attrs.rowspan;et++)d[g+et]=(d[g+et]||0)+_e.attrs.colspan}h.push(Fragment.from(j))}o=h,s=a}if(e!=c){const d=[];for(let h=0,g=0;h<c;h++,g++){const b=[],j=o[g%e];for(let $=0;$<j.childCount;$++){let _=j.child($);h+_.attrs.rowspan>c&&(_=_.type.create({..._.attrs,rowspan:Math.max(1,c-_.attrs.rowspan)},_.content)),b.push(_)}d.push(Fragment.from(b))}o=d,e=c}return{width:s,height:e,rows:o}}function growTable(s,e,o,a,c,d,h){const g=s.doc.type.schema,b=tableNodeTypes(g);let j,$;if(c>e.width)for(let _=0,_e=0;_<e.height;_++){const et=o.child(_);_e+=et.nodeSize;const nt=[];let rt;et.lastChild==null||et.lastChild.type==b.cell?rt=j||(j=b.cell.createAndFill()):rt=$||($=b.header_cell.createAndFill());for(let it=e.width;it<c;it++)nt.push(rt);s.insert(s.mapping.slice(h).map(_e-1+a),nt)}if(d>e.height){const _=[];for(let nt=0,rt=(e.height-1)*e.width;nt<Math.max(e.width,c);nt++){const it=nt>=e.width?!1:o.nodeAt(e.map[rt+nt]).type==b.header_cell;_.push(it?$||($=b.header_cell.createAndFill()):j||(j=b.cell.createAndFill()))}const _e=b.row.create(null,Fragment.from(_)),et=[];for(let nt=e.height;nt<d;nt++)et.push(_e);s.insert(s.mapping.slice(h).map(a+o.nodeSize-2),et)}return!!(j||$)}function isolateHorizontal(s,e,o,a,c,d,h,g){if(h==0||h==e.height)return!1;let b=!1;for(let j=c;j<d;j++){const $=h*e.width+j,_=e.map[$];if(e.map[$-e.width]==_){b=!0;const _e=o.nodeAt(_),{top:et,left:nt}=e.findCell(_);s.setNodeMarkup(s.mapping.slice(g).map(_+a),null,{..._e.attrs,rowspan:h-et}),s.insert(s.mapping.slice(g).map(e.positionAt(h,nt,o)),_e.type.createAndFill({..._e.attrs,rowspan:et+_e.attrs.rowspan-h})),j+=_e.attrs.colspan-1}}return b}function isolateVertical(s,e,o,a,c,d,h,g){if(h==0||h==e.width)return!1;let b=!1;for(let j=c;j<d;j++){const $=j*e.width+h,_=e.map[$];if(e.map[$-1]==_){b=!0;const _e=o.nodeAt(_),et=e.colCount(_),nt=s.mapping.slice(g).map(_+a);s.setNodeMarkup(nt,null,removeColSpan(_e.attrs,h-et,_e.attrs.colspan-(h-et))),s.insert(nt+_e.nodeSize,_e.type.createAndFill(removeColSpan(_e.attrs,0,h-et))),j+=_e.attrs.rowspan-1}}return b}function insertCells(s,e,o,a,c){let d=o?s.doc.nodeAt(o-1):s.doc;if(!d)throw new Error("No table found");let h=TableMap.get(d);const{top:g,left:b}=a,j=b+c.width,$=g+c.height,_=s.tr;let _e=0;function et(){if(d=o?_.doc.nodeAt(o-1):_.doc,!d)throw new Error("No table found");h=TableMap.get(d),_e=_.mapping.maps.length}growTable(_,h,d,o,j,$,_e)&&et(),isolateHorizontal(_,h,d,o,b,j,g,_e)&&et(),isolateHorizontal(_,h,d,o,b,j,$,_e)&&et(),isolateVertical(_,h,d,o,g,$,b,_e)&&et(),isolateVertical(_,h,d,o,g,$,j,_e)&&et();for(let nt=g;nt<$;nt++){const rt=h.positionAt(nt,b,d),it=h.positionAt(nt,j,d);_.replace(_.mapping.slice(_e).map(rt+o),_.mapping.slice(_e).map(it+o),new Slice(c.rows[nt-g],0,0))}et(),_.setSelection(new CellSelection(_.doc.resolve(o+h.positionAt(g,b,d)),_.doc.resolve(o+h.positionAt($-1,j-1,d)))),e(_)}const handleKeyDown=keydownHandler({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1),"Shift-ArrowLeft":shiftArrow("horiz",-1),"Shift-ArrowRight":shiftArrow("horiz",1),"Shift-ArrowUp":shiftArrow("vert",-1),"Shift-ArrowDown":shiftArrow("vert",1),Backspace:deleteCellSelection,"Mod-Backspace":deleteCellSelection,Delete:deleteCellSelection,"Mod-Delete":deleteCellSelection});function maybeSetSelection(s,e,o){return o.eq(s.selection)?!1:(e&&e(s.tr.setSelection(o).scrollIntoView()),!0)}function arrow(s,e){return(o,a,c)=>{if(!c)return!1;const d=o.selection;if(d instanceof CellSelection)return maybeSetSelection(o,a,Selection$2.near(d.$headCell,e));if(s!="horiz"&&!d.empty)return!1;const h=atEndOfCell(c,s,e);if(h==null)return!1;if(s=="horiz")return maybeSetSelection(o,a,Selection$2.near(o.doc.resolve(d.head+e),e));{const g=o.doc.resolve(h),b=nextCell(g,s,e);let j;return b?j=Selection$2.near(b,1):e<0?j=Selection$2.near(o.doc.resolve(g.before(-1)),-1):j=Selection$2.near(o.doc.resolve(g.after(-1)),1),maybeSetSelection(o,a,j)}}}function shiftArrow(s,e){return(o,a,c)=>{if(!c)return!1;const d=o.selection;let h;if(d instanceof CellSelection)h=d;else{const b=atEndOfCell(c,s,e);if(b==null)return!1;h=new CellSelection(o.doc.resolve(b))}const g=nextCell(h.$headCell,s,e);return g?maybeSetSelection(o,a,new CellSelection(h.$anchorCell,g)):!1}}function handleTripleClick(s,e){const o=s.state.doc,a=cellAround(o.resolve(e));return a?(s.dispatch(s.state.tr.setSelection(new CellSelection(a))),!0):!1}function handlePaste(s,e,o){if(!isInTable(s.state))return!1;let a=pastedCells(o);const c=s.state.selection;if(c instanceof CellSelection){a||(a={width:1,height:1,rows:[Fragment.from(fitSlice(tableNodeTypes(s.state.schema).cell,o))]});const d=c.$anchorCell.node(-1),h=c.$anchorCell.start(-1),g=TableMap.get(d).rectBetween(c.$anchorCell.pos-h,c.$headCell.pos-h);return a=clipCells(a,g.right-g.left,g.bottom-g.top),insertCells(s.state,s.dispatch,h,g,a),!0}else if(a){const d=selectionCell(s.state),h=d.start(-1);return insertCells(s.state,s.dispatch,h,TableMap.get(d.node(-1)).findCell(d.pos-h),a),!0}else return!1}function handleMouseDown$1(s,e){var o;if(e.button!=0||e.ctrlKey||e.metaKey)return;const a=domInCell(s,e.target);let c;if(e.shiftKey&&s.state.selection instanceof CellSelection)d(s.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&a&&(c=cellAround(s.state.selection.$anchor))!=null&&((o=cellUnderMouse(s,e))===null||o===void 0?void 0:o.pos)!=c.pos)d(c,e),e.preventDefault();else if(!a)return;function d(b,j){let $=cellUnderMouse(s,j);const _=tableEditingKey.getState(s.state)==null;if(!$||!inSameTable(b,$))if(_)$=b;else return;const _e=new CellSelection(b,$);if(_||!s.state.selection.eq(_e)){const et=s.state.tr.setSelection(_e);_&&et.setMeta(tableEditingKey,b.pos),s.dispatch(et)}}function h(){s.root.removeEventListener("mouseup",h),s.root.removeEventListener("dragstart",h),s.root.removeEventListener("mousemove",g),tableEditingKey.getState(s.state)!=null&&s.dispatch(s.state.tr.setMeta(tableEditingKey,-1))}function g(b){const j=b,$=tableEditingKey.getState(s.state);let _;if($!=null)_=s.state.doc.resolve($);else if(domInCell(s,j.target)!=a&&(_=cellUnderMouse(s,e),!_))return h();_&&d(_,j)}s.root.addEventListener("mouseup",h),s.root.addEventListener("dragstart",h),s.root.addEventListener("mousemove",g)}function atEndOfCell(s,e,o){if(!(s.state.selection instanceof TextSelection))return null;const{$head:a}=s.state.selection;for(let c=a.depth-1;c>=0;c--){const d=a.node(c);if((o<0?a.index(c):a.indexAfter(c))!=(o<0?0:d.childCount))return null;if(d.type.spec.tableRole=="cell"||d.type.spec.tableRole=="header_cell"){const h=a.before(c),g=e=="vert"?o>0?"down":"up":o>0?"right":"left";return s.endOfTextblock(g)?h:null}}return null}function domInCell(s,e){for(;e&&e!=s.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function cellUnderMouse(s,e){const o=s.posAtCoords({left:e.clientX,top:e.clientY});if(!o)return null;let{inside:a,pos:c}=o;return a>=0&&cellAround(s.state.doc.resolve(a))||cellAround(s.state.doc.resolve(c))}var TableView$1=class{constructor(e,o){this.node=e,this.defaultCellMinWidth=o,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${o}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),updateColumnsOnResize(e,this.colgroup,this.table,o),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,updateColumnsOnResize(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function updateColumnsOnResize(s,e,o,a,c,d){let h=0,g=!0,b=e.firstChild;const j=s.firstChild;if(j){for(let _=0,_e=0;_<j.childCount;_++){const{colspan:et,colwidth:nt}=j.child(_).attrs;for(let rt=0;rt<et;rt++,_e++){const it=c==_e?d:nt&&nt[rt],st=it?it+"px":"";if(h+=it||a,it||(g=!1),b)b.style.width!=st&&(b.style.width=st),b=b.nextSibling;else{const lt=document.createElement("col");lt.style.width=st,e.appendChild(lt)}}}for(;b;){var $;const _=b.nextSibling;($=b.parentNode)===null||$===void 0||$.removeChild(b),b=_}g?(o.style.width=h+"px",o.style.minWidth=""):(o.style.width="",o.style.minWidth=h+"px")}}const columnResizingPluginKey=new PluginKey("tableColumnResizing");function columnResizing({handleWidth:s=5,cellMinWidth:e=25,defaultCellMinWidth:o=100,View:a=TableView$1,lastColumnResizable:c=!0}={}){const d=new Plugin({key:columnResizingPluginKey,state:{init(h,g){var b;const j=(b=d.spec)===null||b===void 0||(b=b.props)===null||b===void 0?void 0:b.nodeViews,$=tableNodeTypes(g.schema).table.name;return a&&j&&(j[$]=(_,_e)=>new a(_,o,_e)),new ResizeState(-1,!1)},apply(h,g){return g.apply(h)}},props:{attributes:h=>{const g=columnResizingPluginKey.getState(h);return g&&g.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(h,g)=>{handleMouseMove(h,g,s,c)},mouseleave:h=>{handleMouseLeave(h)},mousedown:(h,g)=>{handleMouseDown(h,g,e,o)}},decorations:h=>{const g=columnResizingPluginKey.getState(h);if(g&&g.activeHandle>-1)return handleDecorations(h,g.activeHandle)},nodeViews:{}}});return d}var ResizeState=class Xn{constructor(e,o){this.activeHandle=e,this.dragging=o}apply(e){const o=this,a=e.getMeta(columnResizingPluginKey);if(a&&a.setHandle!=null)return new Xn(a.setHandle,!1);if(a&&a.setDragging!==void 0)return new Xn(o.activeHandle,a.setDragging);if(o.activeHandle>-1&&e.docChanged){let c=e.mapping.map(o.activeHandle,-1);return pointsAtCell(e.doc.resolve(c))||(c=-1),new Xn(c,o.dragging)}return o}};function handleMouseMove(s,e,o,a){if(!s.editable)return;const c=columnResizingPluginKey.getState(s.state);if(c&&!c.dragging){const d=domCellAround(e.target);let h=-1;if(d){const{left:g,right:b}=d.getBoundingClientRect();e.clientX-g<=o?h=edgeCell(s,e,"left",o):b-e.clientX<=o&&(h=edgeCell(s,e,"right",o))}if(h!=c.activeHandle){if(!a&&h!==-1){const g=s.state.doc.resolve(h),b=g.node(-1),j=TableMap.get(b),$=g.start(-1);if(j.colCount(g.pos-$)+g.nodeAfter.attrs.colspan-1==j.width-1)return}updateHandle(s,h)}}}function handleMouseLeave(s){if(!s.editable)return;const e=columnResizingPluginKey.getState(s.state);e&&e.activeHandle>-1&&!e.dragging&&updateHandle(s,-1)}function handleMouseDown(s,e,o,a){var c;if(!s.editable)return!1;const d=(c=s.dom.ownerDocument.defaultView)!==null&&c!==void 0?c:window,h=columnResizingPluginKey.getState(s.state);if(!h||h.activeHandle==-1||h.dragging)return!1;const g=s.state.doc.nodeAt(h.activeHandle),b=currentColWidth(s,h.activeHandle,g.attrs);s.dispatch(s.state.tr.setMeta(columnResizingPluginKey,{setDragging:{startX:e.clientX,startWidth:b}}));function j(_){d.removeEventListener("mouseup",j),d.removeEventListener("mousemove",$);const _e=columnResizingPluginKey.getState(s.state);_e!=null&&_e.dragging&&(updateColumnWidth(s,_e.activeHandle,draggedWidth(_e.dragging,_,o)),s.dispatch(s.state.tr.setMeta(columnResizingPluginKey,{setDragging:null})))}function $(_){if(!_.which)return j(_);const _e=columnResizingPluginKey.getState(s.state);if(_e&&_e.dragging){const et=draggedWidth(_e.dragging,_,o);displayColumnWidth(s,_e.activeHandle,et,a)}}return displayColumnWidth(s,h.activeHandle,b,a),d.addEventListener("mouseup",j),d.addEventListener("mousemove",$),e.preventDefault(),!0}function currentColWidth(s,e,{colspan:o,colwidth:a}){const c=a&&a[a.length-1];if(c)return c;const d=s.domAtPos(e);let h=d.node.childNodes[d.offset].offsetWidth,g=o;if(a)for(let b=0;b<o;b++)a[b]&&(h-=a[b],g--);return h/g}function domCellAround(s){for(;s&&s.nodeName!="TD"&&s.nodeName!="TH";)s=s.classList&&s.classList.contains("ProseMirror")?null:s.parentNode;return s}function edgeCell(s,e,o,a){const c=o=="right"?-a:a,d=s.posAtCoords({left:e.clientX+c,top:e.clientY});if(!d)return-1;const{pos:h}=d,g=cellAround(s.state.doc.resolve(h));if(!g)return-1;if(o=="right")return g.pos;const b=TableMap.get(g.node(-1)),j=g.start(-1),$=b.map.indexOf(g.pos-j);return $%b.width==0?-1:j+b.map[$-1]}function draggedWidth(s,e,o){const a=e.clientX-s.startX;return Math.max(o,s.startWidth+a)}function updateHandle(s,e){s.dispatch(s.state.tr.setMeta(columnResizingPluginKey,{setHandle:e}))}function updateColumnWidth(s,e,o){const a=s.state.doc.resolve(e),c=a.node(-1),d=TableMap.get(c),h=a.start(-1),g=d.colCount(a.pos-h)+a.nodeAfter.attrs.colspan-1,b=s.state.tr;for(let j=0;j<d.height;j++){const $=j*d.width+g;if(j&&d.map[$]==d.map[$-d.width])continue;const _=d.map[$],_e=c.nodeAt(_).attrs,et=_e.colspan==1?0:g-d.colCount(_);if(_e.colwidth&&_e.colwidth[et]==o)continue;const nt=_e.colwidth?_e.colwidth.slice():zeroes(_e.colspan);nt[et]=o,b.setNodeMarkup(h+_,null,{..._e,colwidth:nt})}b.docChanged&&s.dispatch(b)}function displayColumnWidth(s,e,o,a){const c=s.state.doc.resolve(e),d=c.node(-1),h=c.start(-1),g=TableMap.get(d).colCount(c.pos-h)+c.nodeAfter.attrs.colspan-1;let b=s.domAtPos(c.start(-1)).node;for(;b&&b.nodeName!="TABLE";)b=b.parentNode;b&&updateColumnsOnResize(d,b.firstChild,b,a,g,o)}function zeroes(s){return Array(s).fill(0)}function handleDecorations(s,e){const o=[],a=s.doc.resolve(e),c=a.node(-1);if(!c)return DecorationSet.empty;const d=TableMap.get(c),h=a.start(-1),g=d.colCount(a.pos-h)+a.nodeAfter.attrs.colspan-1;for(let j=0;j<d.height;j++){const $=g+j*d.width;if((g==d.width-1||d.map[$]!=d.map[$+1])&&(j==0||d.map[$]!=d.map[$-d.width])){var b;const _=d.map[$],_e=h+_+c.nodeAt(_).nodeSize-1,et=document.createElement("div");et.className="column-resize-handle",!((b=columnResizingPluginKey.getState(s))===null||b===void 0)&&b.dragging&&o.push(Decoration$1.node(h+_,h+_+c.nodeAt(_).nodeSize,{class:"column-resize-dragging"})),o.push(Decoration$1.widget(_e,et))}}return DecorationSet.create(s.doc,o)}function tableEditing({allowTableNodeSelection:s=!1}={}){return new Plugin({key:tableEditingKey,state:{init(){return null},apply(e,o){const a=e.getMeta(tableEditingKey);if(a!=null)return a==-1?null:a;if(o==null||!e.docChanged)return o;const{deleted:c,pos:d}=e.mapping.mapResult(o);return c?null:d}},props:{decorations:drawCellSelection,handleDOMEvents:{mousedown:handleMouseDown$1},createSelectionBetween(e){return tableEditingKey.getState(e.state)!=null?e.state.selection:null},handleTripleClick,handleKeyDown,handlePaste},appendTransaction(e,o,a){return normalizeSelection(a,fixTables(a,o),s)}})}function getColStyleDeclaration(s,e){return e?["width",`${Math.max(e,s)}px`]:["min-width",`${s}px`]}function updateColumns(s,e,o,a,c,d){var h;let g=0,b=!0,j=e.firstChild;const $=s.firstChild;if($!==null)for(let _=0,_e=0;_<$.childCount;_+=1){const{colspan:et,colwidth:nt}=$.child(_).attrs;for(let rt=0;rt<et;rt+=1,_e+=1){const it=c===_e?d:nt&&nt[rt],st=it?`${it}px`:"";if(g+=it||a,it||(b=!1),j){if(j.style.width!==st){const[lt,ot]=getColStyleDeclaration(a,it);j.style.setProperty(lt,ot)}j=j.nextSibling}else{const lt=document.createElement("col"),[ot,ct]=getColStyleDeclaration(a,it);lt.style.setProperty(ot,ct),e.appendChild(lt)}}}for(;j;){const _=j.nextSibling;(h=j.parentNode)===null||h===void 0||h.removeChild(j),j=_}b?(o.style.width=`${g}px`,o.style.minWidth=""):(o.style.width="",o.style.minWidth=`${g}px`)}class TableView{constructor(e,o){this.node=e,this.cellMinWidth=o,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),updateColumns(e,this.colgroup,this.table,o),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,updateColumns(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function createColGroup(s,e,o,a){let c=0,d=!0;const h=[],g=s.firstChild;if(!g)return{};for(let _=0,_e=0;_<g.childCount;_+=1){const{colspan:et,colwidth:nt}=g.child(_).attrs;for(let rt=0;rt<et;rt+=1,_e+=1){const it=o===_e?a:nt&&nt[rt];c+=it||e,it||(d=!1);const[st,lt]=getColStyleDeclaration(e,it);h.push(["col",{style:`${st}: ${lt}`}])}}const b=d?`${c}px`:"",j=d?"":`${c}px`;return{colgroup:["colgroup",{},...h],tableWidth:b,tableMinWidth:j}}function createCell(s,e){return s.createAndFill()}function getTableNodeTypes(s){if(s.cached.tableNodeTypes)return s.cached.tableNodeTypes;const e={};return Object.keys(s.nodes).forEach(o=>{const a=s.nodes[o];a.spec.tableRole&&(e[a.spec.tableRole]=a)}),s.cached.tableNodeTypes=e,e}function createTable(s,e,o,a,c){const d=getTableNodeTypes(s),h=[],g=[];for(let j=0;j<o;j+=1){const $=createCell(d.cell);if($&&g.push($),a){const _=createCell(d.header_cell);_&&h.push(_)}}const b=[];for(let j=0;j<e;j+=1)b.push(d.row.createChecked(null,a&&j===0?h:g));return d.table.createChecked(null,b)}function isCellSelection(s){return s instanceof CellSelection}const deleteTableWhenAllCellsSelected=({editor:s})=>{const{selection:e}=s.state;if(!isCellSelection(e))return!1;let o=0;const a=findParentNodeClosestToPos(e.ranges[0].$from,d=>d.type.name==="table");return a==null||a.node.descendants(d=>{if(d.type.name==="table")return!1;["tableCell","tableHeader"].includes(d.type.name)&&(o+=1)}),o===e.ranges.length?(s.commands.deleteTable(),!0):!1},Table=Node.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:TableView,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:s,HTMLAttributes:e}){const{colgroup:o,tableWidth:a,tableMinWidth:c}=createColGroup(s,this.options.cellMinWidth),d=["table",mergeAttributes(this.options.HTMLAttributes,e,{style:a?`width: ${a}`:`min-width: ${c}`}),o,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},d]:d},addCommands(){return{insertTable:({rows:s=3,cols:e=3,withHeaderRow:o=!0}={})=>({tr:a,dispatch:c,editor:d})=>{const h=createTable(d.schema,s,e,o);if(c){const g=a.selection.from+1;a.replaceSelectionWith(h).scrollIntoView().setSelection(TextSelection.near(a.doc.resolve(g)))}return!0},addColumnBefore:()=>({state:s,dispatch:e})=>addColumnBefore(s,e),addColumnAfter:()=>({state:s,dispatch:e})=>addColumnAfter(s,e),deleteColumn:()=>({state:s,dispatch:e})=>deleteColumn(s,e),addRowBefore:()=>({state:s,dispatch:e})=>addRowBefore(s,e),addRowAfter:()=>({state:s,dispatch:e})=>addRowAfter(s,e),deleteRow:()=>({state:s,dispatch:e})=>deleteRow(s,e),deleteTable:()=>({state:s,dispatch:e})=>deleteTable(s,e),mergeCells:()=>({state:s,dispatch:e})=>mergeCells(s,e),splitCell:()=>({state:s,dispatch:e})=>splitCell(s,e),toggleHeaderColumn:()=>({state:s,dispatch:e})=>toggleHeader("column")(s,e),toggleHeaderRow:()=>({state:s,dispatch:e})=>toggleHeader("row")(s,e),toggleHeaderCell:()=>({state:s,dispatch:e})=>toggleHeaderCell(s,e),mergeOrSplit:()=>({state:s,dispatch:e})=>mergeCells(s,e)?!0:splitCell(s,e),setCellAttribute:(s,e)=>({state:o,dispatch:a})=>setCellAttr(s,e)(o,a),goToNextCell:()=>({state:s,dispatch:e})=>goToNextCell(1)(s,e),goToPreviousCell:()=>({state:s,dispatch:e})=>goToNextCell(-1)(s,e),fixTables:()=>({state:s,dispatch:e})=>(e&&fixTables(s),!0),setCellSelection:s=>({tr:e,dispatch:o})=>{if(o){const a=CellSelection.create(e.doc,s.anchorCell,s.headCell);e.setSelection(a)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:deleteTableWhenAllCellsSelected,"Mod-Backspace":deleteTableWhenAllCellsSelected,Delete:deleteTableWhenAllCellsSelected,"Mod-Delete":deleteTableWhenAllCellsSelected}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[columnResizing({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],tableEditing({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(s){const e={name:s.name,options:s.options,storage:s.storage};return{tableRole:callOrReturn(getExtensionField(s,"tableRole",e))}}}),TableRow=Node.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:s}){return["tr",mergeAttributes(this.options.HTMLAttributes,s),0]}}),TableCell=Node.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:s=>{const e=s.getAttribute("colwidth");return e?e.split(",").map(a=>parseInt(a,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:s}){return["td",mergeAttributes(this.options.HTMLAttributes,s),0]}}),TableHeader=Node.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:s=>{const e=s.getAttribute("colwidth");return e?e.split(",").map(a=>parseInt(a,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:s}){return["th",mergeAttributes(this.options.HTMLAttributes,s),0]}}),CustomInlineImage=Image.extend({inline:!0,group:"inline",addAttributes(){var s;return{...(s=this.parent)==null?void 0:s.call(this),width:{default:null,parseHTML:e=>e.getAttribute("width")||e.style.width,renderHTML:e=>e.width?{width:e.width}:{}},align:{default:"baseline",parseHTML:e=>e.style.verticalAlign||"baseline",renderHTML:e=>({style:`vertical-align: ${e.align||"baseline"}; margin: 0 0.25rem;`})}}}}),EDITOR_CLASS_NAME="passage-content max-w-none p-4 min-h-[200px] max-h-[50vh] overflow-y-auto focus:outline-none [&_.ProseMirror]:min-h-[180px] [&_.ProseMirror]:outline-none",ToolbarButton=({onClick:s,isActive:e,disabled:o,children:a,title:c,danger:d})=>jsxRuntimeExports.jsx("button",{type:"button",onClick:s,disabled:o,title:c,className:`p-1.5 rounded hover:bg-gray-100 transition-colors ${e?"bg-primary-100 text-primary-700":d?"text-red-500":"text-gray-600"} ${o?"opacity-50 cursor-not-allowed":""}`,children:a}),InlinePassageEditor=({passageId:s,initialContent:e,onSave:o,onCancel:a})=>{const[c,d]=reactExports.useState(!1),[h,g]=reactExports.useState(!1),b=useEditor({extensions:[StarterKit.configure({hardBreak:{keepMarks:!0}}),CustomInlineImage.configure({HTMLAttributes:{class:"rounded-lg max-w-full"}}),Link.configure({openOnClick:!1,HTMLAttributes:{class:"text-primary-600 underline"}}),Table.configure({resizable:!0,HTMLAttributes:{class:"border-collapse table-auto w-full"}}),TableRow,TableHeader.configure({HTMLAttributes:{class:"bg-gray-100 font-semibold"}}),TableCell.configure({HTMLAttributes:{class:"border border-gray-300 p-2"}}),Gapcursor],content:e,editable:!0,autofocus:"end"});reactExports.useEffect(()=>{const _e=et=>{et.key==="Escape"&&(h?g(!1):a())};return window.addEventListener("keydown",_e),()=>window.removeEventListener("keydown",_e)},[h,a]);const j=async()=>{if(b){d(!0);try{const _e=b.getHTML();await api.put(`/admin/passages/${s}`,{content:_e}),o(_e)}catch(_e){console.error("Failed to save passage:",_e),alert("Failed to save. Please try again.")}finally{d(!1)}}},$=()=>{if(!b)return;const _e=b.getAttributes("link").href,et=prompt("Enter URL:",_e);if(et!==null){if(et===""){b.chain().focus().extendMarkRange("link").unsetLink().run();return}b.chain().focus().extendMarkRange("link").setLink({href:et}).run()}};if(!b)return null;const _=()=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border-b border-gray-200 p-2 flex flex-wrap gap-0.5 items-center",children:[jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleBold().run(),isActive:b.isActive("bold"),title:"Bold",children:jsxRuntimeExports.jsx(Bold$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleItalic().run(),isActive:b.isActive("italic"),title:"Italic",children:jsxRuntimeExports.jsx(Italic$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleStrike().run(),isActive:b.isActive("strike"),title:"Strikethrough",children:jsxRuntimeExports.jsx(Strikethrough,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleCode().run(),isActive:b.isActive("code"),title:"Inline Code",children:jsxRuntimeExports.jsx(Code$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleHeading({level:1}).run(),isActive:b.isActive("heading",{level:1}),title:"Heading 1",children:jsxRuntimeExports.jsx(Heading1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleHeading({level:2}).run(),isActive:b.isActive("heading",{level:2}),title:"Heading 2",children:jsxRuntimeExports.jsx(Heading2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleHeading({level:3}).run(),isActive:b.isActive("heading",{level:3}),title:"Heading 3",children:jsxRuntimeExports.jsx(Heading3,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleBulletList().run(),isActive:b.isActive("bulletList"),title:"Bullet List",children:jsxRuntimeExports.jsx(List,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleOrderedList().run(),isActive:b.isActive("orderedList"),title:"Numbered List",children:jsxRuntimeExports.jsx(ListOrdered,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().toggleBlockquote().run(),isActive:b.isActive("blockquote"),title:"Quote",children:jsxRuntimeExports.jsx(Quote,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().setHorizontalRule().run(),title:"Horizontal Rule",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:$,isActive:b.isActive("link"),title:"Add Link",children:jsxRuntimeExports.jsx(Link$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),title:"Insert Table",children:jsxRuntimeExports.jsx(Table$1,{className:"w-4 h-4"})}),b.isActive("table")&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().addColumnAfter().run(),title:"Add Column",children:jsxRuntimeExports.jsx(Columns,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().addRowAfter().run(),title:"Add Row",children:jsxRuntimeExports.jsx(Rows,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().deleteColumn().run(),title:"Delete Column",danger:!0,children:jsxRuntimeExports.jsx(Columns,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().deleteRow().run(),title:"Delete Row",danger:!0,children:jsxRuntimeExports.jsx(Rows,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().mergeCells().run(),title:"Merge Cells",children:jsxRuntimeExports.jsx(Merge,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().splitCell().run(),title:"Split Cell",children:jsxRuntimeExports.jsx(Split,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().deleteTable().run(),title:"Delete Table",danger:!0,children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().undo().run(),disabled:!b.can().undo(),title:"Undo",children:jsxRuntimeExports.jsx(Undo,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(ToolbarButton,{onClick:()=>b.chain().focus().redo().run(),disabled:!b.can().redo(),title:"Redo",children:jsxRuntimeExports.jsx(Redo,{className:"w-4 h-4"})})]});return h?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-lg",children:"Edit Passage Content"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Press ESC to minimize"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>g(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Minimize",children:jsxRuntimeExports.jsx(Minimize2,{className:"w-5 h-5"})})]})]}),_(),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-auto",children:jsxRuntimeExports.jsx("div",{className:"max-w-4xl mx-auto",children:jsxRuntimeExports.jsx(EditorContent,{editor:b,className:EDITOR_CLASS_NAME})})}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:j,disabled:c,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"}),c?"Saving...":"Save"]})]})]}):jsxRuntimeExports.jsxs("div",{className:"border border-primary-300 rounded-xl overflow-hidden bg-white shadow-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary-50 border-b border-primary-200",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-primary-700",children:"Editing Mode"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>g(!0),className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-white rounded transition-colors",title:"Maximize",children:jsxRuntimeExports.jsx(Maximize2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsxs("button",{onClick:a,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800 hover:bg-white rounded transition-colors flex items-center gap-1",children:[jsxRuntimeExports.jsx(X,{className:"w-4 h-4"}),"Cancel"]}),jsxRuntimeExports.jsxs("button",{onClick:j,disabled:c,className:"px-3 py-1.5 text-sm bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center gap-1",children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"}),c?"Saving...":"Save"]})]})]}),_(),jsxRuntimeExports.jsx(EditorContent,{editor:b,className:EDITOR_CLASS_NAME})]})};function generateUniqueId(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const BRANCH_DATA_MARKER="<!--BRANCH_DATA:",BRANCH_DATA_END="-->";function parseBranchData(s){const e=s.lastIndexOf(BRANCH_DATA_MARKER);if(e===-1)return{content:s,branchData:null};const o=s.indexOf(BRANCH_DATA_END,e);if(o===-1)return{content:s,branchData:null};const a=s.substring(e+BRANCH_DATA_MARKER.length,o),c=s.substring(0,e).trimEnd();try{const d=JSON.parse(a);return d.choices=d.choices.map(h=>({...h,id:h.id||generateUniqueId()})),{content:c,branchData:d}}catch{return{content:c,branchData:null}}}function serializeBranchData(s,e){const{content:o}=parseBranchData(s);if(!e||e.choices.length===0)return o;const a=JSON.stringify(e);return`${o}
${BRANCH_DATA_MARKER}${a}${BRANCH_DATA_END}`}function createDefaultBranchData(){return{choices:[{id:generateUniqueId(),button:"Option A",description:"Description for option A"},{id:generateUniqueId(),button:"Option B",description:"Description for option B"}]}}const PASSAGE_TYPE_CONFIG={start:{bg:"bg-gradient-to-r from-emerald-400 to-green-500",text:"text-white",icon:Play,label:"Start"},end:{bg:"bg-gradient-to-r from-rose-400 to-red-500",text:"text-white",icon:Flag,label:"End"},branch:{bg:"bg-gradient-to-r from-amber-400 to-orange-500",text:"text-white",icon:GitFork,label:"Branch"},content:{bg:"bg-gradient-to-r from-violet-400 to-purple-500",text:"text-white",icon:FileText,label:"Content"}},TWINE_STATE_KEY="twine_story_state",PassageView=({context:s})=>{const{passage:e,available_links:o}=s,{bookmarks:a,addBookmark:c,removeBookmark:d,navigateToPassage:h,navigateViaLink:g,currentStory:b,refreshCurrentPassage:j,storyStructure:$}=useStoryStore(),{isAuthenticated:_,user:_e}=useAuthStore(),[et,nt]=reactExports.useState(!1),[rt,it]=reactExports.useState(e.content),{content:st,branchData:lt}=parseBranchData(e.content||""),ot=(lt==null?void 0:lt.choices)||[],ct=[...o].filter(wt=>wt.condition_type!=="user_selection").sort((wt,St)=>wt.link_order-St.link_order),ut=_&&_e&&(_e.role==="super_admin"||_e.role==="editor");reactExports.useEffect(()=>{it(e.content),nt(!1)},[e.id,e.content]);const[at,dt]=reactExports.useState(()=>{try{const wt=sessionStorage.getItem(`${TWINE_STATE_KEY}_${b==null?void 0:b.id}`);if(wt)return JSON.parse(wt)}catch{}return createInitialState()});reactExports.useEffect(()=>{dt(wt=>({...wt,currentPassage:e.name,visitedPassages:wt.visitedPassages.includes(e.name)?wt.visitedPassages:[...wt.visitedPassages,e.name]}))},[e.name]),reactExports.useEffect(()=>{b!=null&&b.id&&sessionStorage.setItem(`${TWINE_STATE_KEY}_${b.id}`,JSON.stringify(at))},[at,b==null?void 0:b.id]);const ft=a.some(wt=>wt.passage_id===e.id),xt=async()=>{ft?await d(e.id):await c(e.id)},Ct=reactExports.useCallback(wt=>{dt(wt)},[]),yt=reactExports.useCallback(wt=>{h(wt)},[h]),Et=extractLinksFromContent(e.content||""),Tt=PASSAGE_TYPE_CONFIG[e.passage_type]||PASSAGE_TYPE_CONFIG.content,ht=Tt.icon;return jsxRuntimeExports.jsxs("article",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden max-w-4xl mx-auto transition-all duration-300 hover:shadow-xl",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-violet-500 via-purple-500 to-fuchsia-500"}),jsxRuntimeExports.jsx("div",{className:"p-8 pt-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2 mb-3",children:jsxRuntimeExports.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-semibold rounded-full shadow-sm ${Tt.bg} ${Tt.text}`,children:[jsxRuntimeExports.jsx(ht,{className:"w-3.5 h-3.5"}),Tt.label]})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight leading-tight",children:e.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[ut&&!et&&e.passage_type!=="branch"&&e.passage_type!=="start"&&jsxRuntimeExports.jsx("button",{onClick:()=>nt(!0),className:"group p-2.5 rounded-xl bg-violet-50 hover:bg-violet-100 text-violet-600 transition-all duration-200 hover:scale-105",title:"Edit passage",children:jsxRuntimeExports.jsx(Pencil,{className:"w-5 h-5 transition-transform group-hover:rotate-12"})}),ut&&(e.passage_type==="branch"||e.passage_type==="start")&&jsxRuntimeExports.jsx("div",{className:"px-3 py-1.5 text-xs font-medium bg-amber-50 text-amber-700 rounded-xl border border-amber-200",children:jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-3.5 h-3.5"})," "]})}),_&&jsxRuntimeExports.jsx("button",{onClick:xt,className:`group p-2.5 rounded-xl transition-all duration-200 hover:scale-105 ${ft?"bg-violet-100 text-violet-600":"bg-gray-50 hover:bg-gray-100 text-gray-400 hover:text-violet-500"}`,title:ft?"Remove bookmark":"Add bookmark",children:ft?jsxRuntimeExports.jsx(BookmarkCheck,{className:"w-5 h-5 transition-transform group-hover:scale-110"}):jsxRuntimeExports.jsx(Bookmark,{className:"w-5 h-5 transition-transform group-hover:scale-110"})})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-8 pb-8",children:[et?jsxRuntimeExports.jsx(InlinePassageEditor,{passageId:e.id,initialContent:rt||"",onSave:wt=>{it(wt),nt(!1),j&&j()},onCancel:()=>nt(!1)}):jsxRuntimeExports.jsx(TwinePassageRenderer,{content:e.passage_type==="branch"||e.passage_type==="start"?st:rt||"",state:at,onStateChange:Ct,onNavigate:yt,passages:($==null?void 0:$.passages)||[]}),(e.passage_type==="branch"||e.passage_type==="start")&&ot.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-10 pt-8 border-t border-gray-100",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-amber-200 to-amber-400"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-400 to-orange-400 blur-lg opacity-30 animate-pulse"}),jsxRuntimeExports.jsxs("div",{className:"relative flex items-center gap-2.5 px-5 py-2.5 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-full shadow-sm",children:[jsxRuntimeExports.jsx(GitFork,{className:"w-5 h-5 text-amber-600"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-amber-700 uppercase tracking-wider",children:"Choose Your Path"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-gradient-to-l from-transparent via-amber-200 to-amber-400"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:ot.map((wt,St)=>{const bt=ct[St],mt=()=>{bt&&g(bt.id)},gt=["from-violet-500 to-purple-600","from-blue-500 to-indigo-600","from-emerald-500 to-teal-600","from-amber-500 to-orange-600","from-rose-500 to-pink-600"],pt=gt[St%gt.length];return jsxRuntimeExports.jsxs("button",{onClick:mt,disabled:!bt,className:`w-full group relative overflow-hidden rounded-2xl text-left transition-all duration-300 ${bt?"cursor-pointer hover:scale-[1.02] hover:shadow-xl":"opacity-50 cursor-not-allowed"}`,children:[jsxRuntimeExports.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${pt} opacity-0 group-hover:opacity-100 transition-opacity duration-300`}),jsxRuntimeExports.jsxs("div",{className:`relative m-[2px] rounded-[14px] p-5 transition-colors duration-300 ${bt?"bg-white group-hover:bg-gray-50":"bg-gray-50"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-5",children:[jsxRuntimeExports.jsxs("div",{className:`relative flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg transition-transform duration-300 group-hover:scale-110 ${bt?`bg-gradient-to-br ${pt} text-white shadow-lg`:"bg-gray-200 text-gray-400"}`,children:[jsxRuntimeExports.jsx("span",{className:"relative z-10",children:St+1}),bt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 rounded-xl bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:`font-semibold text-lg mb-1 transition-colors duration-200 ${bt?"text-gray-800 group-hover:text-gray-900":"text-gray-400"}`,children:wt.button||`Option ${St+1}`}),wt.description&&jsxRuntimeExports.jsx("p",{className:`text-sm line-clamp-2 ${bt?"text-gray-500 group-hover:text-gray-600":"text-gray-400"}`,children:wt.description})]}),jsxRuntimeExports.jsx("div",{className:`flex-shrink-0 p-2 rounded-full transition-all duration-300 ${bt?`bg-gradient-to-r ${pt} text-white shadow-md opacity-50 group-hover:opacity-100 group-hover:translate-x-1`:"bg-gray-200 text-gray-400"}`,children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5"})})]}),!bt&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex items-center gap-1.5 text-xs text-red-500 font-medium",children:[jsxRuntimeExports.jsx("span",{className:"w-4 h-4 rounded-full bg-red-100 flex items-center justify-center text-red-500",children:"!"}),"Not connected to a passage"]})]})]},St)})}),ot.length===0&&ct.length>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-5 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl border border-amber-200 shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-gradient-to-br from-amber-400 to-orange-400 rounded-xl text-white shadow-md",children:jsxRuntimeExports.jsx(GitFork,{className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-amber-800",children:"Decision Point"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-600",children:"Choose your path below to continue"})]})]})]}),(e.passage_type==="branch"||e.passage_type==="start")&&ot.length===0&&jsxRuntimeExports.jsx("div",{className:"mt-8 pt-8 border-t border-gray-100",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 p-5 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl border border-amber-200 shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-gradient-to-br from-amber-400 to-orange-400 rounded-xl text-white shadow-md",children:jsxRuntimeExports.jsx(GitFork,{className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-amber-800",children:"Decision Point"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-600",children:"Choose your path below to continue"})]})]})}),Et.length>0&&e.passage_type!=="branch"&&e.passage_type!=="start"&&jsxRuntimeExports.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-100",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-gray-600 mb-4 uppercase tracking-wide",children:"Continue to:"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-3",children:Et.map((wt,St)=>jsxRuntimeExports.jsxs("button",{onClick:()=>yt(wt),className:"group relative px-5 py-2.5 bg-gradient-to-r from-violet-50 to-purple-50 text-violet-700 rounded-xl hover:from-violet-100 hover:to-purple-100 transition-all duration-200 text-sm font-medium border border-violet-200 hover:border-violet-300 hover:shadow-md hover:scale-105",children:[jsxRuntimeExports.jsx("span",{className:"relative z-10",children:wt}),jsxRuntimeExports.jsx(ChevronRight,{className:"inline-block w-4 h-4 ml-1 opacity-0 group-hover:opacity-100 transition-opacity"})]},St))})]}),e.tags.length>0&&jsxRuntimeExports.jsx("div",{className:"mt-8 pt-6 border-t border-gray-100",children:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map((wt,St)=>jsxRuntimeExports.jsxs("span",{className:"px-3 py-1.5 text-xs font-medium bg-gray-100 text-gray-600 rounded-full hover:bg-gray-200 transition-colors cursor-default",children:["#",wt]},St))})}),Object.keys(at.variables).length>0&&jsxRuntimeExports.jsx("div",{className:"mt-6 pt-6 border-t border-gray-100",children:jsxRuntimeExports.jsxs("details",{className:"text-sm text-gray-500 group",children:[jsxRuntimeExports.jsxs("summary",{className:"cursor-pointer hover:text-gray-700 font-medium flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center text-xs",children:Object.keys(at.variables).length}),"Story Variables"]}),jsxRuntimeExports.jsx("pre",{className:"mt-3 p-4 bg-gray-50 rounded-xl text-xs overflow-auto font-mono border border-gray-100",children:JSON.stringify(at.variables,null,2)})]})})]})]})},PassageNav=({context:s})=>{const e=useNavigate(),{goBack:o,navigateViaLink:a,navigationHistory:c}=useStoryStore(),{passage:d,available_links:h,is_end:g}=s,b=c.length>1,j=h.filter(nt=>nt.condition_type==="user_selection"),_=[...h.filter(nt=>nt.condition_type!=="user_selection")].sort((nt,rt)=>nt.link_order-rt.link_order),_e=async nt=>{await a(nt)},et=()=>{localStorage.removeItem("last_visit"),e("/")};return jsxRuntimeExports.jsxs("div",{className:"fixed bottom-0 left-0 right-0 z-30",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white via-white/95 to-white/80 backdrop-blur-sm"}),jsxRuntimeExports.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-purple-300 to-transparent"}),jsxRuntimeExports.jsxs("div",{className:"relative px-6 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:o,disabled:!b,className:`group flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium transition-all duration-200 ${b?"text-gray-600 hover:text-gray-900 hover:bg-gray-100 active:scale-95":"text-gray-300 cursor-not-allowed"}`,children:[jsxRuntimeExports.jsx(ChevronLeft,{className:`w-5 h-5 transition-transform duration-200 ${b?"group-hover:-translate-x-0.5":""}`}),jsxRuntimeExports.jsx("span",{children:"Previous"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:d.passage_type==="branch"||d.passage_type==="start"?g&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Journey Complete"})]}),jsxRuntimeExports.jsxs("button",{onClick:et,className:"group flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200",children:[jsxRuntimeExports.jsx(RotateCcw,{className:"w-4 h-4 transition-transform group-hover:-rotate-180 duration-500"}),"Start Over"]})]}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:g?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[jsxRuntimeExports.jsx(Sparkles,{className:"w-4 h-4 text-amber-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Journey Complete"})]}),jsxRuntimeExports.jsxs("button",{onClick:et,className:"group flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200",children:[jsxRuntimeExports.jsx(RotateCcw,{className:"w-4 h-4 transition-transform group-hover:-rotate-180 duration-500"}),"Start Over"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[j.map(nt=>jsxRuntimeExports.jsxs("button",{onClick:()=>_e(nt.id),className:"group flex items-center gap-2 px-5 py-2.5 bg-white border-2 border-gray-200 text-gray-700 font-medium rounded-xl hover:border-violet-300 hover:bg-violet-50 hover:text-violet-700 transition-all duration-200 active:scale-95",children:[jsxRuntimeExports.jsx("span",{children:nt.name||"Choice"}),jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 transition-transform group-hover:translate-x-0.5"})]},nt.id)),_.map((nt,rt)=>{const it=_.length>1,st=it?`${rt+1}. `:"",lt=nt.name?`${st}${nt.name}`:it?`${rt+1}. Next`:"Next",ot=rt===0;return jsxRuntimeExports.jsxs("button",{onClick:()=>_e(nt.id),className:`group relative flex items-center gap-2 px-6 py-2.5 font-medium rounded-xl transition-all duration-200 active:scale-95 ${ot?"bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-lg hover:shadow-xl hover:scale-105":"bg-white border-2 border-gray-200 text-gray-700 hover:border-violet-300 hover:bg-violet-50 hover:text-violet-700"}`,children:[ot&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-500 to-purple-600 rounded-xl blur-lg opacity-30 group-hover:opacity-50 transition-opacity"}),jsxRuntimeExports.jsx("span",{className:"relative z-10",children:lt}),jsxRuntimeExports.jsx(ArrowRight,{className:"relative z-10 w-5 h-5 transition-transform duration-200 group-hover:translate-x-0.5 "})]},nt.id)})]})})}),jsxRuntimeExports.jsxs("button",{onClick:et,className:"group flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-all duration-200 active:scale-95",children:[jsxRuntimeExports.jsx(Home,{className:"w-4 h-4 transition-transform duration-200 group-hover:scale-110"}),jsxRuntimeExports.jsx("span",{children:"Change Path"})]})]}),c.length>1&&jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-white rounded-full shadow-sm border border-gray-100",children:[c.slice(-5).map((nt,rt)=>jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-colors ${rt===c.slice(-5).length-1?"bg-violet-500":"bg-gray-300"}`},rt)),c.length>5&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["+",c.length-5]})]})})]})]})};function cc(s){if(typeof s=="string"||typeof s=="number")return""+s;let e="";if(Array.isArray(s))for(let o=0,a;o<s.length;o++)(a=cc(s[o]))!==""&&(e+=(e&&" ")+a);else for(let o in s)s[o]&&(e+=(e&&" ")+o);return e}var noop={value:()=>{}};function dispatch(){for(var s=0,e=arguments.length,o={},a;s<e;++s){if(!(a=arguments[s]+"")||a in o||/[\s.]/.test(a))throw new Error("illegal type: "+a);o[a]=[]}return new Dispatch(o)}function Dispatch(s){this._=s}function parseTypenames$1(s,e){return s.trim().split(/^|\s+/).map(function(o){var a="",c=o.indexOf(".");if(c>=0&&(a=o.slice(c+1),o=o.slice(0,c)),o&&!e.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:a}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(s,e){var o=this._,a=parseTypenames$1(s+"",o),c,d=-1,h=a.length;if(arguments.length<2){for(;++d<h;)if((c=(s=a[d]).type)&&(c=get$1(o[c],s.name)))return c;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++d<h;)if(c=(s=a[d]).type)o[c]=set$1(o[c],s.name,e);else if(e==null)for(c in o)o[c]=set$1(o[c],s.name,null);return this},copy:function(){var s={},e=this._;for(var o in e)s[o]=e[o].slice();return new Dispatch(s)},call:function(s,e){if((c=arguments.length-2)>0)for(var o=new Array(c),a=0,c,d;a<c;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(d=this._[s],a=0,c=d.length;a<c;++a)d[a].value.apply(e,o)},apply:function(s,e,o){if(!this._.hasOwnProperty(s))throw new Error("unknown type: "+s);for(var a=this._[s],c=0,d=a.length;c<d;++c)a[c].value.apply(e,o)}};function get$1(s,e){for(var o=0,a=s.length,c;o<a;++o)if((c=s[o]).name===e)return c.value}function set$1(s,e,o){for(var a=0,c=s.length;a<c;++a)if(s[a].name===e){s[a]=noop,s=s.slice(0,a).concat(s.slice(a+1));break}return o!=null&&s.push({name:e,value:o}),s}var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(s){var e=s+="",o=e.indexOf(":");return o>=0&&(e=s.slice(0,o))!=="xmlns"&&(s=s.slice(o+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:s}:s}function creatorInherit(s){return function(){var e=this.ownerDocument,o=this.namespaceURI;return o===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(s):e.createElementNS(o,s)}}function creatorFixed(s){return function(){return this.ownerDocument.createElementNS(s.space,s.local)}}function creator(s){var e=namespace(s);return(e.local?creatorFixed:creatorInherit)(e)}function none$3(){}function selector(s){return s==null?none$3:function(){return this.querySelector(s)}}function selection_select(s){typeof s!="function"&&(s=selector(s));for(var e=this._groups,o=e.length,a=new Array(o),c=0;c<o;++c)for(var d=e[c],h=d.length,g=a[c]=new Array(h),b,j,$=0;$<h;++$)(b=d[$])&&(j=s.call(b,b.__data__,$,d))&&("__data__"in b&&(j.__data__=b.__data__),g[$]=j);return new Selection$1(a,this._parents)}function array(s){return s==null?[]:Array.isArray(s)?s:Array.from(s)}function empty$1(){return[]}function selectorAll(s){return s==null?empty$1:function(){return this.querySelectorAll(s)}}function arrayAll(s){return function(){return array(s.apply(this,arguments))}}function selection_selectAll(s){typeof s=="function"?s=arrayAll(s):s=selectorAll(s);for(var e=this._groups,o=e.length,a=[],c=[],d=0;d<o;++d)for(var h=e[d],g=h.length,b,j=0;j<g;++j)(b=h[j])&&(a.push(s.call(b,b.__data__,j,h)),c.push(b));return new Selection$1(a,c)}function matcher(s){return function(){return this.matches(s)}}function childMatcher(s){return function(e){return e.matches(s)}}var find$1=Array.prototype.find;function childFind(s){return function(){return find$1.call(this.children,s)}}function childFirst(){return this.firstElementChild}function selection_selectChild(s){return this.select(s==null?childFirst:childFind(typeof s=="function"?s:childMatcher(s)))}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function childrenFilter(s){return function(){return filter.call(this.children,s)}}function selection_selectChildren(s){return this.selectAll(s==null?children:childrenFilter(typeof s=="function"?s:childMatcher(s)))}function selection_filter(s){typeof s!="function"&&(s=matcher(s));for(var e=this._groups,o=e.length,a=new Array(o),c=0;c<o;++c)for(var d=e[c],h=d.length,g=a[c]=[],b,j=0;j<h;++j)(b=d[j])&&s.call(b,b.__data__,j,d)&&g.push(b);return new Selection$1(a,this._parents)}function sparse(s){return new Array(s.length)}function selection_enter(){return new Selection$1(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(s,e){this.ownerDocument=s.ownerDocument,this.namespaceURI=s.namespaceURI,this._next=null,this._parent=s,this.__data__=e}EnterNode.prototype={constructor:EnterNode,appendChild:function(s){return this._parent.insertBefore(s,this._next)},insertBefore:function(s,e){return this._parent.insertBefore(s,e)},querySelector:function(s){return this._parent.querySelector(s)},querySelectorAll:function(s){return this._parent.querySelectorAll(s)}};function constant$3(s){return function(){return s}}function bindIndex(s,e,o,a,c,d){for(var h=0,g,b=e.length,j=d.length;h<j;++h)(g=e[h])?(g.__data__=d[h],a[h]=g):o[h]=new EnterNode(s,d[h]);for(;h<b;++h)(g=e[h])&&(c[h]=g)}function bindKey(s,e,o,a,c,d,h){var g,b,j=new Map,$=e.length,_=d.length,_e=new Array($),et;for(g=0;g<$;++g)(b=e[g])&&(_e[g]=et=h.call(b,b.__data__,g,e)+"",j.has(et)?c[g]=b:j.set(et,b));for(g=0;g<_;++g)et=h.call(s,d[g],g,d)+"",(b=j.get(et))?(a[g]=b,b.__data__=d[g],j.delete(et)):o[g]=new EnterNode(s,d[g]);for(g=0;g<$;++g)(b=e[g])&&j.get(_e[g])===b&&(c[g]=b)}function datum(s){return s.__data__}function selection_data(s,e){if(!arguments.length)return Array.from(this,datum);var o=e?bindKey:bindIndex,a=this._parents,c=this._groups;typeof s!="function"&&(s=constant$3(s));for(var d=c.length,h=new Array(d),g=new Array(d),b=new Array(d),j=0;j<d;++j){var $=a[j],_=c[j],_e=_.length,et=arraylike(s.call($,$&&$.__data__,j,a)),nt=et.length,rt=g[j]=new Array(nt),it=h[j]=new Array(nt),st=b[j]=new Array(_e);o($,_,rt,it,st,et,e);for(var lt=0,ot=0,ct,ut;lt<nt;++lt)if(ct=rt[lt]){for(lt>=ot&&(ot=lt+1);!(ut=it[ot])&&++ot<nt;);ct._next=ut||null}}return h=new Selection$1(h,a),h._enter=g,h._exit=b,h}function arraylike(s){return typeof s=="object"&&"length"in s?s:Array.from(s)}function selection_exit(){return new Selection$1(this._exit||this._groups.map(sparse),this._parents)}function selection_join(s,e,o){var a=this.enter(),c=this,d=this.exit();return typeof s=="function"?(a=s(a),a&&(a=a.selection())):a=a.append(s+""),e!=null&&(c=e(c),c&&(c=c.selection())),o==null?d.remove():o(d),a&&c?a.merge(c).order():c}function selection_merge(s){for(var e=s.selection?s.selection():s,o=this._groups,a=e._groups,c=o.length,d=a.length,h=Math.min(c,d),g=new Array(c),b=0;b<h;++b)for(var j=o[b],$=a[b],_=j.length,_e=g[b]=new Array(_),et,nt=0;nt<_;++nt)(et=j[nt]||$[nt])&&(_e[nt]=et);for(;b<c;++b)g[b]=o[b];return new Selection$1(g,this._parents)}function selection_order(){for(var s=this._groups,e=-1,o=s.length;++e<o;)for(var a=s[e],c=a.length-1,d=a[c],h;--c>=0;)(h=a[c])&&(d&&h.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(h,d),d=h);return this}function selection_sort(s){s||(s=ascending);function e(_,_e){return _&&_e?s(_.__data__,_e.__data__):!_-!_e}for(var o=this._groups,a=o.length,c=new Array(a),d=0;d<a;++d){for(var h=o[d],g=h.length,b=c[d]=new Array(g),j,$=0;$<g;++$)(j=h[$])&&(b[$]=j);b.sort(e)}return new Selection$1(c,this._parents).order()}function ascending(s,e){return s<e?-1:s>e?1:s>=e?0:NaN}function selection_call(){var s=arguments[0];return arguments[0]=this,s.apply(null,arguments),this}function selection_nodes(){return Array.from(this)}function selection_node(){for(var s=this._groups,e=0,o=s.length;e<o;++e)for(var a=s[e],c=0,d=a.length;c<d;++c){var h=a[c];if(h)return h}return null}function selection_size(){let s=0;for(const e of this)++s;return s}function selection_empty(){return!this.node()}function selection_each(s){for(var e=this._groups,o=0,a=e.length;o<a;++o)for(var c=e[o],d=0,h=c.length,g;d<h;++d)(g=c[d])&&s.call(g,g.__data__,d,c);return this}function attrRemove$1(s){return function(){this.removeAttribute(s)}}function attrRemoveNS$1(s){return function(){this.removeAttributeNS(s.space,s.local)}}function attrConstant$1(s,e){return function(){this.setAttribute(s,e)}}function attrConstantNS$1(s,e){return function(){this.setAttributeNS(s.space,s.local,e)}}function attrFunction$1(s,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttribute(s):this.setAttribute(s,o)}}function attrFunctionNS$1(s,e){return function(){var o=e.apply(this,arguments);o==null?this.removeAttributeNS(s.space,s.local):this.setAttributeNS(s.space,s.local,o)}}function selection_attr(s,e){var o=namespace(s);if(arguments.length<2){var a=this.node();return o.local?a.getAttributeNS(o.space,o.local):a.getAttribute(o)}return this.each((e==null?o.local?attrRemoveNS$1:attrRemove$1:typeof e=="function"?o.local?attrFunctionNS$1:attrFunction$1:o.local?attrConstantNS$1:attrConstant$1)(o,e))}function defaultView(s){return s.ownerDocument&&s.ownerDocument.defaultView||s.document&&s||s.defaultView}function styleRemove$1(s){return function(){this.style.removeProperty(s)}}function styleConstant$1(s,e,o){return function(){this.style.setProperty(s,e,o)}}function styleFunction$1(s,e,o){return function(){var a=e.apply(this,arguments);a==null?this.style.removeProperty(s):this.style.setProperty(s,a,o)}}function selection_style(s,e,o){return arguments.length>1?this.each((e==null?styleRemove$1:typeof e=="function"?styleFunction$1:styleConstant$1)(s,e,o??"")):styleValue(this.node(),s)}function styleValue(s,e){return s.style.getPropertyValue(e)||defaultView(s).getComputedStyle(s,null).getPropertyValue(e)}function propertyRemove(s){return function(){delete this[s]}}function propertyConstant(s,e){return function(){this[s]=e}}function propertyFunction(s,e){return function(){var o=e.apply(this,arguments);o==null?delete this[s]:this[s]=o}}function selection_property(s,e){return arguments.length>1?this.each((e==null?propertyRemove:typeof e=="function"?propertyFunction:propertyConstant)(s,e)):this.node()[s]}function classArray(s){return s.trim().split(/^|\s+/)}function classList(s){return s.classList||new ClassList(s)}function ClassList(s){this._node=s,this._names=classArray(s.getAttribute("class")||"")}ClassList.prototype={add:function(s){var e=this._names.indexOf(s);e<0&&(this._names.push(s),this._node.setAttribute("class",this._names.join(" ")))},remove:function(s){var e=this._names.indexOf(s);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(s){return this._names.indexOf(s)>=0}};function classedAdd(s,e){for(var o=classList(s),a=-1,c=e.length;++a<c;)o.add(e[a])}function classedRemove(s,e){for(var o=classList(s),a=-1,c=e.length;++a<c;)o.remove(e[a])}function classedTrue(s){return function(){classedAdd(this,s)}}function classedFalse(s){return function(){classedRemove(this,s)}}function classedFunction(s,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,s)}}function selection_classed(s,e){var o=classArray(s+"");if(arguments.length<2){for(var a=classList(this.node()),c=-1,d=o.length;++c<d;)if(!a.contains(o[c]))return!1;return!0}return this.each((typeof e=="function"?classedFunction:e?classedTrue:classedFalse)(o,e))}function textRemove(){this.textContent=""}function textConstant$1(s){return function(){this.textContent=s}}function textFunction$1(s){return function(){var e=s.apply(this,arguments);this.textContent=e??""}}function selection_text(s){return arguments.length?this.each(s==null?textRemove:(typeof s=="function"?textFunction$1:textConstant$1)(s)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(s){return function(){this.innerHTML=s}}function htmlFunction(s){return function(){var e=s.apply(this,arguments);this.innerHTML=e??""}}function selection_html(s){return arguments.length?this.each(s==null?htmlRemove:(typeof s=="function"?htmlFunction:htmlConstant)(s)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(s){var e=typeof s=="function"?s:creator(s);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function constantNull(){return null}function selection_insert(s,e){var o=typeof s=="function"?s:creator(s),a=e==null?constantNull:typeof e=="function"?e:selector(e);return this.select(function(){return this.insertBefore(o.apply(this,arguments),a.apply(this,arguments)||null)})}function remove$1(){var s=this.parentNode;s&&s.removeChild(this)}function selection_remove(){return this.each(remove$1)}function selection_cloneShallow(){var s=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(s,this.nextSibling):s}function selection_cloneDeep(){var s=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(s,this.nextSibling):s}function selection_clone(s){return this.select(s?selection_cloneDeep:selection_cloneShallow)}function selection_datum(s){return arguments.length?this.property("__data__",s):this.node().__data__}function contextListener(s){return function(e){s.call(this,e,this.__data__)}}function parseTypenames(s){return s.trim().split(/^|\s+/).map(function(e){var o="",a=e.indexOf(".");return a>=0&&(o=e.slice(a+1),e=e.slice(0,a)),{type:e,name:o}})}function onRemove(s){return function(){var e=this.__on;if(e){for(var o=0,a=-1,c=e.length,d;o<c;++o)d=e[o],(!s.type||d.type===s.type)&&d.name===s.name?this.removeEventListener(d.type,d.listener,d.options):e[++a]=d;++a?e.length=a:delete this.__on}}}function onAdd(s,e,o){return function(){var a=this.__on,c,d=contextListener(e);if(a){for(var h=0,g=a.length;h<g;++h)if((c=a[h]).type===s.type&&c.name===s.name){this.removeEventListener(c.type,c.listener,c.options),this.addEventListener(c.type,c.listener=d,c.options=o),c.value=e;return}}this.addEventListener(s.type,d,o),c={type:s.type,name:s.name,value:e,listener:d,options:o},a?a.push(c):this.__on=[c]}}function selection_on(s,e,o){var a=parseTypenames(s+""),c,d=a.length,h;if(arguments.length<2){var g=this.node().__on;if(g){for(var b=0,j=g.length,$;b<j;++b)for(c=0,$=g[b];c<d;++c)if((h=a[c]).type===$.type&&h.name===$.name)return $.value}return}for(g=e?onAdd:onRemove,c=0;c<d;++c)this.each(g(a[c],e,o));return this}function dispatchEvent(s,e,o){var a=defaultView(s),c=a.CustomEvent;typeof c=="function"?c=new c(e,o):(c=a.document.createEvent("Event"),o?(c.initEvent(e,o.bubbles,o.cancelable),c.detail=o.detail):c.initEvent(e,!1,!1)),s.dispatchEvent(c)}function dispatchConstant(s,e){return function(){return dispatchEvent(this,s,e)}}function dispatchFunction(s,e){return function(){return dispatchEvent(this,s,e.apply(this,arguments))}}function selection_dispatch(s,e){return this.each((typeof e=="function"?dispatchFunction:dispatchConstant)(s,e))}function*selection_iterator(){for(var s=this._groups,e=0,o=s.length;e<o;++e)for(var a=s[e],c=0,d=a.length,h;c<d;++c)(h=a[c])&&(yield h)}var root=[null];function Selection$1(s,e){this._groups=s,this._parents=e}function selection(){return new Selection$1([[document.documentElement]],root)}function selection_selection(){return this}Selection$1.prototype=selection.prototype={constructor:Selection$1,select:selection_select,selectAll:selection_selectAll,selectChild:selection_selectChild,selectChildren:selection_selectChildren,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,selection:selection_selection,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch,[Symbol.iterator]:selection_iterator};function select(s){return typeof s=="string"?new Selection$1([[document.querySelector(s)]],[document.documentElement]):new Selection$1([[s]],root)}function sourceEvent(s){let e;for(;e=s.sourceEvent;)s=e;return s}function pointer(s,e){if(s=sourceEvent(s),e===void 0&&(e=s.currentTarget),e){var o=e.ownerSVGElement||e;if(o.createSVGPoint){var a=o.createSVGPoint();return a.x=s.clientX,a.y=s.clientY,a=a.matrixTransform(e.getScreenCTM().inverse()),[a.x,a.y]}if(e.getBoundingClientRect){var c=e.getBoundingClientRect();return[s.clientX-c.left-e.clientLeft,s.clientY-c.top-e.clientTop]}}return[s.pageX,s.pageY]}const nonpassive={passive:!1},nonpassivecapture={capture:!0,passive:!1};function nopropagation$1(s){s.stopImmediatePropagation()}function noevent$1(s){s.preventDefault(),s.stopImmediatePropagation()}function dragDisable(s){var e=s.document.documentElement,o=select(s).on("dragstart.drag",noevent$1,nonpassivecapture);"onselectstart"in e?o.on("selectstart.drag",noevent$1,nonpassivecapture):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function yesdrag(s,e){var o=s.document.documentElement,a=select(s).on("dragstart.drag",null);e&&(a.on("click.drag",noevent$1,nonpassivecapture),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in o?a.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}const constant$2=s=>()=>s;function DragEvent$1(s,{sourceEvent:e,subject:o,target:a,identifier:c,active:d,x:h,y:g,dx:b,dy:j,dispatch:$}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:o,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},identifier:{value:c,enumerable:!0,configurable:!0},active:{value:d,enumerable:!0,configurable:!0},x:{value:h,enumerable:!0,configurable:!0},y:{value:g,enumerable:!0,configurable:!0},dx:{value:b,enumerable:!0,configurable:!0},dy:{value:j,enumerable:!0,configurable:!0},_:{value:$}})}DragEvent$1.prototype.on=function(){var s=this._.on.apply(this._,arguments);return s===this._?this:s};function defaultFilter$1(s){return!s.ctrlKey&&!s.button}function defaultContainer(){return this.parentNode}function defaultSubject(s,e){return e??{x:s.x,y:s.y}}function defaultTouchable$1(){return navigator.maxTouchPoints||"ontouchstart"in this}function drag(){var s=defaultFilter$1,e=defaultContainer,o=defaultSubject,a=defaultTouchable$1,c={},d=dispatch("start","drag","end"),h=0,g,b,j,$,_=0;function _e(ct){ct.on("mousedown.drag",et).filter(a).on("touchstart.drag",it).on("touchmove.drag",st,nonpassive).on("touchend.drag touchcancel.drag",lt).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function et(ct,ut){if(!($||!s.call(this,ct,ut))){var at=ot(this,e.call(this,ct,ut),ct,ut,"mouse");at&&(select(ct.view).on("mousemove.drag",nt,nonpassivecapture).on("mouseup.drag",rt,nonpassivecapture),dragDisable(ct.view),nopropagation$1(ct),j=!1,g=ct.clientX,b=ct.clientY,at("start",ct))}}function nt(ct){if(noevent$1(ct),!j){var ut=ct.clientX-g,at=ct.clientY-b;j=ut*ut+at*at>_}c.mouse("drag",ct)}function rt(ct){select(ct.view).on("mousemove.drag mouseup.drag",null),yesdrag(ct.view,j),noevent$1(ct),c.mouse("end",ct)}function it(ct,ut){if(s.call(this,ct,ut)){var at=ct.changedTouches,dt=e.call(this,ct,ut),ft=at.length,xt,Ct;for(xt=0;xt<ft;++xt)(Ct=ot(this,dt,ct,ut,at[xt].identifier,at[xt]))&&(nopropagation$1(ct),Ct("start",ct,at[xt]))}}function st(ct){var ut=ct.changedTouches,at=ut.length,dt,ft;for(dt=0;dt<at;++dt)(ft=c[ut[dt].identifier])&&(noevent$1(ct),ft("drag",ct,ut[dt]))}function lt(ct){var ut=ct.changedTouches,at=ut.length,dt,ft;for($&&clearTimeout($),$=setTimeout(function(){$=null},500),dt=0;dt<at;++dt)(ft=c[ut[dt].identifier])&&(nopropagation$1(ct),ft("end",ct,ut[dt]))}function ot(ct,ut,at,dt,ft,xt){var Ct=d.copy(),yt=pointer(xt||at,ut),Et,Tt,ht;if((ht=o.call(ct,new DragEvent$1("beforestart",{sourceEvent:at,target:_e,identifier:ft,active:h,x:yt[0],y:yt[1],dx:0,dy:0,dispatch:Ct}),dt))!=null)return Et=ht.x-yt[0]||0,Tt=ht.y-yt[1]||0,function wt(St,bt,mt){var gt=yt,pt;switch(St){case"start":c[ft]=wt,pt=h++;break;case"end":delete c[ft],--h;case"drag":yt=pointer(mt||bt,ut),pt=h;break}Ct.call(St,ct,new DragEvent$1(St,{sourceEvent:bt,subject:ht,target:_e,identifier:ft,active:pt,x:yt[0]+Et,y:yt[1]+Tt,dx:yt[0]-gt[0],dy:yt[1]-gt[1],dispatch:Ct}),dt)}}return _e.filter=function(ct){return arguments.length?(s=typeof ct=="function"?ct:constant$2(!!ct),_e):s},_e.container=function(ct){return arguments.length?(e=typeof ct=="function"?ct:constant$2(ct),_e):e},_e.subject=function(ct){return arguments.length?(o=typeof ct=="function"?ct:constant$2(ct),_e):o},_e.touchable=function(ct){return arguments.length?(a=typeof ct=="function"?ct:constant$2(!!ct),_e):a},_e.on=function(){var ct=d.on.apply(d,arguments);return ct===d?_e:ct},_e.clickDistance=function(ct){return arguments.length?(_=(ct=+ct)*ct,_e):Math.sqrt(_)},_e}function define(s,e,o){s.prototype=e.prototype=o,o.constructor=s}function extend(s,e){var o=Object.create(s.prototype);for(var a in e)o[a]=e[a];return o}function Color$1(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color$1,color,{copy(s){return Object.assign(new this.constructor,this,s)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(s){var e,o;return s=(s+"").trim().toLowerCase(),(e=reHex.exec(s))?(o=e[1].length,e=parseInt(e[1],16),o===6?rgbn(e):o===3?new Rgb(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):o===8?rgba(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):o===4?rgba(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=reRgbInteger.exec(s))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(s))?new Rgb(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=reRgbaInteger.exec(s))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(s))?rgba(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=reHslPercent.exec(s))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(s))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(s)?rgbn(named[s]):s==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(s){return new Rgb(s>>16&255,s>>8&255,s&255,1)}function rgba(s,e,o,a){return a<=0&&(s=e=o=NaN),new Rgb(s,e,o,a)}function rgbConvert(s){return s instanceof Color$1||(s=color(s)),s?(s=s.rgb(),new Rgb(s.r,s.g,s.b,s.opacity)):new Rgb}function rgb(s,e,o,a){return arguments.length===1?rgbConvert(s):new Rgb(s,e,o,a??1)}function Rgb(s,e,o,a){this.r=+s,this.g=+e,this.b=+o,this.opacity=+a}define(Rgb,rgb,extend(Color$1,{brighter(s){return s=s==null?brighter:Math.pow(brighter,s),new Rgb(this.r*s,this.g*s,this.b*s,this.opacity)},darker(s){return s=s==null?darker:Math.pow(darker,s),new Rgb(this.r*s,this.g*s,this.b*s,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const s=clampa(this.opacity);return`${s===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${s===1?")":`, ${s})`}`}function clampa(s){return isNaN(s)?1:Math.max(0,Math.min(1,s))}function clampi(s){return Math.max(0,Math.min(255,Math.round(s)||0))}function hex(s){return s=clampi(s),(s<16?"0":"")+s.toString(16)}function hsla(s,e,o,a){return a<=0?s=e=o=NaN:o<=0||o>=1?s=e=NaN:e<=0&&(s=NaN),new Hsl(s,e,o,a)}function hslConvert(s){if(s instanceof Hsl)return new Hsl(s.h,s.s,s.l,s.opacity);if(s instanceof Color$1||(s=color(s)),!s)return new Hsl;if(s instanceof Hsl)return s;s=s.rgb();var e=s.r/255,o=s.g/255,a=s.b/255,c=Math.min(e,o,a),d=Math.max(e,o,a),h=NaN,g=d-c,b=(d+c)/2;return g?(e===d?h=(o-a)/g+(o<a)*6:o===d?h=(a-e)/g+2:h=(e-o)/g+4,g/=b<.5?d+c:2-d-c,h*=60):g=b>0&&b<1?0:h,new Hsl(h,g,b,s.opacity)}function hsl(s,e,o,a){return arguments.length===1?hslConvert(s):new Hsl(s,e,o,a??1)}function Hsl(s,e,o,a){this.h=+s,this.s=+e,this.l=+o,this.opacity=+a}define(Hsl,hsl,extend(Color$1,{brighter(s){return s=s==null?brighter:Math.pow(brighter,s),new Hsl(this.h,this.s,this.l*s,this.opacity)},darker(s){return s=s==null?darker:Math.pow(darker,s),new Hsl(this.h,this.s,this.l*s,this.opacity)},rgb(){var s=this.h%360+(this.h<0)*360,e=isNaN(s)||isNaN(this.s)?0:this.s,o=this.l,a=o+(o<.5?o:1-o)*e,c=2*o-a;return new Rgb(hsl2rgb(s>=240?s-240:s+120,c,a),hsl2rgb(s,c,a),hsl2rgb(s<120?s+240:s-120,c,a),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const s=clampa(this.opacity);return`${s===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${s===1?")":`, ${s})`}`}}));function clamph(s){return s=(s||0)%360,s<0?s+360:s}function clampt(s){return Math.max(0,Math.min(1,s||0))}function hsl2rgb(s,e,o){return(s<60?e+(o-e)*s/60:s<180?o:s<240?e+(o-e)*(240-s)/60:e)*255}const constant$1=s=>()=>s;function linear(s,e){return function(o){return s+o*e}}function exponential(s,e,o){return s=Math.pow(s,o),e=Math.pow(e,o)-s,o=1/o,function(a){return Math.pow(s+a*e,o)}}function gamma(s){return(s=+s)==1?nogamma:function(e,o){return o-e?exponential(e,o,s):constant$1(isNaN(e)?o:e)}}function nogamma(s,e){var o=e-s;return o?linear(s,o):constant$1(isNaN(s)?e:s)}const interpolateRgb=function s(e){var o=gamma(e);function a(c,d){var h=o((c=rgb(c)).r,(d=rgb(d)).r),g=o(c.g,d.g),b=o(c.b,d.b),j=nogamma(c.opacity,d.opacity);return function($){return c.r=h($),c.g=g($),c.b=b($),c.opacity=j($),c+""}}return a.gamma=s,a}(1);function numberArray(s,e){e||(e=[]);var o=s?Math.min(e.length,s.length):0,a=e.slice(),c;return function(d){for(c=0;c<o;++c)a[c]=s[c]*(1-d)+e[c]*d;return a}}function isNumberArray(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function genericArray(s,e){var o=e?e.length:0,a=s?Math.min(o,s.length):0,c=new Array(a),d=new Array(o),h;for(h=0;h<a;++h)c[h]=interpolate$1(s[h],e[h]);for(;h<o;++h)d[h]=e[h];return function(g){for(h=0;h<a;++h)d[h]=c[h](g);return d}}function date(s,e){var o=new Date;return s=+s,e=+e,function(a){return o.setTime(s*(1-a)+e*a),o}}function interpolateNumber(s,e){return s=+s,e=+e,function(o){return s*(1-o)+e*o}}function object(s,e){var o={},a={},c;(s===null||typeof s!="object")&&(s={}),(e===null||typeof e!="object")&&(e={});for(c in e)c in s?o[c]=interpolate$1(s[c],e[c]):a[c]=e[c];return function(d){for(c in o)a[c]=o[c](d);return a}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(s){return function(){return s}}function one(s){return function(e){return s(e)+""}}function interpolateString(s,e){var o=reA.lastIndex=reB.lastIndex=0,a,c,d,h=-1,g=[],b=[];for(s=s+"",e=e+"";(a=reA.exec(s))&&(c=reB.exec(e));)(d=c.index)>o&&(d=e.slice(o,d),g[h]?g[h]+=d:g[++h]=d),(a=a[0])===(c=c[0])?g[h]?g[h]+=c:g[++h]=c:(g[++h]=null,b.push({i:h,x:interpolateNumber(a,c)})),o=reB.lastIndex;return o<e.length&&(d=e.slice(o),g[h]?g[h]+=d:g[++h]=d),g.length<2?b[0]?one(b[0].x):zero(e):(e=b.length,function(j){for(var $=0,_;$<e;++$)g[(_=b[$]).i]=_.x(j);return g.join("")})}function interpolate$1(s,e){var o=typeof e,a;return e==null||o==="boolean"?constant$1(e):(o==="number"?interpolateNumber:o==="string"?(a=color(e))?(e=a,interpolateRgb):interpolateString:e instanceof color?interpolateRgb:e instanceof Date?date:isNumberArray(e)?numberArray:Array.isArray(e)?genericArray:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?object:interpolateNumber)(s,e)}var degrees=180/Math.PI,identity$2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(s,e,o,a,c,d){var h,g,b;return(h=Math.sqrt(s*s+e*e))&&(s/=h,e/=h),(b=s*o+e*a)&&(o-=s*b,a-=e*b),(g=Math.sqrt(o*o+a*a))&&(o/=g,a/=g,b/=g),s*a<e*o&&(s=-s,e=-e,b=-b,h=-h),{translateX:c,translateY:d,rotate:Math.atan2(e,s)*degrees,skewX:Math.atan(b)*degrees,scaleX:h,scaleY:g}}var svgNode;function parseCss(s){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(s+"");return e.isIdentity?identity$2:decompose(e.a,e.b,e.c,e.d,e.e,e.f)}function parseSvg(s){return s==null||(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",s),!(s=svgNode.transform.baseVal.consolidate()))?identity$2:(s=s.matrix,decompose(s.a,s.b,s.c,s.d,s.e,s.f))}function interpolateTransform(s,e,o,a){function c(j){return j.length?j.pop()+" ":""}function d(j,$,_,_e,et,nt){if(j!==_||$!==_e){var rt=et.push("translate(",null,e,null,o);nt.push({i:rt-4,x:interpolateNumber(j,_)},{i:rt-2,x:interpolateNumber($,_e)})}else(_||_e)&&et.push("translate("+_+e+_e+o)}function h(j,$,_,_e){j!==$?(j-$>180?$+=360:$-j>180&&(j+=360),_e.push({i:_.push(c(_)+"rotate(",null,a)-2,x:interpolateNumber(j,$)})):$&&_.push(c(_)+"rotate("+$+a)}function g(j,$,_,_e){j!==$?_e.push({i:_.push(c(_)+"skewX(",null,a)-2,x:interpolateNumber(j,$)}):$&&_.push(c(_)+"skewX("+$+a)}function b(j,$,_,_e,et,nt){if(j!==_||$!==_e){var rt=et.push(c(et)+"scale(",null,",",null,")");nt.push({i:rt-4,x:interpolateNumber(j,_)},{i:rt-2,x:interpolateNumber($,_e)})}else(_!==1||_e!==1)&&et.push(c(et)+"scale("+_+","+_e+")")}return function(j,$){var _=[],_e=[];return j=s(j),$=s($),d(j.translateX,j.translateY,$.translateX,$.translateY,_,_e),h(j.rotate,$.rotate,_,_e),g(j.skewX,$.skewX,_,_e),b(j.scaleX,j.scaleY,$.scaleX,$.scaleY,_,_e),j=$=null,function(et){for(var nt=-1,rt=_e.length,it;++nt<rt;)_[(it=_e[nt]).i]=it.x(et);return _.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")"),epsilon2=1e-12;function cosh(s){return((s=Math.exp(s))+1/s)/2}function sinh(s){return((s=Math.exp(s))-1/s)/2}function tanh(s){return((s=Math.exp(2*s))-1)/(s+1)}const interpolateZoom=function s(e,o,a){function c(d,h){var g=d[0],b=d[1],j=d[2],$=h[0],_=h[1],_e=h[2],et=$-g,nt=_-b,rt=et*et+nt*nt,it,st;if(rt<epsilon2)st=Math.log(_e/j)/e,it=function(dt){return[g+dt*et,b+dt*nt,j*Math.exp(e*dt*st)]};else{var lt=Math.sqrt(rt),ot=(_e*_e-j*j+a*rt)/(2*j*o*lt),ct=(_e*_e-j*j-a*rt)/(2*_e*o*lt),ut=Math.log(Math.sqrt(ot*ot+1)-ot),at=Math.log(Math.sqrt(ct*ct+1)-ct);st=(at-ut)/e,it=function(dt){var ft=dt*st,xt=cosh(ut),Ct=j/(o*lt)*(xt*tanh(e*ft+ut)-sinh(ut));return[g+Ct*et,b+Ct*nt,j*xt/cosh(e*ft+ut)]}}return it.duration=st*1e3*e/Math.SQRT2,it}return c.rho=function(d){var h=Math.max(.001,+d),g=h*h,b=g*g;return s(h,g,b)},c}(Math.SQRT2,2,4);var frame=0,timeout$1=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(s){setTimeout(s,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(s,e,o){if(typeof s!="function")throw new TypeError("callback is not a function");o=(o==null?now():+o)+(e==null?0:+e),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=s,this._time=o,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(s,e,o){var a=new Timer;return a.restart(s,e,o),a}function timerFlush(){now(),++frame;for(var s=taskHead,e;s;)(e=clockNow-s._time)>=0&&s._call.call(void 0,e),s=s._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout$1=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var s=clock.now(),e=s-clockLast;e>pokeDelay&&(clockSkew-=e,clockLast=s)}function nap(){for(var s,e=taskHead,o,a=1/0;e;)e._call?(a>e._time&&(a=e._time),s=e,e=e._next):(o=e._next,e._next=null,e=s?s._next=o:taskHead=o);taskTail=s,sleep(a)}function sleep(s){if(!frame){timeout$1&&(timeout$1=clearTimeout(timeout$1));var e=s-clockNow;e>24?(s<1/0&&(timeout$1=setTimeout(wake,s-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function timeout(s,e,o){var a=new Timer;return e=e==null?0:+e,a.restart(c=>{a.stop(),s(c+e)},e,o),a}var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(s,e,o,a,c,d){var h=s.__transition;if(!h)s.__transition={};else if(o in h)return;create(s,o,{name:e,index:a,group:c,on:emptyOn,tween:emptyTween,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:CREATED})}function init(s,e){var o=get(s,e);if(o.state>CREATED)throw new Error("too late; already scheduled");return o}function set(s,e){var o=get(s,e);if(o.state>STARTED)throw new Error("too late; already running");return o}function get(s,e){var o=s.__transition;if(!o||!(o=o[e]))throw new Error("transition not found");return o}function create(s,e,o){var a=s.__transition,c;a[e]=o,o.timer=timer(d,0,o.time);function d(j){o.state=SCHEDULED,o.timer.restart(h,o.delay,o.time),o.delay<=j&&h(j-o.delay)}function h(j){var $,_,_e,et;if(o.state!==SCHEDULED)return b();for($ in a)if(et=a[$],et.name===o.name){if(et.state===STARTED)return timeout(h);et.state===RUNNING?(et.state=ENDED,et.timer.stop(),et.on.call("interrupt",s,s.__data__,et.index,et.group),delete a[$]):+$<e&&(et.state=ENDED,et.timer.stop(),et.on.call("cancel",s,s.__data__,et.index,et.group),delete a[$])}if(timeout(function(){o.state===STARTED&&(o.state=RUNNING,o.timer.restart(g,o.delay,o.time),g(j))}),o.state=STARTING,o.on.call("start",s,s.__data__,o.index,o.group),o.state===STARTING){for(o.state=STARTED,c=new Array(_e=o.tween.length),$=0,_=-1;$<_e;++$)(et=o.tween[$].value.call(s,s.__data__,o.index,o.group))&&(c[++_]=et);c.length=_+1}}function g(j){for(var $=j<o.duration?o.ease.call(null,j/o.duration):(o.timer.restart(b),o.state=ENDING,1),_=-1,_e=c.length;++_<_e;)c[_].call(s,$);o.state===ENDING&&(o.on.call("end",s,s.__data__,o.index,o.group),b())}function b(){o.state=ENDED,o.timer.stop(),delete a[e];for(var j in a)return;delete s.__transition}}function interrupt(s,e){var o=s.__transition,a,c,d=!0,h;if(o){e=e==null?null:e+"";for(h in o){if((a=o[h]).name!==e){d=!1;continue}c=a.state>STARTING&&a.state<ENDING,a.state=ENDED,a.timer.stop(),a.on.call(c?"interrupt":"cancel",s,s.__data__,a.index,a.group),delete o[h]}d&&delete s.__transition}}function selection_interrupt(s){return this.each(function(){interrupt(this,s)})}function tweenRemove(s,e){var o,a;return function(){var c=set(this,s),d=c.tween;if(d!==o){a=o=d;for(var h=0,g=a.length;h<g;++h)if(a[h].name===e){a=a.slice(),a.splice(h,1);break}}c.tween=a}}function tweenFunction(s,e,o){var a,c;if(typeof o!="function")throw new Error;return function(){var d=set(this,s),h=d.tween;if(h!==a){c=(a=h).slice();for(var g={name:e,value:o},b=0,j=c.length;b<j;++b)if(c[b].name===e){c[b]=g;break}b===j&&c.push(g)}d.tween=c}}function transition_tween(s,e){var o=this._id;if(s+="",arguments.length<2){for(var a=get(this.node(),o).tween,c=0,d=a.length,h;c<d;++c)if((h=a[c]).name===s)return h.value;return null}return this.each((e==null?tweenRemove:tweenFunction)(o,s,e))}function tweenValue(s,e,o){var a=s._id;return s.each(function(){var c=set(this,a);(c.value||(c.value={}))[e]=o.apply(this,arguments)}),function(c){return get(c,a).value[e]}}function interpolate(s,e){var o;return(typeof e=="number"?interpolateNumber:e instanceof color?interpolateRgb:(o=color(e))?(e=o,interpolateRgb):interpolateString)(s,e)}function attrRemove(s){return function(){this.removeAttribute(s)}}function attrRemoveNS(s){return function(){this.removeAttributeNS(s.space,s.local)}}function attrConstant(s,e,o){var a,c=o+"",d;return function(){var h=this.getAttribute(s);return h===c?null:h===a?d:d=e(a=h,o)}}function attrConstantNS(s,e,o){var a,c=o+"",d;return function(){var h=this.getAttributeNS(s.space,s.local);return h===c?null:h===a?d:d=e(a=h,o)}}function attrFunction(s,e,o){var a,c,d;return function(){var h,g=o(this),b;return g==null?void this.removeAttribute(s):(h=this.getAttribute(s),b=g+"",h===b?null:h===a&&b===c?d:(c=b,d=e(a=h,g)))}}function attrFunctionNS(s,e,o){var a,c,d;return function(){var h,g=o(this),b;return g==null?void this.removeAttributeNS(s.space,s.local):(h=this.getAttributeNS(s.space,s.local),b=g+"",h===b?null:h===a&&b===c?d:(c=b,d=e(a=h,g)))}}function transition_attr(s,e){var o=namespace(s),a=o==="transform"?interpolateTransformSvg:interpolate;return this.attrTween(s,typeof e=="function"?(o.local?attrFunctionNS:attrFunction)(o,a,tweenValue(this,"attr."+s,e)):e==null?(o.local?attrRemoveNS:attrRemove)(o):(o.local?attrConstantNS:attrConstant)(o,a,e))}function attrInterpolate(s,e){return function(o){this.setAttribute(s,e.call(this,o))}}function attrInterpolateNS(s,e){return function(o){this.setAttributeNS(s.space,s.local,e.call(this,o))}}function attrTweenNS(s,e){var o,a;function c(){var d=e.apply(this,arguments);return d!==a&&(o=(a=d)&&attrInterpolateNS(s,d)),o}return c._value=e,c}function attrTween(s,e){var o,a;function c(){var d=e.apply(this,arguments);return d!==a&&(o=(a=d)&&attrInterpolate(s,d)),o}return c._value=e,c}function transition_attrTween(s,e){var o="attr."+s;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(e==null)return this.tween(o,null);if(typeof e!="function")throw new Error;var a=namespace(s);return this.tween(o,(a.local?attrTweenNS:attrTween)(a,e))}function delayFunction(s,e){return function(){init(this,s).delay=+e.apply(this,arguments)}}function delayConstant(s,e){return e=+e,function(){init(this,s).delay=e}}function transition_delay(s){var e=this._id;return arguments.length?this.each((typeof s=="function"?delayFunction:delayConstant)(e,s)):get(this.node(),e).delay}function durationFunction(s,e){return function(){set(this,s).duration=+e.apply(this,arguments)}}function durationConstant(s,e){return e=+e,function(){set(this,s).duration=e}}function transition_duration(s){var e=this._id;return arguments.length?this.each((typeof s=="function"?durationFunction:durationConstant)(e,s)):get(this.node(),e).duration}function easeConstant(s,e){if(typeof e!="function")throw new Error;return function(){set(this,s).ease=e}}function transition_ease(s){var e=this._id;return arguments.length?this.each(easeConstant(e,s)):get(this.node(),e).ease}function easeVarying(s,e){return function(){var o=e.apply(this,arguments);if(typeof o!="function")throw new Error;set(this,s).ease=o}}function transition_easeVarying(s){if(typeof s!="function")throw new Error;return this.each(easeVarying(this._id,s))}function transition_filter(s){typeof s!="function"&&(s=matcher(s));for(var e=this._groups,o=e.length,a=new Array(o),c=0;c<o;++c)for(var d=e[c],h=d.length,g=a[c]=[],b,j=0;j<h;++j)(b=d[j])&&s.call(b,b.__data__,j,d)&&g.push(b);return new Transition(a,this._parents,this._name,this._id)}function transition_merge(s){if(s._id!==this._id)throw new Error;for(var e=this._groups,o=s._groups,a=e.length,c=o.length,d=Math.min(a,c),h=new Array(a),g=0;g<d;++g)for(var b=e[g],j=o[g],$=b.length,_=h[g]=new Array($),_e,et=0;et<$;++et)(_e=b[et]||j[et])&&(_[et]=_e);for(;g<a;++g)h[g]=e[g];return new Transition(h,this._parents,this._name,this._id)}function start(s){return(s+"").trim().split(/^|\s+/).every(function(e){var o=e.indexOf(".");return o>=0&&(e=e.slice(0,o)),!e||e==="start"})}function onFunction(s,e,o){var a,c,d=start(e)?init:set;return function(){var h=d(this,s),g=h.on;g!==a&&(c=(a=g).copy()).on(e,o),h.on=c}}function transition_on(s,e){var o=this._id;return arguments.length<2?get(this.node(),o).on.on(s):this.each(onFunction(o,s,e))}function removeFunction(s){return function(){var e=this.parentNode;for(var o in this.__transition)if(+o!==s)return;e&&e.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(s){var e=this._name,o=this._id;typeof s!="function"&&(s=selector(s));for(var a=this._groups,c=a.length,d=new Array(c),h=0;h<c;++h)for(var g=a[h],b=g.length,j=d[h]=new Array(b),$,_,_e=0;_e<b;++_e)($=g[_e])&&(_=s.call($,$.__data__,_e,g))&&("__data__"in $&&(_.__data__=$.__data__),j[_e]=_,schedule(j[_e],e,o,_e,j,get($,o)));return new Transition(d,this._parents,e,o)}function transition_selectAll(s){var e=this._name,o=this._id;typeof s!="function"&&(s=selectorAll(s));for(var a=this._groups,c=a.length,d=[],h=[],g=0;g<c;++g)for(var b=a[g],j=b.length,$,_=0;_<j;++_)if($=b[_]){for(var _e=s.call($,$.__data__,_,b),et,nt=get($,o),rt=0,it=_e.length;rt<it;++rt)(et=_e[rt])&&schedule(et,e,o,rt,_e,nt);d.push(_e),h.push($)}return new Transition(d,h,e,o)}var Selection=selection.prototype.constructor;function transition_selection(){return new Selection(this._groups,this._parents)}function styleNull(s,e){var o,a,c;return function(){var d=styleValue(this,s),h=(this.style.removeProperty(s),styleValue(this,s));return d===h?null:d===o&&h===a?c:c=e(o=d,a=h)}}function styleRemove(s){return function(){this.style.removeProperty(s)}}function styleConstant(s,e,o){var a,c=o+"",d;return function(){var h=styleValue(this,s);return h===c?null:h===a?d:d=e(a=h,o)}}function styleFunction(s,e,o){var a,c,d;return function(){var h=styleValue(this,s),g=o(this),b=g+"";return g==null&&(b=g=(this.style.removeProperty(s),styleValue(this,s))),h===b?null:h===a&&b===c?d:(c=b,d=e(a=h,g))}}function styleMaybeRemove(s,e){var o,a,c,d="style."+e,h="end."+d,g;return function(){var b=set(this,s),j=b.on,$=b.value[d]==null?g||(g=styleRemove(e)):void 0;(j!==o||c!==$)&&(a=(o=j).copy()).on(h,c=$),b.on=a}}function transition_style(s,e,o){var a=(s+="")=="transform"?interpolateTransformCss:interpolate;return e==null?this.styleTween(s,styleNull(s,a)).on("end.style."+s,styleRemove(s)):typeof e=="function"?this.styleTween(s,styleFunction(s,a,tweenValue(this,"style."+s,e))).each(styleMaybeRemove(this._id,s)):this.styleTween(s,styleConstant(s,a,e),o).on("end.style."+s,null)}function styleInterpolate(s,e,o){return function(a){this.style.setProperty(s,e.call(this,a),o)}}function styleTween(s,e,o){var a,c;function d(){var h=e.apply(this,arguments);return h!==c&&(a=(c=h)&&styleInterpolate(s,h,o)),a}return d._value=e,d}function transition_styleTween(s,e,o){var a="style."+(s+="");if(arguments.length<2)return(a=this.tween(a))&&a._value;if(e==null)return this.tween(a,null);if(typeof e!="function")throw new Error;return this.tween(a,styleTween(s,e,o??""))}function textConstant(s){return function(){this.textContent=s}}function textFunction(s){return function(){var e=s(this);this.textContent=e??""}}function transition_text(s){return this.tween("text",typeof s=="function"?textFunction(tweenValue(this,"text",s)):textConstant(s==null?"":s+""))}function textInterpolate(s){return function(e){this.textContent=s.call(this,e)}}function textTween(s){var e,o;function a(){var c=s.apply(this,arguments);return c!==o&&(e=(o=c)&&textInterpolate(c)),e}return a._value=s,a}function transition_textTween(s){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(s==null)return this.tween(e,null);if(typeof s!="function")throw new Error;return this.tween(e,textTween(s))}function transition_transition(){for(var s=this._name,e=this._id,o=newId(),a=this._groups,c=a.length,d=0;d<c;++d)for(var h=a[d],g=h.length,b,j=0;j<g;++j)if(b=h[j]){var $=get(b,e);schedule(b,s,o,j,h,{time:$.time+$.delay+$.duration,delay:0,duration:$.duration,ease:$.ease})}return new Transition(a,this._parents,s,o)}function transition_end(){var s,e,o=this,a=o._id,c=o.size();return new Promise(function(d,h){var g={value:h},b={value:function(){--c===0&&d()}};o.each(function(){var j=set(this,a),$=j.on;$!==s&&(e=(s=$).copy(),e._.cancel.push(g),e._.interrupt.push(g),e._.end.push(b)),j.on=e}),c===0&&d()})}var id=0;function Transition(s,e,o,a){this._groups=s,this._parents=e,this._name=o,this._id=a}function newId(){return++id}var selection_prototype=selection.prototype;Transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,easeVarying:transition_easeVarying,end:transition_end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};function cubicInOut(s){return((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2}var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(s,e){for(var o;!(o=s.__transition)||!(o=o[e]);)if(!(s=s.parentNode))throw new Error(`transition ${e} not found`);return o}function selection_transition(s){var e,o;s instanceof Transition?(e=s._id,s=s._name):(e=newId(),(o=defaultTiming).time=now(),s=s==null?null:s+"");for(var a=this._groups,c=a.length,d=0;d<c;++d)for(var h=a[d],g=h.length,b,j=0;j<g;++j)(b=h[j])&&schedule(b,s,e,j,h,o||inherit(b,e));return new Transition(a,this._parents,s,e)}selection.prototype.interrupt=selection_interrupt;selection.prototype.transition=selection_transition;const constant=s=>()=>s;function ZoomEvent(s,{sourceEvent:e,target:o,transform:a,dispatch:c}){Object.defineProperties(this,{type:{value:s,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},transform:{value:a,enumerable:!0,configurable:!0},_:{value:c}})}function Transform(s,e,o){this.k=s,this.x=e,this.y=o}Transform.prototype={constructor:Transform,scale:function(s){return s===1?this:new Transform(this.k*s,this.x,this.y)},translate:function(s,e){return s===0&e===0?this:new Transform(this.k,this.x+this.k*s,this.y+this.k*e)},apply:function(s){return[s[0]*this.k+this.x,s[1]*this.k+this.y]},applyX:function(s){return s*this.k+this.x},applyY:function(s){return s*this.k+this.y},invert:function(s){return[(s[0]-this.x)/this.k,(s[1]-this.y)/this.k]},invertX:function(s){return(s-this.x)/this.k},invertY:function(s){return(s-this.y)/this.k},rescaleX:function(s){return s.copy().domain(s.range().map(this.invertX,this).map(s.invert,s))},rescaleY:function(s){return s.copy().domain(s.range().map(this.invertY,this).map(s.invert,s))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var identity$1=new Transform(1,0,0);transform.prototype=Transform.prototype;function transform(s){for(;!s.__zoom;)if(!(s=s.parentNode))return identity$1;return s.__zoom}function nopropagation(s){s.stopImmediatePropagation()}function noevent(s){s.preventDefault(),s.stopImmediatePropagation()}function defaultFilter(s){return(!s.ctrlKey||s.type==="wheel")&&!s.button}function defaultExtent(){var s=this;return s instanceof SVGElement?(s=s.ownerSVGElement||s,s.hasAttribute("viewBox")?(s=s.viewBox.baseVal,[[s.x,s.y],[s.x+s.width,s.y+s.height]]):[[0,0],[s.width.baseVal.value,s.height.baseVal.value]]):[[0,0],[s.clientWidth,s.clientHeight]]}function defaultTransform(){return this.__zoom||identity$1}function defaultWheelDelta(s){return-s.deltaY*(s.deltaMode===1?.05:s.deltaMode?1:.002)*(s.ctrlKey?10:1)}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function defaultConstrain(s,e,o){var a=s.invertX(e[0][0])-o[0][0],c=s.invertX(e[1][0])-o[1][0],d=s.invertY(e[0][1])-o[0][1],h=s.invertY(e[1][1])-o[1][1];return s.translate(c>a?(a+c)/2:Math.min(0,a)||Math.max(0,c),h>d?(d+h)/2:Math.min(0,d)||Math.max(0,h))}function zoom(){var s=defaultFilter,e=defaultExtent,o=defaultConstrain,a=defaultWheelDelta,c=defaultTouchable,d=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],g=250,b=interpolateZoom,j=dispatch("start","zoom","end"),$,_,_e,et=500,nt=150,rt=0,it=10;function st(ht){ht.property("__zoom",defaultTransform).on("wheel.zoom",ft,{passive:!1}).on("mousedown.zoom",xt).on("dblclick.zoom",Ct).filter(c).on("touchstart.zoom",yt).on("touchmove.zoom",Et).on("touchend.zoom touchcancel.zoom",Tt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}st.transform=function(ht,wt,St,bt){var mt=ht.selection?ht.selection():ht;mt.property("__zoom",defaultTransform),ht!==mt?ut(ht,wt,St,bt):mt.interrupt().each(function(){at(this,arguments).event(bt).start().zoom(null,typeof wt=="function"?wt.apply(this,arguments):wt).end()})},st.scaleBy=function(ht,wt,St,bt){st.scaleTo(ht,function(){var mt=this.__zoom.k,gt=typeof wt=="function"?wt.apply(this,arguments):wt;return mt*gt},St,bt)},st.scaleTo=function(ht,wt,St,bt){st.transform(ht,function(){var mt=e.apply(this,arguments),gt=this.__zoom,pt=St==null?ct(mt):typeof St=="function"?St.apply(this,arguments):St,kt=gt.invert(pt),Rt=typeof wt=="function"?wt.apply(this,arguments):wt;return o(ot(lt(gt,Rt),pt,kt),mt,h)},St,bt)},st.translateBy=function(ht,wt,St,bt){st.transform(ht,function(){return o(this.__zoom.translate(typeof wt=="function"?wt.apply(this,arguments):wt,typeof St=="function"?St.apply(this,arguments):St),e.apply(this,arguments),h)},null,bt)},st.translateTo=function(ht,wt,St,bt,mt){st.transform(ht,function(){var gt=e.apply(this,arguments),pt=this.__zoom,kt=bt==null?ct(gt):typeof bt=="function"?bt.apply(this,arguments):bt;return o(identity$1.translate(kt[0],kt[1]).scale(pt.k).translate(typeof wt=="function"?-wt.apply(this,arguments):-wt,typeof St=="function"?-St.apply(this,arguments):-St),gt,h)},bt,mt)};function lt(ht,wt){return wt=Math.max(d[0],Math.min(d[1],wt)),wt===ht.k?ht:new Transform(wt,ht.x,ht.y)}function ot(ht,wt,St){var bt=wt[0]-St[0]*ht.k,mt=wt[1]-St[1]*ht.k;return bt===ht.x&&mt===ht.y?ht:new Transform(ht.k,bt,mt)}function ct(ht){return[(+ht[0][0]+ +ht[1][0])/2,(+ht[0][1]+ +ht[1][1])/2]}function ut(ht,wt,St,bt){ht.on("start.zoom",function(){at(this,arguments).event(bt).start()}).on("interrupt.zoom end.zoom",function(){at(this,arguments).event(bt).end()}).tween("zoom",function(){var mt=this,gt=arguments,pt=at(mt,gt).event(bt),kt=e.apply(mt,gt),Rt=St==null?ct(kt):typeof St=="function"?St.apply(mt,gt):St,At=Math.max(kt[1][0]-kt[0][0],kt[1][1]-kt[0][1]),Mt=mt.__zoom,Dt=typeof wt=="function"?wt.apply(mt,gt):wt,$t=b(Mt.invert(Rt).concat(At/Mt.k),Dt.invert(Rt).concat(At/Dt.k));return function(_t){if(_t===1)_t=Dt;else{var Pt=$t(_t),Ht=At/Pt[2];_t=new Transform(Ht,Rt[0]-Pt[0]*Ht,Rt[1]-Pt[1]*Ht)}pt.zoom(null,_t)}})}function at(ht,wt,St){return!St&&ht.__zooming||new dt(ht,wt)}function dt(ht,wt){this.that=ht,this.args=wt,this.active=0,this.sourceEvent=null,this.extent=e.apply(ht,wt),this.taps=0}dt.prototype={event:function(ht){return ht&&(this.sourceEvent=ht),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(ht,wt){return this.mouse&&ht!=="mouse"&&(this.mouse[1]=wt.invert(this.mouse[0])),this.touch0&&ht!=="touch"&&(this.touch0[1]=wt.invert(this.touch0[0])),this.touch1&&ht!=="touch"&&(this.touch1[1]=wt.invert(this.touch1[0])),this.that.__zoom=wt,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(ht){var wt=select(this.that).datum();j.call(ht,this.that,new ZoomEvent(ht,{sourceEvent:this.sourceEvent,target:st,transform:this.that.__zoom,dispatch:j}),wt)}};function ft(ht,...wt){if(!s.apply(this,arguments))return;var St=at(this,wt).event(ht),bt=this.__zoom,mt=Math.max(d[0],Math.min(d[1],bt.k*Math.pow(2,a.apply(this,arguments)))),gt=pointer(ht);if(St.wheel)(St.mouse[0][0]!==gt[0]||St.mouse[0][1]!==gt[1])&&(St.mouse[1]=bt.invert(St.mouse[0]=gt)),clearTimeout(St.wheel);else{if(bt.k===mt)return;St.mouse=[gt,bt.invert(gt)],interrupt(this),St.start()}noevent(ht),St.wheel=setTimeout(pt,nt),St.zoom("mouse",o(ot(lt(bt,mt),St.mouse[0],St.mouse[1]),St.extent,h));function pt(){St.wheel=null,St.end()}}function xt(ht,...wt){if(_e||!s.apply(this,arguments))return;var St=ht.currentTarget,bt=at(this,wt,!0).event(ht),mt=select(ht.view).on("mousemove.zoom",Rt,!0).on("mouseup.zoom",At,!0),gt=pointer(ht,St),pt=ht.clientX,kt=ht.clientY;dragDisable(ht.view),nopropagation(ht),bt.mouse=[gt,this.__zoom.invert(gt)],interrupt(this),bt.start();function Rt(Mt){if(noevent(Mt),!bt.moved){var Dt=Mt.clientX-pt,$t=Mt.clientY-kt;bt.moved=Dt*Dt+$t*$t>rt}bt.event(Mt).zoom("mouse",o(ot(bt.that.__zoom,bt.mouse[0]=pointer(Mt,St),bt.mouse[1]),bt.extent,h))}function At(Mt){mt.on("mousemove.zoom mouseup.zoom",null),yesdrag(Mt.view,bt.moved),noevent(Mt),bt.event(Mt).end()}}function Ct(ht,...wt){if(s.apply(this,arguments)){var St=this.__zoom,bt=pointer(ht.changedTouches?ht.changedTouches[0]:ht,this),mt=St.invert(bt),gt=St.k*(ht.shiftKey?.5:2),pt=o(ot(lt(St,gt),bt,mt),e.apply(this,wt),h);noevent(ht),g>0?select(this).transition().duration(g).call(ut,pt,bt,ht):select(this).call(st.transform,pt,bt,ht)}}function yt(ht,...wt){if(s.apply(this,arguments)){var St=ht.touches,bt=St.length,mt=at(this,wt,ht.changedTouches.length===bt).event(ht),gt,pt,kt,Rt;for(nopropagation(ht),pt=0;pt<bt;++pt)kt=St[pt],Rt=pointer(kt,this),Rt=[Rt,this.__zoom.invert(Rt),kt.identifier],mt.touch0?!mt.touch1&&mt.touch0[2]!==Rt[2]&&(mt.touch1=Rt,mt.taps=0):(mt.touch0=Rt,gt=!0,mt.taps=1+!!$);$&&($=clearTimeout($)),gt&&(mt.taps<2&&(_=Rt[0],$=setTimeout(function(){$=null},et)),interrupt(this),mt.start())}}function Et(ht,...wt){if(this.__zooming){var St=at(this,wt).event(ht),bt=ht.changedTouches,mt=bt.length,gt,pt,kt,Rt;for(noevent(ht),gt=0;gt<mt;++gt)pt=bt[gt],kt=pointer(pt,this),St.touch0&&St.touch0[2]===pt.identifier?St.touch0[0]=kt:St.touch1&&St.touch1[2]===pt.identifier&&(St.touch1[0]=kt);if(pt=St.that.__zoom,St.touch1){var At=St.touch0[0],Mt=St.touch0[1],Dt=St.touch1[0],$t=St.touch1[1],_t=(_t=Dt[0]-At[0])*_t+(_t=Dt[1]-At[1])*_t,Pt=(Pt=$t[0]-Mt[0])*Pt+(Pt=$t[1]-Mt[1])*Pt;pt=lt(pt,Math.sqrt(_t/Pt)),kt=[(At[0]+Dt[0])/2,(At[1]+Dt[1])/2],Rt=[(Mt[0]+$t[0])/2,(Mt[1]+$t[1])/2]}else if(St.touch0)kt=St.touch0[0],Rt=St.touch0[1];else return;St.zoom("touch",o(ot(pt,kt,Rt),St.extent,h))}}function Tt(ht,...wt){if(this.__zooming){var St=at(this,wt).event(ht),bt=ht.changedTouches,mt=bt.length,gt,pt;for(nopropagation(ht),_e&&clearTimeout(_e),_e=setTimeout(function(){_e=null},et),gt=0;gt<mt;++gt)pt=bt[gt],St.touch0&&St.touch0[2]===pt.identifier?delete St.touch0:St.touch1&&St.touch1[2]===pt.identifier&&delete St.touch1;if(St.touch1&&!St.touch0&&(St.touch0=St.touch1,delete St.touch1),St.touch0)St.touch0[1]=this.__zoom.invert(St.touch0[0]);else if(St.end(),St.taps===2&&(pt=pointer(pt,this),Math.hypot(_[0]-pt[0],_[1]-pt[1])<it)){var kt=select(this).on("dblclick.zoom");kt&&kt.apply(this,arguments)}}}return st.wheelDelta=function(ht){return arguments.length?(a=typeof ht=="function"?ht:constant(+ht),st):a},st.filter=function(ht){return arguments.length?(s=typeof ht=="function"?ht:constant(!!ht),st):s},st.touchable=function(ht){return arguments.length?(c=typeof ht=="function"?ht:constant(!!ht),st):c},st.extent=function(ht){return arguments.length?(e=typeof ht=="function"?ht:constant([[+ht[0][0],+ht[0][1]],[+ht[1][0],+ht[1][1]]]),st):e},st.scaleExtent=function(ht){return arguments.length?(d[0]=+ht[0],d[1]=+ht[1],st):[d[0],d[1]]},st.translateExtent=function(ht){return arguments.length?(h[0][0]=+ht[0][0],h[1][0]=+ht[1][0],h[0][1]=+ht[0][1],h[1][1]=+ht[1][1],st):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},st.constrain=function(ht){return arguments.length?(o=ht,st):o},st.duration=function(ht){return arguments.length?(g=+ht,st):g},st.interpolate=function(ht){return arguments.length?(b=ht,st):b},st.on=function(){var ht=j.on.apply(j,arguments);return ht===j?st:ht},st.clickDistance=function(ht){return arguments.length?(rt=(ht=+ht)*ht,st):Math.sqrt(rt)},st.tapDistance=function(ht){return arguments.length?(it=+ht,st):it},st}const errorMessages={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:s=>`Node type "${s}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:s=>`The old edge with id=${s} does not exist.`,error009:s=>`Marker type "${s}" doesn't exist.`,error008:(s,{id:e,sourceHandle:o,targetHandle:a})=>`Couldn't create edge for ${s} handle id: "${s==="source"?o:a}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:s=>`Edge type "${s}" not found. Using fallback type "default".`,error012:s=>`Node with id "${s}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(s="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${s}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},infiniteExtent=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],elementSelectionKeys=["Enter"," ","Escape"],defaultAriaLabelConfig={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:s,x:e,y:o})=>`Moved selected node ${s}. New position, x: ${e}, y: ${o}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ConnectionMode;(function(s){s.Strict="strict",s.Loose="loose"})(ConnectionMode||(ConnectionMode={}));var PanOnScrollMode;(function(s){s.Free="free",s.Vertical="vertical",s.Horizontal="horizontal"})(PanOnScrollMode||(PanOnScrollMode={}));var SelectionMode;(function(s){s.Partial="partial",s.Full="full"})(SelectionMode||(SelectionMode={}));const initialConnection={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var ConnectionLineType;(function(s){s.Bezier="default",s.Straight="straight",s.Step="step",s.SmoothStep="smoothstep",s.SimpleBezier="simplebezier"})(ConnectionLineType||(ConnectionLineType={}));var MarkerType;(function(s){s.Arrow="arrow",s.ArrowClosed="arrowclosed"})(MarkerType||(MarkerType={}));var Position;(function(s){s.Left="left",s.Top="top",s.Right="right",s.Bottom="bottom"})(Position||(Position={}));const oppositePosition={[Position.Left]:Position.Right,[Position.Right]:Position.Left,[Position.Top]:Position.Bottom,[Position.Bottom]:Position.Top};function getConnectionStatus(s){return s===null?null:s?"valid":"invalid"}const isEdgeBase=s=>"id"in s&&"source"in s&&"target"in s,isNodeBase=s=>"id"in s&&"position"in s&&!("source"in s)&&!("target"in s),isInternalNodeBase=s=>"id"in s&&"internals"in s&&!("source"in s)&&!("target"in s),getNodePositionWithOrigin=(s,e=[0,0])=>{const{width:o,height:a}=getNodeDimensions(s),c=s.origin??e,d=o*c[0],h=a*c[1];return{x:s.position.x-d,y:s.position.y-h}},getNodesBounds=(s,e={nodeOrigin:[0,0]})=>{if(s.length===0)return{x:0,y:0,width:0,height:0};const o=s.reduce((a,c)=>{const d=typeof c=="string";let h=!e.nodeLookup&&!d?c:void 0;e.nodeLookup&&(h=d?e.nodeLookup.get(c):isInternalNodeBase(c)?c:e.nodeLookup.get(c.id));const g=h?nodeToBox(h,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return getBoundsOfBoxes(a,g)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return boxToRect(o)},getInternalNodesBounds=(s,e={})=>{let o={x:1/0,y:1/0,x2:-1/0,y2:-1/0},a=!1;return s.forEach(c=>{(e.filter===void 0||e.filter(c))&&(o=getBoundsOfBoxes(o,nodeToBox(c)),a=!0)}),a?boxToRect(o):{x:0,y:0,width:0,height:0}},getNodesInside=(s,e,[o,a,c]=[0,0,1],d=!1,h=!1)=>{const g={...pointToRendererPoint(e,[o,a,c]),width:e.width/c,height:e.height/c},b=[];for(const j of s.values()){const{measured:$,selectable:_=!0,hidden:_e=!1}=j;if(h&&!_||_e)continue;const et=$.width??j.width??j.initialWidth??null,nt=$.height??j.height??j.initialHeight??null,rt=getOverlappingArea(g,nodeToRect(j)),it=(et??0)*(nt??0),st=d&&rt>0;(!j.internals.handleBounds||st||rt>=it||j.dragging)&&b.push(j)}return b},getConnectedEdges=(s,e)=>{const o=new Set;return s.forEach(a=>{o.add(a.id)}),e.filter(a=>o.has(a.source)||o.has(a.target))};function getFitViewNodes(s,e){const o=new Map,a=e!=null&&e.nodes?new Set(e.nodes.map(c=>c.id)):null;return s.forEach(c=>{c.measured.width&&c.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!c.hidden)&&(!a||a.has(c.id))&&o.set(c.id,c)}),o}async function fitViewport({nodes:s,width:e,height:o,panZoom:a,minZoom:c,maxZoom:d},h){if(s.size===0)return Promise.resolve(!0);const g=getFitViewNodes(s,h),b=getInternalNodesBounds(g),j=getViewportForBounds(b,e,o,(h==null?void 0:h.minZoom)??c,(h==null?void 0:h.maxZoom)??d,(h==null?void 0:h.padding)??.1);return await a.setViewport(j,{duration:h==null?void 0:h.duration,ease:h==null?void 0:h.ease,interpolate:h==null?void 0:h.interpolate}),Promise.resolve(!0)}function calculateNodePosition({nodeId:s,nextPosition:e,nodeLookup:o,nodeOrigin:a=[0,0],nodeExtent:c,onError:d}){const h=o.get(s),g=h.parentId?o.get(h.parentId):void 0,{x:b,y:j}=g?g.internals.positionAbsolute:{x:0,y:0},$=h.origin??a;let _=h.extent||c;if(h.extent==="parent"&&!h.expandParent)if(!g)d==null||d("005",errorMessages.error005());else{const et=g.measured.width,nt=g.measured.height;et&&nt&&(_=[[b,j],[b+et,j+nt]])}else g&&isCoordinateExtent(h.extent)&&(_=[[h.extent[0][0]+b,h.extent[0][1]+j],[h.extent[1][0]+b,h.extent[1][1]+j]]);const _e=isCoordinateExtent(_)?clampPosition(e,_,h.measured):e;return(h.measured.width===void 0||h.measured.height===void 0)&&(d==null||d("015",errorMessages.error015())),{position:{x:_e.x-b+(h.measured.width??0)*$[0],y:_e.y-j+(h.measured.height??0)*$[1]},positionAbsolute:_e}}async function getElementsToRemove({nodesToRemove:s=[],edgesToRemove:e=[],nodes:o,edges:a,onBeforeDelete:c}){const d=new Set(s.map(_e=>_e.id)),h=[];for(const _e of o){if(_e.deletable===!1)continue;const et=d.has(_e.id),nt=!et&&_e.parentId&&h.find(rt=>rt.id===_e.parentId);(et||nt)&&h.push(_e)}const g=new Set(e.map(_e=>_e.id)),b=a.filter(_e=>_e.deletable!==!1),$=getConnectedEdges(h,b);for(const _e of b)g.has(_e.id)&&!$.find(nt=>nt.id===_e.id)&&$.push(_e);if(!c)return{edges:$,nodes:h};const _=await c({nodes:h,edges:$});return typeof _=="boolean"?_?{edges:$,nodes:h}:{edges:[],nodes:[]}:_}const clamp=(s,e=0,o=1)=>Math.min(Math.max(s,e),o),clampPosition=(s={x:0,y:0},e,o)=>({x:clamp(s.x,e[0][0],e[1][0]-((o==null?void 0:o.width)??0)),y:clamp(s.y,e[0][1],e[1][1]-((o==null?void 0:o.height)??0))});function clampPositionToParent(s,e,o){const{width:a,height:c}=getNodeDimensions(o),{x:d,y:h}=o.internals.positionAbsolute;return clampPosition(s,[[d,h],[d+a,h+c]],e)}const calcAutoPanVelocity=(s,e,o)=>s<e?clamp(Math.abs(s-e),1,e)/e:s>o?-clamp(Math.abs(s-o),1,e)/e:0,calcAutoPan=(s,e,o=15,a=40)=>{const c=calcAutoPanVelocity(s.x,a,e.width-a)*o,d=calcAutoPanVelocity(s.y,a,e.height-a)*o;return[c,d]},getBoundsOfBoxes=(s,e)=>({x:Math.min(s.x,e.x),y:Math.min(s.y,e.y),x2:Math.max(s.x2,e.x2),y2:Math.max(s.y2,e.y2)}),rectToBox=({x:s,y:e,width:o,height:a})=>({x:s,y:e,x2:s+o,y2:e+a}),boxToRect=({x:s,y:e,x2:o,y2:a})=>({x:s,y:e,width:o-s,height:a-e}),nodeToRect=(s,e=[0,0])=>{var c,d;const{x:o,y:a}=isInternalNodeBase(s)?s.internals.positionAbsolute:getNodePositionWithOrigin(s,e);return{x:o,y:a,width:((c=s.measured)==null?void 0:c.width)??s.width??s.initialWidth??0,height:((d=s.measured)==null?void 0:d.height)??s.height??s.initialHeight??0}},nodeToBox=(s,e=[0,0])=>{var c,d;const{x:o,y:a}=isInternalNodeBase(s)?s.internals.positionAbsolute:getNodePositionWithOrigin(s,e);return{x:o,y:a,x2:o+(((c=s.measured)==null?void 0:c.width)??s.width??s.initialWidth??0),y2:a+(((d=s.measured)==null?void 0:d.height)??s.height??s.initialHeight??0)}},getBoundsOfRects=(s,e)=>boxToRect(getBoundsOfBoxes(rectToBox(s),rectToBox(e))),getOverlappingArea=(s,e)=>{const o=Math.max(0,Math.min(s.x+s.width,e.x+e.width)-Math.max(s.x,e.x)),a=Math.max(0,Math.min(s.y+s.height,e.y+e.height)-Math.max(s.y,e.y));return Math.ceil(o*a)},isRectObject=s=>isNumeric(s.width)&&isNumeric(s.height)&&isNumeric(s.x)&&isNumeric(s.y),isNumeric=s=>!isNaN(s)&&isFinite(s),devWarn=(s,e)=>{},snapPosition=(s,e=[1,1])=>({x:e[0]*Math.round(s.x/e[0]),y:e[1]*Math.round(s.y/e[1])}),pointToRendererPoint=({x:s,y:e},[o,a,c],d=!1,h=[1,1])=>{const g={x:(s-o)/c,y:(e-a)/c};return d?snapPosition(g,h):g},rendererPointToPoint=({x:s,y:e},[o,a,c])=>({x:s*c+o,y:e*c+a});function parsePadding(s,e){if(typeof s=="number")return Math.floor((e-e/(1+s))*.5);if(typeof s=="string"&&s.endsWith("px")){const o=parseFloat(s);if(!Number.isNaN(o))return Math.floor(o)}if(typeof s=="string"&&s.endsWith("%")){const o=parseFloat(s);if(!Number.isNaN(o))return Math.floor(e*o*.01)}return console.error(`[React Flow] The padding value "${s}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function parsePaddings(s,e,o){if(typeof s=="string"||typeof s=="number"){const a=parsePadding(s,o),c=parsePadding(s,e);return{top:a,right:c,bottom:a,left:c,x:c*2,y:a*2}}if(typeof s=="object"){const a=parsePadding(s.top??s.y??0,o),c=parsePadding(s.bottom??s.y??0,o),d=parsePadding(s.left??s.x??0,e),h=parsePadding(s.right??s.x??0,e);return{top:a,right:h,bottom:c,left:d,x:d+h,y:a+c}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function calculateAppliedPaddings(s,e,o,a,c,d){const{x:h,y:g}=rendererPointToPoint(s,[e,o,a]),{x:b,y:j}=rendererPointToPoint({x:s.x+s.width,y:s.y+s.height},[e,o,a]),$=c-b,_=d-j;return{left:Math.floor(h),top:Math.floor(g),right:Math.floor($),bottom:Math.floor(_)}}const getViewportForBounds=(s,e,o,a,c,d)=>{const h=parsePaddings(d,e,o),g=(e-h.x)/s.width,b=(o-h.y)/s.height,j=Math.min(g,b),$=clamp(j,a,c),_=s.x+s.width/2,_e=s.y+s.height/2,et=e/2-_*$,nt=o/2-_e*$,rt=calculateAppliedPaddings(s,et,nt,$,e,o),it={left:Math.min(rt.left-h.left,0),top:Math.min(rt.top-h.top,0),right:Math.min(rt.right-h.right,0),bottom:Math.min(rt.bottom-h.bottom,0)};return{x:et-it.left+it.right,y:nt-it.top+it.bottom,zoom:$}},isMacOs=()=>{var s;return typeof navigator<"u"&&((s=navigator==null?void 0:navigator.userAgent)==null?void 0:s.indexOf("Mac"))>=0};function isCoordinateExtent(s){return s!=null&&s!=="parent"}function getNodeDimensions(s){var e,o;return{width:((e=s.measured)==null?void 0:e.width)??s.width??s.initialWidth??0,height:((o=s.measured)==null?void 0:o.height)??s.height??s.initialHeight??0}}function nodeHasDimensions(s){var e,o;return(((e=s.measured)==null?void 0:e.width)??s.width??s.initialWidth)!==void 0&&(((o=s.measured)==null?void 0:o.height)??s.height??s.initialHeight)!==void 0}function evaluateAbsolutePosition(s,e={width:0,height:0},o,a,c){const d={...s},h=a.get(o);if(h){const g=h.origin||c;d.x+=h.internals.positionAbsolute.x-(e.width??0)*g[0],d.y+=h.internals.positionAbsolute.y-(e.height??0)*g[1]}return d}function areSetsEqual(s,e){if(s.size!==e.size)return!1;for(const o of s)if(!e.has(o))return!1;return!0}function withResolvers(){let s,e;return{promise:new Promise((a,c)=>{s=a,e=c}),resolve:s,reject:e}}function mergeAriaLabelConfig(s){return{...defaultAriaLabelConfig,...s||{}}}function getPointerPosition(s,{snapGrid:e=[0,0],snapToGrid:o=!1,transform:a,containerBounds:c}){const{x:d,y:h}=getEventPosition(s),g=pointToRendererPoint({x:d-((c==null?void 0:c.left)??0),y:h-((c==null?void 0:c.top)??0)},a),{x:b,y:j}=o?snapPosition(g,e):g;return{xSnapped:b,ySnapped:j,...g}}const getDimensions=s=>({width:s.offsetWidth,height:s.offsetHeight}),getHostForElement=s=>{var e;return((e=s==null?void 0:s.getRootNode)==null?void 0:e.call(s))||(window==null?void 0:window.document)},inputTags=["INPUT","SELECT","TEXTAREA"];function isInputDOMNode(s){var a,c;const e=((c=(a=s.composedPath)==null?void 0:a.call(s))==null?void 0:c[0])||s.target;return(e==null?void 0:e.nodeType)!==1?!1:inputTags.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const isMouseEvent=s=>"clientX"in s,getEventPosition=(s,e)=>{var d,h;const o=isMouseEvent(s),a=o?s.clientX:(d=s.touches)==null?void 0:d[0].clientX,c=o?s.clientY:(h=s.touches)==null?void 0:h[0].clientY;return{x:a-((e==null?void 0:e.left)??0),y:c-((e==null?void 0:e.top)??0)}},getHandleBounds=(s,e,o,a,c)=>{const d=e.querySelectorAll(`.${s}`);return!d||!d.length?null:Array.from(d).map(h=>{const g=h.getBoundingClientRect();return{id:h.getAttribute("data-handleid"),type:s,nodeId:c,position:h.getAttribute("data-handlepos"),x:(g.left-o.left)/a,y:(g.top-o.top)/a,...getDimensions(h)}})};function getBezierEdgeCenter({sourceX:s,sourceY:e,targetX:o,targetY:a,sourceControlX:c,sourceControlY:d,targetControlX:h,targetControlY:g}){const b=s*.125+c*.375+h*.375+o*.125,j=e*.125+d*.375+g*.375+a*.125,$=Math.abs(b-s),_=Math.abs(j-e);return[b,j,$,_]}function calculateControlOffset(s,e){return s>=0?.5*s:e*25*Math.sqrt(-s)}function getControlWithCurvature({pos:s,x1:e,y1:o,x2:a,y2:c,c:d}){switch(s){case Position.Left:return[e-calculateControlOffset(e-a,d),o];case Position.Right:return[e+calculateControlOffset(a-e,d),o];case Position.Top:return[e,o-calculateControlOffset(o-c,d)];case Position.Bottom:return[e,o+calculateControlOffset(c-o,d)]}}function getBezierPath({sourceX:s,sourceY:e,sourcePosition:o=Position.Bottom,targetX:a,targetY:c,targetPosition:d=Position.Top,curvature:h=.25}){const[g,b]=getControlWithCurvature({pos:o,x1:s,y1:e,x2:a,y2:c,c:h}),[j,$]=getControlWithCurvature({pos:d,x1:a,y1:c,x2:s,y2:e,c:h}),[_,_e,et,nt]=getBezierEdgeCenter({sourceX:s,sourceY:e,targetX:a,targetY:c,sourceControlX:g,sourceControlY:b,targetControlX:j,targetControlY:$});return[`M${s},${e} C${g},${b} ${j},${$} ${a},${c}`,_,_e,et,nt]}function getEdgeCenter({sourceX:s,sourceY:e,targetX:o,targetY:a}){const c=Math.abs(o-s)/2,d=o<s?o+c:o-c,h=Math.abs(a-e)/2,g=a<e?a+h:a-h;return[d,g,c,h]}function getElevatedEdgeZIndex({sourceNode:s,targetNode:e,selected:o=!1,zIndex:a=0,elevateOnSelect:c=!1,zIndexMode:d="basic"}){if(d==="manual")return a;const h=c&&o?a+1e3:a,g=Math.max(s.parentId||c&&s.selected?s.internals.z:0,e.parentId||c&&e.selected?e.internals.z:0);return h+g}function isEdgeVisible({sourceNode:s,targetNode:e,width:o,height:a,transform:c}){const d=getBoundsOfBoxes(nodeToBox(s),nodeToBox(e));d.x===d.x2&&(d.x2+=1),d.y===d.y2&&(d.y2+=1);const h={x:-c[0]/c[2],y:-c[1]/c[2],width:o/c[2],height:a/c[2]};return getOverlappingArea(h,boxToRect(d))>0}const getEdgeId=({source:s,sourceHandle:e,target:o,targetHandle:a})=>`xy-edge__${s}${e||""}-${o}${a||""}`,connectionExists=(s,e)=>e.some(o=>o.source===s.source&&o.target===s.target&&(o.sourceHandle===s.sourceHandle||!o.sourceHandle&&!s.sourceHandle)&&(o.targetHandle===s.targetHandle||!o.targetHandle&&!s.targetHandle)),addEdge=(s,e,o={})=>{if(!s.source||!s.target)return e;const a=o.getEdgeId||getEdgeId;let c;return isEdgeBase(s)?c={...s}:c={...s,id:a(s)},connectionExists(c,e)?e:(c.sourceHandle===null&&delete c.sourceHandle,c.targetHandle===null&&delete c.targetHandle,e.concat(c))};function getStraightPath({sourceX:s,sourceY:e,targetX:o,targetY:a}){const[c,d,h,g]=getEdgeCenter({sourceX:s,sourceY:e,targetX:o,targetY:a});return[`M ${s},${e}L ${o},${a}`,c,d,h,g]}const handleDirections={[Position.Left]:{x:-1,y:0},[Position.Right]:{x:1,y:0},[Position.Top]:{x:0,y:-1},[Position.Bottom]:{x:0,y:1}},getDirection=({source:s,sourcePosition:e=Position.Bottom,target:o})=>e===Position.Left||e===Position.Right?s.x<o.x?{x:1,y:0}:{x:-1,y:0}:s.y<o.y?{x:0,y:1}:{x:0,y:-1},distance=(s,e)=>Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2));function getPoints({source:s,sourcePosition:e=Position.Bottom,target:o,targetPosition:a=Position.Top,center:c,offset:d,stepPosition:h}){const g=handleDirections[e],b=handleDirections[a],j={x:s.x+g.x*d,y:s.y+g.y*d},$={x:o.x+b.x*d,y:o.y+b.y*d},_=getDirection({source:j,sourcePosition:e,target:$}),_e=_.x!==0?"x":"y",et=_[_e];let nt=[],rt,it;const st={x:0,y:0},lt={x:0,y:0},[,,ot,ct]=getEdgeCenter({sourceX:s.x,sourceY:s.y,targetX:o.x,targetY:o.y});if(g[_e]*b[_e]===-1){_e==="x"?(rt=c.x??j.x+($.x-j.x)*h,it=c.y??(j.y+$.y)/2):(rt=c.x??(j.x+$.x)/2,it=c.y??j.y+($.y-j.y)*h);const at=[{x:rt,y:j.y},{x:rt,y:$.y}],dt=[{x:j.x,y:it},{x:$.x,y:it}];g[_e]===et?nt=_e==="x"?at:dt:nt=_e==="x"?dt:at}else{const at=[{x:j.x,y:$.y}],dt=[{x:$.x,y:j.y}];if(_e==="x"?nt=g.x===et?dt:at:nt=g.y===et?at:dt,e===a){const Et=Math.abs(s[_e]-o[_e]);if(Et<=d){const Tt=Math.min(d-1,d-Et);g[_e]===et?st[_e]=(j[_e]>s[_e]?-1:1)*Tt:lt[_e]=($[_e]>o[_e]?-1:1)*Tt}}if(e!==a){const Et=_e==="x"?"y":"x",Tt=g[_e]===b[Et],ht=j[Et]>$[Et],wt=j[Et]<$[Et];(g[_e]===1&&(!Tt&&ht||Tt&&wt)||g[_e]!==1&&(!Tt&&wt||Tt&&ht))&&(nt=_e==="x"?at:dt)}const ft={x:j.x+st.x,y:j.y+st.y},xt={x:$.x+lt.x,y:$.y+lt.y},Ct=Math.max(Math.abs(ft.x-nt[0].x),Math.abs(xt.x-nt[0].x)),yt=Math.max(Math.abs(ft.y-nt[0].y),Math.abs(xt.y-nt[0].y));Ct>=yt?(rt=(ft.x+xt.x)/2,it=nt[0].y):(rt=nt[0].x,it=(ft.y+xt.y)/2)}return[[s,{x:j.x+st.x,y:j.y+st.y},...nt,{x:$.x+lt.x,y:$.y+lt.y},o],rt,it,ot,ct]}function getBend(s,e,o,a){const c=Math.min(distance(s,e)/2,distance(e,o)/2,a),{x:d,y:h}=e;if(s.x===d&&d===o.x||s.y===h&&h===o.y)return`L${d} ${h}`;if(s.y===h){const j=s.x<o.x?-1:1,$=s.y<o.y?1:-1;return`L ${d+c*j},${h}Q ${d},${h} ${d},${h+c*$}`}const g=s.x<o.x?1:-1,b=s.y<o.y?-1:1;return`L ${d},${h+c*b}Q ${d},${h} ${d+c*g},${h}`}function getSmoothStepPath({sourceX:s,sourceY:e,sourcePosition:o=Position.Bottom,targetX:a,targetY:c,targetPosition:d=Position.Top,borderRadius:h=5,centerX:g,centerY:b,offset:j=20,stepPosition:$=.5}){const[_,_e,et,nt,rt]=getPoints({source:{x:s,y:e},sourcePosition:o,target:{x:a,y:c},targetPosition:d,center:{x:g,y:b},offset:j,stepPosition:$});return[_.reduce((st,lt,ot)=>{let ct="";return ot>0&&ot<_.length-1?ct=getBend(_[ot-1],lt,_[ot+1],h):ct=`${ot===0?"M":"L"}${lt.x} ${lt.y}`,st+=ct,st},""),_e,et,nt,rt]}function isNodeInitialized(s){var e;return s&&!!(s.internals.handleBounds||(e=s.handles)!=null&&e.length)&&!!(s.measured.width||s.width||s.initialWidth)}function getEdgePosition(s){var _;const{sourceNode:e,targetNode:o}=s;if(!isNodeInitialized(e)||!isNodeInitialized(o))return null;const a=e.internals.handleBounds||toHandleBounds(e.handles),c=o.internals.handleBounds||toHandleBounds(o.handles),d=getHandle$1((a==null?void 0:a.source)??[],s.sourceHandle),h=getHandle$1(s.connectionMode===ConnectionMode.Strict?(c==null?void 0:c.target)??[]:((c==null?void 0:c.target)??[]).concat((c==null?void 0:c.source)??[]),s.targetHandle);if(!d||!h)return(_=s.onError)==null||_.call(s,"008",errorMessages.error008(d?"target":"source",{id:s.id,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle})),null;const g=(d==null?void 0:d.position)||Position.Bottom,b=(h==null?void 0:h.position)||Position.Top,j=getHandlePosition(e,d,g),$=getHandlePosition(o,h,b);return{sourceX:j.x,sourceY:j.y,targetX:$.x,targetY:$.y,sourcePosition:g,targetPosition:b}}function toHandleBounds(s){if(!s)return null;const e=[],o=[];for(const a of s)a.width=a.width??1,a.height=a.height??1,a.type==="source"?e.push(a):a.type==="target"&&o.push(a);return{source:e,target:o}}function getHandlePosition(s,e,o=Position.Left,a=!1){const c=((e==null?void 0:e.x)??0)+s.internals.positionAbsolute.x,d=((e==null?void 0:e.y)??0)+s.internals.positionAbsolute.y,{width:h,height:g}=e??getNodeDimensions(s);if(a)return{x:c+h/2,y:d+g/2};switch((e==null?void 0:e.position)??o){case Position.Top:return{x:c+h/2,y:d};case Position.Right:return{x:c+h,y:d+g/2};case Position.Bottom:return{x:c+h/2,y:d+g};case Position.Left:return{x:c,y:d+g/2}}}function getHandle$1(s,e){return s&&(e?s.find(o=>o.id===e):s[0])||null}function getMarkerId(s,e){return s?typeof s=="string"?s:`${e?`${e}__`:""}${Object.keys(s).sort().map(a=>`${a}=${s[a]}`).join("&")}`:""}function createMarkerIds(s,{id:e,defaultColor:o,defaultMarkerStart:a,defaultMarkerEnd:c}){const d=new Set;return s.reduce((h,g)=>([g.markerStart||a,g.markerEnd||c].forEach(b=>{if(b&&typeof b=="object"){const j=getMarkerId(b,e);d.has(j)||(h.push({id:j,color:b.color||o,...b}),d.add(j))}}),h),[]).sort((h,g)=>h.id.localeCompare(g.id))}const SELECTED_NODE_Z=1e3,ROOT_PARENT_Z_INCREMENT=10,defaultOptions={nodeOrigin:[0,0],nodeExtent:infiniteExtent,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},adoptUserNodesDefaultOptions={...defaultOptions,checkEquality:!0};function mergeObjects(s,e){const o={...s};for(const a in e)e[a]!==void 0&&(o[a]=e[a]);return o}function updateAbsolutePositions(s,e,o){const a=mergeObjects(defaultOptions,o);for(const c of s.values())if(c.parentId)updateChildNode(c,s,e,a);else{const d=getNodePositionWithOrigin(c,a.nodeOrigin),h=isCoordinateExtent(c.extent)?c.extent:a.nodeExtent,g=clampPosition(d,h,getNodeDimensions(c));c.internals.positionAbsolute=g}}function parseHandles(s,e){if(!s.handles)return s.measured?e==null?void 0:e.internals.handleBounds:void 0;const o=[],a=[];for(const c of s.handles){const d={id:c.id,width:c.width??1,height:c.height??1,nodeId:s.id,x:c.x,y:c.y,position:c.position,type:c.type};c.type==="source"?o.push(d):c.type==="target"&&a.push(d)}return{source:o,target:a}}function isManualZIndexMode(s){return s==="manual"}function adoptUserNodes(s,e,o,a={}){var j,$;const c=mergeObjects(adoptUserNodesDefaultOptions,a),d={i:0},h=new Map(e),g=c!=null&&c.elevateNodesOnSelect&&!isManualZIndexMode(c.zIndexMode)?SELECTED_NODE_Z:0;let b=s.length>0;e.clear(),o.clear();for(const _ of s){let _e=h.get(_.id);if(c.checkEquality&&_===(_e==null?void 0:_e.internals.userNode))e.set(_.id,_e);else{const et=getNodePositionWithOrigin(_,c.nodeOrigin),nt=isCoordinateExtent(_.extent)?_.extent:c.nodeExtent,rt=clampPosition(et,nt,getNodeDimensions(_));_e={...c.defaults,..._,measured:{width:(j=_.measured)==null?void 0:j.width,height:($=_.measured)==null?void 0:$.height},internals:{positionAbsolute:rt,handleBounds:parseHandles(_,_e),z:calculateZ(_,g,c.zIndexMode),userNode:_}},e.set(_.id,_e)}(_e.measured===void 0||_e.measured.width===void 0||_e.measured.height===void 0)&&!_e.hidden&&(b=!1),_.parentId&&updateChildNode(_e,e,o,a,d)}return b}function updateParentLookup(s,e){if(!s.parentId)return;const o=e.get(s.parentId);o?o.set(s.id,s):e.set(s.parentId,new Map([[s.id,s]]))}function updateChildNode(s,e,o,a,c){const{elevateNodesOnSelect:d,nodeOrigin:h,nodeExtent:g,zIndexMode:b}=mergeObjects(defaultOptions,a),j=s.parentId,$=e.get(j);if(!$){console.warn(`Parent node ${j} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}updateParentLookup(s,o),c&&!$.parentId&&$.internals.rootParentIndex===void 0&&b==="auto"&&($.internals.rootParentIndex=++c.i,$.internals.z=$.internals.z+c.i*ROOT_PARENT_Z_INCREMENT),c&&$.internals.rootParentIndex!==void 0&&(c.i=$.internals.rootParentIndex);const _=d&&!isManualZIndexMode(b)?SELECTED_NODE_Z:0,{x:_e,y:et,z:nt}=calculateChildXYZ(s,$,h,g,_,b),{positionAbsolute:rt}=s.internals,it=_e!==rt.x||et!==rt.y;(it||nt!==s.internals.z)&&e.set(s.id,{...s,internals:{...s.internals,positionAbsolute:it?{x:_e,y:et}:rt,z:nt}})}function calculateZ(s,e,o){const a=isNumeric(s.zIndex)?s.zIndex:0;return isManualZIndexMode(o)?a:a+(s.selected?e:0)}function calculateChildXYZ(s,e,o,a,c,d){const{x:h,y:g}=e.internals.positionAbsolute,b=getNodeDimensions(s),j=getNodePositionWithOrigin(s,o),$=isCoordinateExtent(s.extent)?clampPosition(j,s.extent,b):j;let _=clampPosition({x:h+$.x,y:g+$.y},a,b);s.extent==="parent"&&(_=clampPositionToParent(_,b,e));const _e=calculateZ(s,c,d),et=e.internals.z??0;return{x:_.x,y:_.y,z:et>=_e?et+1:_e}}function handleExpandParent(s,e,o,a=[0,0]){var h;const c=[],d=new Map;for(const g of s){const b=e.get(g.parentId);if(!b)continue;const j=((h=d.get(g.parentId))==null?void 0:h.expandedRect)??nodeToRect(b),$=getBoundsOfRects(j,g.rect);d.set(g.parentId,{expandedRect:$,parent:b})}return d.size>0&&d.forEach(({expandedRect:g,parent:b},j)=>{var ot;const $=b.internals.positionAbsolute,_=getNodeDimensions(b),_e=b.origin??a,et=g.x<$.x?Math.round(Math.abs($.x-g.x)):0,nt=g.y<$.y?Math.round(Math.abs($.y-g.y)):0,rt=Math.max(_.width,Math.round(g.width)),it=Math.max(_.height,Math.round(g.height)),st=(rt-_.width)*_e[0],lt=(it-_.height)*_e[1];(et>0||nt>0||st||lt)&&(c.push({id:j,type:"position",position:{x:b.position.x-et+st,y:b.position.y-nt+lt}}),(ot=o.get(j))==null||ot.forEach(ct=>{s.some(ut=>ut.id===ct.id)||c.push({id:ct.id,type:"position",position:{x:ct.position.x+et,y:ct.position.y+nt}})})),(_.width<g.width||_.height<g.height||et||nt)&&c.push({id:j,type:"dimensions",setAttributes:!0,dimensions:{width:rt+(et?_e[0]*et-st:0),height:it+(nt?_e[1]*nt-lt:0)}})}),c}function updateNodeInternals(s,e,o,a,c,d,h){const g=a==null?void 0:a.querySelector(".xyflow__viewport");let b=!1;if(!g)return{changes:[],updatedInternals:b};const j=[],$=window.getComputedStyle(g),{m22:_}=new window.DOMMatrixReadOnly($.transform),_e=[];for(const et of s.values()){const nt=e.get(et.id);if(!nt)continue;if(nt.hidden){e.set(nt.id,{...nt,internals:{...nt.internals,handleBounds:void 0}}),b=!0;continue}const rt=getDimensions(et.nodeElement),it=nt.measured.width!==rt.width||nt.measured.height!==rt.height;if(!!(rt.width&&rt.height&&(it||!nt.internals.handleBounds||et.force))){const lt=et.nodeElement.getBoundingClientRect(),ot=isCoordinateExtent(nt.extent)?nt.extent:d;let{positionAbsolute:ct}=nt.internals;nt.parentId&&nt.extent==="parent"?ct=clampPositionToParent(ct,rt,e.get(nt.parentId)):ot&&(ct=clampPosition(ct,ot,rt));const ut={...nt,measured:rt,internals:{...nt.internals,positionAbsolute:ct,handleBounds:{source:getHandleBounds("source",et.nodeElement,lt,_,nt.id),target:getHandleBounds("target",et.nodeElement,lt,_,nt.id)}}};e.set(nt.id,ut),nt.parentId&&updateChildNode(ut,e,o,{nodeOrigin:c,zIndexMode:h}),b=!0,it&&(j.push({id:nt.id,type:"dimensions",dimensions:rt}),nt.expandParent&&nt.parentId&&_e.push({id:nt.id,parentId:nt.parentId,rect:nodeToRect(ut,c)}))}}if(_e.length>0){const et=handleExpandParent(_e,e,o,c);j.push(...et)}return{changes:j,updatedInternals:b}}async function panBy({delta:s,panZoom:e,transform:o,translateExtent:a,width:c,height:d}){if(!e||!s.x&&!s.y)return Promise.resolve(!1);const h=await e.setViewportConstrained({x:o[0]+s.x,y:o[1]+s.y,zoom:o[2]},[[0,0],[c,d]],a),g=!!h&&(h.x!==o[0]||h.y!==o[1]||h.k!==o[2]);return Promise.resolve(g)}function addConnectionToLookup(s,e,o,a,c,d){let h=c;const g=a.get(h)||new Map;a.set(h,g.set(o,e)),h=`${c}-${s}`;const b=a.get(h)||new Map;if(a.set(h,b.set(o,e)),d){h=`${c}-${s}-${d}`;const j=a.get(h)||new Map;a.set(h,j.set(o,e))}}function updateConnectionLookup(s,e,o){s.clear(),e.clear();for(const a of o){const{source:c,target:d,sourceHandle:h=null,targetHandle:g=null}=a,b={edgeId:a.id,source:c,target:d,sourceHandle:h,targetHandle:g},j=`${c}-${h}--${d}-${g}`,$=`${d}-${g}--${c}-${h}`;addConnectionToLookup("source",b,$,s,c,h),addConnectionToLookup("target",b,j,s,d,g),e.set(a.id,a)}}function isParentSelected(s,e){if(!s.parentId)return!1;const o=e.get(s.parentId);return o?o.selected?!0:isParentSelected(o,e):!1}function hasSelector(s,e,o){var c;let a=s;do{if((c=a==null?void 0:a.matches)!=null&&c.call(a,e))return!0;if(a===o)return!1;a=a==null?void 0:a.parentElement}while(a);return!1}function getDragItems(s,e,o,a){const c=new Map;for(const[d,h]of s)if((h.selected||h.id===a)&&(!h.parentId||!isParentSelected(h,s))&&(h.draggable||e&&typeof h.draggable>"u")){const g=s.get(d);g&&c.set(d,{id:d,position:g.position||{x:0,y:0},distance:{x:o.x-g.internals.positionAbsolute.x,y:o.y-g.internals.positionAbsolute.y},extent:g.extent,parentId:g.parentId,origin:g.origin,expandParent:g.expandParent,internals:{positionAbsolute:g.internals.positionAbsolute||{x:0,y:0}},measured:{width:g.measured.width??0,height:g.measured.height??0}})}return c}function getEventHandlerParams({nodeId:s,dragItems:e,nodeLookup:o,dragging:a=!0}){var h,g,b;const c=[];for(const[j,$]of e){const _=(h=o.get(j))==null?void 0:h.internals.userNode;_&&c.push({..._,position:$.position,dragging:a})}if(!s)return[c[0],c];const d=(g=o.get(s))==null?void 0:g.internals.userNode;return[d?{...d,position:((b=e.get(s))==null?void 0:b.position)||d.position,dragging:a}:c[0],c]}function calculateSnapOffset({dragItems:s,snapGrid:e,x:o,y:a}){const c=s.values().next().value;if(!c)return null;const d={x:o-c.distance.x,y:a-c.distance.y},h=snapPosition(d,e);return{x:h.x-d.x,y:h.y-d.y}}function XYDrag({onNodeMouseDown:s,getStoreItems:e,onDragStart:o,onDrag:a,onDragStop:c}){let d={x:null,y:null},h=0,g=new Map,b=!1,j={x:0,y:0},$=null,_=!1,_e=null,et=!1,nt=!1,rt=null;function it({noDragClassName:lt,handleSelector:ot,domNode:ct,isSelectable:ut,nodeId:at,nodeClickDistance:dt=0}){_e=select(ct);function ft({x:Et,y:Tt}){const{nodeLookup:ht,nodeExtent:wt,snapGrid:St,snapToGrid:bt,nodeOrigin:mt,onNodeDrag:gt,onSelectionDrag:pt,onError:kt,updateNodePositions:Rt}=e();d={x:Et,y:Tt};let At=!1;const Mt=g.size>1,Dt=Mt&&wt?rectToBox(getInternalNodesBounds(g)):null,$t=Mt&&bt?calculateSnapOffset({dragItems:g,snapGrid:St,x:Et,y:Tt}):null;for(const[_t,Pt]of g){if(!ht.has(_t))continue;let Ht={x:Et-Pt.distance.x,y:Tt-Pt.distance.y};bt&&(Ht=$t?{x:Math.round(Ht.x+$t.x),y:Math.round(Ht.y+$t.y)}:snapPosition(Ht,St));let Kt=null;if(Mt&&wt&&!Pt.extent&&Dt){const{positionAbsolute:Ot}=Pt.internals,Wt=Ot.x-Dt.x+wt[0][0],Ft=Ot.x+Pt.measured.width-Dt.x2+wt[1][0],qt=Ot.y-Dt.y+wt[0][1],en=Ot.y+Pt.measured.height-Dt.y2+wt[1][1];Kt=[[Wt,qt],[Ft,en]]}const{position:Ut,positionAbsolute:Nt}=calculateNodePosition({nodeId:_t,nextPosition:Ht,nodeLookup:ht,nodeExtent:Kt||wt,nodeOrigin:mt,onError:kt});At=At||Pt.position.x!==Ut.x||Pt.position.y!==Ut.y,Pt.position=Ut,Pt.internals.positionAbsolute=Nt}if(nt=nt||At,!!At&&(Rt(g,!0),rt&&(a||gt||!at&&pt))){const[_t,Pt]=getEventHandlerParams({nodeId:at,dragItems:g,nodeLookup:ht});a==null||a(rt,g,_t,Pt),gt==null||gt(rt,_t,Pt),at||pt==null||pt(rt,Pt)}}async function xt(){if(!$)return;const{transform:Et,panBy:Tt,autoPanSpeed:ht,autoPanOnNodeDrag:wt}=e();if(!wt){b=!1,cancelAnimationFrame(h);return}const[St,bt]=calcAutoPan(j,$,ht);(St!==0||bt!==0)&&(d.x=(d.x??0)-St/Et[2],d.y=(d.y??0)-bt/Et[2],await Tt({x:St,y:bt})&&ft(d)),h=requestAnimationFrame(xt)}function Ct(Et){var Mt;const{nodeLookup:Tt,multiSelectionActive:ht,nodesDraggable:wt,transform:St,snapGrid:bt,snapToGrid:mt,selectNodesOnDrag:gt,onNodeDragStart:pt,onSelectionDragStart:kt,unselectNodesAndEdges:Rt}=e();_=!0,(!gt||!ut)&&!ht&&at&&((Mt=Tt.get(at))!=null&&Mt.selected||Rt()),ut&&gt&&at&&(s==null||s(at));const At=getPointerPosition(Et.sourceEvent,{transform:St,snapGrid:bt,snapToGrid:mt,containerBounds:$});if(d=At,g=getDragItems(Tt,wt,At,at),g.size>0&&(o||pt||!at&&kt)){const[Dt,$t]=getEventHandlerParams({nodeId:at,dragItems:g,nodeLookup:Tt});o==null||o(Et.sourceEvent,g,Dt,$t),pt==null||pt(Et.sourceEvent,Dt,$t),at||kt==null||kt(Et.sourceEvent,$t)}}const yt=drag().clickDistance(dt).on("start",Et=>{const{domNode:Tt,nodeDragThreshold:ht,transform:wt,snapGrid:St,snapToGrid:bt}=e();$=(Tt==null?void 0:Tt.getBoundingClientRect())||null,et=!1,nt=!1,rt=Et.sourceEvent,ht===0&&Ct(Et),d=getPointerPosition(Et.sourceEvent,{transform:wt,snapGrid:St,snapToGrid:bt,containerBounds:$}),j=getEventPosition(Et.sourceEvent,$)}).on("drag",Et=>{const{autoPanOnNodeDrag:Tt,transform:ht,snapGrid:wt,snapToGrid:St,nodeDragThreshold:bt,nodeLookup:mt}=e(),gt=getPointerPosition(Et.sourceEvent,{transform:ht,snapGrid:wt,snapToGrid:St,containerBounds:$});if(rt=Et.sourceEvent,(Et.sourceEvent.type==="touchmove"&&Et.sourceEvent.touches.length>1||at&&!mt.has(at))&&(et=!0),!et){if(!b&&Tt&&_&&(b=!0,xt()),!_){const pt=getEventPosition(Et.sourceEvent,$),kt=pt.x-j.x,Rt=pt.y-j.y;Math.sqrt(kt*kt+Rt*Rt)>bt&&Ct(Et)}(d.x!==gt.xSnapped||d.y!==gt.ySnapped)&&g&&_&&(j=getEventPosition(Et.sourceEvent,$),ft(gt))}}).on("end",Et=>{if(!(!_||et)&&(b=!1,_=!1,cancelAnimationFrame(h),g.size>0)){const{nodeLookup:Tt,updateNodePositions:ht,onNodeDragStop:wt,onSelectionDragStop:St}=e();if(nt&&(ht(g,!1),nt=!1),c||wt||!at&&St){const[bt,mt]=getEventHandlerParams({nodeId:at,dragItems:g,nodeLookup:Tt,dragging:!1});c==null||c(Et.sourceEvent,g,bt,mt),wt==null||wt(Et.sourceEvent,bt,mt),at||St==null||St(Et.sourceEvent,mt)}}}).filter(Et=>{const Tt=Et.target;return!Et.button&&(!lt||!hasSelector(Tt,`.${lt}`,ct))&&(!ot||hasSelector(Tt,ot,ct))});_e.call(yt)}function st(){_e==null||_e.on(".drag",null)}return{update:it,destroy:st}}function getNodesWithinDistance(s,e,o){const a=[],c={x:s.x-o,y:s.y-o,width:o*2,height:o*2};for(const d of e.values())getOverlappingArea(c,nodeToRect(d))>0&&a.push(d);return a}const ADDITIONAL_DISTANCE=250;function getClosestHandle(s,e,o,a){var g,b;let c=[],d=1/0;const h=getNodesWithinDistance(s,o,e+ADDITIONAL_DISTANCE);for(const j of h){const $=[...((g=j.internals.handleBounds)==null?void 0:g.source)??[],...((b=j.internals.handleBounds)==null?void 0:b.target)??[]];for(const _ of $){if(a.nodeId===_.nodeId&&a.type===_.type&&a.id===_.id)continue;const{x:_e,y:et}=getHandlePosition(j,_,_.position,!0),nt=Math.sqrt(Math.pow(_e-s.x,2)+Math.pow(et-s.y,2));nt>e||(nt<d?(c=[{..._,x:_e,y:et}],d=nt):nt===d&&c.push({..._,x:_e,y:et}))}}if(!c.length)return null;if(c.length>1){const j=a.type==="source"?"target":"source";return c.find($=>$.type===j)??c[0]}return c[0]}function getHandle(s,e,o,a,c,d=!1){var j,$,_;const h=a.get(s);if(!h)return null;const g=c==="strict"?(j=h.internals.handleBounds)==null?void 0:j[e]:[...(($=h.internals.handleBounds)==null?void 0:$.source)??[],...((_=h.internals.handleBounds)==null?void 0:_.target)??[]],b=(o?g==null?void 0:g.find(_e=>_e.id===o):g==null?void 0:g[0])??null;return b&&d?{...b,...getHandlePosition(h,b,b.position,!0)}:b}function getHandleType(s,e){return s||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function isConnectionValid(s,e){let o=null;return e?o=!0:s&&!e&&(o=!1),o}const alwaysValid=()=>!0;function onPointerDown(s,{connectionMode:e,connectionRadius:o,handleId:a,nodeId:c,edgeUpdaterType:d,isTarget:h,domNode:g,nodeLookup:b,lib:j,autoPanOnConnect:$,flowId:_,panBy:_e,cancelConnection:et,onConnectStart:nt,onConnect:rt,onConnectEnd:it,isValidConnection:st=alwaysValid,onReconnectEnd:lt,updateConnection:ot,getTransform:ct,getFromHandle:ut,autoPanSpeed:at,dragThreshold:dt=1,handleDomNode:ft}){const xt=getHostForElement(s.target);let Ct=0,yt;const{x:Et,y:Tt}=getEventPosition(s),ht=getHandleType(d,ft),wt=g==null?void 0:g.getBoundingClientRect();let St=!1;if(!wt||!ht)return;const bt=getHandle(c,ht,a,b,e);if(!bt)return;let mt=getEventPosition(s,wt),gt=!1,pt=null,kt=!1,Rt=null;function At(){if(!$||!wt)return;const[Ut,Nt]=calcAutoPan(mt,wt,at);_e({x:Ut,y:Nt}),Ct=requestAnimationFrame(At)}const Mt={...bt,nodeId:c,type:ht,position:bt.position},Dt=b.get(c);let _t={inProgress:!0,isValid:null,from:getHandlePosition(Dt,Mt,Position.Left,!0),fromHandle:Mt,fromPosition:Mt.position,fromNode:Dt,to:mt,toHandle:null,toPosition:oppositePosition[Mt.position],toNode:null,pointer:mt};function Pt(){St=!0,ot(_t),nt==null||nt(s,{nodeId:c,handleId:a,handleType:ht})}dt===0&&Pt();function Ht(Ut){if(!St){const{x:en,y:on}=getEventPosition(Ut),cn=en-Et,dn=on-Tt;if(!(cn*cn+dn*dn>dt*dt))return;Pt()}if(!ut()||!Mt){Kt(Ut);return}const Nt=ct();mt=getEventPosition(Ut,wt),yt=getClosestHandle(pointToRendererPoint(mt,Nt,!1,[1,1]),o,b,Mt),gt||(At(),gt=!0);const Ot=isValidHandle(Ut,{handle:yt,connectionMode:e,fromNodeId:c,fromHandleId:a,fromType:h?"target":"source",isValidConnection:st,doc:xt,lib:j,flowId:_,nodeLookup:b});Rt=Ot.handleDomNode,pt=Ot.connection,kt=isConnectionValid(!!yt,Ot.isValid);const Wt=b.get(c),Ft=Wt?getHandlePosition(Wt,Mt,Position.Left,!0):_t.from,qt={..._t,from:Ft,isValid:kt,to:Ot.toHandle&&kt?rendererPointToPoint({x:Ot.toHandle.x,y:Ot.toHandle.y},Nt):mt,toHandle:Ot.toHandle,toPosition:kt&&Ot.toHandle?Ot.toHandle.position:oppositePosition[Mt.position],toNode:Ot.toHandle?b.get(Ot.toHandle.nodeId):null,pointer:mt};ot(qt),_t=qt}function Kt(Ut){if(!("touches"in Ut&&Ut.touches.length>0)){if(St){(yt||Rt)&&pt&&kt&&(rt==null||rt(pt));const{inProgress:Nt,...Ot}=_t,Wt={...Ot,toPosition:_t.toHandle?_t.toPosition:null};it==null||it(Ut,Wt),d&&(lt==null||lt(Ut,Wt))}et(),cancelAnimationFrame(Ct),gt=!1,kt=!1,pt=null,Rt=null,xt.removeEventListener("mousemove",Ht),xt.removeEventListener("mouseup",Kt),xt.removeEventListener("touchmove",Ht),xt.removeEventListener("touchend",Kt)}}xt.addEventListener("mousemove",Ht),xt.addEventListener("mouseup",Kt),xt.addEventListener("touchmove",Ht),xt.addEventListener("touchend",Kt)}function isValidHandle(s,{handle:e,connectionMode:o,fromNodeId:a,fromHandleId:c,fromType:d,doc:h,lib:g,flowId:b,isValidConnection:j=alwaysValid,nodeLookup:$}){const _=d==="target",_e=e?h.querySelector(`.${g}-flow__handle[data-id="${b}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:et,y:nt}=getEventPosition(s),rt=h.elementFromPoint(et,nt),it=rt!=null&&rt.classList.contains(`${g}-flow__handle`)?rt:_e,st={handleDomNode:it,isValid:!1,connection:null,toHandle:null};if(it){const lt=getHandleType(void 0,it),ot=it.getAttribute("data-nodeid"),ct=it.getAttribute("data-handleid"),ut=it.classList.contains("connectable"),at=it.classList.contains("connectableend");if(!ot||!lt)return st;const dt={source:_?ot:a,sourceHandle:_?ct:c,target:_?a:ot,targetHandle:_?c:ct};st.connection=dt;const xt=ut&&at&&(o===ConnectionMode.Strict?_&&lt==="source"||!_&&lt==="target":ot!==a||ct!==c);st.isValid=xt&&j(dt),st.toHandle=getHandle(ot,lt,ct,$,o,!0)}return st}const XYHandle={onPointerDown,isValid:isValidHandle};function XYMinimap({domNode:s,panZoom:e,getTransform:o,getViewScale:a}){const c=select(s);function d({translateExtent:g,width:b,height:j,zoomStep:$=1,pannable:_=!0,zoomable:_e=!0,inversePan:et=!1}){const nt=ot=>{if(ot.sourceEvent.type!=="wheel"||!e)return;const ct=o(),ut=ot.sourceEvent.ctrlKey&&isMacOs()?10:1,at=-ot.sourceEvent.deltaY*(ot.sourceEvent.deltaMode===1?.05:ot.sourceEvent.deltaMode?1:.002)*$,dt=ct[2]*Math.pow(2,at*ut);e.scaleTo(dt)};let rt=[0,0];const it=ot=>{(ot.sourceEvent.type==="mousedown"||ot.sourceEvent.type==="touchstart")&&(rt=[ot.sourceEvent.clientX??ot.sourceEvent.touches[0].clientX,ot.sourceEvent.clientY??ot.sourceEvent.touches[0].clientY])},st=ot=>{const ct=o();if(ot.sourceEvent.type!=="mousemove"&&ot.sourceEvent.type!=="touchmove"||!e)return;const ut=[ot.sourceEvent.clientX??ot.sourceEvent.touches[0].clientX,ot.sourceEvent.clientY??ot.sourceEvent.touches[0].clientY],at=[ut[0]-rt[0],ut[1]-rt[1]];rt=ut;const dt=a()*Math.max(ct[2],Math.log(ct[2]))*(et?-1:1),ft={x:ct[0]-at[0]*dt,y:ct[1]-at[1]*dt},xt=[[0,0],[b,j]];e.setViewportConstrained({x:ft.x,y:ft.y,zoom:ct[2]},xt,g)},lt=zoom().on("start",it).on("zoom",_?st:null).on("zoom.wheel",_e?nt:null);c.call(lt,{})}function h(){c.on("zoom",null)}return{update:d,destroy:h,pointer}}const transformToViewport=s=>({x:s.x,y:s.y,zoom:s.k}),viewportToTransform=({x:s,y:e,zoom:o})=>identity$1.translate(s,e).scale(o),isWrappedWithClass=(s,e)=>s.target.closest(`.${e}`),isRightClickPan=(s,e)=>e===2&&Array.isArray(s)&&s.includes(2),defaultEase=s=>((s*=2)<=1?s*s*s:(s-=2)*s*s+2)/2,getD3Transition=(s,e=0,o=defaultEase,a=()=>{})=>{const c=typeof e=="number"&&e>0;return c||a(),c?s.transition().duration(e).ease(o).on("end",a):s},wheelDelta=s=>{const e=s.ctrlKey&&isMacOs()?10:1;return-s.deltaY*(s.deltaMode===1?.05:s.deltaMode?1:.002)*e};function createPanOnScrollHandler({zoomPanValues:s,noWheelClassName:e,d3Selection:o,d3Zoom:a,panOnScrollMode:c,panOnScrollSpeed:d,zoomOnPinch:h,onPanZoomStart:g,onPanZoom:b,onPanZoomEnd:j}){return $=>{if(isWrappedWithClass($,e))return $.ctrlKey&&$.preventDefault(),!1;$.preventDefault(),$.stopImmediatePropagation();const _=o.property("__zoom").k||1;if($.ctrlKey&&h){const it=pointer($),st=wheelDelta($),lt=_*Math.pow(2,st);a.scaleTo(o,lt,it,$);return}const _e=$.deltaMode===1?20:1;let et=c===PanOnScrollMode.Vertical?0:$.deltaX*_e,nt=c===PanOnScrollMode.Horizontal?0:$.deltaY*_e;!isMacOs()&&$.shiftKey&&c!==PanOnScrollMode.Vertical&&(et=$.deltaY*_e,nt=0),a.translateBy(o,-(et/_)*d,-(nt/_)*d,{internal:!0});const rt=transformToViewport(o.property("__zoom"));clearTimeout(s.panScrollTimeout),s.isPanScrolling?(b==null||b($,rt),s.panScrollTimeout=setTimeout(()=>{j==null||j($,rt),s.isPanScrolling=!1},150)):(s.isPanScrolling=!0,g==null||g($,rt))}}function createZoomOnScrollHandler({noWheelClassName:s,preventScrolling:e,d3ZoomHandler:o}){return function(a,c){const d=a.type==="wheel",h=!e&&d&&!a.ctrlKey,g=isWrappedWithClass(a,s);if(a.ctrlKey&&d&&g&&a.preventDefault(),h||g)return null;a.preventDefault(),o.call(this,a,c)}}function createPanZoomStartHandler({zoomPanValues:s,onDraggingChange:e,onPanZoomStart:o}){return a=>{var d,h,g;if((d=a.sourceEvent)!=null&&d.internal)return;const c=transformToViewport(a.transform);s.mouseButton=((h=a.sourceEvent)==null?void 0:h.button)||0,s.isZoomingOrPanning=!0,s.prevViewport=c,((g=a.sourceEvent)==null?void 0:g.type)==="mousedown"&&e(!0),o&&(o==null||o(a.sourceEvent,c))}}function createPanZoomHandler({zoomPanValues:s,panOnDrag:e,onPaneContextMenu:o,onTransformChange:a,onPanZoom:c}){return d=>{var h,g;s.usedRightMouseButton=!!(o&&isRightClickPan(e,s.mouseButton??0)),(h=d.sourceEvent)!=null&&h.sync||a([d.transform.x,d.transform.y,d.transform.k]),c&&!((g=d.sourceEvent)!=null&&g.internal)&&(c==null||c(d.sourceEvent,transformToViewport(d.transform)))}}function createPanZoomEndHandler({zoomPanValues:s,panOnDrag:e,panOnScroll:o,onDraggingChange:a,onPanZoomEnd:c,onPaneContextMenu:d}){return h=>{var g;if(!((g=h.sourceEvent)!=null&&g.internal)&&(s.isZoomingOrPanning=!1,d&&isRightClickPan(e,s.mouseButton??0)&&!s.usedRightMouseButton&&h.sourceEvent&&d(h.sourceEvent),s.usedRightMouseButton=!1,a(!1),c)){const b=transformToViewport(h.transform);s.prevViewport=b,clearTimeout(s.timerId),s.timerId=setTimeout(()=>{c==null||c(h.sourceEvent,b)},o?150:0)}}}function createFilter({zoomActivationKeyPressed:s,zoomOnScroll:e,zoomOnPinch:o,panOnDrag:a,panOnScroll:c,zoomOnDoubleClick:d,userSelectionActive:h,noWheelClassName:g,noPanClassName:b,lib:j,connectionInProgress:$}){return _=>{var it;const _e=s||e,et=o&&_.ctrlKey,nt=_.type==="wheel";if(_.button===1&&_.type==="mousedown"&&(isWrappedWithClass(_,`${j}-flow__node`)||isWrappedWithClass(_,`${j}-flow__edge`)))return!0;if(!a&&!_e&&!c&&!d&&!o||h||$&&!nt||isWrappedWithClass(_,g)&&nt||isWrappedWithClass(_,b)&&(!nt||c&&nt&&!s)||!o&&_.ctrlKey&&nt)return!1;if(!o&&_.type==="touchstart"&&((it=_.touches)==null?void 0:it.length)>1)return _.preventDefault(),!1;if(!_e&&!c&&!et&&nt||!a&&(_.type==="mousedown"||_.type==="touchstart")||Array.isArray(a)&&!a.includes(_.button)&&_.type==="mousedown")return!1;const rt=Array.isArray(a)&&a.includes(_.button)||!_.button||_.button<=1;return(!_.ctrlKey||nt)&&rt}}function XYPanZoom({domNode:s,minZoom:e,maxZoom:o,translateExtent:a,viewport:c,onPanZoom:d,onPanZoomStart:h,onPanZoomEnd:g,onDraggingChange:b}){const j={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},$=s.getBoundingClientRect(),_=zoom().scaleExtent([e,o]).translateExtent(a),_e=select(s).call(_);lt({x:c.x,y:c.y,zoom:clamp(c.zoom,e,o)},[[0,0],[$.width,$.height]],a);const et=_e.on("wheel.zoom"),nt=_e.on("dblclick.zoom");_.wheelDelta(wheelDelta);function rt(yt,Et){return _e?new Promise(Tt=>{_==null||_.interpolate((Et==null?void 0:Et.interpolate)==="linear"?interpolate$1:interpolateZoom).transform(getD3Transition(_e,Et==null?void 0:Et.duration,Et==null?void 0:Et.ease,()=>Tt(!0)),yt)}):Promise.resolve(!1)}function it({noWheelClassName:yt,noPanClassName:Et,onPaneContextMenu:Tt,userSelectionActive:ht,panOnScroll:wt,panOnDrag:St,panOnScrollMode:bt,panOnScrollSpeed:mt,preventScrolling:gt,zoomOnPinch:pt,zoomOnScroll:kt,zoomOnDoubleClick:Rt,zoomActivationKeyPressed:At,lib:Mt,onTransformChange:Dt,connectionInProgress:$t,paneClickDistance:_t,selectionOnDrag:Pt}){ht&&!j.isZoomingOrPanning&&st();const Ht=wt&&!At&&!ht;_.clickDistance(Pt?1/0:!isNumeric(_t)||_t<0?0:_t);const Kt=Ht?createPanOnScrollHandler({zoomPanValues:j,noWheelClassName:yt,d3Selection:_e,d3Zoom:_,panOnScrollMode:bt,panOnScrollSpeed:mt,zoomOnPinch:pt,onPanZoomStart:h,onPanZoom:d,onPanZoomEnd:g}):createZoomOnScrollHandler({noWheelClassName:yt,preventScrolling:gt,d3ZoomHandler:et});if(_e.on("wheel.zoom",Kt,{passive:!1}),!ht){const Nt=createPanZoomStartHandler({zoomPanValues:j,onDraggingChange:b,onPanZoomStart:h});_.on("start",Nt);const Ot=createPanZoomHandler({zoomPanValues:j,panOnDrag:St,onPaneContextMenu:!!Tt,onPanZoom:d,onTransformChange:Dt});_.on("zoom",Ot);const Wt=createPanZoomEndHandler({zoomPanValues:j,panOnDrag:St,panOnScroll:wt,onPaneContextMenu:Tt,onPanZoomEnd:g,onDraggingChange:b});_.on("end",Wt)}const Ut=createFilter({zoomActivationKeyPressed:At,panOnDrag:St,zoomOnScroll:kt,panOnScroll:wt,zoomOnDoubleClick:Rt,zoomOnPinch:pt,userSelectionActive:ht,noPanClassName:Et,noWheelClassName:yt,lib:Mt,connectionInProgress:$t});_.filter(Ut),Rt?_e.on("dblclick.zoom",nt):_e.on("dblclick.zoom",null)}function st(){_.on("zoom",null)}async function lt(yt,Et,Tt){const ht=viewportToTransform(yt),wt=_==null?void 0:_.constrain()(ht,Et,Tt);return wt&&await rt(wt),new Promise(St=>St(wt))}async function ot(yt,Et){const Tt=viewportToTransform(yt);return await rt(Tt,Et),new Promise(ht=>ht(Tt))}function ct(yt){if(_e){const Et=viewportToTransform(yt),Tt=_e.property("__zoom");(Tt.k!==yt.zoom||Tt.x!==yt.x||Tt.y!==yt.y)&&(_==null||_.transform(_e,Et,null,{sync:!0}))}}function ut(){const yt=_e?transform(_e.node()):{x:0,y:0,k:1};return{x:yt.x,y:yt.y,zoom:yt.k}}function at(yt,Et){return _e?new Promise(Tt=>{_==null||_.interpolate((Et==null?void 0:Et.interpolate)==="linear"?interpolate$1:interpolateZoom).scaleTo(getD3Transition(_e,Et==null?void 0:Et.duration,Et==null?void 0:Et.ease,()=>Tt(!0)),yt)}):Promise.resolve(!1)}function dt(yt,Et){return _e?new Promise(Tt=>{_==null||_.interpolate((Et==null?void 0:Et.interpolate)==="linear"?interpolate$1:interpolateZoom).scaleBy(getD3Transition(_e,Et==null?void 0:Et.duration,Et==null?void 0:Et.ease,()=>Tt(!0)),yt)}):Promise.resolve(!1)}function ft(yt){_==null||_.scaleExtent(yt)}function xt(yt){_==null||_.translateExtent(yt)}function Ct(yt){const Et=!isNumeric(yt)||yt<0?0:yt;_==null||_.clickDistance(Et)}return{update:it,destroy:st,setViewport:ot,setViewportConstrained:lt,getViewport:ut,scaleTo:at,scaleBy:dt,setScaleExtent:ft,setTranslateExtent:xt,syncViewport:ct,setClickDistance:Ct}}var ResizeControlVariant;(function(s){s.Line="line",s.Handle="handle"})(ResizeControlVariant||(ResizeControlVariant={}));function getResizeDirection({width:s,prevWidth:e,height:o,prevHeight:a,affectsX:c,affectsY:d}){const h=s-e,g=o-a,b=[h>0?1:h<0?-1:0,g>0?1:g<0?-1:0];return h&&c&&(b[0]=b[0]*-1),g&&d&&(b[1]=b[1]*-1),b}function getControlDirection(s){const e=s.includes("right")||s.includes("left"),o=s.includes("bottom")||s.includes("top"),a=s.includes("left"),c=s.includes("top");return{isHorizontal:e,isVertical:o,affectsX:a,affectsY:c}}function getLowerExtentClamp(s,e){return Math.max(0,e-s)}function getUpperExtentClamp(s,e){return Math.max(0,s-e)}function getSizeClamp(s,e,o){return Math.max(0,e-s,s-o)}function xor(s,e){return s?!e:e}function getDimensionsAfterResize(s,e,o,a,c,d,h,g){let{affectsX:b,affectsY:j}=e;const{isHorizontal:$,isVertical:_}=e,_e=$&&_,{xSnapped:et,ySnapped:nt}=o,{minWidth:rt,maxWidth:it,minHeight:st,maxHeight:lt}=a,{x:ot,y:ct,width:ut,height:at,aspectRatio:dt}=s;let ft=Math.floor($?et-s.pointerX:0),xt=Math.floor(_?nt-s.pointerY:0);const Ct=ut+(b?-ft:ft),yt=at+(j?-xt:xt),Et=-d[0]*ut,Tt=-d[1]*at;let ht=getSizeClamp(Ct,rt,it),wt=getSizeClamp(yt,st,lt);if(h){let mt=0,gt=0;b&&ft<0?mt=getLowerExtentClamp(ot+ft+Et,h[0][0]):!b&&ft>0&&(mt=getUpperExtentClamp(ot+Ct+Et,h[1][0])),j&&xt<0?gt=getLowerExtentClamp(ct+xt+Tt,h[0][1]):!j&&xt>0&&(gt=getUpperExtentClamp(ct+yt+Tt,h[1][1])),ht=Math.max(ht,mt),wt=Math.max(wt,gt)}if(g){let mt=0,gt=0;b&&ft>0?mt=getUpperExtentClamp(ot+ft,g[0][0]):!b&&ft<0&&(mt=getLowerExtentClamp(ot+Ct,g[1][0])),j&&xt>0?gt=getUpperExtentClamp(ct+xt,g[0][1]):!j&&xt<0&&(gt=getLowerExtentClamp(ct+yt,g[1][1])),ht=Math.max(ht,mt),wt=Math.max(wt,gt)}if(c){if($){const mt=getSizeClamp(Ct/dt,st,lt)*dt;if(ht=Math.max(ht,mt),h){let gt=0;!b&&!j||b&&!j&&_e?gt=getUpperExtentClamp(ct+Tt+Ct/dt,h[1][1])*dt:gt=getLowerExtentClamp(ct+Tt+(b?ft:-ft)/dt,h[0][1])*dt,ht=Math.max(ht,gt)}if(g){let gt=0;!b&&!j||b&&!j&&_e?gt=getLowerExtentClamp(ct+Ct/dt,g[1][1])*dt:gt=getUpperExtentClamp(ct+(b?ft:-ft)/dt,g[0][1])*dt,ht=Math.max(ht,gt)}}if(_){const mt=getSizeClamp(yt*dt,rt,it)/dt;if(wt=Math.max(wt,mt),h){let gt=0;!b&&!j||j&&!b&&_e?gt=getUpperExtentClamp(ot+yt*dt+Et,h[1][0])/dt:gt=getLowerExtentClamp(ot+(j?xt:-xt)*dt+Et,h[0][0])/dt,wt=Math.max(wt,gt)}if(g){let gt=0;!b&&!j||j&&!b&&_e?gt=getLowerExtentClamp(ot+yt*dt,g[1][0])/dt:gt=getUpperExtentClamp(ot+(j?xt:-xt)*dt,g[0][0])/dt,wt=Math.max(wt,gt)}}}xt=xt+(xt<0?wt:-wt),ft=ft+(ft<0?ht:-ht),c&&(_e?Ct>yt*dt?xt=(xor(b,j)?-ft:ft)/dt:ft=(xor(b,j)?-xt:xt)*dt:$?(xt=ft/dt,j=b):(ft=xt*dt,b=j));const St=b?ot+ft:ot,bt=j?ct+xt:ct;return{width:ut+(b?-ft:ft),height:at+(j?-xt:xt),x:d[0]*ft*(b?-1:1)+St,y:d[1]*xt*(j?-1:1)+bt}}const initPrevValues$1={width:0,height:0,x:0,y:0},initStartValues={...initPrevValues$1,pointerX:0,pointerY:0,aspectRatio:1};function nodeToParentExtent(s){return[[0,0],[s.measured.width,s.measured.height]]}function nodeToChildExtent(s,e,o){const a=e.position.x+s.position.x,c=e.position.y+s.position.y,d=s.measured.width??0,h=s.measured.height??0,g=o[0]*d,b=o[1]*h;return[[a-g,c-b],[a+d-g,c+h-b]]}function XYResizer({domNode:s,nodeId:e,getStoreItems:o,onChange:a,onEnd:c}){const d=select(s);let h={controlDirection:getControlDirection("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function g({controlPosition:j,boundaries:$,keepAspectRatio:_,resizeDirection:_e,onResizeStart:et,onResize:nt,onResizeEnd:rt,shouldResize:it}){let st={...initPrevValues$1},lt={...initStartValues};h={boundaries:$,resizeDirection:_e,keepAspectRatio:_,controlDirection:getControlDirection(j)};let ot,ct=null,ut=[],at,dt,ft,xt=!1;const Ct=drag().on("start",yt=>{const{nodeLookup:Et,transform:Tt,snapGrid:ht,snapToGrid:wt,nodeOrigin:St,paneDomNode:bt}=o();if(ot=Et.get(e),!ot)return;ct=(bt==null?void 0:bt.getBoundingClientRect())??null;const{xSnapped:mt,ySnapped:gt}=getPointerPosition(yt.sourceEvent,{transform:Tt,snapGrid:ht,snapToGrid:wt,containerBounds:ct});st={width:ot.measured.width??0,height:ot.measured.height??0,x:ot.position.x??0,y:ot.position.y??0},lt={...st,pointerX:mt,pointerY:gt,aspectRatio:st.width/st.height},at=void 0,ot.parentId&&(ot.extent==="parent"||ot.expandParent)&&(at=Et.get(ot.parentId),dt=at&&ot.extent==="parent"?nodeToParentExtent(at):void 0),ut=[],ft=void 0;for(const[pt,kt]of Et)if(kt.parentId===e&&(ut.push({id:pt,position:{...kt.position},extent:kt.extent}),kt.extent==="parent"||kt.expandParent)){const Rt=nodeToChildExtent(kt,ot,kt.origin??St);ft?ft=[[Math.min(Rt[0][0],ft[0][0]),Math.min(Rt[0][1],ft[0][1])],[Math.max(Rt[1][0],ft[1][0]),Math.max(Rt[1][1],ft[1][1])]]:ft=Rt}et==null||et(yt,{...st})}).on("drag",yt=>{const{transform:Et,snapGrid:Tt,snapToGrid:ht,nodeOrigin:wt}=o(),St=getPointerPosition(yt.sourceEvent,{transform:Et,snapGrid:Tt,snapToGrid:ht,containerBounds:ct}),bt=[];if(!ot)return;const{x:mt,y:gt,width:pt,height:kt}=st,Rt={},At=ot.origin??wt,{width:Mt,height:Dt,x:$t,y:_t}=getDimensionsAfterResize(lt,h.controlDirection,St,h.boundaries,h.keepAspectRatio,At,dt,ft),Pt=Mt!==pt,Ht=Dt!==kt,Kt=$t!==mt&&Pt,Ut=_t!==gt&&Ht;if(!Kt&&!Ut&&!Pt&&!Ht)return;if((Kt||Ut||At[0]===1||At[1]===1)&&(Rt.x=Kt?$t:st.x,Rt.y=Ut?_t:st.y,st.x=Rt.x,st.y=Rt.y,ut.length>0)){const Ft=$t-mt,qt=_t-gt;for(const en of ut)en.position={x:en.position.x-Ft+At[0]*(Mt-pt),y:en.position.y-qt+At[1]*(Dt-kt)},bt.push(en)}if((Pt||Ht)&&(Rt.width=Pt&&(!h.resizeDirection||h.resizeDirection==="horizontal")?Mt:st.width,Rt.height=Ht&&(!h.resizeDirection||h.resizeDirection==="vertical")?Dt:st.height,st.width=Rt.width,st.height=Rt.height),at&&ot.expandParent){const Ft=At[0]*(Rt.width??0);Rt.x&&Rt.x<Ft&&(st.x=Ft,lt.x=lt.x-(Rt.x-Ft));const qt=At[1]*(Rt.height??0);Rt.y&&Rt.y<qt&&(st.y=qt,lt.y=lt.y-(Rt.y-qt))}const Nt=getResizeDirection({width:st.width,prevWidth:pt,height:st.height,prevHeight:kt,affectsX:h.controlDirection.affectsX,affectsY:h.controlDirection.affectsY}),Ot={...st,direction:Nt};(it==null?void 0:it(yt,Ot))!==!1&&(xt=!0,nt==null||nt(yt,Ot),a(Rt,bt))}).on("end",yt=>{xt&&(rt==null||rt(yt,{...st}),c==null||c({...st}),xt=!1)});d.call(Ct)}function b(){d.on(".drag",null)}return{update:g,destroy:b}}const{useDebugValue}=React$2,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports,identity=s=>s;function useStoreWithEqualityFn(s,e=identity,o){const a=useSyncExternalStoreWithSelector(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,o);return useDebugValue(a),a}const createWithEqualityFnImpl=(s,e)=>{const o=createStore$1(s),a=(c,d=e)=>useStoreWithEqualityFn(o,c,d);return Object.assign(a,o),a},createWithEqualityFn=(s,e)=>s?createWithEqualityFnImpl(s,e):createWithEqualityFnImpl;function shallow$1(s,e){if(Object.is(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;if(s instanceof Map&&e instanceof Map){if(s.size!==e.size)return!1;for(const[a,c]of s)if(!Object.is(c,e.get(a)))return!1;return!0}if(s instanceof Set&&e instanceof Set){if(s.size!==e.size)return!1;for(const a of s)if(!e.has(a))return!1;return!0}const o=Object.keys(s);if(o.length!==Object.keys(e).length)return!1;for(const a of o)if(!Object.prototype.hasOwnProperty.call(e,a)||!Object.is(s[a],e[a]))return!1;return!0}const StoreContext=reactExports.createContext(null),Provider$1=StoreContext.Provider,zustandErrorMessage=errorMessages.error001();function useStore(s,e){const o=reactExports.useContext(StoreContext);if(o===null)throw new Error(zustandErrorMessage);return useStoreWithEqualityFn(o,s,e)}function useStoreApi(){const s=reactExports.useContext(StoreContext);if(s===null)throw new Error(zustandErrorMessage);return reactExports.useMemo(()=>({getState:s.getState,setState:s.setState,subscribe:s.subscribe}),[s])}const style={display:"none"},ariaLiveStyle={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},ARIA_NODE_DESC_KEY="react-flow__node-desc",ARIA_EDGE_DESC_KEY="react-flow__edge-desc",ARIA_LIVE_MESSAGE="react-flow__aria-live",ariaLiveSelector=s=>s.ariaLiveMessage,ariaLabelConfigSelector=s=>s.ariaLabelConfig;function AriaLiveMessage({rfId:s}){const e=useStore(ariaLiveSelector);return jsxRuntimeExports.jsx("div",{id:`${ARIA_LIVE_MESSAGE}-${s}`,"aria-live":"assertive","aria-atomic":"true",style:ariaLiveStyle,children:e})}function A11yDescriptions({rfId:s,disableKeyboardA11y:e}){const o=useStore(ariaLabelConfigSelector);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{id:`${ARIA_NODE_DESC_KEY}-${s}`,style,children:e?o["node.a11yDescription.default"]:o["node.a11yDescription.keyboardDisabled"]}),jsxRuntimeExports.jsx("div",{id:`${ARIA_EDGE_DESC_KEY}-${s}`,style,children:o["edge.a11yDescription.default"]}),!e&&jsxRuntimeExports.jsx(AriaLiveMessage,{rfId:s})]})}const Panel=reactExports.forwardRef(({position:s="top-left",children:e,className:o,style:a,...c},d)=>{const h=`${s}`.split("-");return jsxRuntimeExports.jsx("div",{className:cc(["react-flow__panel",o,...h]),style:a,ref:d,...c,children:e})});Panel.displayName="Panel";function Attribution({proOptions:s,position:e="bottom-right"}){return s!=null&&s.hideAttribution?null:jsxRuntimeExports.jsx(Panel,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:jsxRuntimeExports.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const selector$m=s=>{const e=[],o=[];for(const[,a]of s.nodeLookup)a.selected&&e.push(a.internals.userNode);for(const[,a]of s.edgeLookup)a.selected&&o.push(a);return{selectedNodes:e,selectedEdges:o}},selectId=s=>s.id;function areEqual(s,e){return shallow$1(s.selectedNodes.map(selectId),e.selectedNodes.map(selectId))&&shallow$1(s.selectedEdges.map(selectId),e.selectedEdges.map(selectId))}function SelectionListenerInner({onSelectionChange:s}){const e=useStoreApi(),{selectedNodes:o,selectedEdges:a}=useStore(selector$m,areEqual);return reactExports.useEffect(()=>{const c={nodes:o,edges:a};s==null||s(c),e.getState().onSelectionChangeHandlers.forEach(d=>d(c))},[o,a,s]),null}const changeSelector=s=>!!s.onSelectionChangeHandlers;function SelectionListener({onSelectionChange:s}){const e=useStore(changeSelector);return s||e?jsxRuntimeExports.jsx(SelectionListenerInner,{onSelectionChange:s}):null}const defaultNodeOrigin=[0,0],defaultViewport={x:0,y:0,zoom:1},reactFlowFieldsToTrack=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],fieldsToTrack=[...reactFlowFieldsToTrack,"rfId"],selector$l=s=>({setNodes:s.setNodes,setEdges:s.setEdges,setMinZoom:s.setMinZoom,setMaxZoom:s.setMaxZoom,setTranslateExtent:s.setTranslateExtent,setNodeExtent:s.setNodeExtent,reset:s.reset,setDefaultNodesAndEdges:s.setDefaultNodesAndEdges}),initPrevValues={translateExtent:infiniteExtent,nodeOrigin:defaultNodeOrigin,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function StoreUpdater(s){const{setNodes:e,setEdges:o,setMinZoom:a,setMaxZoom:c,setTranslateExtent:d,setNodeExtent:h,reset:g,setDefaultNodesAndEdges:b}=useStore(selector$l,shallow$1),j=useStoreApi();reactExports.useEffect(()=>(b(s.defaultNodes,s.defaultEdges),()=>{$.current=initPrevValues,g()}),[]);const $=reactExports.useRef(initPrevValues);return reactExports.useEffect(()=>{for(const _ of fieldsToTrack){const _e=s[_],et=$.current[_];_e!==et&&(typeof s[_]>"u"||(_==="nodes"?e(_e):_==="edges"?o(_e):_==="minZoom"?a(_e):_==="maxZoom"?c(_e):_==="translateExtent"?d(_e):_==="nodeExtent"?h(_e):_==="ariaLabelConfig"?j.setState({ariaLabelConfig:mergeAriaLabelConfig(_e)}):_==="fitView"?j.setState({fitViewQueued:_e}):_==="fitViewOptions"?j.setState({fitViewOptions:_e}):j.setState({[_]:_e})))}$.current=s},fieldsToTrack.map(_=>s[_])),null}function getMediaQuery(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function useColorModeClass(s){var a;const[e,o]=reactExports.useState(s==="system"?null:s);return reactExports.useEffect(()=>{if(s!=="system"){o(s);return}const c=getMediaQuery(),d=()=>o(c!=null&&c.matches?"dark":"light");return d(),c==null||c.addEventListener("change",d),()=>{c==null||c.removeEventListener("change",d)}},[s]),e!==null?e:(a=getMediaQuery())!=null&&a.matches?"dark":"light"}const defaultDoc=typeof document<"u"?document:null;function useKeyPress(s=null,e={target:defaultDoc,actInsideInputWithModifier:!0}){const[o,a]=reactExports.useState(!1),c=reactExports.useRef(!1),d=reactExports.useRef(new Set([])),[h,g]=reactExports.useMemo(()=>{if(s!==null){const j=(Array.isArray(s)?s:[s]).filter(_=>typeof _=="string").map(_=>_.replace("+",`
`).replace(`

`,`
+`).split(`
`)),$=j.reduce((_,_e)=>_.concat(..._e),[]);return[j,$]}return[[],[]]},[s]);return reactExports.useEffect(()=>{const b=(e==null?void 0:e.target)??defaultDoc,j=(e==null?void 0:e.actInsideInputWithModifier)??!0;if(s!==null){const $=et=>{var it,st;if(c.current=et.ctrlKey||et.metaKey||et.shiftKey||et.altKey,(!c.current||c.current&&!j)&&isInputDOMNode(et))return!1;const rt=useKeyOrCode(et.code,g);if(d.current.add(et[rt]),isMatchingKey(h,d.current,!1)){const lt=((st=(it=et.composedPath)==null?void 0:it.call(et))==null?void 0:st[0])||et.target,ot=(lt==null?void 0:lt.nodeName)==="BUTTON"||(lt==null?void 0:lt.nodeName)==="A";e.preventDefault!==!1&&(c.current||!ot)&&et.preventDefault(),a(!0)}},_=et=>{const nt=useKeyOrCode(et.code,g);isMatchingKey(h,d.current,!0)?(a(!1),d.current.clear()):d.current.delete(et[nt]),et.key==="Meta"&&d.current.clear(),c.current=!1},_e=()=>{d.current.clear(),a(!1)};return b==null||b.addEventListener("keydown",$),b==null||b.addEventListener("keyup",_),window.addEventListener("blur",_e),window.addEventListener("contextmenu",_e),()=>{b==null||b.removeEventListener("keydown",$),b==null||b.removeEventListener("keyup",_),window.removeEventListener("blur",_e),window.removeEventListener("contextmenu",_e)}}},[s,a]),o}function isMatchingKey(s,e,o){return s.filter(a=>o||a.length===e.size).some(a=>a.every(c=>e.has(c)))}function useKeyOrCode(s,e){return e.includes(s)?"code":"key"}const useViewportHelper=()=>{const s=useStoreApi();return reactExports.useMemo(()=>({zoomIn:e=>{const{panZoom:o}=s.getState();return o?o.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:o}=s.getState();return o?o.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,o)=>{const{panZoom:a}=s.getState();return a?a.scaleTo(e,{duration:o==null?void 0:o.duration}):Promise.resolve(!1)},getZoom:()=>s.getState().transform[2],setViewport:async(e,o)=>{const{transform:[a,c,d],panZoom:h}=s.getState();return h?(await h.setViewport({x:e.x??a,y:e.y??c,zoom:e.zoom??d},o),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,o,a]=s.getState().transform;return{x:e,y:o,zoom:a}},setCenter:async(e,o,a)=>s.getState().setCenter(e,o,a),fitBounds:async(e,o)=>{const{width:a,height:c,minZoom:d,maxZoom:h,panZoom:g}=s.getState(),b=getViewportForBounds(e,a,c,d,h,(o==null?void 0:o.padding)??.1);return g?(await g.setViewport(b,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,o={})=>{const{transform:a,snapGrid:c,snapToGrid:d,domNode:h}=s.getState();if(!h)return e;const{x:g,y:b}=h.getBoundingClientRect(),j={x:e.x-g,y:e.y-b},$=o.snapGrid??c,_=o.snapToGrid??d;return pointToRendererPoint(j,a,_,$)},flowToScreenPosition:e=>{const{transform:o,domNode:a}=s.getState();if(!a)return e;const{x:c,y:d}=a.getBoundingClientRect(),h=rendererPointToPoint(e,o);return{x:h.x+c,y:h.y+d}}}),[])};function applyChanges(s,e){const o=[],a=new Map,c=[];for(const d of s)if(d.type==="add"){c.push(d);continue}else if(d.type==="remove"||d.type==="replace")a.set(d.id,[d]);else{const h=a.get(d.id);h?h.push(d):a.set(d.id,[d])}for(const d of e){const h=a.get(d.id);if(!h){o.push(d);continue}if(h[0].type==="remove")continue;if(h[0].type==="replace"){o.push({...h[0].item});continue}const g={...d};for(const b of h)applyChange(b,g);o.push(g)}return c.length&&c.forEach(d=>{d.index!==void 0?o.splice(d.index,0,{...d.item}):o.push({...d.item})}),o}function applyChange(s,e){switch(s.type){case"select":{e.selected=s.selected;break}case"position":{typeof s.position<"u"&&(e.position=s.position),typeof s.dragging<"u"&&(e.dragging=s.dragging);break}case"dimensions":{typeof s.dimensions<"u"&&(e.measured={...s.dimensions},s.setAttributes&&((s.setAttributes===!0||s.setAttributes==="width")&&(e.width=s.dimensions.width),(s.setAttributes===!0||s.setAttributes==="height")&&(e.height=s.dimensions.height))),typeof s.resizing=="boolean"&&(e.resizing=s.resizing);break}}}function applyNodeChanges(s,e){return applyChanges(s,e)}function applyEdgeChanges(s,e){return applyChanges(s,e)}function createSelectionChange(s,e){return{id:s,type:"select",selected:e}}function getSelectionChanges(s,e=new Set,o=!1){const a=[];for(const[c,d]of s){const h=e.has(c);!(d.selected===void 0&&!h)&&d.selected!==h&&(o&&(d.selected=h),a.push(createSelectionChange(d.id,h)))}return a}function getElementsDiffChanges({items:s=[],lookup:e}){var c;const o=[],a=new Map(s.map(d=>[d.id,d]));for(const[d,h]of s.entries()){const g=e.get(h.id),b=((c=g==null?void 0:g.internals)==null?void 0:c.userNode)??g;b!==void 0&&b!==h&&o.push({id:h.id,item:h,type:"replace"}),b===void 0&&o.push({item:h,type:"add",index:d})}for(const[d]of e)a.get(d)===void 0&&o.push({id:d,type:"remove"});return o}function elementToRemoveChange(s){return{id:s.id,type:"remove"}}const isNode=s=>isNodeBase(s),isEdge=s=>isEdgeBase(s);function fixedForwardRef(s){return reactExports.forwardRef(s)}const useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function useQueue(s){const[e,o]=reactExports.useState(BigInt(0)),[a]=reactExports.useState(()=>createQueue(()=>o(c=>c+BigInt(1))));return useIsomorphicLayoutEffect(()=>{const c=a.get();c.length&&(s(c),a.reset())},[e]),a}function createQueue(s){let e=[];return{get:()=>e,reset:()=>{e=[]},push:o=>{e.push(o),s()}}}const BatchContext=reactExports.createContext(null);function BatchProvider({children:s}){const e=useStoreApi(),o=reactExports.useCallback(g=>{const{nodes:b=[],setNodes:j,hasDefaultNodes:$,onNodesChange:_,nodeLookup:_e,fitViewQueued:et,onNodesChangeMiddlewareMap:nt}=e.getState();let rt=b;for(const st of g)rt=typeof st=="function"?st(rt):st;let it=getElementsDiffChanges({items:rt,lookup:_e});for(const st of nt.values())it=st(it);$&&j(rt),it.length>0?_==null||_(it):et&&window.requestAnimationFrame(()=>{const{fitViewQueued:st,nodes:lt,setNodes:ot}=e.getState();st&&ot(lt)})},[]),a=useQueue(o),c=reactExports.useCallback(g=>{const{edges:b=[],setEdges:j,hasDefaultEdges:$,onEdgesChange:_,edgeLookup:_e}=e.getState();let et=b;for(const nt of g)et=typeof nt=="function"?nt(et):nt;$?j(et):_&&_(getElementsDiffChanges({items:et,lookup:_e}))},[]),d=useQueue(c),h=reactExports.useMemo(()=>({nodeQueue:a,edgeQueue:d}),[]);return jsxRuntimeExports.jsx(BatchContext.Provider,{value:h,children:s})}function useBatchContext(){const s=reactExports.useContext(BatchContext);if(!s)throw new Error("useBatchContext must be used within a BatchProvider");return s}const selector$k=s=>!!s.panZoom;function useReactFlow(){const s=useViewportHelper(),e=useStoreApi(),o=useBatchContext(),a=useStore(selector$k),c=reactExports.useMemo(()=>{const d=_=>e.getState().nodeLookup.get(_),h=_=>{o.nodeQueue.push(_)},g=_=>{o.edgeQueue.push(_)},b=_=>{var st,lt;const{nodeLookup:_e,nodeOrigin:et}=e.getState(),nt=isNode(_)?_:_e.get(_.id),rt=nt.parentId?evaluateAbsolutePosition(nt.position,nt.measured,nt.parentId,_e,et):nt.position,it={...nt,position:rt,width:((st=nt.measured)==null?void 0:st.width)??nt.width,height:((lt=nt.measured)==null?void 0:lt.height)??nt.height};return nodeToRect(it)},j=(_,_e,et={replace:!1})=>{h(nt=>nt.map(rt=>{if(rt.id===_){const it=typeof _e=="function"?_e(rt):_e;return et.replace&&isNode(it)?it:{...rt,...it}}return rt}))},$=(_,_e,et={replace:!1})=>{g(nt=>nt.map(rt=>{if(rt.id===_){const it=typeof _e=="function"?_e(rt):_e;return et.replace&&isEdge(it)?it:{...rt,...it}}return rt}))};return{getNodes:()=>e.getState().nodes.map(_=>({..._})),getNode:_=>{var _e;return(_e=d(_))==null?void 0:_e.internals.userNode},getInternalNode:d,getEdges:()=>{const{edges:_=[]}=e.getState();return _.map(_e=>({..._e}))},getEdge:_=>e.getState().edgeLookup.get(_),setNodes:h,setEdges:g,addNodes:_=>{const _e=Array.isArray(_)?_:[_];o.nodeQueue.push(et=>[...et,..._e])},addEdges:_=>{const _e=Array.isArray(_)?_:[_];o.edgeQueue.push(et=>[...et,..._e])},toObject:()=>{const{nodes:_=[],edges:_e=[],transform:et}=e.getState(),[nt,rt,it]=et;return{nodes:_.map(st=>({...st})),edges:_e.map(st=>({...st})),viewport:{x:nt,y:rt,zoom:it}}},deleteElements:async({nodes:_=[],edges:_e=[]})=>{const{nodes:et,edges:nt,onNodesDelete:rt,onEdgesDelete:it,triggerNodeChanges:st,triggerEdgeChanges:lt,onDelete:ot,onBeforeDelete:ct}=e.getState(),{nodes:ut,edges:at}=await getElementsToRemove({nodesToRemove:_,edgesToRemove:_e,nodes:et,edges:nt,onBeforeDelete:ct}),dt=at.length>0,ft=ut.length>0;if(dt){const xt=at.map(elementToRemoveChange);it==null||it(at),lt(xt)}if(ft){const xt=ut.map(elementToRemoveChange);rt==null||rt(ut),st(xt)}return(ft||dt)&&(ot==null||ot({nodes:ut,edges:at})),{deletedNodes:ut,deletedEdges:at}},getIntersectingNodes:(_,_e=!0,et)=>{const nt=isRectObject(_),rt=nt?_:b(_),it=et!==void 0;return rt?(et||e.getState().nodes).filter(st=>{const lt=e.getState().nodeLookup.get(st.id);if(lt&&!nt&&(st.id===_.id||!lt.internals.positionAbsolute))return!1;const ot=nodeToRect(it?st:lt),ct=getOverlappingArea(ot,rt);return _e&&ct>0||ct>=ot.width*ot.height||ct>=rt.width*rt.height}):[]},isNodeIntersecting:(_,_e,et=!0)=>{const rt=isRectObject(_)?_:b(_);if(!rt)return!1;const it=getOverlappingArea(rt,_e);return et&&it>0||it>=_e.width*_e.height||it>=rt.width*rt.height},updateNode:j,updateNodeData:(_,_e,et={replace:!1})=>{j(_,nt=>{const rt=typeof _e=="function"?_e(nt):_e;return et.replace?{...nt,data:rt}:{...nt,data:{...nt.data,...rt}}},et)},updateEdge:$,updateEdgeData:(_,_e,et={replace:!1})=>{$(_,nt=>{const rt=typeof _e=="function"?_e(nt):_e;return et.replace?{...nt,data:rt}:{...nt,data:{...nt.data,...rt}}},et)},getNodesBounds:_=>{const{nodeLookup:_e,nodeOrigin:et}=e.getState();return getNodesBounds(_,{nodeLookup:_e,nodeOrigin:et})},getHandleConnections:({type:_,id:_e,nodeId:et})=>{var nt;return Array.from(((nt=e.getState().connectionLookup.get(`${et}-${_}${_e?`-${_e}`:""}`))==null?void 0:nt.values())??[])},getNodeConnections:({type:_,handleId:_e,nodeId:et})=>{var nt;return Array.from(((nt=e.getState().connectionLookup.get(`${et}${_?_e?`-${_}-${_e}`:`-${_}`:""}`))==null?void 0:nt.values())??[])},fitView:async _=>{const _e=e.getState().fitViewResolver??withResolvers();return e.setState({fitViewQueued:!0,fitViewOptions:_,fitViewResolver:_e}),o.nodeQueue.push(et=>[...et]),_e.promise}}},[]);return reactExports.useMemo(()=>({...c,...s,viewportInitialized:a}),[a])}const selected=s=>s.selected,win$1=typeof window<"u"?window:void 0;function useGlobalKeyHandler({deleteKeyCode:s,multiSelectionKeyCode:e}){const o=useStoreApi(),{deleteElements:a}=useReactFlow(),c=useKeyPress(s,{actInsideInputWithModifier:!1}),d=useKeyPress(e,{target:win$1});reactExports.useEffect(()=>{if(c){const{edges:h,nodes:g}=o.getState();a({nodes:g.filter(selected),edges:h.filter(selected)}),o.setState({nodesSelectionActive:!1})}},[c]),reactExports.useEffect(()=>{o.setState({multiSelectionActive:d})},[d])}function useResizeHandler(s){const e=useStoreApi();reactExports.useEffect(()=>{const o=()=>{var c,d,h,g;if(!s.current||!(((d=(c=s.current).checkVisibility)==null?void 0:d.call(c))??!0))return!1;const a=getDimensions(s.current);(a.height===0||a.width===0)&&((g=(h=e.getState()).onError)==null||g.call(h,"004",errorMessages.error004())),e.setState({width:a.width||500,height:a.height||500})};if(s.current){o(),window.addEventListener("resize",o);const a=new ResizeObserver(()=>o());return a.observe(s.current),()=>{window.removeEventListener("resize",o),a&&s.current&&a.unobserve(s.current)}}},[])}const containerStyle={position:"absolute",width:"100%",height:"100%",top:0,left:0},selector$j=s=>({userSelectionActive:s.userSelectionActive,lib:s.lib,connectionInProgress:s.connection.inProgress});function ZoomPane({onPaneContextMenu:s,zoomOnScroll:e=!0,zoomOnPinch:o=!0,panOnScroll:a=!1,panOnScrollSpeed:c=.5,panOnScrollMode:d=PanOnScrollMode.Free,zoomOnDoubleClick:h=!0,panOnDrag:g=!0,defaultViewport:b,translateExtent:j,minZoom:$,maxZoom:_,zoomActivationKeyCode:_e,preventScrolling:et=!0,children:nt,noWheelClassName:rt,noPanClassName:it,onViewportChange:st,isControlledViewport:lt,paneClickDistance:ot,selectionOnDrag:ct}){const ut=useStoreApi(),at=reactExports.useRef(null),{userSelectionActive:dt,lib:ft,connectionInProgress:xt}=useStore(selector$j,shallow$1),Ct=useKeyPress(_e),yt=reactExports.useRef();useResizeHandler(at);const Et=reactExports.useCallback(Tt=>{st==null||st({x:Tt[0],y:Tt[1],zoom:Tt[2]}),lt||ut.setState({transform:Tt})},[st,lt]);return reactExports.useEffect(()=>{if(at.current){yt.current=XYPanZoom({domNode:at.current,minZoom:$,maxZoom:_,translateExtent:j,viewport:b,onDraggingChange:St=>ut.setState({paneDragging:St}),onPanZoomStart:(St,bt)=>{const{onViewportChangeStart:mt,onMoveStart:gt}=ut.getState();gt==null||gt(St,bt),mt==null||mt(bt)},onPanZoom:(St,bt)=>{const{onViewportChange:mt,onMove:gt}=ut.getState();gt==null||gt(St,bt),mt==null||mt(bt)},onPanZoomEnd:(St,bt)=>{const{onViewportChangeEnd:mt,onMoveEnd:gt}=ut.getState();gt==null||gt(St,bt),mt==null||mt(bt)}});const{x:Tt,y:ht,zoom:wt}=yt.current.getViewport();return ut.setState({panZoom:yt.current,transform:[Tt,ht,wt],domNode:at.current.closest(".react-flow")}),()=>{var St;(St=yt.current)==null||St.destroy()}}},[]),reactExports.useEffect(()=>{var Tt;(Tt=yt.current)==null||Tt.update({onPaneContextMenu:s,zoomOnScroll:e,zoomOnPinch:o,panOnScroll:a,panOnScrollSpeed:c,panOnScrollMode:d,zoomOnDoubleClick:h,panOnDrag:g,zoomActivationKeyPressed:Ct,preventScrolling:et,noPanClassName:it,userSelectionActive:dt,noWheelClassName:rt,lib:ft,onTransformChange:Et,connectionInProgress:xt,selectionOnDrag:ct,paneClickDistance:ot})},[s,e,o,a,c,d,h,g,Ct,et,it,dt,rt,ft,Et,xt,ct,ot]),jsxRuntimeExports.jsx("div",{className:"react-flow__renderer",ref:at,style:containerStyle,children:nt})}const selector$i=s=>({userSelectionActive:s.userSelectionActive,userSelectionRect:s.userSelectionRect});function UserSelection(){const{userSelectionActive:s,userSelectionRect:e}=useStore(selector$i,shallow$1);return s&&e?jsxRuntimeExports.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const wrapHandler=(s,e)=>o=>{o.target===e.current&&(s==null||s(o))},selector$h=s=>({userSelectionActive:s.userSelectionActive,elementsSelectable:s.elementsSelectable,connectionInProgress:s.connection.inProgress,dragging:s.paneDragging});function Pane({isSelecting:s,selectionKeyPressed:e,selectionMode:o=SelectionMode.Full,panOnDrag:a,paneClickDistance:c,selectionOnDrag:d,onSelectionStart:h,onSelectionEnd:g,onPaneClick:b,onPaneContextMenu:j,onPaneScroll:$,onPaneMouseEnter:_,onPaneMouseMove:_e,onPaneMouseLeave:et,children:nt}){const rt=useStoreApi(),{userSelectionActive:it,elementsSelectable:st,dragging:lt,connectionInProgress:ot}=useStore(selector$h,shallow$1),ct=st&&(s||it),ut=reactExports.useRef(null),at=reactExports.useRef(),dt=reactExports.useRef(new Set),ft=reactExports.useRef(new Set),xt=reactExports.useRef(!1),Ct=mt=>{if(xt.current||ot){xt.current=!1;return}b==null||b(mt),rt.getState().resetSelectedElements(),rt.setState({nodesSelectionActive:!1})},yt=mt=>{if(Array.isArray(a)&&(a!=null&&a.includes(2))){mt.preventDefault();return}j==null||j(mt)},Et=$?mt=>$(mt):void 0,Tt=mt=>{xt.current&&(mt.stopPropagation(),xt.current=!1)},ht=mt=>{var Dt,$t;const{domNode:gt}=rt.getState();if(at.current=gt==null?void 0:gt.getBoundingClientRect(),!at.current)return;const pt=mt.target===ut.current;if(!pt&&!!mt.target.closest(".nokey")||!s||!(d&&pt||e)||mt.button!==0||!mt.isPrimary)return;($t=(Dt=mt.target)==null?void 0:Dt.setPointerCapture)==null||$t.call(Dt,mt.pointerId),xt.current=!1;const{x:At,y:Mt}=getEventPosition(mt.nativeEvent,at.current);rt.setState({userSelectionRect:{width:0,height:0,startX:At,startY:Mt,x:At,y:Mt}}),pt||(mt.stopPropagation(),mt.preventDefault())},wt=mt=>{const{userSelectionRect:gt,transform:pt,nodeLookup:kt,edgeLookup:Rt,connectionLookup:At,triggerNodeChanges:Mt,triggerEdgeChanges:Dt,defaultEdgeOptions:$t,resetSelectedElements:_t}=rt.getState();if(!at.current||!gt)return;const{x:Pt,y:Ht}=getEventPosition(mt.nativeEvent,at.current),{startX:Kt,startY:Ut}=gt;if(!xt.current){const qt=e?0:c;if(Math.hypot(Pt-Kt,Ht-Ut)<=qt)return;_t(),h==null||h(mt)}xt.current=!0;const Nt={startX:Kt,startY:Ut,x:Pt<Kt?Pt:Kt,y:Ht<Ut?Ht:Ut,width:Math.abs(Pt-Kt),height:Math.abs(Ht-Ut)},Ot=dt.current,Wt=ft.current;dt.current=new Set(getNodesInside(kt,Nt,pt,o===SelectionMode.Partial,!0).map(qt=>qt.id)),ft.current=new Set;const Ft=($t==null?void 0:$t.selectable)??!0;for(const qt of dt.current){const en=At.get(qt);if(en)for(const{edgeId:on}of en.values()){const cn=Rt.get(on);cn&&(cn.selectable??Ft)&&ft.current.add(on)}}if(!areSetsEqual(Ot,dt.current)){const qt=getSelectionChanges(kt,dt.current,!0);Mt(qt)}if(!areSetsEqual(Wt,ft.current)){const qt=getSelectionChanges(Rt,ft.current);Dt(qt)}rt.setState({userSelectionRect:Nt,userSelectionActive:!0,nodesSelectionActive:!1})},St=mt=>{var gt,pt;mt.button===0&&((pt=(gt=mt.target)==null?void 0:gt.releasePointerCapture)==null||pt.call(gt,mt.pointerId),!it&&mt.target===ut.current&&rt.getState().userSelectionRect&&(Ct==null||Ct(mt)),rt.setState({userSelectionActive:!1,userSelectionRect:null}),xt.current&&(g==null||g(mt),rt.setState({nodesSelectionActive:dt.current.size>0})))},bt=a===!0||Array.isArray(a)&&a.includes(0);return jsxRuntimeExports.jsxs("div",{className:cc(["react-flow__pane",{draggable:bt,dragging:lt,selection:s}]),onClick:ct?void 0:wrapHandler(Ct,ut),onContextMenu:wrapHandler(yt,ut),onWheel:wrapHandler(Et,ut),onPointerEnter:ct?void 0:_,onPointerMove:ct?wt:_e,onPointerUp:ct?St:void 0,onPointerDownCapture:ct?ht:void 0,onClickCapture:ct?Tt:void 0,onPointerLeave:et,ref:ut,style:containerStyle,children:[nt,jsxRuntimeExports.jsx(UserSelection,{})]})}function handleNodeClick({id:s,store:e,unselect:o=!1,nodeRef:a}){const{addSelectedNodes:c,unselectNodesAndEdges:d,multiSelectionActive:h,nodeLookup:g,onError:b}=e.getState(),j=g.get(s);if(!j){b==null||b("012",errorMessages.error012(s));return}e.setState({nodesSelectionActive:!1}),j.selected?(o||j.selected&&h)&&(d({nodes:[j],edges:[]}),requestAnimationFrame(()=>{var $;return($=a==null?void 0:a.current)==null?void 0:$.blur()})):c([s])}function useDrag({nodeRef:s,disabled:e=!1,noDragClassName:o,handleSelector:a,nodeId:c,isSelectable:d,nodeClickDistance:h}){const g=useStoreApi(),[b,j]=reactExports.useState(!1),$=reactExports.useRef();return reactExports.useEffect(()=>{$.current=XYDrag({getStoreItems:()=>g.getState(),onNodeMouseDown:_=>{handleNodeClick({id:_,store:g,nodeRef:s})},onDragStart:()=>{j(!0)},onDragStop:()=>{j(!1)}})},[]),reactExports.useEffect(()=>{var _,_e;if(e)(_=$.current)==null||_.destroy();else if(s.current)return(_e=$.current)==null||_e.update({noDragClassName:o,handleSelector:a,domNode:s.current,isSelectable:d,nodeId:c,nodeClickDistance:h}),()=>{var et;(et=$.current)==null||et.destroy()}},[o,a,e,d,s,c]),b}const selectedAndDraggable=s=>e=>e.selected&&(e.draggable||s&&typeof e.draggable>"u");function useMoveSelectedNodes(){const s=useStoreApi();return reactExports.useCallback(o=>{const{nodeExtent:a,snapToGrid:c,snapGrid:d,nodesDraggable:h,onError:g,updateNodePositions:b,nodeLookup:j,nodeOrigin:$}=s.getState(),_=new Map,_e=selectedAndDraggable(h),et=c?d[0]:5,nt=c?d[1]:5,rt=o.direction.x*et*o.factor,it=o.direction.y*nt*o.factor;for(const[,st]of j){if(!_e(st))continue;let lt={x:st.internals.positionAbsolute.x+rt,y:st.internals.positionAbsolute.y+it};c&&(lt=snapPosition(lt,d));const{position:ot,positionAbsolute:ct}=calculateNodePosition({nodeId:st.id,nextPosition:lt,nodeLookup:j,nodeExtent:a,nodeOrigin:$,onError:g});st.position=ot,st.internals.positionAbsolute=ct,_.set(st.id,st)}b(_)},[])}const NodeIdContext=reactExports.createContext(null),Provider=NodeIdContext.Provider;NodeIdContext.Consumer;const useNodeId=()=>reactExports.useContext(NodeIdContext),selector$g=s=>({connectOnClick:s.connectOnClick,noPanClassName:s.noPanClassName,rfId:s.rfId}),connectingSelector=(s,e,o)=>a=>{const{connectionClickStartHandle:c,connectionMode:d,connection:h}=a,{fromHandle:g,toHandle:b,isValid:j}=h,$=(b==null?void 0:b.nodeId)===s&&(b==null?void 0:b.id)===e&&(b==null?void 0:b.type)===o;return{connectingFrom:(g==null?void 0:g.nodeId)===s&&(g==null?void 0:g.id)===e&&(g==null?void 0:g.type)===o,connectingTo:$,clickConnecting:(c==null?void 0:c.nodeId)===s&&(c==null?void 0:c.id)===e&&(c==null?void 0:c.type)===o,isPossibleEndHandle:d===ConnectionMode.Strict?(g==null?void 0:g.type)!==o:s!==(g==null?void 0:g.nodeId)||e!==(g==null?void 0:g.id),connectionInProcess:!!g,clickConnectionInProcess:!!c,valid:$&&j}};function HandleComponent({type:s="source",position:e=Position.Top,isValidConnection:o,isConnectable:a=!0,isConnectableStart:c=!0,isConnectableEnd:d=!0,id:h,onConnect:g,children:b,className:j,onMouseDown:$,onTouchStart:_,..._e},et){var wt,St;const nt=h||null,rt=s==="target",it=useStoreApi(),st=useNodeId(),{connectOnClick:lt,noPanClassName:ot,rfId:ct}=useStore(selector$g,shallow$1),{connectingFrom:ut,connectingTo:at,clickConnecting:dt,isPossibleEndHandle:ft,connectionInProcess:xt,clickConnectionInProcess:Ct,valid:yt}=useStore(connectingSelector(st,nt,s),shallow$1);st||(St=(wt=it.getState()).onError)==null||St.call(wt,"010",errorMessages.error010());const Et=bt=>{const{defaultEdgeOptions:mt,onConnect:gt,hasDefaultEdges:pt}=it.getState(),kt={...mt,...bt};if(pt){const{edges:Rt,setEdges:At}=it.getState();At(addEdge(kt,Rt))}gt==null||gt(kt),g==null||g(kt)},Tt=bt=>{if(!st)return;const mt=isMouseEvent(bt.nativeEvent);if(c&&(mt&&bt.button===0||!mt)){const gt=it.getState();XYHandle.onPointerDown(bt.nativeEvent,{handleDomNode:bt.currentTarget,autoPanOnConnect:gt.autoPanOnConnect,connectionMode:gt.connectionMode,connectionRadius:gt.connectionRadius,domNode:gt.domNode,nodeLookup:gt.nodeLookup,lib:gt.lib,isTarget:rt,handleId:nt,nodeId:st,flowId:gt.rfId,panBy:gt.panBy,cancelConnection:gt.cancelConnection,onConnectStart:gt.onConnectStart,onConnectEnd:gt.onConnectEnd,updateConnection:gt.updateConnection,onConnect:Et,isValidConnection:o||gt.isValidConnection,getTransform:()=>it.getState().transform,getFromHandle:()=>it.getState().connection.fromHandle,autoPanSpeed:gt.autoPanSpeed,dragThreshold:gt.connectionDragThreshold})}mt?$==null||$(bt):_==null||_(bt)},ht=bt=>{const{onClickConnectStart:mt,onClickConnectEnd:gt,connectionClickStartHandle:pt,connectionMode:kt,isValidConnection:Rt,lib:At,rfId:Mt,nodeLookup:Dt,connection:$t}=it.getState();if(!st||!pt&&!c)return;if(!pt){mt==null||mt(bt.nativeEvent,{nodeId:st,handleId:nt,handleType:s}),it.setState({connectionClickStartHandle:{nodeId:st,type:s,id:nt}});return}const _t=getHostForElement(bt.target),Pt=o||Rt,{connection:Ht,isValid:Kt}=XYHandle.isValid(bt.nativeEvent,{handle:{nodeId:st,id:nt,type:s},connectionMode:kt,fromNodeId:pt.nodeId,fromHandleId:pt.id||null,fromType:pt.type,isValidConnection:Pt,flowId:Mt,doc:_t,lib:At,nodeLookup:Dt});Kt&&Ht&&Et(Ht);const Ut=structuredClone($t);delete Ut.inProgress,Ut.toPosition=Ut.toHandle?Ut.toHandle.position:null,gt==null||gt(bt,Ut),it.setState({connectionClickStartHandle:null})};return jsxRuntimeExports.jsx("div",{"data-handleid":nt,"data-nodeid":st,"data-handlepos":e,"data-id":`${ct}-${st}-${nt}-${s}`,className:cc(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",ot,j,{source:!rt,target:rt,connectable:a,connectablestart:c,connectableend:d,clickconnecting:dt,connectingfrom:ut,connectingto:at,valid:yt,connectionindicator:a&&(!xt||ft)&&(xt||Ct?d:c)}]),onMouseDown:Tt,onTouchStart:Tt,onClick:lt?ht:void 0,ref:et,..._e,children:b})}const Handle=reactExports.memo(fixedForwardRef(HandleComponent));function InputNode({data:s,isConnectable:e,sourcePosition:o=Position.Bottom}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[s==null?void 0:s.label,jsxRuntimeExports.jsx(Handle,{type:"source",position:o,isConnectable:e})]})}function DefaultNode({data:s,isConnectable:e,targetPosition:o=Position.Top,sourcePosition:a=Position.Bottom}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Handle,{type:"target",position:o,isConnectable:e}),s==null?void 0:s.label,jsxRuntimeExports.jsx(Handle,{type:"source",position:a,isConnectable:e})]})}function GroupNode(){return null}function OutputNode({data:s,isConnectable:e,targetPosition:o=Position.Top}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Handle,{type:"target",position:o,isConnectable:e}),s==null?void 0:s.label]})}const arrowKeyDiffs={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},builtinNodeTypes={input:InputNode,default:DefaultNode,output:OutputNode,group:GroupNode};function getNodeInlineStyleDimensions(s){var e,o,a,c;return s.internals.handleBounds===void 0?{width:s.width??s.initialWidth??((e=s.style)==null?void 0:e.width),height:s.height??s.initialHeight??((o=s.style)==null?void 0:o.height)}:{width:s.width??((a=s.style)==null?void 0:a.width),height:s.height??((c=s.style)==null?void 0:c.height)}}const selector$f=s=>{const{width:e,height:o,x:a,y:c}=getInternalNodesBounds(s.nodeLookup,{filter:d=>!!d.selected});return{width:isNumeric(e)?e:null,height:isNumeric(o)?o:null,userSelectionActive:s.userSelectionActive,transformString:`translate(${s.transform[0]}px,${s.transform[1]}px) scale(${s.transform[2]}) translate(${a}px,${c}px)`}};function NodesSelection({onSelectionContextMenu:s,noPanClassName:e,disableKeyboardA11y:o}){const a=useStoreApi(),{width:c,height:d,transformString:h,userSelectionActive:g}=useStore(selector$f,shallow$1),b=useMoveSelectedNodes(),j=reactExports.useRef(null);if(reactExports.useEffect(()=>{var _e;o||(_e=j.current)==null||_e.focus({preventScroll:!0})},[o]),useDrag({nodeRef:j}),g||!c||!d)return null;const $=s?_e=>{const et=a.getState().nodes.filter(nt=>nt.selected);s(_e,et)}:void 0,_=_e=>{Object.prototype.hasOwnProperty.call(arrowKeyDiffs,_e.key)&&(_e.preventDefault(),b({direction:arrowKeyDiffs[_e.key],factor:_e.shiftKey?4:1}))};return jsxRuntimeExports.jsx("div",{className:cc(["react-flow__nodesselection","react-flow__container",e]),style:{transform:h},children:jsxRuntimeExports.jsx("div",{ref:j,className:"react-flow__nodesselection-rect",onContextMenu:$,tabIndex:o?void 0:-1,onKeyDown:o?void 0:_,style:{width:c,height:d}})})}const win=typeof window<"u"?window:void 0,selector$e=s=>({nodesSelectionActive:s.nodesSelectionActive,userSelectionActive:s.userSelectionActive});function FlowRendererComponent({children:s,onPaneClick:e,onPaneMouseEnter:o,onPaneMouseMove:a,onPaneMouseLeave:c,onPaneContextMenu:d,onPaneScroll:h,paneClickDistance:g,deleteKeyCode:b,selectionKeyCode:j,selectionOnDrag:$,selectionMode:_,onSelectionStart:_e,onSelectionEnd:et,multiSelectionKeyCode:nt,panActivationKeyCode:rt,zoomActivationKeyCode:it,elementsSelectable:st,zoomOnScroll:lt,zoomOnPinch:ot,panOnScroll:ct,panOnScrollSpeed:ut,panOnScrollMode:at,zoomOnDoubleClick:dt,panOnDrag:ft,defaultViewport:xt,translateExtent:Ct,minZoom:yt,maxZoom:Et,preventScrolling:Tt,onSelectionContextMenu:ht,noWheelClassName:wt,noPanClassName:St,disableKeyboardA11y:bt,onViewportChange:mt,isControlledViewport:gt}){const{nodesSelectionActive:pt,userSelectionActive:kt}=useStore(selector$e,shallow$1),Rt=useKeyPress(j,{target:win}),At=useKeyPress(rt,{target:win}),Mt=At||ft,Dt=At||ct,$t=$&&Mt!==!0,_t=Rt||kt||$t;return useGlobalKeyHandler({deleteKeyCode:b,multiSelectionKeyCode:nt}),jsxRuntimeExports.jsx(ZoomPane,{onPaneContextMenu:d,elementsSelectable:st,zoomOnScroll:lt,zoomOnPinch:ot,panOnScroll:Dt,panOnScrollSpeed:ut,panOnScrollMode:at,zoomOnDoubleClick:dt,panOnDrag:!Rt&&Mt,defaultViewport:xt,translateExtent:Ct,minZoom:yt,maxZoom:Et,zoomActivationKeyCode:it,preventScrolling:Tt,noWheelClassName:wt,noPanClassName:St,onViewportChange:mt,isControlledViewport:gt,paneClickDistance:g,selectionOnDrag:$t,children:jsxRuntimeExports.jsxs(Pane,{onSelectionStart:_e,onSelectionEnd:et,onPaneClick:e,onPaneMouseEnter:o,onPaneMouseMove:a,onPaneMouseLeave:c,onPaneContextMenu:d,onPaneScroll:h,panOnDrag:Mt,isSelecting:!!_t,selectionMode:_,selectionKeyPressed:Rt,paneClickDistance:g,selectionOnDrag:$t,children:[s,pt&&jsxRuntimeExports.jsx(NodesSelection,{onSelectionContextMenu:ht,noPanClassName:St,disableKeyboardA11y:bt})]})})}FlowRendererComponent.displayName="FlowRenderer";const FlowRenderer=reactExports.memo(FlowRendererComponent),selector$d=s=>e=>s?getNodesInside(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(o=>o.id):Array.from(e.nodeLookup.keys());function useVisibleNodeIds(s){return useStore(reactExports.useCallback(selector$d(s),[s]),shallow$1)}const selector$c=s=>s.updateNodeInternals;function useResizeObserver(){const s=useStore(selector$c),[e]=reactExports.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(o=>{const a=new Map;o.forEach(c=>{const d=c.target.getAttribute("data-id");a.set(d,{id:d,nodeElement:c.target,force:!0})}),s(a)}));return reactExports.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function useNodeObserver({node:s,nodeType:e,hasDimensions:o,resizeObserver:a}){const c=useStoreApi(),d=reactExports.useRef(null),h=reactExports.useRef(null),g=reactExports.useRef(s.sourcePosition),b=reactExports.useRef(s.targetPosition),j=reactExports.useRef(e),$=o&&!!s.internals.handleBounds;return reactExports.useEffect(()=>{d.current&&!s.hidden&&(!$||h.current!==d.current)&&(h.current&&(a==null||a.unobserve(h.current)),a==null||a.observe(d.current),h.current=d.current)},[$,s.hidden]),reactExports.useEffect(()=>()=>{h.current&&(a==null||a.unobserve(h.current),h.current=null)},[]),reactExports.useEffect(()=>{if(d.current){const _=j.current!==e,_e=g.current!==s.sourcePosition,et=b.current!==s.targetPosition;(_||_e||et)&&(j.current=e,g.current=s.sourcePosition,b.current=s.targetPosition,c.getState().updateNodeInternals(new Map([[s.id,{id:s.id,nodeElement:d.current,force:!0}]])))}},[s.id,e,s.sourcePosition,s.targetPosition]),d}function NodeWrapper({id:s,onClick:e,onMouseEnter:o,onMouseMove:a,onMouseLeave:c,onContextMenu:d,onDoubleClick:h,nodesDraggable:g,elementsSelectable:b,nodesConnectable:j,nodesFocusable:$,resizeObserver:_,noDragClassName:_e,noPanClassName:et,disableKeyboardA11y:nt,rfId:rt,nodeTypes:it,nodeClickDistance:st,onError:lt}){const{node:ot,internals:ct,isParent:ut}=useStore(Pt=>{const Ht=Pt.nodeLookup.get(s),Kt=Pt.parentLookup.has(s);return{node:Ht,internals:Ht.internals,isParent:Kt}},shallow$1);let at=ot.type||"default",dt=(it==null?void 0:it[at])||builtinNodeTypes[at];dt===void 0&&(lt==null||lt("003",errorMessages.error003(at)),at="default",dt=(it==null?void 0:it.default)||builtinNodeTypes.default);const ft=!!(ot.draggable||g&&typeof ot.draggable>"u"),xt=!!(ot.selectable||b&&typeof ot.selectable>"u"),Ct=!!(ot.connectable||j&&typeof ot.connectable>"u"),yt=!!(ot.focusable||$&&typeof ot.focusable>"u"),Et=useStoreApi(),Tt=nodeHasDimensions(ot),ht=useNodeObserver({node:ot,nodeType:at,hasDimensions:Tt,resizeObserver:_}),wt=useDrag({nodeRef:ht,disabled:ot.hidden||!ft,noDragClassName:_e,handleSelector:ot.dragHandle,nodeId:s,isSelectable:xt,nodeClickDistance:st}),St=useMoveSelectedNodes();if(ot.hidden)return null;const bt=getNodeDimensions(ot),mt=getNodeInlineStyleDimensions(ot),gt=xt||ft||e||o||a||c,pt=o?Pt=>o(Pt,{...ct.userNode}):void 0,kt=a?Pt=>a(Pt,{...ct.userNode}):void 0,Rt=c?Pt=>c(Pt,{...ct.userNode}):void 0,At=d?Pt=>d(Pt,{...ct.userNode}):void 0,Mt=h?Pt=>h(Pt,{...ct.userNode}):void 0,Dt=Pt=>{const{selectNodesOnDrag:Ht,nodeDragThreshold:Kt}=Et.getState();xt&&(!Ht||!ft||Kt>0)&&handleNodeClick({id:s,store:Et,nodeRef:ht}),e&&e(Pt,{...ct.userNode})},$t=Pt=>{if(!(isInputDOMNode(Pt.nativeEvent)||nt)){if(elementSelectionKeys.includes(Pt.key)&&xt){const Ht=Pt.key==="Escape";handleNodeClick({id:s,store:Et,unselect:Ht,nodeRef:ht})}else if(ft&&ot.selected&&Object.prototype.hasOwnProperty.call(arrowKeyDiffs,Pt.key)){Pt.preventDefault();const{ariaLabelConfig:Ht}=Et.getState();Et.setState({ariaLiveMessage:Ht["node.a11yDescription.ariaLiveMessage"]({direction:Pt.key.replace("Arrow","").toLowerCase(),x:~~ct.positionAbsolute.x,y:~~ct.positionAbsolute.y})}),St({direction:arrowKeyDiffs[Pt.key],factor:Pt.shiftKey?4:1})}}},_t=()=>{var Wt;if(nt||!((Wt=ht.current)!=null&&Wt.matches(":focus-visible")))return;const{transform:Pt,width:Ht,height:Kt,autoPanOnNodeFocus:Ut,setCenter:Nt}=Et.getState();if(!Ut)return;getNodesInside(new Map([[s,ot]]),{x:0,y:0,width:Ht,height:Kt},Pt,!0).length>0||Nt(ot.position.x+bt.width/2,ot.position.y+bt.height/2,{zoom:Pt[2]})};return jsxRuntimeExports.jsx("div",{className:cc(["react-flow__node",`react-flow__node-${at}`,{[et]:ft},ot.className,{selected:ot.selected,selectable:xt,parent:ut,draggable:ft,dragging:wt}]),ref:ht,style:{zIndex:ct.z,transform:`translate(${ct.positionAbsolute.x}px,${ct.positionAbsolute.y}px)`,pointerEvents:gt?"all":"none",visibility:Tt?"visible":"hidden",...ot.style,...mt},"data-id":s,"data-testid":`rf__node-${s}`,onMouseEnter:pt,onMouseMove:kt,onMouseLeave:Rt,onContextMenu:At,onClick:Dt,onDoubleClick:Mt,onKeyDown:yt?$t:void 0,tabIndex:yt?0:void 0,onFocus:yt?_t:void 0,role:ot.ariaRole??(yt?"group":void 0),"aria-roledescription":"node","aria-describedby":nt?void 0:`${ARIA_NODE_DESC_KEY}-${rt}`,"aria-label":ot.ariaLabel,...ot.domAttributes,children:jsxRuntimeExports.jsx(Provider,{value:s,children:jsxRuntimeExports.jsx(dt,{id:s,data:ot.data,type:at,positionAbsoluteX:ct.positionAbsolute.x,positionAbsoluteY:ct.positionAbsolute.y,selected:ot.selected??!1,selectable:xt,draggable:ft,deletable:ot.deletable??!0,isConnectable:Ct,sourcePosition:ot.sourcePosition,targetPosition:ot.targetPosition,dragging:wt,dragHandle:ot.dragHandle,zIndex:ct.z,parentId:ot.parentId,...bt})})})}var NodeWrapper$1=reactExports.memo(NodeWrapper);const selector$b=s=>({nodesDraggable:s.nodesDraggable,nodesConnectable:s.nodesConnectable,nodesFocusable:s.nodesFocusable,elementsSelectable:s.elementsSelectable,onError:s.onError});function NodeRendererComponent(s){const{nodesDraggable:e,nodesConnectable:o,nodesFocusable:a,elementsSelectable:c,onError:d}=useStore(selector$b,shallow$1),h=useVisibleNodeIds(s.onlyRenderVisibleElements),g=useResizeObserver();return jsxRuntimeExports.jsx("div",{className:"react-flow__nodes",style:containerStyle,children:h.map(b=>jsxRuntimeExports.jsx(NodeWrapper$1,{id:b,nodeTypes:s.nodeTypes,nodeExtent:s.nodeExtent,onClick:s.onNodeClick,onMouseEnter:s.onNodeMouseEnter,onMouseMove:s.onNodeMouseMove,onMouseLeave:s.onNodeMouseLeave,onContextMenu:s.onNodeContextMenu,onDoubleClick:s.onNodeDoubleClick,noDragClassName:s.noDragClassName,noPanClassName:s.noPanClassName,rfId:s.rfId,disableKeyboardA11y:s.disableKeyboardA11y,resizeObserver:g,nodesDraggable:e,nodesConnectable:o,nodesFocusable:a,elementsSelectable:c,nodeClickDistance:s.nodeClickDistance,onError:d},b))})}NodeRendererComponent.displayName="NodeRenderer";const NodeRenderer=reactExports.memo(NodeRendererComponent);function useVisibleEdgeIds(s){return useStore(reactExports.useCallback(o=>{if(!s)return o.edges.map(c=>c.id);const a=[];if(o.width&&o.height)for(const c of o.edges){const d=o.nodeLookup.get(c.source),h=o.nodeLookup.get(c.target);d&&h&&isEdgeVisible({sourceNode:d,targetNode:h,width:o.width,height:o.height,transform:o.transform})&&a.push(c.id)}return a},[s]),shallow$1)}const ArrowSymbol=({color:s="none",strokeWidth:e=1})=>{const o={strokeWidth:e,...s&&{stroke:s}};return jsxRuntimeExports.jsx("polyline",{className:"arrow",style:o,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},ArrowClosedSymbol=({color:s="none",strokeWidth:e=1})=>{const o={strokeWidth:e,...s&&{stroke:s,fill:s}};return jsxRuntimeExports.jsx("polyline",{className:"arrowclosed",style:o,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},MarkerSymbols={[MarkerType.Arrow]:ArrowSymbol,[MarkerType.ArrowClosed]:ArrowClosedSymbol};function useMarkerSymbol(s){const e=useStoreApi();return reactExports.useMemo(()=>{var c,d;return Object.prototype.hasOwnProperty.call(MarkerSymbols,s)?MarkerSymbols[s]:((d=(c=e.getState()).onError)==null||d.call(c,"009",errorMessages.error009(s)),null)},[s])}const Marker=({id:s,type:e,color:o,width:a=12.5,height:c=12.5,markerUnits:d="strokeWidth",strokeWidth:h,orient:g="auto-start-reverse"})=>{const b=useMarkerSymbol(e);return b?jsxRuntimeExports.jsx("marker",{className:"react-flow__arrowhead",id:s,markerWidth:`${a}`,markerHeight:`${c}`,viewBox:"-10 -10 20 20",markerUnits:d,orient:g,refX:"0",refY:"0",children:jsxRuntimeExports.jsx(b,{color:o,strokeWidth:h})}):null},MarkerDefinitions=({defaultColor:s,rfId:e})=>{const o=useStore(d=>d.edges),a=useStore(d=>d.defaultEdgeOptions),c=reactExports.useMemo(()=>createMarkerIds(o,{id:e,defaultColor:s,defaultMarkerStart:a==null?void 0:a.markerStart,defaultMarkerEnd:a==null?void 0:a.markerEnd}),[o,a,e,s]);return c.length?jsxRuntimeExports.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:jsxRuntimeExports.jsx("defs",{children:c.map(d=>jsxRuntimeExports.jsx(Marker,{id:d.id,type:d.type,color:d.color,width:d.width,height:d.height,markerUnits:d.markerUnits,strokeWidth:d.strokeWidth,orient:d.orient},d.id))})}):null};MarkerDefinitions.displayName="MarkerDefinitions";var MarkerDefinitions$1=reactExports.memo(MarkerDefinitions);function EdgeTextComponent({x:s,y:e,label:o,labelStyle:a,labelShowBg:c=!0,labelBgStyle:d,labelBgPadding:h=[2,4],labelBgBorderRadius:g=2,children:b,className:j,...$}){const[_,_e]=reactExports.useState({x:1,y:0,width:0,height:0}),et=cc(["react-flow__edge-textwrapper",j]),nt=reactExports.useRef(null);return reactExports.useEffect(()=>{if(nt.current){const rt=nt.current.getBBox();_e({x:rt.x,y:rt.y,width:rt.width,height:rt.height})}},[o]),o?jsxRuntimeExports.jsxs("g",{transform:`translate(${s-_.width/2} ${e-_.height/2})`,className:et,visibility:_.width?"visible":"hidden",...$,children:[c&&jsxRuntimeExports.jsx("rect",{width:_.width+2*h[0],x:-h[0],y:-h[1],height:_.height+2*h[1],className:"react-flow__edge-textbg",style:d,rx:g,ry:g}),jsxRuntimeExports.jsx("text",{className:"react-flow__edge-text",y:_.height/2,dy:"0.3em",ref:nt,style:a,children:o}),b]}):null}EdgeTextComponent.displayName="EdgeText";const EdgeText=reactExports.memo(EdgeTextComponent);function BaseEdge({path:s,labelX:e,labelY:o,label:a,labelStyle:c,labelShowBg:d,labelBgStyle:h,labelBgPadding:g,labelBgBorderRadius:b,interactionWidth:j=20,...$}){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("path",{...$,d:s,fill:"none",className:cc(["react-flow__edge-path",$.className])}),j?jsxRuntimeExports.jsx("path",{d:s,fill:"none",strokeOpacity:0,strokeWidth:j,className:"react-flow__edge-interaction"}):null,a&&isNumeric(e)&&isNumeric(o)?jsxRuntimeExports.jsx(EdgeText,{x:e,y:o,label:a,labelStyle:c,labelShowBg:d,labelBgStyle:h,labelBgPadding:g,labelBgBorderRadius:b}):null]})}function getControl({pos:s,x1:e,y1:o,x2:a,y2:c}){return s===Position.Left||s===Position.Right?[.5*(e+a),o]:[e,.5*(o+c)]}function getSimpleBezierPath({sourceX:s,sourceY:e,sourcePosition:o=Position.Bottom,targetX:a,targetY:c,targetPosition:d=Position.Top}){const[h,g]=getControl({pos:o,x1:s,y1:e,x2:a,y2:c}),[b,j]=getControl({pos:d,x1:a,y1:c,x2:s,y2:e}),[$,_,_e,et]=getBezierEdgeCenter({sourceX:s,sourceY:e,targetX:a,targetY:c,sourceControlX:h,sourceControlY:g,targetControlX:b,targetControlY:j});return[`M${s},${e} C${h},${g} ${b},${j} ${a},${c}`,$,_,_e,et]}function createSimpleBezierEdge(s){return reactExports.memo(({id:e,sourceX:o,sourceY:a,targetX:c,targetY:d,sourcePosition:h,targetPosition:g,label:b,labelStyle:j,labelShowBg:$,labelBgStyle:_,labelBgPadding:_e,labelBgBorderRadius:et,style:nt,markerEnd:rt,markerStart:it,interactionWidth:st})=>{const[lt,ot,ct]=getSimpleBezierPath({sourceX:o,sourceY:a,sourcePosition:h,targetX:c,targetY:d,targetPosition:g}),ut=s.isInternal?void 0:e;return jsxRuntimeExports.jsx(BaseEdge,{id:ut,path:lt,labelX:ot,labelY:ct,label:b,labelStyle:j,labelShowBg:$,labelBgStyle:_,labelBgPadding:_e,labelBgBorderRadius:et,style:nt,markerEnd:rt,markerStart:it,interactionWidth:st})})}const SimpleBezierEdge=createSimpleBezierEdge({isInternal:!1}),SimpleBezierEdgeInternal=createSimpleBezierEdge({isInternal:!0});SimpleBezierEdge.displayName="SimpleBezierEdge";SimpleBezierEdgeInternal.displayName="SimpleBezierEdgeInternal";function createSmoothStepEdge(s){return reactExports.memo(({id:e,sourceX:o,sourceY:a,targetX:c,targetY:d,label:h,labelStyle:g,labelShowBg:b,labelBgStyle:j,labelBgPadding:$,labelBgBorderRadius:_,style:_e,sourcePosition:et=Position.Bottom,targetPosition:nt=Position.Top,markerEnd:rt,markerStart:it,pathOptions:st,interactionWidth:lt})=>{const[ot,ct,ut]=getSmoothStepPath({sourceX:o,sourceY:a,sourcePosition:et,targetX:c,targetY:d,targetPosition:nt,borderRadius:st==null?void 0:st.borderRadius,offset:st==null?void 0:st.offset,stepPosition:st==null?void 0:st.stepPosition}),at=s.isInternal?void 0:e;return jsxRuntimeExports.jsx(BaseEdge,{id:at,path:ot,labelX:ct,labelY:ut,label:h,labelStyle:g,labelShowBg:b,labelBgStyle:j,labelBgPadding:$,labelBgBorderRadius:_,style:_e,markerEnd:rt,markerStart:it,interactionWidth:lt})})}const SmoothStepEdge=createSmoothStepEdge({isInternal:!1}),SmoothStepEdgeInternal=createSmoothStepEdge({isInternal:!0});SmoothStepEdge.displayName="SmoothStepEdge";SmoothStepEdgeInternal.displayName="SmoothStepEdgeInternal";function createStepEdge(s){return reactExports.memo(({id:e,...o})=>{var c;const a=s.isInternal?void 0:e;return jsxRuntimeExports.jsx(SmoothStepEdge,{...o,id:a,pathOptions:reactExports.useMemo(()=>{var d;return{borderRadius:0,offset:(d=o.pathOptions)==null?void 0:d.offset}},[(c=o.pathOptions)==null?void 0:c.offset])})})}const StepEdge=createStepEdge({isInternal:!1}),StepEdgeInternal=createStepEdge({isInternal:!0});StepEdge.displayName="StepEdge";StepEdgeInternal.displayName="StepEdgeInternal";function createStraightEdge(s){return reactExports.memo(({id:e,sourceX:o,sourceY:a,targetX:c,targetY:d,label:h,labelStyle:g,labelShowBg:b,labelBgStyle:j,labelBgPadding:$,labelBgBorderRadius:_,style:_e,markerEnd:et,markerStart:nt,interactionWidth:rt})=>{const[it,st,lt]=getStraightPath({sourceX:o,sourceY:a,targetX:c,targetY:d}),ot=s.isInternal?void 0:e;return jsxRuntimeExports.jsx(BaseEdge,{id:ot,path:it,labelX:st,labelY:lt,label:h,labelStyle:g,labelShowBg:b,labelBgStyle:j,labelBgPadding:$,labelBgBorderRadius:_,style:_e,markerEnd:et,markerStart:nt,interactionWidth:rt})})}const StraightEdge=createStraightEdge({isInternal:!1}),StraightEdgeInternal=createStraightEdge({isInternal:!0});StraightEdge.displayName="StraightEdge";StraightEdgeInternal.displayName="StraightEdgeInternal";function createBezierEdge(s){return reactExports.memo(({id:e,sourceX:o,sourceY:a,targetX:c,targetY:d,sourcePosition:h=Position.Bottom,targetPosition:g=Position.Top,label:b,labelStyle:j,labelShowBg:$,labelBgStyle:_,labelBgPadding:_e,labelBgBorderRadius:et,style:nt,markerEnd:rt,markerStart:it,pathOptions:st,interactionWidth:lt})=>{const[ot,ct,ut]=getBezierPath({sourceX:o,sourceY:a,sourcePosition:h,targetX:c,targetY:d,targetPosition:g,curvature:st==null?void 0:st.curvature}),at=s.isInternal?void 0:e;return jsxRuntimeExports.jsx(BaseEdge,{id:at,path:ot,labelX:ct,labelY:ut,label:b,labelStyle:j,labelShowBg:$,labelBgStyle:_,labelBgPadding:_e,labelBgBorderRadius:et,style:nt,markerEnd:rt,markerStart:it,interactionWidth:lt})})}const BezierEdge=createBezierEdge({isInternal:!1}),BezierEdgeInternal=createBezierEdge({isInternal:!0});BezierEdge.displayName="BezierEdge";BezierEdgeInternal.displayName="BezierEdgeInternal";const builtinEdgeTypes={default:BezierEdgeInternal,straight:StraightEdgeInternal,step:StepEdgeInternal,smoothstep:SmoothStepEdgeInternal,simplebezier:SimpleBezierEdgeInternal},nullPosition={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},shiftX=(s,e,o)=>o===Position.Left?s-e:o===Position.Right?s+e:s,shiftY=(s,e,o)=>o===Position.Top?s-e:o===Position.Bottom?s+e:s,EdgeUpdaterClassName="react-flow__edgeupdater";function EdgeAnchor({position:s,centerX:e,centerY:o,radius:a=10,onMouseDown:c,onMouseEnter:d,onMouseOut:h,type:g}){return jsxRuntimeExports.jsx("circle",{onMouseDown:c,onMouseEnter:d,onMouseOut:h,className:cc([EdgeUpdaterClassName,`${EdgeUpdaterClassName}-${g}`]),cx:shiftX(e,a,s),cy:shiftY(o,a,s),r:a,stroke:"transparent",fill:"transparent"})}function EdgeUpdateAnchors({isReconnectable:s,reconnectRadius:e,edge:o,sourceX:a,sourceY:c,targetX:d,targetY:h,sourcePosition:g,targetPosition:b,onReconnect:j,onReconnectStart:$,onReconnectEnd:_,setReconnecting:_e,setUpdateHover:et}){const nt=useStoreApi(),rt=(ct,ut)=>{if(ct.button!==0)return;const{autoPanOnConnect:at,domNode:dt,isValidConnection:ft,connectionMode:xt,connectionRadius:Ct,lib:yt,onConnectStart:Et,onConnectEnd:Tt,cancelConnection:ht,nodeLookup:wt,rfId:St,panBy:bt,updateConnection:mt}=nt.getState(),gt=ut.type==="target",pt=(At,Mt)=>{_e(!1),_==null||_(At,o,ut.type,Mt)},kt=At=>j==null?void 0:j(o,At),Rt=(At,Mt)=>{_e(!0),$==null||$(ct,o,ut.type),Et==null||Et(At,Mt)};XYHandle.onPointerDown(ct.nativeEvent,{autoPanOnConnect:at,connectionMode:xt,connectionRadius:Ct,domNode:dt,handleId:ut.id,nodeId:ut.nodeId,nodeLookup:wt,isTarget:gt,edgeUpdaterType:ut.type,lib:yt,flowId:St,cancelConnection:ht,panBy:bt,isValidConnection:ft,onConnect:kt,onConnectStart:Rt,onConnectEnd:Tt,onReconnectEnd:pt,updateConnection:mt,getTransform:()=>nt.getState().transform,getFromHandle:()=>nt.getState().connection.fromHandle,dragThreshold:nt.getState().connectionDragThreshold,handleDomNode:ct.currentTarget})},it=ct=>rt(ct,{nodeId:o.target,id:o.targetHandle??null,type:"target"}),st=ct=>rt(ct,{nodeId:o.source,id:o.sourceHandle??null,type:"source"}),lt=()=>et(!0),ot=()=>et(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[(s===!0||s==="source")&&jsxRuntimeExports.jsx(EdgeAnchor,{position:g,centerX:a,centerY:c,radius:e,onMouseDown:it,onMouseEnter:lt,onMouseOut:ot,type:"source"}),(s===!0||s==="target")&&jsxRuntimeExports.jsx(EdgeAnchor,{position:b,centerX:d,centerY:h,radius:e,onMouseDown:st,onMouseEnter:lt,onMouseOut:ot,type:"target"})]})}function EdgeWrapper({id:s,edgesFocusable:e,edgesReconnectable:o,elementsSelectable:a,onClick:c,onDoubleClick:d,onContextMenu:h,onMouseEnter:g,onMouseMove:b,onMouseLeave:j,reconnectRadius:$,onReconnect:_,onReconnectStart:_e,onReconnectEnd:et,rfId:nt,edgeTypes:rt,noPanClassName:it,onError:st,disableKeyboardA11y:lt}){let ot=useStore(Nt=>Nt.edgeLookup.get(s));const ct=useStore(Nt=>Nt.defaultEdgeOptions);ot=ct?{...ct,...ot}:ot;let ut=ot.type||"default",at=(rt==null?void 0:rt[ut])||builtinEdgeTypes[ut];at===void 0&&(st==null||st("011",errorMessages.error011(ut)),ut="default",at=(rt==null?void 0:rt.default)||builtinEdgeTypes.default);const dt=!!(ot.focusable||e&&typeof ot.focusable>"u"),ft=typeof _<"u"&&(ot.reconnectable||o&&typeof ot.reconnectable>"u"),xt=!!(ot.selectable||a&&typeof ot.selectable>"u"),Ct=reactExports.useRef(null),[yt,Et]=reactExports.useState(!1),[Tt,ht]=reactExports.useState(!1),wt=useStoreApi(),{zIndex:St,sourceX:bt,sourceY:mt,targetX:gt,targetY:pt,sourcePosition:kt,targetPosition:Rt}=useStore(reactExports.useCallback(Nt=>{const Ot=Nt.nodeLookup.get(ot.source),Wt=Nt.nodeLookup.get(ot.target);if(!Ot||!Wt)return{zIndex:ot.zIndex,...nullPosition};const Ft=getEdgePosition({id:s,sourceNode:Ot,targetNode:Wt,sourceHandle:ot.sourceHandle||null,targetHandle:ot.targetHandle||null,connectionMode:Nt.connectionMode,onError:st});return{zIndex:getElevatedEdgeZIndex({selected:ot.selected,zIndex:ot.zIndex,sourceNode:Ot,targetNode:Wt,elevateOnSelect:Nt.elevateEdgesOnSelect,zIndexMode:Nt.zIndexMode}),...Ft||nullPosition}},[ot.source,ot.target,ot.sourceHandle,ot.targetHandle,ot.selected,ot.zIndex]),shallow$1),At=reactExports.useMemo(()=>ot.markerStart?`url('#${getMarkerId(ot.markerStart,nt)}')`:void 0,[ot.markerStart,nt]),Mt=reactExports.useMemo(()=>ot.markerEnd?`url('#${getMarkerId(ot.markerEnd,nt)}')`:void 0,[ot.markerEnd,nt]);if(ot.hidden||bt===null||mt===null||gt===null||pt===null)return null;const Dt=Nt=>{var qt;const{addSelectedEdges:Ot,unselectNodesAndEdges:Wt,multiSelectionActive:Ft}=wt.getState();xt&&(wt.setState({nodesSelectionActive:!1}),ot.selected&&Ft?(Wt({nodes:[],edges:[ot]}),(qt=Ct.current)==null||qt.blur()):Ot([s])),c&&c(Nt,ot)},$t=d?Nt=>{d(Nt,{...ot})}:void 0,_t=h?Nt=>{h(Nt,{...ot})}:void 0,Pt=g?Nt=>{g(Nt,{...ot})}:void 0,Ht=b?Nt=>{b(Nt,{...ot})}:void 0,Kt=j?Nt=>{j(Nt,{...ot})}:void 0,Ut=Nt=>{var Ot;if(!lt&&elementSelectionKeys.includes(Nt.key)&&xt){const{unselectNodesAndEdges:Wt,addSelectedEdges:Ft}=wt.getState();Nt.key==="Escape"?((Ot=Ct.current)==null||Ot.blur(),Wt({edges:[ot]})):Ft([s])}};return jsxRuntimeExports.jsx("svg",{style:{zIndex:St},children:jsxRuntimeExports.jsxs("g",{className:cc(["react-flow__edge",`react-flow__edge-${ut}`,ot.className,it,{selected:ot.selected,animated:ot.animated,inactive:!xt&&!c,updating:yt,selectable:xt}]),onClick:Dt,onDoubleClick:$t,onContextMenu:_t,onMouseEnter:Pt,onMouseMove:Ht,onMouseLeave:Kt,onKeyDown:dt?Ut:void 0,tabIndex:dt?0:void 0,role:ot.ariaRole??(dt?"group":"img"),"aria-roledescription":"edge","data-id":s,"data-testid":`rf__edge-${s}`,"aria-label":ot.ariaLabel===null?void 0:ot.ariaLabel||`Edge from ${ot.source} to ${ot.target}`,"aria-describedby":dt?`${ARIA_EDGE_DESC_KEY}-${nt}`:void 0,ref:Ct,...ot.domAttributes,children:[!Tt&&jsxRuntimeExports.jsx(at,{id:s,source:ot.source,target:ot.target,type:ot.type,selected:ot.selected,animated:ot.animated,selectable:xt,deletable:ot.deletable??!0,label:ot.label,labelStyle:ot.labelStyle,labelShowBg:ot.labelShowBg,labelBgStyle:ot.labelBgStyle,labelBgPadding:ot.labelBgPadding,labelBgBorderRadius:ot.labelBgBorderRadius,sourceX:bt,sourceY:mt,targetX:gt,targetY:pt,sourcePosition:kt,targetPosition:Rt,data:ot.data,style:ot.style,sourceHandleId:ot.sourceHandle,targetHandleId:ot.targetHandle,markerStart:At,markerEnd:Mt,pathOptions:"pathOptions"in ot?ot.pathOptions:void 0,interactionWidth:ot.interactionWidth}),ft&&jsxRuntimeExports.jsx(EdgeUpdateAnchors,{edge:ot,isReconnectable:ft,reconnectRadius:$,onReconnect:_,onReconnectStart:_e,onReconnectEnd:et,sourceX:bt,sourceY:mt,targetX:gt,targetY:pt,sourcePosition:kt,targetPosition:Rt,setUpdateHover:Et,setReconnecting:ht})]})})}var EdgeWrapper$1=reactExports.memo(EdgeWrapper);const selector$a=s=>({edgesFocusable:s.edgesFocusable,edgesReconnectable:s.edgesReconnectable,elementsSelectable:s.elementsSelectable,connectionMode:s.connectionMode,onError:s.onError});function EdgeRendererComponent({defaultMarkerColor:s,onlyRenderVisibleElements:e,rfId:o,edgeTypes:a,noPanClassName:c,onReconnect:d,onEdgeContextMenu:h,onEdgeMouseEnter:g,onEdgeMouseMove:b,onEdgeMouseLeave:j,onEdgeClick:$,reconnectRadius:_,onEdgeDoubleClick:_e,onReconnectStart:et,onReconnectEnd:nt,disableKeyboardA11y:rt}){const{edgesFocusable:it,edgesReconnectable:st,elementsSelectable:lt,onError:ot}=useStore(selector$a,shallow$1),ct=useVisibleEdgeIds(e);return jsxRuntimeExports.jsxs("div",{className:"react-flow__edges",children:[jsxRuntimeExports.jsx(MarkerDefinitions$1,{defaultColor:s,rfId:o}),ct.map(ut=>jsxRuntimeExports.jsx(EdgeWrapper$1,{id:ut,edgesFocusable:it,edgesReconnectable:st,elementsSelectable:lt,noPanClassName:c,onReconnect:d,onContextMenu:h,onMouseEnter:g,onMouseMove:b,onMouseLeave:j,onClick:$,reconnectRadius:_,onDoubleClick:_e,onReconnectStart:et,onReconnectEnd:nt,rfId:o,onError:ot,edgeTypes:a,disableKeyboardA11y:rt},ut))]})}EdgeRendererComponent.displayName="EdgeRenderer";const EdgeRenderer=reactExports.memo(EdgeRendererComponent),selector$9=s=>`translate(${s.transform[0]}px,${s.transform[1]}px) scale(${s.transform[2]})`;function Viewport$1({children:s}){const e=useStore(selector$9);return jsxRuntimeExports.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:s})}function useOnInitHandler(s){const e=useReactFlow(),o=reactExports.useRef(!1);reactExports.useEffect(()=>{!o.current&&e.viewportInitialized&&s&&(setTimeout(()=>s(e),1),o.current=!0)},[s,e.viewportInitialized])}const selector$8=s=>{var e;return(e=s.panZoom)==null?void 0:e.syncViewport};function useViewportSync(s){const e=useStore(selector$8),o=useStoreApi();return reactExports.useEffect(()=>{s&&(e==null||e(s),o.setState({transform:[s.x,s.y,s.zoom]}))},[s,e]),null}function storeSelector$1(s){return s.connection.inProgress?{...s.connection,to:pointToRendererPoint(s.connection.to,s.transform)}:{...s.connection}}function getSelector(s){return storeSelector$1}function useConnection(s){const e=getSelector();return useStore(e,shallow$1)}const selector$7=s=>({nodesConnectable:s.nodesConnectable,isValid:s.connection.isValid,inProgress:s.connection.inProgress,width:s.width,height:s.height});function ConnectionLineWrapper({containerStyle:s,style:e,type:o,component:a}){const{nodesConnectable:c,width:d,height:h,isValid:g,inProgress:b}=useStore(selector$7,shallow$1);return!(d&&c&&b)?null:jsxRuntimeExports.jsx("svg",{style:s,width:d,height:h,className:"react-flow__connectionline react-flow__container",children:jsxRuntimeExports.jsx("g",{className:cc(["react-flow__connection",getConnectionStatus(g)]),children:jsxRuntimeExports.jsx(ConnectionLine,{style:e,type:o,CustomComponent:a,isValid:g})})})}const ConnectionLine=({style:s,type:e=ConnectionLineType.Bezier,CustomComponent:o,isValid:a})=>{const{inProgress:c,from:d,fromNode:h,fromHandle:g,fromPosition:b,to:j,toNode:$,toHandle:_,toPosition:_e,pointer:et}=useConnection();if(!c)return;if(o)return jsxRuntimeExports.jsx(o,{connectionLineType:e,connectionLineStyle:s,fromNode:h,fromHandle:g,fromX:d.x,fromY:d.y,toX:j.x,toY:j.y,fromPosition:b,toPosition:_e,connectionStatus:getConnectionStatus(a),toNode:$,toHandle:_,pointer:et});let nt="";const rt={sourceX:d.x,sourceY:d.y,sourcePosition:b,targetX:j.x,targetY:j.y,targetPosition:_e};switch(e){case ConnectionLineType.Bezier:[nt]=getBezierPath(rt);break;case ConnectionLineType.SimpleBezier:[nt]=getSimpleBezierPath(rt);break;case ConnectionLineType.Step:[nt]=getSmoothStepPath({...rt,borderRadius:0});break;case ConnectionLineType.SmoothStep:[nt]=getSmoothStepPath(rt);break;default:[nt]=getStraightPath(rt)}return jsxRuntimeExports.jsx("path",{d:nt,fill:"none",className:"react-flow__connection-path",style:s})};ConnectionLine.displayName="ConnectionLine";const emptyTypes={};function useNodeOrEdgeTypesWarning(s=emptyTypes){reactExports.useRef(s),useStoreApi(),reactExports.useEffect(()=>{},[s])}function useStylesLoadedWarning(){useStoreApi(),reactExports.useRef(!1),reactExports.useEffect(()=>{},[])}function GraphViewComponent({nodeTypes:s,edgeTypes:e,onInit:o,onNodeClick:a,onEdgeClick:c,onNodeDoubleClick:d,onEdgeDoubleClick:h,onNodeMouseEnter:g,onNodeMouseMove:b,onNodeMouseLeave:j,onNodeContextMenu:$,onSelectionContextMenu:_,onSelectionStart:_e,onSelectionEnd:et,connectionLineType:nt,connectionLineStyle:rt,connectionLineComponent:it,connectionLineContainerStyle:st,selectionKeyCode:lt,selectionOnDrag:ot,selectionMode:ct,multiSelectionKeyCode:ut,panActivationKeyCode:at,zoomActivationKeyCode:dt,deleteKeyCode:ft,onlyRenderVisibleElements:xt,elementsSelectable:Ct,defaultViewport:yt,translateExtent:Et,minZoom:Tt,maxZoom:ht,preventScrolling:wt,defaultMarkerColor:St,zoomOnScroll:bt,zoomOnPinch:mt,panOnScroll:gt,panOnScrollSpeed:pt,panOnScrollMode:kt,zoomOnDoubleClick:Rt,panOnDrag:At,onPaneClick:Mt,onPaneMouseEnter:Dt,onPaneMouseMove:$t,onPaneMouseLeave:_t,onPaneScroll:Pt,onPaneContextMenu:Ht,paneClickDistance:Kt,nodeClickDistance:Ut,onEdgeContextMenu:Nt,onEdgeMouseEnter:Ot,onEdgeMouseMove:Wt,onEdgeMouseLeave:Ft,reconnectRadius:qt,onReconnect:en,onReconnectStart:on,onReconnectEnd:cn,noDragClassName:dn,noWheelClassName:mn,noPanClassName:gn,disableKeyboardA11y:En,nodeExtent:bn,rfId:jt,viewport:It,onViewportChange:Bt}){return useNodeOrEdgeTypesWarning(s),useNodeOrEdgeTypesWarning(e),useStylesLoadedWarning(),useOnInitHandler(o),useViewportSync(It),jsxRuntimeExports.jsx(FlowRenderer,{onPaneClick:Mt,onPaneMouseEnter:Dt,onPaneMouseMove:$t,onPaneMouseLeave:_t,onPaneContextMenu:Ht,onPaneScroll:Pt,paneClickDistance:Kt,deleteKeyCode:ft,selectionKeyCode:lt,selectionOnDrag:ot,selectionMode:ct,onSelectionStart:_e,onSelectionEnd:et,multiSelectionKeyCode:ut,panActivationKeyCode:at,zoomActivationKeyCode:dt,elementsSelectable:Ct,zoomOnScroll:bt,zoomOnPinch:mt,zoomOnDoubleClick:Rt,panOnScroll:gt,panOnScrollSpeed:pt,panOnScrollMode:kt,panOnDrag:At,defaultViewport:yt,translateExtent:Et,minZoom:Tt,maxZoom:ht,onSelectionContextMenu:_,preventScrolling:wt,noDragClassName:dn,noWheelClassName:mn,noPanClassName:gn,disableKeyboardA11y:En,onViewportChange:Bt,isControlledViewport:!!It,children:jsxRuntimeExports.jsxs(Viewport$1,{children:[jsxRuntimeExports.jsx(EdgeRenderer,{edgeTypes:e,onEdgeClick:c,onEdgeDoubleClick:h,onReconnect:en,onReconnectStart:on,onReconnectEnd:cn,onlyRenderVisibleElements:xt,onEdgeContextMenu:Nt,onEdgeMouseEnter:Ot,onEdgeMouseMove:Wt,onEdgeMouseLeave:Ft,reconnectRadius:qt,defaultMarkerColor:St,noPanClassName:gn,disableKeyboardA11y:En,rfId:jt}),jsxRuntimeExports.jsx(ConnectionLineWrapper,{style:rt,type:nt,component:it,containerStyle:st}),jsxRuntimeExports.jsx("div",{className:"react-flow__edgelabel-renderer"}),jsxRuntimeExports.jsx(NodeRenderer,{nodeTypes:s,onNodeClick:a,onNodeDoubleClick:d,onNodeMouseEnter:g,onNodeMouseMove:b,onNodeMouseLeave:j,onNodeContextMenu:$,nodeClickDistance:Ut,onlyRenderVisibleElements:xt,noPanClassName:gn,noDragClassName:dn,disableKeyboardA11y:En,nodeExtent:bn,rfId:jt}),jsxRuntimeExports.jsx("div",{className:"react-flow__viewport-portal"})]})})}GraphViewComponent.displayName="GraphView";const GraphView=reactExports.memo(GraphViewComponent),getInitialState=({nodes:s,edges:e,defaultNodes:o,defaultEdges:a,width:c,height:d,fitView:h,fitViewOptions:g,minZoom:b=.5,maxZoom:j=2,nodeOrigin:$,nodeExtent:_,zIndexMode:_e="basic"}={})=>{const et=new Map,nt=new Map,rt=new Map,it=new Map,st=a??e??[],lt=o??s??[],ot=$??[0,0],ct=_??infiniteExtent;updateConnectionLookup(rt,it,st);const ut=adoptUserNodes(lt,et,nt,{nodeOrigin:ot,nodeExtent:ct,zIndexMode:_e});let at=[0,0,1];if(h&&c&&d){const dt=getInternalNodesBounds(et,{filter:yt=>!!((yt.width||yt.initialWidth)&&(yt.height||yt.initialHeight))}),{x:ft,y:xt,zoom:Ct}=getViewportForBounds(dt,c,d,b,j,(g==null?void 0:g.padding)??.1);at=[ft,xt,Ct]}return{rfId:"1",width:c??0,height:d??0,transform:at,nodes:lt,nodesInitialized:ut,nodeLookup:et,parentLookup:nt,edges:st,edgeLookup:it,connectionLookup:rt,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:o!==void 0,hasDefaultEdges:a!==void 0,panZoom:null,minZoom:b,maxZoom:j,translateExtent:infiniteExtent,nodeExtent:ct,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:ConnectionMode.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:ot,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:h??!1,fitViewOptions:g,fitViewResolver:null,connection:{...initialConnection},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:devWarn,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:defaultAriaLabelConfig,zIndexMode:_e,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},createStore=({nodes:s,edges:e,defaultNodes:o,defaultEdges:a,width:c,height:d,fitView:h,fitViewOptions:g,minZoom:b,maxZoom:j,nodeOrigin:$,nodeExtent:_,zIndexMode:_e})=>createWithEqualityFn((et,nt)=>{async function rt(){const{nodeLookup:it,panZoom:st,fitViewOptions:lt,fitViewResolver:ot,width:ct,height:ut,minZoom:at,maxZoom:dt}=nt();st&&(await fitViewport({nodes:it,width:ct,height:ut,panZoom:st,minZoom:at,maxZoom:dt},lt),ot==null||ot.resolve(!0),et({fitViewResolver:null}))}return{...getInitialState({nodes:s,edges:e,width:c,height:d,fitView:h,fitViewOptions:g,minZoom:b,maxZoom:j,nodeOrigin:$,nodeExtent:_,defaultNodes:o,defaultEdges:a,zIndexMode:_e}),setNodes:it=>{const{nodeLookup:st,parentLookup:lt,nodeOrigin:ot,elevateNodesOnSelect:ct,fitViewQueued:ut,zIndexMode:at}=nt(),dt=adoptUserNodes(it,st,lt,{nodeOrigin:ot,nodeExtent:_,elevateNodesOnSelect:ct,checkEquality:!0,zIndexMode:at});ut&&dt?(rt(),et({nodes:it,nodesInitialized:dt,fitViewQueued:!1,fitViewOptions:void 0})):et({nodes:it,nodesInitialized:dt})},setEdges:it=>{const{connectionLookup:st,edgeLookup:lt}=nt();updateConnectionLookup(st,lt,it),et({edges:it})},setDefaultNodesAndEdges:(it,st)=>{if(it){const{setNodes:lt}=nt();lt(it),et({hasDefaultNodes:!0})}if(st){const{setEdges:lt}=nt();lt(st),et({hasDefaultEdges:!0})}},updateNodeInternals:it=>{const{triggerNodeChanges:st,nodeLookup:lt,parentLookup:ot,domNode:ct,nodeOrigin:ut,nodeExtent:at,debug:dt,fitViewQueued:ft,zIndexMode:xt}=nt(),{changes:Ct,updatedInternals:yt}=updateNodeInternals(it,lt,ot,ct,ut,at,xt);yt&&(updateAbsolutePositions(lt,ot,{nodeOrigin:ut,nodeExtent:at,zIndexMode:xt}),ft?(rt(),et({fitViewQueued:!1,fitViewOptions:void 0})):et({}),(Ct==null?void 0:Ct.length)>0&&(dt&&console.log("React Flow: trigger node changes",Ct),st==null||st(Ct)))},updateNodePositions:(it,st=!1)=>{const lt=[];let ot=[];const{nodeLookup:ct,triggerNodeChanges:ut,connection:at,updateConnection:dt,onNodesChangeMiddlewareMap:ft}=nt();for(const[xt,Ct]of it){const yt=ct.get(xt),Et=!!(yt!=null&&yt.expandParent&&(yt!=null&&yt.parentId)&&(Ct!=null&&Ct.position)),Tt={id:xt,type:"position",position:Et?{x:Math.max(0,Ct.position.x),y:Math.max(0,Ct.position.y)}:Ct.position,dragging:st};if(yt&&at.inProgress&&at.fromNode.id===yt.id){const ht=getHandlePosition(yt,at.fromHandle,Position.Left,!0);dt({...at,from:ht})}Et&&yt.parentId&&lt.push({id:xt,parentId:yt.parentId,rect:{...Ct.internals.positionAbsolute,width:Ct.measured.width??0,height:Ct.measured.height??0}}),ot.push(Tt)}if(lt.length>0){const{parentLookup:xt,nodeOrigin:Ct}=nt(),yt=handleExpandParent(lt,ct,xt,Ct);ot.push(...yt)}for(const xt of ft.values())ot=xt(ot);ut(ot)},triggerNodeChanges:it=>{const{onNodesChange:st,setNodes:lt,nodes:ot,hasDefaultNodes:ct,debug:ut}=nt();if(it!=null&&it.length){if(ct){const at=applyNodeChanges(it,ot);lt(at)}ut&&console.log("React Flow: trigger node changes",it),st==null||st(it)}},triggerEdgeChanges:it=>{const{onEdgesChange:st,setEdges:lt,edges:ot,hasDefaultEdges:ct,debug:ut}=nt();if(it!=null&&it.length){if(ct){const at=applyEdgeChanges(it,ot);lt(at)}ut&&console.log("React Flow: trigger edge changes",it),st==null||st(it)}},addSelectedNodes:it=>{const{multiSelectionActive:st,edgeLookup:lt,nodeLookup:ot,triggerNodeChanges:ct,triggerEdgeChanges:ut}=nt();if(st){const at=it.map(dt=>createSelectionChange(dt,!0));ct(at);return}ct(getSelectionChanges(ot,new Set([...it]),!0)),ut(getSelectionChanges(lt))},addSelectedEdges:it=>{const{multiSelectionActive:st,edgeLookup:lt,nodeLookup:ot,triggerNodeChanges:ct,triggerEdgeChanges:ut}=nt();if(st){const at=it.map(dt=>createSelectionChange(dt,!0));ut(at);return}ut(getSelectionChanges(lt,new Set([...it]))),ct(getSelectionChanges(ot,new Set,!0))},unselectNodesAndEdges:({nodes:it,edges:st}={})=>{const{edges:lt,nodes:ot,nodeLookup:ct,triggerNodeChanges:ut,triggerEdgeChanges:at}=nt(),dt=it||ot,ft=st||lt,xt=dt.map(yt=>{const Et=ct.get(yt.id);return Et&&(Et.selected=!1),createSelectionChange(yt.id,!1)}),Ct=ft.map(yt=>createSelectionChange(yt.id,!1));ut(xt),at(Ct)},setMinZoom:it=>{const{panZoom:st,maxZoom:lt}=nt();st==null||st.setScaleExtent([it,lt]),et({minZoom:it})},setMaxZoom:it=>{const{panZoom:st,minZoom:lt}=nt();st==null||st.setScaleExtent([lt,it]),et({maxZoom:it})},setTranslateExtent:it=>{var st;(st=nt().panZoom)==null||st.setTranslateExtent(it),et({translateExtent:it})},resetSelectedElements:()=>{const{edges:it,nodes:st,triggerNodeChanges:lt,triggerEdgeChanges:ot,elementsSelectable:ct}=nt();if(!ct)return;const ut=st.reduce((dt,ft)=>ft.selected?[...dt,createSelectionChange(ft.id,!1)]:dt,[]),at=it.reduce((dt,ft)=>ft.selected?[...dt,createSelectionChange(ft.id,!1)]:dt,[]);lt(ut),ot(at)},setNodeExtent:it=>{const{nodes:st,nodeLookup:lt,parentLookup:ot,nodeOrigin:ct,elevateNodesOnSelect:ut,nodeExtent:at,zIndexMode:dt}=nt();it[0][0]===at[0][0]&&it[0][1]===at[0][1]&&it[1][0]===at[1][0]&&it[1][1]===at[1][1]||(adoptUserNodes(st,lt,ot,{nodeOrigin:ct,nodeExtent:it,elevateNodesOnSelect:ut,checkEquality:!1,zIndexMode:dt}),et({nodeExtent:it}))},panBy:it=>{const{transform:st,width:lt,height:ot,panZoom:ct,translateExtent:ut}=nt();return panBy({delta:it,panZoom:ct,transform:st,translateExtent:ut,width:lt,height:ot})},setCenter:async(it,st,lt)=>{const{width:ot,height:ct,maxZoom:ut,panZoom:at}=nt();if(!at)return Promise.resolve(!1);const dt=typeof(lt==null?void 0:lt.zoom)<"u"?lt.zoom:ut;return await at.setViewport({x:ot/2-it*dt,y:ct/2-st*dt,zoom:dt},{duration:lt==null?void 0:lt.duration,ease:lt==null?void 0:lt.ease,interpolate:lt==null?void 0:lt.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{et({connection:{...initialConnection}})},updateConnection:it=>{et({connection:it})},reset:()=>et({...getInitialState()})}},Object.is);function ReactFlowProvider({initialNodes:s,initialEdges:e,defaultNodes:o,defaultEdges:a,initialWidth:c,initialHeight:d,initialMinZoom:h,initialMaxZoom:g,initialFitViewOptions:b,fitView:j,nodeOrigin:$,nodeExtent:_,zIndexMode:_e,children:et}){const[nt]=reactExports.useState(()=>createStore({nodes:s,edges:e,defaultNodes:o,defaultEdges:a,width:c,height:d,fitView:j,minZoom:h,maxZoom:g,fitViewOptions:b,nodeOrigin:$,nodeExtent:_,zIndexMode:_e}));return jsxRuntimeExports.jsx(Provider$1,{value:nt,children:jsxRuntimeExports.jsx(BatchProvider,{children:et})})}function Wrapper({children:s,nodes:e,edges:o,defaultNodes:a,defaultEdges:c,width:d,height:h,fitView:g,fitViewOptions:b,minZoom:j,maxZoom:$,nodeOrigin:_,nodeExtent:_e,zIndexMode:et}){return reactExports.useContext(StoreContext)?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s}):jsxRuntimeExports.jsx(ReactFlowProvider,{initialNodes:e,initialEdges:o,defaultNodes:a,defaultEdges:c,initialWidth:d,initialHeight:h,fitView:g,initialFitViewOptions:b,initialMinZoom:j,initialMaxZoom:$,nodeOrigin:_,nodeExtent:_e,zIndexMode:et,children:s})}const wrapperStyle={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function ReactFlow({nodes:s,edges:e,defaultNodes:o,defaultEdges:a,className:c,nodeTypes:d,edgeTypes:h,onNodeClick:g,onEdgeClick:b,onInit:j,onMove:$,onMoveStart:_,onMoveEnd:_e,onConnect:et,onConnectStart:nt,onConnectEnd:rt,onClickConnectStart:it,onClickConnectEnd:st,onNodeMouseEnter:lt,onNodeMouseMove:ot,onNodeMouseLeave:ct,onNodeContextMenu:ut,onNodeDoubleClick:at,onNodeDragStart:dt,onNodeDrag:ft,onNodeDragStop:xt,onNodesDelete:Ct,onEdgesDelete:yt,onDelete:Et,onSelectionChange:Tt,onSelectionDragStart:ht,onSelectionDrag:wt,onSelectionDragStop:St,onSelectionContextMenu:bt,onSelectionStart:mt,onSelectionEnd:gt,onBeforeDelete:pt,connectionMode:kt,connectionLineType:Rt=ConnectionLineType.Bezier,connectionLineStyle:At,connectionLineComponent:Mt,connectionLineContainerStyle:Dt,deleteKeyCode:$t="Backspace",selectionKeyCode:_t="Shift",selectionOnDrag:Pt=!1,selectionMode:Ht=SelectionMode.Full,panActivationKeyCode:Kt="Space",multiSelectionKeyCode:Ut=isMacOs()?"Meta":"Control",zoomActivationKeyCode:Nt=isMacOs()?"Meta":"Control",snapToGrid:Ot,snapGrid:Wt,onlyRenderVisibleElements:Ft=!1,selectNodesOnDrag:qt,nodesDraggable:en,autoPanOnNodeFocus:on,nodesConnectable:cn,nodesFocusable:dn,nodeOrigin:mn=defaultNodeOrigin,edgesFocusable:gn,edgesReconnectable:En,elementsSelectable:bn=!0,defaultViewport:jt=defaultViewport,minZoom:It=.5,maxZoom:Bt=2,translateExtent:Yt=infiniteExtent,preventScrolling:Qt=!0,nodeExtent:Xt,defaultMarkerColor:hn="#b1b1b7",zoomOnScroll:vn=!0,zoomOnPinch:kn=!0,panOnScroll:Gt=!1,panOnScrollSpeed:Jt=.5,panOnScrollMode:tn=PanOnScrollMode.Free,zoomOnDoubleClick:ln=!0,panOnDrag:fn=!0,onPaneClick:Nn,onPaneMouseEnter:wn,onPaneMouseMove:xn,onPaneMouseLeave:An,onPaneScroll:Cn,onPaneContextMenu:Jn,paneClickDistance:Qn=1,nodeClickDistance:rn=0,children:Mn,onReconnect:Zn,onReconnectStart:Hn,onReconnectEnd:Dn,onEdgeContextMenu:zn,onEdgeDoubleClick:Vn,onEdgeMouseEnter:er,onEdgeMouseMove:pn,onEdgeMouseLeave:Rn,reconnectRadius:Wn=10,onNodesChange:Un,onEdgesChange:On,noDragClassName:Kn="nodrag",noWheelClassName:yn="nowheel",noPanClassName:Pn="nopan",fitView:In,fitViewOptions:Ln,connectOnClick:Gn,attributionPosition:nr,proOptions:Vt,defaultEdgeOptions:vt,elevateNodesOnSelect:Lt=!0,elevateEdgesOnSelect:zt=!1,disableKeyboardA11y:Zt=!1,autoPanOnConnect:an,autoPanOnNodeDrag:nn,autoPanSpeed:un,connectionRadius:Sn,isValidConnection:jn,onError:$n,style:sn,id:_n,nodeDragThreshold:qn,connectionDragThreshold:gr,viewport:xr,onViewportChange:yr,width:Sr,height:Er,colorMode:br="light",debug:wr,onScroll:Yn,ariaLabelConfig:vr,zIndexMode:lr="basic",...kr},Cr){const rr=_n||"1",Rr=useColorModeClass(br),Tr=reactExports.useCallback(ar=>{ar.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Yn==null||Yn(ar)},[Yn]);return jsxRuntimeExports.jsx("div",{"data-testid":"rf__wrapper",...kr,onScroll:Tr,style:{...sn,...wrapperStyle},ref:Cr,className:cc(["react-flow",c,Rr]),id:_n,role:"application",children:jsxRuntimeExports.jsxs(Wrapper,{nodes:s,edges:e,width:Sr,height:Er,fitView:In,fitViewOptions:Ln,minZoom:It,maxZoom:Bt,nodeOrigin:mn,nodeExtent:Xt,zIndexMode:lr,children:[jsxRuntimeExports.jsx(GraphView,{onInit:j,onNodeClick:g,onEdgeClick:b,onNodeMouseEnter:lt,onNodeMouseMove:ot,onNodeMouseLeave:ct,onNodeContextMenu:ut,onNodeDoubleClick:at,nodeTypes:d,edgeTypes:h,connectionLineType:Rt,connectionLineStyle:At,connectionLineComponent:Mt,connectionLineContainerStyle:Dt,selectionKeyCode:_t,selectionOnDrag:Pt,selectionMode:Ht,deleteKeyCode:$t,multiSelectionKeyCode:Ut,panActivationKeyCode:Kt,zoomActivationKeyCode:Nt,onlyRenderVisibleElements:Ft,defaultViewport:jt,translateExtent:Yt,minZoom:It,maxZoom:Bt,preventScrolling:Qt,zoomOnScroll:vn,zoomOnPinch:kn,zoomOnDoubleClick:ln,panOnScroll:Gt,panOnScrollSpeed:Jt,panOnScrollMode:tn,panOnDrag:fn,onPaneClick:Nn,onPaneMouseEnter:wn,onPaneMouseMove:xn,onPaneMouseLeave:An,onPaneScroll:Cn,onPaneContextMenu:Jn,paneClickDistance:Qn,nodeClickDistance:rn,onSelectionContextMenu:bt,onSelectionStart:mt,onSelectionEnd:gt,onReconnect:Zn,onReconnectStart:Hn,onReconnectEnd:Dn,onEdgeContextMenu:zn,onEdgeDoubleClick:Vn,onEdgeMouseEnter:er,onEdgeMouseMove:pn,onEdgeMouseLeave:Rn,reconnectRadius:Wn,defaultMarkerColor:hn,noDragClassName:Kn,noWheelClassName:yn,noPanClassName:Pn,rfId:rr,disableKeyboardA11y:Zt,nodeExtent:Xt,viewport:xr,onViewportChange:yr}),jsxRuntimeExports.jsx(StoreUpdater,{nodes:s,edges:e,defaultNodes:o,defaultEdges:a,onConnect:et,onConnectStart:nt,onConnectEnd:rt,onClickConnectStart:it,onClickConnectEnd:st,nodesDraggable:en,autoPanOnNodeFocus:on,nodesConnectable:cn,nodesFocusable:dn,edgesFocusable:gn,edgesReconnectable:En,elementsSelectable:bn,elevateNodesOnSelect:Lt,elevateEdgesOnSelect:zt,minZoom:It,maxZoom:Bt,nodeExtent:Xt,onNodesChange:Un,onEdgesChange:On,snapToGrid:Ot,snapGrid:Wt,connectionMode:kt,translateExtent:Yt,connectOnClick:Gn,defaultEdgeOptions:vt,fitView:In,fitViewOptions:Ln,onNodesDelete:Ct,onEdgesDelete:yt,onDelete:Et,onNodeDragStart:dt,onNodeDrag:ft,onNodeDragStop:xt,onSelectionDrag:wt,onSelectionDragStart:ht,onSelectionDragStop:St,onMove:$,onMoveStart:_,onMoveEnd:_e,noPanClassName:Pn,nodeOrigin:mn,rfId:rr,autoPanOnConnect:an,autoPanOnNodeDrag:nn,autoPanSpeed:un,onError:$n,connectionRadius:Sn,isValidConnection:jn,selectNodesOnDrag:qt,nodeDragThreshold:qn,connectionDragThreshold:gr,onBeforeDelete:pt,debug:wr,ariaLabelConfig:vr,zIndexMode:lr}),jsxRuntimeExports.jsx(SelectionListener,{onSelectionChange:Tt}),Mn,jsxRuntimeExports.jsx(Attribution,{proOptions:Vt,position:nr}),jsxRuntimeExports.jsx(A11yDescriptions,{rfId:rr,disableKeyboardA11y:Zt})]})})}var index=fixedForwardRef(ReactFlow);function useNodesState(s){const[e,o]=reactExports.useState(s),a=reactExports.useCallback(c=>o(d=>applyNodeChanges(c,d)),[]);return[e,o,a]}function useEdgesState(s){const[e,o]=reactExports.useState(s),a=reactExports.useCallback(c=>o(d=>applyEdgeChanges(c,d)),[]);return[e,o,a]}function LinePattern({dimensions:s,lineWidth:e,variant:o,className:a}){return jsxRuntimeExports.jsx("path",{strokeWidth:e,d:`M${s[0]/2} 0 V${s[1]} M0 ${s[1]/2} H${s[0]}`,className:cc(["react-flow__background-pattern",o,a])})}function DotPattern({radius:s,className:e}){return jsxRuntimeExports.jsx("circle",{cx:s,cy:s,r:s,className:cc(["react-flow__background-pattern","dots",e])})}var BackgroundVariant;(function(s){s.Lines="lines",s.Dots="dots",s.Cross="cross"})(BackgroundVariant||(BackgroundVariant={}));const defaultSize={[BackgroundVariant.Dots]:1,[BackgroundVariant.Lines]:1,[BackgroundVariant.Cross]:6},selector$3=s=>({transform:s.transform,patternId:`pattern-${s.rfId}`});function BackgroundComponent({id:s,variant:e=BackgroundVariant.Dots,gap:o=20,size:a,lineWidth:c=1,offset:d=0,color:h,bgColor:g,style:b,className:j,patternClassName:$}){const _=reactExports.useRef(null),{transform:_e,patternId:et}=useStore(selector$3,shallow$1),nt=a||defaultSize[e],rt=e===BackgroundVariant.Dots,it=e===BackgroundVariant.Cross,st=Array.isArray(o)?o:[o,o],lt=[st[0]*_e[2]||1,st[1]*_e[2]||1],ot=nt*_e[2],ct=Array.isArray(d)?d:[d,d],ut=it?[ot,ot]:lt,at=[ct[0]*_e[2]||1+ut[0]/2,ct[1]*_e[2]||1+ut[1]/2],dt=`${et}${s||""}`;return jsxRuntimeExports.jsxs("svg",{className:cc(["react-flow__background",j]),style:{...b,...containerStyle,"--xy-background-color-props":g,"--xy-background-pattern-color-props":h},ref:_,"data-testid":"rf__background",children:[jsxRuntimeExports.jsx("pattern",{id:dt,x:_e[0]%lt[0],y:_e[1]%lt[1],width:lt[0],height:lt[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${at[0]},-${at[1]})`,children:rt?jsxRuntimeExports.jsx(DotPattern,{radius:ot/2,className:$}):jsxRuntimeExports.jsx(LinePattern,{dimensions:ut,lineWidth:c,variant:e,className:$})}),jsxRuntimeExports.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${dt})`})]})}BackgroundComponent.displayName="Background";const Background=reactExports.memo(BackgroundComponent);function PlusIcon(){return jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:jsxRuntimeExports.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function MinusIcon(){return jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:jsxRuntimeExports.jsx("path",{d:"M0 0h32v4.2H0z"})})}function FitViewIcon(){return jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:jsxRuntimeExports.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function LockIcon(){return jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:jsxRuntimeExports.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function UnlockIcon(){return jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:jsxRuntimeExports.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function ControlButton({children:s,className:e,...o}){return jsxRuntimeExports.jsx("button",{type:"button",className:cc(["react-flow__controls-button",e]),...o,children:s})}const selector$2=s=>({isInteractive:s.nodesDraggable||s.nodesConnectable||s.elementsSelectable,minZoomReached:s.transform[2]<=s.minZoom,maxZoomReached:s.transform[2]>=s.maxZoom,ariaLabelConfig:s.ariaLabelConfig});function ControlsComponent({style:s,showZoom:e=!0,showFitView:o=!0,showInteractive:a=!0,fitViewOptions:c,onZoomIn:d,onZoomOut:h,onFitView:g,onInteractiveChange:b,className:j,children:$,position:_="bottom-left",orientation:_e="vertical","aria-label":et}){const nt=useStoreApi(),{isInteractive:rt,minZoomReached:it,maxZoomReached:st,ariaLabelConfig:lt}=useStore(selector$2,shallow$1),{zoomIn:ot,zoomOut:ct,fitView:ut}=useReactFlow(),at=()=>{ot(),d==null||d()},dt=()=>{ct(),h==null||h()},ft=()=>{ut(c),g==null||g()},xt=()=>{nt.setState({nodesDraggable:!rt,nodesConnectable:!rt,elementsSelectable:!rt}),b==null||b(!rt)},Ct=_e==="horizontal"?"horizontal":"vertical";return jsxRuntimeExports.jsxs(Panel,{className:cc(["react-flow__controls",Ct,j]),position:_,style:s,"data-testid":"rf__controls","aria-label":et??lt["controls.ariaLabel"],children:[e&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ControlButton,{onClick:at,className:"react-flow__controls-zoomin",title:lt["controls.zoomIn.ariaLabel"],"aria-label":lt["controls.zoomIn.ariaLabel"],disabled:st,children:jsxRuntimeExports.jsx(PlusIcon,{})}),jsxRuntimeExports.jsx(ControlButton,{onClick:dt,className:"react-flow__controls-zoomout",title:lt["controls.zoomOut.ariaLabel"],"aria-label":lt["controls.zoomOut.ariaLabel"],disabled:it,children:jsxRuntimeExports.jsx(MinusIcon,{})})]}),o&&jsxRuntimeExports.jsx(ControlButton,{className:"react-flow__controls-fitview",onClick:ft,title:lt["controls.fitView.ariaLabel"],"aria-label":lt["controls.fitView.ariaLabel"],children:jsxRuntimeExports.jsx(FitViewIcon,{})}),a&&jsxRuntimeExports.jsx(ControlButton,{className:"react-flow__controls-interactive",onClick:xt,title:lt["controls.interactive.ariaLabel"],"aria-label":lt["controls.interactive.ariaLabel"],children:rt?jsxRuntimeExports.jsx(UnlockIcon,{}):jsxRuntimeExports.jsx(LockIcon,{})}),$]})}ControlsComponent.displayName="Controls";const Controls=reactExports.memo(ControlsComponent);function MiniMapNodeComponent({id:s,x:e,y:o,width:a,height:c,style:d,color:h,strokeColor:g,strokeWidth:b,className:j,borderRadius:$,shapeRendering:_,selected:_e,onClick:et}){const{background:nt,backgroundColor:rt}=d||{},it=h||nt||rt;return jsxRuntimeExports.jsx("rect",{className:cc(["react-flow__minimap-node",{selected:_e},j]),x:e,y:o,rx:$,ry:$,width:a,height:c,style:{fill:it,stroke:g,strokeWidth:b},shapeRendering:_,onClick:et?st=>et(st,s):void 0})}const MiniMapNode=reactExports.memo(MiniMapNodeComponent),selectorNodeIds=s=>s.nodes.map(e=>e.id),getAttrFunction=s=>s instanceof Function?s:()=>s;function MiniMapNodes({nodeStrokeColor:s,nodeColor:e,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:c,nodeComponent:d=MiniMapNode,onClick:h}){const g=useStore(selectorNodeIds,shallow$1),b=getAttrFunction(e),j=getAttrFunction(s),$=getAttrFunction(o),_=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:g.map(_e=>jsxRuntimeExports.jsx(NodeComponentWrapper,{id:_e,nodeColorFunc:b,nodeStrokeColorFunc:j,nodeClassNameFunc:$,nodeBorderRadius:a,nodeStrokeWidth:c,NodeComponent:d,onClick:h,shapeRendering:_},_e))})}function NodeComponentWrapperInner({id:s,nodeColorFunc:e,nodeStrokeColorFunc:o,nodeClassNameFunc:a,nodeBorderRadius:c,nodeStrokeWidth:d,shapeRendering:h,NodeComponent:g,onClick:b}){const{node:j,x:$,y:_,width:_e,height:et}=useStore(nt=>{const{internals:rt}=nt.nodeLookup.get(s),it=rt.userNode,{x:st,y:lt}=rt.positionAbsolute,{width:ot,height:ct}=getNodeDimensions(it);return{node:it,x:st,y:lt,width:ot,height:ct}},shallow$1);return!j||j.hidden||!nodeHasDimensions(j)?null:jsxRuntimeExports.jsx(g,{x:$,y:_,width:_e,height:et,style:j.style,selected:!!j.selected,className:a(j),color:e(j),borderRadius:c,strokeColor:o(j),strokeWidth:d,shapeRendering:h,onClick:b,id:j.id})}const NodeComponentWrapper=reactExports.memo(NodeComponentWrapperInner);var MiniMapNodes$1=reactExports.memo(MiniMapNodes);const defaultWidth=200,defaultHeight=150,filterHidden=s=>!s.hidden,selector$1=s=>{const e={x:-s.transform[0]/s.transform[2],y:-s.transform[1]/s.transform[2],width:s.width/s.transform[2],height:s.height/s.transform[2]};return{viewBB:e,boundingRect:s.nodeLookup.size>0?getBoundsOfRects(getInternalNodesBounds(s.nodeLookup,{filter:filterHidden}),e):e,rfId:s.rfId,panZoom:s.panZoom,translateExtent:s.translateExtent,flowWidth:s.width,flowHeight:s.height,ariaLabelConfig:s.ariaLabelConfig}},ARIA_LABEL_KEY="react-flow__minimap-desc";function MiniMapComponent({style:s,className:e,nodeStrokeColor:o,nodeColor:a,nodeClassName:c="",nodeBorderRadius:d=5,nodeStrokeWidth:h,nodeComponent:g,bgColor:b,maskColor:j,maskStrokeColor:$,maskStrokeWidth:_,position:_e="bottom-right",onClick:et,onNodeClick:nt,pannable:rt=!1,zoomable:it=!1,ariaLabel:st,inversePan:lt,zoomStep:ot=1,offsetScale:ct=5}){const ut=useStoreApi(),at=reactExports.useRef(null),{boundingRect:dt,viewBB:ft,rfId:xt,panZoom:Ct,translateExtent:yt,flowWidth:Et,flowHeight:Tt,ariaLabelConfig:ht}=useStore(selector$1,shallow$1),wt=(s==null?void 0:s.width)??defaultWidth,St=(s==null?void 0:s.height)??defaultHeight,bt=dt.width/wt,mt=dt.height/St,gt=Math.max(bt,mt),pt=gt*wt,kt=gt*St,Rt=ct*gt,At=dt.x-(pt-dt.width)/2-Rt,Mt=dt.y-(kt-dt.height)/2-Rt,Dt=pt+Rt*2,$t=kt+Rt*2,_t=`${ARIA_LABEL_KEY}-${xt}`,Pt=reactExports.useRef(0),Ht=reactExports.useRef();Pt.current=gt,reactExports.useEffect(()=>{if(at.current&&Ct)return Ht.current=XYMinimap({domNode:at.current,panZoom:Ct,getTransform:()=>ut.getState().transform,getViewScale:()=>Pt.current}),()=>{var Ot;(Ot=Ht.current)==null||Ot.destroy()}},[Ct]),reactExports.useEffect(()=>{var Ot;(Ot=Ht.current)==null||Ot.update({translateExtent:yt,width:Et,height:Tt,inversePan:lt,pannable:rt,zoomStep:ot,zoomable:it})},[rt,it,lt,ot,yt,Et,Tt]);const Kt=et?Ot=>{var qt;const[Wt,Ft]=((qt=Ht.current)==null?void 0:qt.pointer(Ot))||[0,0];et(Ot,{x:Wt,y:Ft})}:void 0,Ut=nt?reactExports.useCallback((Ot,Wt)=>{const Ft=ut.getState().nodeLookup.get(Wt).internals.userNode;nt(Ot,Ft)},[]):void 0,Nt=st??ht["minimap.ariaLabel"];return jsxRuntimeExports.jsx(Panel,{position:_e,style:{...s,"--xy-minimap-background-color-props":typeof b=="string"?b:void 0,"--xy-minimap-mask-background-color-props":typeof j=="string"?j:void 0,"--xy-minimap-mask-stroke-color-props":typeof $=="string"?$:void 0,"--xy-minimap-mask-stroke-width-props":typeof _=="number"?_*gt:void 0,"--xy-minimap-node-background-color-props":typeof a=="string"?a:void 0,"--xy-minimap-node-stroke-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-width-props":typeof h=="number"?h:void 0},className:cc(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:jsxRuntimeExports.jsxs("svg",{width:wt,height:St,viewBox:`${At} ${Mt} ${Dt} ${$t}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":_t,ref:at,onClick:Kt,children:[Nt&&jsxRuntimeExports.jsx("title",{id:_t,children:Nt}),jsxRuntimeExports.jsx(MiniMapNodes$1,{onClick:Ut,nodeColor:a,nodeStrokeColor:o,nodeBorderRadius:d,nodeClassName:c,nodeStrokeWidth:h,nodeComponent:g}),jsxRuntimeExports.jsx("path",{className:"react-flow__minimap-mask",d:`M${At-Rt},${Mt-Rt}h${Dt+Rt*2}v${$t+Rt*2}h${-Dt-Rt*2}z
        M${ft.x},${ft.y}h${ft.width}v${ft.height}h${-ft.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}MiniMapComponent.displayName="MiniMap";const MiniMap=reactExports.memo(MiniMapComponent),scaleSelector=s=>e=>s?`${Math.max(1/e.transform[2],1)}`:void 0,defaultPositions={[ResizeControlVariant.Line]:"right",[ResizeControlVariant.Handle]:"bottom-right"};function ResizeControl({nodeId:s,position:e,variant:o=ResizeControlVariant.Handle,className:a,style:c=void 0,children:d,color:h,minWidth:g=10,minHeight:b=10,maxWidth:j=Number.MAX_VALUE,maxHeight:$=Number.MAX_VALUE,keepAspectRatio:_=!1,resizeDirection:_e,autoScale:et=!0,shouldResize:nt,onResizeStart:rt,onResize:it,onResizeEnd:st}){const lt=useNodeId(),ot=typeof s=="string"?s:lt,ct=useStoreApi(),ut=reactExports.useRef(null),at=o===ResizeControlVariant.Handle,dt=useStore(reactExports.useCallback(scaleSelector(at&&et),[at,et]),shallow$1),ft=reactExports.useRef(null),xt=e??defaultPositions[o];reactExports.useEffect(()=>{if(!(!ut.current||!ot))return ft.current||(ft.current=XYResizer({domNode:ut.current,nodeId:ot,getStoreItems:()=>{const{nodeLookup:yt,transform:Et,snapGrid:Tt,snapToGrid:ht,nodeOrigin:wt,domNode:St}=ct.getState();return{nodeLookup:yt,transform:Et,snapGrid:Tt,snapToGrid:ht,nodeOrigin:wt,paneDomNode:St}},onChange:(yt,Et)=>{const{triggerNodeChanges:Tt,nodeLookup:ht,parentLookup:wt,nodeOrigin:St}=ct.getState(),bt=[],mt={x:yt.x,y:yt.y},gt=ht.get(ot);if(gt&&gt.expandParent&&gt.parentId){const pt=gt.origin??St,kt=yt.width??gt.measured.width??0,Rt=yt.height??gt.measured.height??0,At={id:gt.id,parentId:gt.parentId,rect:{width:kt,height:Rt,...evaluateAbsolutePosition({x:yt.x??gt.position.x,y:yt.y??gt.position.y},{width:kt,height:Rt},gt.parentId,ht,pt)}},Mt=handleExpandParent([At],ht,wt,St);bt.push(...Mt),mt.x=yt.x?Math.max(pt[0]*kt,yt.x):void 0,mt.y=yt.y?Math.max(pt[1]*Rt,yt.y):void 0}if(mt.x!==void 0&&mt.y!==void 0){const pt={id:ot,type:"position",position:{...mt}};bt.push(pt)}if(yt.width!==void 0&&yt.height!==void 0){const kt={id:ot,type:"dimensions",resizing:!0,setAttributes:_e?_e==="horizontal"?"width":"height":!0,dimensions:{width:yt.width,height:yt.height}};bt.push(kt)}for(const pt of Et){const kt={...pt,type:"position"};bt.push(kt)}Tt(bt)},onEnd:({width:yt,height:Et})=>{const Tt={id:ot,type:"dimensions",resizing:!1,dimensions:{width:yt,height:Et}};ct.getState().triggerNodeChanges([Tt])}})),ft.current.update({controlPosition:xt,boundaries:{minWidth:g,minHeight:b,maxWidth:j,maxHeight:$},keepAspectRatio:_,resizeDirection:_e,onResizeStart:rt,onResize:it,onResizeEnd:st,shouldResize:nt}),()=>{var yt;(yt=ft.current)==null||yt.destroy()}},[xt,g,b,j,$,_,rt,it,st,nt]);const Ct=xt.split("-");return jsxRuntimeExports.jsx("div",{className:cc(["react-flow__resize-control","nodrag",...Ct,o,a]),ref:ut,style:{...c,scale:dt,...h&&{[at?"backgroundColor":"borderColor"]:h}},children:d})}reactExports.memo(ResizeControl);const BranchNode=reactExports.memo(({data:s,selected:e})=>{const o=s,a=o.passage,c=o.isCurrentPassage||!1,{branchData:d}=parseBranchData(a.content||""),h=(d==null?void 0:d.choices)||[],g=a.passage_type==="start",b=c?"#7C3AED":g?"#059669":"#D97706",j=g?"linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%)":"linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)",$=c?"0 0 0 3px rgba(124, 58, 237, 0.3), 0 8px 24px rgba(124, 58, 237, 0.25)":e?"0 0 0 2px rgba(99, 102, 241, 0.5), 0 8px 20px rgba(0, 0, 0, 0.15)":"0 4px 12px rgba(0, 0, 0, 0.08)";return jsxRuntimeExports.jsxs("div",{className:`
        relative min-w-[200px] max-w-[280px]
        transition-all duration-200 ease-out
        ${e?"scale-[1.02]":"hover:scale-[1.01]"}
      `,style:{background:j,border:`2px solid ${b}`,borderRadius:"12px",padding:"12px",boxShadow:$,cursor:"pointer"},children:[jsxRuntimeExports.jsx(Handle,{type:"target",position:Position.Top,className:`
          !w-4 !h-4 !-top-2
          ${g?"!bg-emerald-500":"!bg-amber-500"}
          !border-2 !border-white
          !shadow-md
          transition-transform hover:scale-125
        `}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:`
          p-1.5 rounded-lg
          ${g?"bg-emerald-500/20":"bg-amber-500/20"}
        `,children:g?jsxRuntimeExports.jsx(Play,{className:"w-4 h-4 text-emerald-700"}):jsxRuntimeExports.jsx(GitFork,{className:"w-4 h-4 text-amber-700"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-800 text-sm block truncate",children:o.label}),jsxRuntimeExports.jsx("span",{className:`
            text-[10px] font-medium uppercase tracking-wide
            ${g?"text-emerald-600":"text-amber-600"}
          `,children:g?"":""})]}),g&&jsxRuntimeExports.jsx(Flag,{className:"w-4 h-4 text-emerald-600 flex-shrink-0"})]}),h.length>0?jsxRuntimeExports.jsx("div",{className:`
          space-y-1.5 mt-3 pt-3
          border-t ${g?"border-emerald-300/60":"border-amber-300/60"}
        `,children:h.map((_,_e)=>jsxRuntimeExports.jsxs("div",{className:`
                group flex items-center gap-2 text-xs rounded-lg px-2.5 py-1.5 relative
                transition-colors duration-150
                ${g?"bg-emerald-100/70 hover:bg-emerald-200/70":"bg-amber-100/70 hover:bg-amber-200/70"}
              `,children:[jsxRuntimeExports.jsx("span",{className:`
                flex-shrink-0 w-5 h-5 rounded-full
                ${g?"bg-emerald-600":"bg-amber-600"}
                text-white flex items-center justify-center font-bold text-[10px]
                shadow-sm
              `,children:_e+1}),jsxRuntimeExports.jsx("span",{className:`
                truncate flex-1
                ${g?"text-emerald-800":"text-amber-800"}
                font-medium
              `,title:_.button||` ${_e+1}`,children:_.button||` ${_e+1}`}),jsxRuntimeExports.jsx(Handle,{type:"source",position:Position.Right,id:`choice-${_e}`,className:`
                  !w-3 !h-3
                  ${g?"!bg-emerald-600":"!bg-amber-600"}
                  !border-2 !border-white
                  !shadow-sm
                  transition-transform group-hover:scale-125
                `,style:{top:"auto",right:-6}})]},_.id))}):jsxRuntimeExports.jsx(Handle,{type:"source",position:Position.Bottom,className:`
            !w-4 !h-4 !-bottom-2
            ${g?"!bg-emerald-500":"!bg-amber-500"}
            !border-2 !border-white
            !shadow-md
            transition-transform hover:scale-125
          `}),c&&jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1",children:jsxRuntimeExports.jsxs("span",{className:"relative flex h-3 w-3",children:[jsxRuntimeExports.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75"}),jsxRuntimeExports.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary-600"})]})})]})});BranchNode.displayName="BranchNode";const DefaultBufferLength=1024;let nextPropID=0,Range$1=class{constructor(e,o){this.from=e,this.to=o}};class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=NodeType.match(e)),o=>{let a=e(o);return a===void 0?null:[this,a]}}}NodeProp.closedBy=new NodeProp({deserialize:s=>s.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:s=>s.split(" ")});NodeProp.group=new NodeProp({deserialize:s=>s.split(" ")});NodeProp.isolate=new NodeProp({deserialize:s=>{if(s&&s!="rtl"&&s!="ltr"&&s!="auto")throw new RangeError("Invalid value for isolate: "+s);return s||"auto"}});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(e,o,a,c=!1){this.tree=e,this.overlay=o,this.parser=a,this.bracketed=c}static get(e){return e&&e.props&&e.props[NodeProp.mounted.id]}}const noProps=Object.create(null);class NodeType{constructor(e,o,a,c=0){this.name=e,this.props=o,this.id=a,this.flags=c}static define(e){let o=e.props&&e.props.length?Object.create(null):noProps,a=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),c=new NodeType(e.name||"",o,e.id,a);if(e.props){for(let d of e.props)if(Array.isArray(d)||(d=d(c)),d){if(d[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");o[d[0].id]=d[1]}}return c}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let o=this.prop(NodeProp.group);return o?o.indexOf(e)>-1:!1}return this.id==e}static match(e){let o=Object.create(null);for(let a in e)for(let c of a.split(" "))o[c]=e[a];return a=>{for(let c=a.prop(NodeProp.group),d=-1;d<(c?c.length:0);d++){let h=o[d<0?a.name:c[d]];if(h)return h}}}}NodeType.none=new NodeType("",Object.create(null),0,8);const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays",s[s.EnterBracketed=16]="EnterBracketed"})(IterMode||(IterMode={}));class Tree{constructor(e,o,a,c,d){if(this.type=e,this.children=o,this.positions=a,this.length=c,this.props=null,d&&d.length){this.props=Object.create(null);for(let[h,g]of d)this.props[typeof h=="number"?h:h.id]=g}}toString(){let e=MountedTree.get(this);if(e&&!e.overlay)return e.tree.toString();let o="";for(let a of this.children){let c=a.toString();c&&(o&&(o+=","),o+=c)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(o.length?"("+o+")":""):o}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,o=0,a=0){let c=CachedNode.get(this)||this.topNode,d=new TreeCursor(c);return d.moveTo(e,o),CachedNode.set(this,d._tree),d}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,o=0){let a=resolveNode(CachedNode.get(this)||this.topNode,e,o,!1);return CachedNode.set(this,a),a}resolveInner(e,o=0){let a=resolveNode(CachedInnerNode.get(this)||this.topNode,e,o,!0);return CachedInnerNode.set(this,a),a}resolveStack(e,o=0){return stackIterator(this,e,o)}iterate(e){let{enter:o,leave:a,from:c=0,to:d=this.length}=e,h=e.mode||0,g=(h&IterMode.IncludeAnonymous)>0;for(let b=this.cursor(h|IterMode.IncludeAnonymous);;){let j=!1;if(b.from<=d&&b.to>=c&&(!g&&b.type.isAnonymous||o(b)!==!1)){if(b.firstChild())continue;j=!0}for(;j&&a&&(g||!b.type.isAnonymous)&&a(b),!b.nextSibling();){if(!b.parent())return;j=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let o in this.props)e.push([+o,this.props[o]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(o,a,c)=>new Tree(this.type,o,a,c,this.propValues),e.makeTree||((o,a,c)=>new Tree(NodeType.none,o,a,c)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,o){this.buffer=e,this.index=o}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,o,a){this.buffer=e,this.length=o,this.set=a}get type(){return NodeType.none}toString(){let e=[];for(let o=0;o<this.buffer.length;)e.push(this.childString(o)),o=this.buffer[o+3];return e.join(",")}childString(e){let o=this.buffer[e],a=this.buffer[e+3],c=this.set.types[o],d=c.name;if(/\W/.test(d)&&!c.isError&&(d=JSON.stringify(d)),e+=4,a==e)return d;let h=[];for(;e<a;)h.push(this.childString(e)),e=this.buffer[e+3];return d+"("+h.join(",")+")"}findChild(e,o,a,c,d){let{buffer:h}=this,g=-1;for(let b=e;b!=o&&!(checkSide(d,c,h[b+1],h[b+2])&&(g=b,a>0));b=h[b+3]);return g}slice(e,o,a){let c=this.buffer,d=new Uint16Array(o-e),h=0;for(let g=e,b=0;g<o;){d[b++]=c[g++],d[b++]=c[g++]-a;let j=d[b++]=c[g++]-a;d[b++]=c[g++]-e,h=Math.max(h,j)}return new TreeBuffer(d,h,this.set)}}function checkSide(s,e,o,a){switch(s){case-2:return o<e;case-1:return a>=e&&o<e;case 0:return o<e&&a>e;case 1:return o<=e&&a>e;case 2:return a>e;case 4:return!0}}function resolveNode(s,e,o,a){for(var c;s.from==s.to||(o<1?s.from>=e:s.from>e)||(o>-1?s.to<=e:s.to<e);){let h=!a&&s instanceof TreeNode&&s.index<0?null:s.parent;if(!h)return s;s=h}let d=a?0:IterMode.IgnoreOverlays;if(a)for(let h=s,g=h.parent;g;h=g,g=h.parent)h instanceof TreeNode&&h.index<0&&((c=g.enter(e,o,d))===null||c===void 0?void 0:c.from)!=h.from&&(s=g);for(;;){let h=s.enter(e,o,d);if(!h)return s;s=h}}class BaseNode{cursor(e=0){return new TreeCursor(this,e)}getChild(e,o=null,a=null){let c=getChildren(this,e,o,a);return c.length?c[0]:null}getChildren(e,o=null,a=null){return getChildren(this,e,o,a)}resolve(e,o=0){return resolveNode(this,e,o,!1)}resolveInner(e,o=0){return resolveNode(this,e,o,!0)}matchContext(e){return matchNodeContext(this.parent,e)}enterUnfinishedNodesBefore(e){let o=this.childBefore(e),a=this;for(;o;){let c=o.lastChild;if(!c||c.to!=o.to)break;c.type.isError&&c.from==c.to?(a=o,o=c.prevSibling):o=c}return a}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(e,o,a,c){super(),this._tree=e,this.from=o,this.index=a,this._parent=c}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,o,a,c,d=0){var h;for(let g=this;;){for(let{children:b,positions:j}=g._tree,$=o>0?b.length:-1;e!=$;e+=o){let _=b[e],_e=j[e]+g.from;if(!(!(d&IterMode.EnterBracketed&&_ instanceof Tree&&((h=MountedTree.get(_))===null||h===void 0?void 0:h.overlay)===null&&(_e>=a||_e+_.length<=a))&&!checkSide(c,a,_e,_e+_.length))){if(_ instanceof TreeBuffer){if(d&IterMode.ExcludeBuffers)continue;let et=_.findChild(0,_.buffer.length,o,a-_e,c);if(et>-1)return new BufferNode(new BufferContext(g,_,e,_e),null,et)}else if(d&IterMode.IncludeAnonymous||!_.type.isAnonymous||hasChild(_)){let et;if(!(d&IterMode.IgnoreMounts)&&(et=MountedTree.get(_))&&!et.overlay)return new TreeNode(et.tree,_e,e,g);let nt=new TreeNode(_,_e,e,g);return d&IterMode.IncludeAnonymous||!nt.type.isAnonymous?nt:nt.nextChild(o<0?_.children.length-1:0,o,a,c,d)}}}if(d&IterMode.IncludeAnonymous||!g.type.isAnonymous||(g.index>=0?e=g.index+o:e=o<0?-1:g._parent._tree.children.length,g=g._parent,!g))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,o,a=0){let c;if(!(a&IterMode.IgnoreOverlays)&&(c=MountedTree.get(this._tree))&&c.overlay){let d=e-this.from,h=a&IterMode.EnterBracketed&&c.bracketed;for(let{from:g,to:b}of c.overlay)if((o>0||h?g<=d:g<d)&&(o<0||h?b>=d:b>d))return new TreeNode(c.tree,c.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,o,a)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(s,e,o,a){let c=s.cursor(),d=[];if(!c.firstChild())return d;if(o!=null){for(let h=!1;!h;)if(h=c.type.is(o),!c.nextSibling())return d}for(;;){if(a!=null&&c.type.is(a))return d;if(c.type.is(e)&&d.push(c.node),!c.nextSibling())return a==null?d:[]}}function matchNodeContext(s,e,o=e.length-1){for(let a=s;o>=0;a=a.parent){if(!a)return!1;if(!a.type.isAnonymous){if(e[o]&&e[o]!=a.name)return!1;o--}}return!0}class BufferContext{constructor(e,o,a,c){this.parent=e,this.buffer=o,this.index=a,this.start=c}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,o,a){super(),this.context=e,this._parent=o,this.index=a,this.type=e.buffer.set.types[e.buffer.buffer[a]]}child(e,o,a){let{buffer:c}=this.context,d=c.findChild(this.index+4,c.buffer[this.index+3],e,o-this.context.start,a);return d<0?null:new BufferNode(this.context,this,d)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,o,a=0){if(a&IterMode.ExcludeBuffers)return null;let{buffer:c}=this.context,d=c.findChild(this.index+4,c.buffer[this.index+3],o>0?1:-1,e-this.context.start,o);return d<0?null:new BufferNode(this.context,this,d)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,o=e.buffer[this.index+3];return o<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,o):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,o=this._parent?this._parent.index+4:0;return this.index==o?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(o,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],o=[],{buffer:a}=this.context,c=this.index+4,d=a.buffer[this.index+3];if(d>c){let h=a.buffer[this.index+1];e.push(a.slice(c,d,h)),o.push(0)}return new Tree(this.type,e,o,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(s){if(!s.length)return null;let e=0,o=s[0];for(let d=1;d<s.length;d++){let h=s[d];(h.from>o.from||h.to<o.to)&&(o=h,e=d)}let a=o instanceof TreeNode&&o.index<0?null:o.parent,c=s.slice();return a?c[e]=a:c.splice(e,1),new StackIterator(c,o)}class StackIterator{constructor(e,o){this.heads=e,this.node=o}get next(){return iterStack(this.heads)}}function stackIterator(s,e,o){let a=s.resolveInner(e,o),c=null;for(let d=a instanceof TreeNode?a:a.context.parent;d;d=d.parent)if(d.index<0){let h=d.parent;(c||(c=[a])).push(h.resolve(e,o)),d=h}else{let h=MountedTree.get(d.tree);if(h&&h.overlay&&h.overlay[0].from<=e&&h.overlay[h.overlay.length-1].to>=e){let g=new TreeNode(h.tree,h.overlay[0].from+d.from,-1,d);(c||(c=[a])).push(resolveNode(g,e,o,!1))}}return c?iterStack(c):a}class TreeCursor{get name(){return this.type.name}constructor(e,o=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=o&~IterMode.EnterBracketed,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let a=e._parent;a;a=a._parent)this.stack.unshift(a.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,o){this.index=e;let{start:a,buffer:c}=this.buffer;return this.type=o||c.set.types[c.buffer[e]],this.from=a+c.buffer[e+1],this.to=a+c.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,o,a){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,o,a,this.mode));let{buffer:c}=this.buffer,d=c.findChild(this.index+4,c.buffer[this.index+3],e,o-this.buffer.start,a);return d<0?!1:(this.stack.push(this.index),this.yieldBuf(d))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,o,a=this.mode){return this.buffer?a&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,o):this.yield(this._tree.enter(e,o,a))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:o}=this.buffer,a=this.stack.length-1;if(e<0){let c=a<0?0:this.stack[a]+4;if(this.index!=c)return this.yieldBuf(o.findChild(c,this.index,-1,0,4))}else{let c=o.buffer[this.index+3];if(c<(a<0?o.buffer.length:o.buffer[this.stack[a]+3]))return this.yieldBuf(c)}return a<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let o,a,{buffer:c}=this;if(c){if(e>0){if(this.index<c.buffer.buffer.length)return!1}else for(let d=0;d<this.index;d++)if(c.buffer.buffer[d+3]<this.index)return!1;({index:o,parent:a}=c)}else({index:o,_parent:a}=this._tree);for(;a;{index:o,_parent:a}=a)if(o>-1)for(let d=o+e,h=e<0?-1:a._tree.children.length;d!=h;d+=e){let g=a._tree.children[d];if(this.mode&IterMode.IncludeAnonymous||g instanceof TreeBuffer||!g.type.isAnonymous||hasChild(g))return!1}return!0}move(e,o){if(o&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,o=0){for(;(this.from==this.to||(o<1?this.from>=e:this.from>e)||(o>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,o););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,o=null,a=0;if(e&&e.context==this.buffer)e:for(let c=this.index,d=this.stack.length;d>=0;){for(let h=e;h;h=h._parent)if(h.index==c){if(c==this.index)return h;o=h,a=d+1;break e}c=this.stack[--d]}for(let c=a;c<this.stack.length;c++)o=new BufferNode(this.buffer,o,this.stack[c]);return this.bufferNode=new BufferNode(this.buffer,o,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,o){for(let a=0;;){let c=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){a++;continue}this.type.isAnonymous||(c=!0)}for(;;){if(c&&o&&o(this),c=this.type.isAnonymous,!a)return;if(this.nextSibling())break;this.parent(),a--,c=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node.parent,e);let{buffer:o}=this.buffer,{types:a}=o.set;for(let c=e.length-1,d=this.stack.length-1;c>=0;d--){if(d<0)return matchNodeContext(this._tree,e,c);let h=a[o.buffer[this.stack[d]]];if(!h.isAnonymous){if(e[c]&&e[c]!=h.name)return!1;c--}}return!0}}function hasChild(s){return s.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(s){var e;let{buffer:o,nodeSet:a,maxBufferLength:c=DefaultBufferLength,reused:d=[],minRepeatType:h=a.types.length}=s,g=Array.isArray(o)?new FlatBufferCursor(o,o.length):o,b=a.types,j=0,$=0;function _(ut,at,dt,ft,xt,Ct){let{id:yt,start:Et,end:Tt,size:ht}=g,wt=$,St=j;if(ht<0)if(g.next(),ht==-1){let kt=d[yt];dt.push(kt),ft.push(Et-ut);return}else if(ht==-3){j=yt;return}else if(ht==-4){$=yt;return}else throw new RangeError(`Unrecognized record size: ${ht}`);let bt=b[yt],mt,gt,pt=Et-ut;if(Tt-Et<=c&&(gt=it(g.pos-at,xt))){let kt=new Uint16Array(gt.size-gt.skip),Rt=g.pos-gt.size,At=kt.length;for(;g.pos>Rt;)At=st(gt.start,kt,At);mt=new TreeBuffer(kt,Tt-gt.start,a),pt=gt.start-ut}else{let kt=g.pos-ht;g.next();let Rt=[],At=[],Mt=yt>=h?yt:-1,Dt=0,$t=Tt;for(;g.pos>kt;)Mt>=0&&g.id==Mt&&g.size>=0?(g.end<=$t-c&&(nt(Rt,At,Et,Dt,g.end,$t,Mt,wt,St),Dt=Rt.length,$t=g.end),g.next()):Ct>2500?_e(Et,kt,Rt,At):_(Et,kt,Rt,At,Mt,Ct+1);if(Mt>=0&&Dt>0&&Dt<Rt.length&&nt(Rt,At,Et,Dt,Et,$t,Mt,wt,St),Rt.reverse(),At.reverse(),Mt>-1&&Dt>0){let _t=et(bt,St);mt=balanceRange(bt,Rt,At,0,Rt.length,0,Tt-Et,_t,_t)}else mt=rt(bt,Rt,At,Tt-Et,wt-Tt,St)}dt.push(mt),ft.push(pt)}function _e(ut,at,dt,ft){let xt=[],Ct=0,yt=-1;for(;g.pos>at;){let{id:Et,start:Tt,end:ht,size:wt}=g;if(wt>4)g.next();else{if(yt>-1&&Tt<yt)break;yt<0&&(yt=ht-c),xt.push(Et,Tt,ht),Ct++,g.next()}}if(Ct){let Et=new Uint16Array(Ct*4),Tt=xt[xt.length-2];for(let ht=xt.length-3,wt=0;ht>=0;ht-=3)Et[wt++]=xt[ht],Et[wt++]=xt[ht+1]-Tt,Et[wt++]=xt[ht+2]-Tt,Et[wt++]=wt;dt.push(new TreeBuffer(Et,xt[2]-Tt,a)),ft.push(Tt-ut)}}function et(ut,at){return(dt,ft,xt)=>{let Ct=0,yt=dt.length-1,Et,Tt;if(yt>=0&&(Et=dt[yt])instanceof Tree){if(!yt&&Et.type==ut&&Et.length==xt)return Et;(Tt=Et.prop(NodeProp.lookAhead))&&(Ct=ft[yt]+Et.length+Tt)}return rt(ut,dt,ft,xt,Ct,at)}}function nt(ut,at,dt,ft,xt,Ct,yt,Et,Tt){let ht=[],wt=[];for(;ut.length>ft;)ht.push(ut.pop()),wt.push(at.pop()+dt-xt);ut.push(rt(a.types[yt],ht,wt,Ct-xt,Et-Ct,Tt)),at.push(xt-dt)}function rt(ut,at,dt,ft,xt,Ct,yt){if(Ct){let Et=[NodeProp.contextHash,Ct];yt=yt?[Et].concat(yt):[Et]}if(xt>25){let Et=[NodeProp.lookAhead,xt];yt=yt?[Et].concat(yt):[Et]}return new Tree(ut,at,dt,ft,yt)}function it(ut,at){let dt=g.fork(),ft=0,xt=0,Ct=0,yt=dt.end-c,Et={size:0,start:0,skip:0};e:for(let Tt=dt.pos-ut;dt.pos>Tt;){let ht=dt.size;if(dt.id==at&&ht>=0){Et.size=ft,Et.start=xt,Et.skip=Ct,Ct+=4,ft+=4,dt.next();continue}let wt=dt.pos-ht;if(ht<0||wt<Tt||dt.start<yt)break;let St=dt.id>=h?4:0,bt=dt.start;for(dt.next();dt.pos>wt;){if(dt.size<0)if(dt.size==-3||dt.size==-4)St+=4;else break e;else dt.id>=h&&(St+=4);dt.next()}xt=bt,ft+=ht,Ct+=St}return(at<0||ft==ut)&&(Et.size=ft,Et.start=xt,Et.skip=Ct),Et.size>4?Et:void 0}function st(ut,at,dt){let{id:ft,start:xt,end:Ct,size:yt}=g;if(g.next(),yt>=0&&ft<h){let Et=dt;if(yt>4){let Tt=g.pos-(yt-4);for(;g.pos>Tt;)dt=st(ut,at,dt)}at[--dt]=Et,at[--dt]=Ct-ut,at[--dt]=xt-ut,at[--dt]=ft}else yt==-3?j=ft:yt==-4&&($=ft);return dt}let lt=[],ot=[];for(;g.pos>0;)_(s.start||0,s.bufferStart||0,lt,ot,-1,0);let ct=(e=s.length)!==null&&e!==void 0?e:lt.length?ot[0]+lt[0].length:0;return new Tree(b[s.topID],lt.reverse(),ot.reverse(),ct)}const nodeSizeCache=new WeakMap;function nodeSize(s,e){if(!s.isAnonymous||e instanceof TreeBuffer||e.type!=s)return 1;let o=nodeSizeCache.get(e);if(o==null){o=1;for(let a of e.children){if(a.type!=s||!(a instanceof Tree)){o=1;break}o+=nodeSize(s,a)}nodeSizeCache.set(e,o)}return o}function balanceRange(s,e,o,a,c,d,h,g,b){let j=0;for(let nt=a;nt<c;nt++)j+=nodeSize(s,e[nt]);let $=Math.ceil(j*1.5/8),_=[],_e=[];function et(nt,rt,it,st,lt){for(let ot=it;ot<st;){let ct=ot,ut=rt[ot],at=nodeSize(s,nt[ot]);for(ot++;ot<st;ot++){let dt=nodeSize(s,nt[ot]);if(at+dt>=$)break;at+=dt}if(ot==ct+1){if(at>$){let dt=nt[ct];et(dt.children,dt.positions,0,dt.children.length,rt[ct]+lt);continue}_.push(nt[ct])}else{let dt=rt[ot-1]+nt[ot-1].length-ut;_.push(balanceRange(s,nt,rt,ct,ot,ut,dt,null,b))}_e.push(ut+lt-d)}}return et(e,o,a,c,0),(g||b)(_,_e,h)}class TreeFragment{constructor(e,o,a,c,d=!1,h=!1){this.from=e,this.to=o,this.tree=a,this.offset=c,this.open=(d?1:0)|(h?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,o=[],a=!1){let c=[new TreeFragment(0,e.length,e,0,!1,a)];for(let d of o)d.to>e.length&&c.push(d);return c}static applyChanges(e,o,a=128){if(!o.length)return e;let c=[],d=1,h=e.length?e[0]:null;for(let g=0,b=0,j=0;;g++){let $=g<o.length?o[g]:null,_=$?$.fromA:1e9;if(_-b>=a)for(;h&&h.from<_;){let _e=h;if(b>=_e.from||_<=_e.to||j){let et=Math.max(_e.from,b)-j,nt=Math.min(_e.to,_)-j;_e=et>=nt?null:new TreeFragment(et,nt,_e.tree,_e.offset+j,g>0,!!$)}if(_e&&c.push(_e),h.to>_)break;h=d<e.length?e[d++]:null}if(!$)break;b=$.toA,j=$.toA-$.toB}return c}}class Parser{startParse(e,o,a){return typeof e=="string"&&(e=new StringInput(e)),a=a?a.length?a.map(c=>new Range$1(c.from,c.to)):[new Range$1(0,0)]:[new Range$1(0,e.length)],this.createParse(e,o||[],a)}parse(e,o,a){let c=this.startParse(e,o,a);for(;;){let d=c.advance();if(d)return d}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,o){return this.string.slice(e,o)}}new NodeProp({perNode:!0});let rangeFrom=[],rangeTo=[];(()=>{let s="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,o=0;e<s.length;e++)(e%2?rangeTo:rangeFrom).push(o=o+s[e])})();function isExtendingChar(s){if(s<768)return!1;for(let e=0,o=rangeFrom.length;;){let a=e+o>>1;if(s<rangeFrom[a])o=a;else if(s>=rangeTo[a])e=a+1;else return!0;if(e==o)return!1}}function isRegionalIndicator(s){return s>=127462&&s<=127487}const ZWJ=8205;function findClusterBreak$1(s,e,o=!0,a=!0){return(o?nextClusterBreak:prevClusterBreak)(s,e,a)}function nextClusterBreak(s,e,o){if(e==s.length)return e;e&&surrogateLow$1(s.charCodeAt(e))&&surrogateHigh$1(s.charCodeAt(e-1))&&e--;let a=codePointAt$1(s,e);for(e+=codePointSize$1(a);e<s.length;){let c=codePointAt$1(s,e);if(a==ZWJ||c==ZWJ||o&&isExtendingChar(c))e+=codePointSize$1(c),a=c;else if(isRegionalIndicator(c)){let d=0,h=e-2;for(;h>=0&&isRegionalIndicator(codePointAt$1(s,h));)d++,h-=2;if(d%2==0)break;e+=2}else break}return e}function prevClusterBreak(s,e,o){for(;e>0;){let a=nextClusterBreak(s,e-2,o);if(a<e)return a;e--}return 0}function codePointAt$1(s,e){let o=s.charCodeAt(e);if(!surrogateHigh$1(o)||e+1==s.length)return o;let a=s.charCodeAt(e+1);return surrogateLow$1(a)?(o-55296<<10)+(a-56320)+65536:o}function surrogateLow$1(s){return s>=56320&&s<57344}function surrogateHigh$1(s){return s>=55296&&s<56320}function codePointSize$1(s){return s<65536?1:2}class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,o,a){[e,o]=clip(this,e,o);let c=[];return this.decompose(0,e,c,2),a.length&&a.decompose(0,a.length,c,3),this.decompose(o,this.length,c,1),TextNode.from(c,this.length-(o-e)+a.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,o=this.length){[e,o]=clip(this,e,o);let a=[];return this.decompose(e,o,a,0),TextNode.from(a,o-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let o=this.scanIdentical(e,1),a=this.length-this.scanIdentical(e,-1),c=new RawTextCursor(this),d=new RawTextCursor(e);for(let h=o,g=o;;){if(c.next(h),d.next(h),h=0,c.lineBreak!=d.lineBreak||c.done!=d.done||c.value!=d.value)return!1;if(g+=c.value.length,c.done||g>=a)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,o=this.length){return new PartialTextCursor(this,e,o)}iterLines(e,o){let a;if(e==null)a=this.iter();else{o==null&&(o=this.lines+1);let c=this.line(e).from;a=this.iterRange(c,Math.max(c,o==this.lines+1?this.length:o<=1?0:this.line(o-1).to))}return new LineCursor(a)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,o=textLength(e)){super(),this.text=e,this.length=o}get lines(){return this.text.length}get children(){return null}lineInner(e,o,a,c){for(let d=0;;d++){let h=this.text[d],g=c+h.length;if((o?a:g)>=e)return new Line(c,g,a,h);c=g+1,a++}}decompose(e,o,a,c){let d=e<=0&&o>=this.length?this:new TextLeaf(sliceText(this.text,e,o),Math.min(o,this.length)-Math.max(0,e));if(c&1){let h=a.pop(),g=appendText(d.text,h.text.slice(),0,d.length);if(g.length<=32)a.push(new TextLeaf(g,h.length+d.length));else{let b=g.length>>1;a.push(new TextLeaf(g.slice(0,b)),new TextLeaf(g.slice(b)))}}else a.push(d)}replace(e,o,a){if(!(a instanceof TextLeaf))return super.replace(e,o,a);[e,o]=clip(this,e,o);let c=appendText(this.text,appendText(a.text,sliceText(this.text,0,e)),o),d=this.length+a.length-(o-e);return c.length<=32?new TextLeaf(c,d):TextNode.from(TextLeaf.split(c,[]),d)}sliceString(e,o=this.length,a=`
`){[e,o]=clip(this,e,o);let c="";for(let d=0,h=0;d<=o&&h<this.text.length;h++){let g=this.text[h],b=d+g.length;d>e&&h&&(c+=a),e<b&&o>d&&(c+=g.slice(Math.max(0,e-d),o-d)),d=b+1}return c}flatten(e){for(let o of this.text)e.push(o)}scanIdentical(){return 0}static split(e,o){let a=[],c=-1;for(let d of e)a.push(d),c+=d.length+1,a.length==32&&(o.push(new TextLeaf(a,c)),a=[],c=-1);return c>-1&&o.push(new TextLeaf(a,c)),o}}class TextNode extends Text{constructor(e,o){super(),this.children=e,this.length=o,this.lines=0;for(let a of e)this.lines+=a.lines}lineInner(e,o,a,c){for(let d=0;;d++){let h=this.children[d],g=c+h.length,b=a+h.lines-1;if((o?b:g)>=e)return h.lineInner(e,o,a,c);c=g+1,a=b+1}}decompose(e,o,a,c){for(let d=0,h=0;h<=o&&d<this.children.length;d++){let g=this.children[d],b=h+g.length;if(e<=b&&o>=h){let j=c&((h<=e?1:0)|(b>=o?2:0));h>=e&&b<=o&&!j?a.push(g):g.decompose(e-h,o-h,a,j)}h=b+1}}replace(e,o,a){if([e,o]=clip(this,e,o),a.lines<this.lines)for(let c=0,d=0;c<this.children.length;c++){let h=this.children[c],g=d+h.length;if(e>=d&&o<=g){let b=h.replace(e-d,o-d,a),j=this.lines-h.lines+b.lines;if(b.lines<j>>4&&b.lines>j>>6){let $=this.children.slice();return $[c]=b,new TextNode($,this.length-(o-e)+a.length)}return super.replace(d,g,b)}d=g+1}return super.replace(e,o,a)}sliceString(e,o=this.length,a=`
`){[e,o]=clip(this,e,o);let c="";for(let d=0,h=0;d<this.children.length&&h<=o;d++){let g=this.children[d],b=h+g.length;h>e&&d&&(c+=a),e<b&&o>h&&(c+=g.sliceString(e-h,o-h,a)),h=b+1}return c}flatten(e){for(let o of this.children)o.flatten(e)}scanIdentical(e,o){if(!(e instanceof TextNode))return 0;let a=0,[c,d,h,g]=o>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;c+=o,d+=o){if(c==h||d==g)return a;let b=this.children[c],j=e.children[d];if(b!=j)return a+b.scanIdentical(j,o);a+=b.length+1}}static from(e,o=e.reduce((a,c)=>a+c.length+1,-1)){let a=0;for(let et of e)a+=et.lines;if(a<32){let et=[];for(let nt of e)nt.flatten(et);return new TextLeaf(et,o)}let c=Math.max(32,a>>5),d=c<<1,h=c>>1,g=[],b=0,j=-1,$=[];function _(et){let nt;if(et.lines>d&&et instanceof TextNode)for(let rt of et.children)_(rt);else et.lines>h&&(b>h||!b)?(_e(),g.push(et)):et instanceof TextLeaf&&b&&(nt=$[$.length-1])instanceof TextLeaf&&et.lines+nt.lines<=32?(b+=et.lines,j+=et.length+1,$[$.length-1]=new TextLeaf(nt.text.concat(et.text),nt.length+1+et.length)):(b+et.lines>c&&_e(),b+=et.lines,j+=et.length+1,$.push(et))}function _e(){b!=0&&(g.push($.length==1?$[0]:TextNode.from($,j)),j=-1,b=$.length=0)}for(let et of e)_(et);return _e(),g.length==1?g[0]:new TextNode(g,o)}}Text.empty=new TextLeaf([""],0);function textLength(s){let e=-1;for(let o of s)e+=o.length+1;return e}function appendText(s,e,o=0,a=1e9){for(let c=0,d=0,h=!0;d<s.length&&c<=a;d++){let g=s[d],b=c+g.length;b>=o&&(b>a&&(g=g.slice(0,a-c)),c<o&&(g=g.slice(o-c)),h?(e[e.length-1]+=g,h=!1):e.push(g)),c=b+1}return e}function sliceText(s,e,o){return appendText(s,[""],e,o)}class RawTextCursor{constructor(e,o=1){this.dir=o,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[o>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,o){for(this.done=this.lineBreak=!1;;){let a=this.nodes.length-1,c=this.nodes[a],d=this.offsets[a],h=d>>1,g=c instanceof TextLeaf?c.text.length:c.children.length;if(h==(o>0?g:0)){if(a==0)return this.done=!0,this.value="",this;o>0&&this.offsets[a-1]++,this.nodes.pop(),this.offsets.pop()}else if((d&1)==(o>0?0:1)){if(this.offsets[a]+=o,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(c instanceof TextLeaf){let b=c.text[h+(o<0?-1:0)];if(this.offsets[a]+=o,b.length>Math.max(0,e))return this.value=e==0?b:o>0?b.slice(e):b.slice(0,b.length-e),this;e-=b.length}else{let b=c.children[h+(o<0?-1:0)];e>b.length?(e-=b.length,this.offsets[a]+=o):(o<0&&this.offsets[a]--,this.nodes.push(b),this.offsets.push(o>0?1:(b instanceof TextLeaf?b.text.length:b.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,o,a){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,o>a?-1:1),this.pos=o>a?e.length:0,this.from=Math.min(o,a),this.to=Math.max(o,a)}nextInner(e,o){if(o<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,o<0?this.pos-this.to:this.from-this.pos);let a=o<0?this.pos-this.from:this.to-this.pos;e>a&&(e=a),a-=e;let{value:c}=this.cursor.next(e);return this.pos+=(c.length+e)*o,this.value=c.length<=a?c:o<0?c.slice(c.length-a):c.slice(0,a),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:o,lineBreak:a,value:c}=this.inner.next(e);return o&&this.afterBreak?(this.value="",this.afterBreak=!1):o?(this.done=!0,this.value=""):a?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=c,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,o,a,c){this.from=e,this.to=o,this.number=a,this.text=c}get length(){return this.to-this.from}}function clip(s,e,o){return e=Math.max(0,Math.min(s.length,e)),[e,Math.max(e,Math.min(s.length,o))]}function findClusterBreak(s,e,o=!0,a=!0){return findClusterBreak$1(s,e,o,a)}function surrogateLow(s){return s>=56320&&s<57344}function surrogateHigh(s){return s>=55296&&s<56320}function codePointAt(s,e){let o=s.charCodeAt(e);if(!surrogateHigh(o)||e+1==s.length)return o;let a=s.charCodeAt(e+1);return surrogateLow(a)?(o-55296<<10)+(a-56320)+65536:o}function fromCodePoint(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function codePointSize(s){return s<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let o=0;o<this.sections.length;o+=2)e+=this.sections[o];return e}get newLength(){let e=0;for(let o=0;o<this.sections.length;o+=2){let a=this.sections[o+1];e+=a<0?this.sections[o]:a}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let o=0,a=0,c=0;o<this.sections.length;){let d=this.sections[o++],h=this.sections[o++];h<0?(e(a,c,d),c+=d):c+=h,a+=d}}iterChangedRanges(e,o=!1){iterChanges(this,e,o)}get invertedDesc(){let e=[];for(let o=0;o<this.sections.length;){let a=this.sections[o++],c=this.sections[o++];c<0?e.push(a,c):e.push(c,a)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,o=!1){return e.empty?this:mapSet(this,e,o)}mapPos(e,o=-1,a=MapMode.Simple){let c=0,d=0;for(let h=0;h<this.sections.length;){let g=this.sections[h++],b=this.sections[h++],j=c+g;if(b<0){if(j>e)return d+(e-c);d+=g}else{if(a!=MapMode.Simple&&j>=e&&(a==MapMode.TrackDel&&c<e&&j>e||a==MapMode.TrackBefore&&c<e||a==MapMode.TrackAfter&&j>e))return null;if(j>e||j==e&&o<0&&!g)return e==c||o<0?d:d+b;d+=b}c=j}if(e>c)throw new RangeError(`Position ${e} is out of range for changeset of length ${c}`);return d}touchesRange(e,o=e){for(let a=0,c=0;a<this.sections.length&&c<=o;){let d=this.sections[a++],h=this.sections[a++],g=c+d;if(h>=0&&c<=o&&g>=e)return c<e&&g>o?"cover":!0;c=g}return!1}toString(){let e="";for(let o=0;o<this.sections.length;){let a=this.sections[o++],c=this.sections[o++];e+=(e?" ":"")+a+(c>=0?":"+c:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(o=>typeof o!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,o){super(e),this.inserted=o}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(o,a,c,d,h)=>e=e.replace(c,c+(a-o),h),!1),e}mapDesc(e,o=!1){return mapSet(this,e,o,!0)}invert(e){let o=this.sections.slice(),a=[];for(let c=0,d=0;c<o.length;c+=2){let h=o[c],g=o[c+1];if(g>=0){o[c]=g,o[c+1]=h;let b=c>>1;for(;a.length<b;)a.push(Text.empty);a.push(h?e.slice(d,d+h):Text.empty)}d+=h}return new ChangeSet(o,a)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,o=!1){return e.empty?this:mapSet(this,e,o,!0)}iterChanges(e,o=!1){iterChanges(this,e,o)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let o=[],a=[],c=[],d=new SectionIter(this);e:for(let h=0,g=0;;){let b=h==e.length?1e9:e[h++];for(;g<b||g==b&&d.len==0;){if(d.done)break e;let $=Math.min(d.len,b-g);addSection(c,$,-1);let _=d.ins==-1?-1:d.off==0?d.ins:0;addSection(o,$,_),_>0&&addInsert(a,o,d.text),d.forward($),g+=$}let j=e[h++];for(;g<j;){if(d.done)break e;let $=Math.min(d.len,j-g);addSection(o,$,-1),addSection(c,$,d.ins==-1?-1:d.off==0?d.ins:0),d.forward($),g+=$}}return{changes:new ChangeSet(o,a),filtered:ChangeDesc.create(c)}}toJSON(){let e=[];for(let o=0;o<this.sections.length;o+=2){let a=this.sections[o],c=this.sections[o+1];c<0?e.push(a):c==0?e.push([a]):e.push([a].concat(this.inserted[o>>1].toJSON()))}return e}static of(e,o,a){let c=[],d=[],h=0,g=null;function b($=!1){if(!$&&!c.length)return;h<o&&addSection(c,o-h,-1);let _=new ChangeSet(c,d);g=g?g.compose(_.map(g)):_,c=[],d=[],h=0}function j($){if(Array.isArray($))for(let _ of $)j(_);else if($ instanceof ChangeSet){if($.length!=o)throw new RangeError(`Mismatched change set length (got ${$.length}, expected ${o})`);b(),g=g?g.compose($.map(g)):$}else{let{from:_,to:_e=_,insert:et}=$;if(_>_e||_<0||_e>o)throw new RangeError(`Invalid change range ${_} to ${_e} (in doc of length ${o})`);let nt=et?typeof et=="string"?Text.of(et.split(a||DefaultSplit)):et:Text.empty,rt=nt.length;if(_==_e&&rt==0)return;_<h&&b(),_>h&&addSection(c,_-h,-1),addSection(c,_e-_,rt),addInsert(d,c,nt),h=_e}}return j(e),b(!g),g}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let o=[],a=[];for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="number")o.push(d,-1);else{if(!Array.isArray(d)||typeof d[0]!="number"||d.some((h,g)=>g&&typeof h!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(d.length==1)o.push(d[0],0);else{for(;a.length<c;)a.push(Text.empty);a[c]=Text.of(d.slice(1)),o.push(d[0],a[c].length)}}}return new ChangeSet(o,a)}static createSet(e,o){return new ChangeSet(e,o)}}function addSection(s,e,o,a=!1){if(e==0&&o<=0)return;let c=s.length-2;c>=0&&o<=0&&o==s[c+1]?s[c]+=e:c>=0&&e==0&&s[c]==0?s[c+1]+=o:a?(s[c]+=e,s[c+1]+=o):s.push(e,o)}function addInsert(s,e,o){if(o.length==0)return;let a=e.length-2>>1;if(a<s.length)s[s.length-1]=s[s.length-1].append(o);else{for(;s.length<a;)s.push(Text.empty);s.push(o)}}function iterChanges(s,e,o){let a=s.inserted;for(let c=0,d=0,h=0;h<s.sections.length;){let g=s.sections[h++],b=s.sections[h++];if(b<0)c+=g,d+=g;else{let j=c,$=d,_=Text.empty;for(;j+=g,$+=b,b&&a&&(_=_.append(a[h-2>>1])),!(o||h==s.sections.length||s.sections[h+1]<0);)g=s.sections[h++],b=s.sections[h++];e(c,j,d,$,_),c=j,d=$}}}function mapSet(s,e,o,a=!1){let c=[],d=a?[]:null,h=new SectionIter(s),g=new SectionIter(e);for(let b=-1;;){if(h.done&&g.len||g.done&&h.len)throw new Error("Mismatched change set lengths");if(h.ins==-1&&g.ins==-1){let j=Math.min(h.len,g.len);addSection(c,j,-1),h.forward(j),g.forward(j)}else if(g.ins>=0&&(h.ins<0||b==h.i||h.off==0&&(g.len<h.len||g.len==h.len&&!o))){let j=g.len;for(addSection(c,g.ins,-1);j;){let $=Math.min(h.len,j);h.ins>=0&&b<h.i&&h.len<=$&&(addSection(c,0,h.ins),d&&addInsert(d,c,h.text),b=h.i),h.forward($),j-=$}g.next()}else if(h.ins>=0){let j=0,$=h.len;for(;$;)if(g.ins==-1){let _=Math.min($,g.len);j+=_,$-=_,g.forward(_)}else if(g.ins==0&&g.len<$)$-=g.len,g.next();else break;addSection(c,j,b<h.i?h.ins:0),d&&b<h.i&&addInsert(d,c,h.text),b=h.i,h.forward(h.len-$)}else{if(h.done&&g.done)return d?ChangeSet.createSet(c,d):ChangeDesc.create(c);throw new Error("Mismatched change set lengths")}}}function composeSets(s,e,o=!1){let a=[],c=o?[]:null,d=new SectionIter(s),h=new SectionIter(e);for(let g=!1;;){if(d.done&&h.done)return c?ChangeSet.createSet(a,c):ChangeDesc.create(a);if(d.ins==0)addSection(a,d.len,0,g),d.next();else if(h.len==0&&!h.done)addSection(a,0,h.ins,g),c&&addInsert(c,a,h.text),h.next();else{if(d.done||h.done)throw new Error("Mismatched change set lengths");{let b=Math.min(d.len2,h.len),j=a.length;if(d.ins==-1){let $=h.ins==-1?-1:h.off?0:h.ins;addSection(a,b,$,g),c&&$&&addInsert(c,a,h.text)}else h.ins==-1?(addSection(a,d.off?0:d.len,b,g),c&&addInsert(c,a,d.textBit(b))):(addSection(a,d.off?0:d.len,h.off?0:h.ins,g),c&&!h.off&&addInsert(c,a,h.text));g=(d.ins>b||h.ins>=0&&h.len>b)&&(g||a.length>j),d.forward2(b),h.forward(b)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,o=this.i-2>>1;return o>=e.length?Text.empty:e[o]}textBit(e){let{inserted:o}=this.set,a=this.i-2>>1;return a>=o.length&&!e?Text.empty:o[a].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,o,a){this.from=e,this.to=o,this.flags=a}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,o=-1){let a,c;return this.empty?a=c=e.mapPos(this.from,o):(a=e.mapPos(this.from,1),c=e.mapPos(this.to,-1)),a==this.from&&c==this.to?this:new SelectionRange(a,c,this.flags)}extend(e,o=e){if(e<=this.anchor&&o>=this.anchor)return EditorSelection.range(e,o);let a=Math.abs(e-this.anchor)>Math.abs(o-this.anchor)?e:o;return EditorSelection.range(this.anchor,a)}eq(e,o=!1){return this.anchor==e.anchor&&this.head==e.head&&this.goalColumn==e.goalColumn&&(!o||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,o,a){return new SelectionRange(e,o,a)}}class EditorSelection{constructor(e,o){this.ranges=e,this.mainIndex=o}map(e,o=-1){return e.empty?this:EditorSelection.create(this.ranges.map(a=>a.map(e,o)),this.mainIndex)}eq(e,o=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let a=0;a<this.ranges.length;a++)if(!this.ranges[a].eq(e.ranges[a],o))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(e,o=!0){return EditorSelection.create([e].concat(this.ranges),o?0:this.mainIndex+1)}replaceRange(e,o=this.mainIndex){let a=this.ranges.slice();return a[o]=e,EditorSelection.create(a,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(o=>SelectionRange.fromJSON(o)),e.main)}static single(e,o=e){return new EditorSelection([EditorSelection.range(e,o)],0)}static create(e,o=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let a=0,c=0;c<e.length;c++){let d=e[c];if(d.empty?d.from<=a:d.from<a)return EditorSelection.normalized(e.slice(),o);a=d.to}return new EditorSelection(e,o)}static cursor(e,o=0,a,c){return SelectionRange.create(e,e,(o==0?0:o<0?8:16)|(a==null?7:Math.min(6,a))|(c??16777215)<<6)}static range(e,o,a,c){let d=(a??16777215)<<6|(c==null?7:Math.min(6,c));return o<e?SelectionRange.create(o,e,48|d):SelectionRange.create(e,o,(o>e?8:0)|d)}static normalized(e,o=0){let a=e[o];e.sort((c,d)=>c.from-d.from),o=e.indexOf(a);for(let c=1;c<e.length;c++){let d=e[c],h=e[c-1];if(d.empty?d.from<=h.to:d.from<h.to){let g=h.from,b=Math.max(d.to,h.to);c<=o&&o--,e.splice(--c,2,d.anchor>d.head?EditorSelection.range(b,g):EditorSelection.range(g,b))}}return new EditorSelection(e,o)}}function checkSelection(s,e){for(let o of s.ranges)if(o.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,o,a,c,d){this.combine=e,this.compareInput=o,this.compare=a,this.isStatic=c,this.id=nextID++,this.default=e([]),this.extensions=typeof d=="function"?d(this):d}get reader(){return this}static define(e={}){return new Facet(e.combine||(o=>o),e.compareInput||((o,a)=>o===a),e.compare||(e.combine?(o,a)=>o===a:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,o){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,o)}computeN(e,o){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,o)}from(e,o){return o||(o=a=>a),this.compute([e],a=>o(a.field(e)))}}function sameArray$1(s,e){return s==e||s.length==e.length&&s.every((o,a)=>o===e[a])}class FacetProvider{constructor(e,o,a,c){this.dependencies=e,this.facet=o,this.type=a,this.value=c,this.id=nextID++}dynamicSlot(e){var o;let a=this.value,c=this.facet.compareInput,d=this.id,h=e[d]>>1,g=this.type==2,b=!1,j=!1,$=[];for(let _ of this.dependencies)_=="doc"?b=!0:_=="selection"?j=!0:((o=e[_.id])!==null&&o!==void 0?o:1)&1||$.push(e[_.id]);return{create(_){return _.values[h]=a(_),1},update(_,_e){if(b&&_e.docChanged||j&&(_e.docChanged||_e.selection)||ensureAll(_,$)){let et=a(_);if(g?!compareArray(et,_.values[h],c):!c(et,_.values[h]))return _.values[h]=et,1}return 0},reconfigure:(_,_e)=>{let et,nt=_e.config.address[d];if(nt!=null){let rt=getAddr(_e,nt);if(this.dependencies.every(it=>it instanceof Facet?_e.facet(it)===_.facet(it):it instanceof StateField?_e.field(it,!1)==_.field(it,!1):!0)||(g?compareArray(et=a(_),rt,c):c(et=a(_),rt)))return _.values[h]=rt,0}else et=a(_);return _.values[h]=et,1}}}}function compareArray(s,e,o){if(s.length!=e.length)return!1;for(let a=0;a<s.length;a++)if(!o(s[a],e[a]))return!1;return!0}function ensureAll(s,e){let o=!1;for(let a of e)ensureAddr(s,a)&1&&(o=!0);return o}function dynamicFacetSlot(s,e,o){let a=o.map(b=>s[b.id]),c=o.map(b=>b.type),d=a.filter(b=>!(b&1)),h=s[e.id]>>1;function g(b){let j=[];for(let $=0;$<a.length;$++){let _=getAddr(b,a[$]);if(c[$]==2)for(let _e of _)j.push(_e);else j.push(_)}return e.combine(j)}return{create(b){for(let j of a)ensureAddr(b,j);return b.values[h]=g(b),1},update(b,j){if(!ensureAll(b,d))return 0;let $=g(b);return e.compare($,b.values[h])?0:(b.values[h]=$,1)},reconfigure(b,j){let $=ensureAll(b,a),_=j.config.facets[e.id],_e=j.facet(e);if(_&&!$&&sameArray$1(o,_))return b.values[h]=_e,0;let et=g(b);return e.compare(et,_e)?(b.values[h]=_e,0):(b.values[h]=et,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,o,a,c,d){this.id=e,this.createF=o,this.updateF=a,this.compareF=c,this.spec=d,this.provides=void 0}static define(e){let o=new StateField(nextID++,e.create,e.update,e.compare||((a,c)=>a===c),e);return e.provide&&(o.provides=e.provide(o)),o}create(e){let o=e.facet(initField).find(a=>a.field==this);return((o==null?void 0:o.create)||this.createF)(e)}slot(e){let o=e[this.id]>>1;return{create:a=>(a.values[o]=this.create(a),1),update:(a,c)=>{let d=a.values[o],h=this.updateF(d,c);return this.compareF(d,h)?0:(a.values[o]=h,1)},reconfigure:(a,c)=>{let d=a.facet(initField),h=c.facet(initField),g;return(g=d.find(b=>b.field==this))&&g!=h.find(b=>b.field==this)?(a.values[o]=g.create(a),1):c.config.address[this.id]!=null?(a.values[o]=c.field(this),0):(a.values[o]=this.create(a),1)}}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(s){return e=>new PrecExtension(e,s)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,o){this.inner=e,this.prec=o}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,o){this.compartment=e,this.inner=o}}class Configuration{constructor(e,o,a,c,d,h){for(this.base=e,this.compartments=o,this.dynamicSlots=a,this.address=c,this.staticValues=d,this.facets=h,this.statusTemplate=[];this.statusTemplate.length<a.length;)this.statusTemplate.push(0)}staticFacet(e){let o=this.address[e.id];return o==null?e.default:this.staticValues[o>>1]}static resolve(e,o,a){let c=[],d=Object.create(null),h=new Map;for(let _e of flatten(e,o,h))_e instanceof StateField?c.push(_e):(d[_e.facet.id]||(d[_e.facet.id]=[])).push(_e);let g=Object.create(null),b=[],j=[];for(let _e of c)g[_e.id]=j.length<<1,j.push(et=>_e.slot(et));let $=a==null?void 0:a.config.facets;for(let _e in d){let et=d[_e],nt=et[0].facet,rt=$&&$[_e]||[];if(et.every(it=>it.type==0))if(g[nt.id]=b.length<<1|1,sameArray$1(rt,et))b.push(a.facet(nt));else{let it=nt.combine(et.map(st=>st.value));b.push(a&&nt.compare(it,a.facet(nt))?a.facet(nt):it)}else{for(let it of et)it.type==0?(g[it.id]=b.length<<1|1,b.push(it.value)):(g[it.id]=j.length<<1,j.push(st=>it.dynamicSlot(st)));g[nt.id]=j.length<<1,j.push(it=>dynamicFacetSlot(it,nt,et))}}let _=j.map(_e=>_e(g));return new Configuration(e,h,_,g,b,d)}}function flatten(s,e,o){let a=[[],[],[],[],[]],c=new Map;function d(h,g){let b=c.get(h);if(b!=null){if(b<=g)return;let j=a[b].indexOf(h);j>-1&&a[b].splice(j,1),h instanceof CompartmentInstance&&o.delete(h.compartment)}if(c.set(h,g),Array.isArray(h))for(let j of h)d(j,g);else if(h instanceof CompartmentInstance){if(o.has(h.compartment))throw new RangeError("Duplicate use of compartment in extensions");let j=e.get(h.compartment)||h.inner;o.set(h.compartment,j),d(j,g)}else if(h instanceof PrecExtension)d(h.inner,h.prec);else if(h instanceof StateField)a[g].push(h),h.provides&&d(h.provides,g);else if(h instanceof FacetProvider)a[g].push(h),h.facet.extensions&&d(h.facet.extensions,Prec_.default);else{let j=h.extension;if(!j)throw new Error(`Unrecognized extension value in extension set (${h}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);d(j,g)}}return d(s,Prec_.default),a.reduce((h,g)=>h.concat(g))}function ensureAddr(s,e){if(e&1)return 2;let o=e>>1,a=s.status[o];if(a==4)throw new Error("Cyclic dependency between fields and/or facets");if(a&2)return a;s.status[o]=4;let c=s.computeSlot(s,s.config.dynamicSlots[o]);return s.status[o]=2|c}function getAddr(s,e){return e&1?s.config.staticValues[e>>1]:s.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:s=>s.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:s=>s.length?s[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:s=>s.length?s[0]:!1});class Annotation{constructor(e,o){this.type=e,this.value=o}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,o){this.type=e,this.value=o}map(e){let o=this.type.map(this.value,e);return o===void 0?void 0:o==this.value?this:new StateEffect(this.type,o)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(o=>o))}static mapEffects(e,o){if(!e.length)return e;let a=[];for(let c of e){let d=c.map(o);d&&a.push(d)}return a}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,o,a,c,d,h){this.startState=e,this.changes=o,this.selection=a,this.effects=c,this.annotations=d,this.scrollIntoView=h,this._doc=null,this._state=null,a&&checkSelection(a,o.newLength),d.some(g=>g.type==Transaction.time)||(this.annotations=d.concat(Transaction.time.of(Date.now())))}static create(e,o,a,c,d,h){return new Transaction(e,o,a,c,d,h)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let o of this.annotations)if(o.type==e)return o.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let o=this.annotation(Transaction.userEvent);return!!(o&&(o==e||o.length>e.length&&o.slice(0,e.length)==e&&o[e.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(s,e){let o=[];for(let a=0,c=0;;){let d,h;if(a<s.length&&(c==e.length||e[c]>=s[a]))d=s[a++],h=s[a++];else if(c<e.length)d=e[c++],h=e[c++];else return o;!o.length||o[o.length-1]<d?o.push(d,h):o[o.length-1]<h&&(o[o.length-1]=h)}}function mergeTransaction(s,e,o){var a;let c,d,h;return o?(c=e.changes,d=ChangeSet.empty(e.changes.length),h=s.changes.compose(e.changes)):(c=e.changes.map(s.changes),d=s.changes.mapDesc(e.changes,!0),h=s.changes.compose(c)),{changes:h,selection:e.selection?e.selection.map(d):(a=s.selection)===null||a===void 0?void 0:a.map(c),effects:StateEffect.mapEffects(s.effects,c).concat(StateEffect.mapEffects(e.effects,d)),annotations:s.annotations.length?s.annotations.concat(e.annotations):e.annotations,scrollIntoView:s.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(s,e,o){let a=e.selection,c=asArray$1(e.annotations);return e.userEvent&&(c=c.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],o,s.facet(lineSeparator)),selection:a&&(a instanceof EditorSelection?a:EditorSelection.single(a.anchor,a.head)),effects:asArray$1(e.effects),annotations:c,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(s,e,o){let a=resolveTransactionInner(s,e.length?e[0]:{},s.doc.length);e.length&&e[0].filter===!1&&(o=!1);for(let d=1;d<e.length;d++){e[d].filter===!1&&(o=!1);let h=!!e[d].sequential;a=mergeTransaction(a,resolveTransactionInner(s,e[d],h?a.changes.newLength:s.doc.length),h)}let c=Transaction.create(s,a.changes,a.selection,a.effects,a.annotations,a.scrollIntoView);return extendTransaction(o?filterTransaction(c):c)}function filterTransaction(s){let e=s.startState,o=!0;for(let c of e.facet(changeFilter)){let d=c(s);if(d===!1){o=!1;break}Array.isArray(d)&&(o=o===!0?d:joinRanges(o,d))}if(o!==!0){let c,d;if(o===!1)d=s.changes.invertedDesc,c=ChangeSet.empty(e.doc.length);else{let h=s.changes.filter(o);c=h.changes,d=h.filtered.mapDesc(h.changes).invertedDesc}s=Transaction.create(e,c,s.selection&&s.selection.map(d),StateEffect.mapEffects(s.effects,d),s.annotations,s.scrollIntoView)}let a=e.facet(transactionFilter);for(let c=a.length-1;c>=0;c--){let d=a[c](s);d instanceof Transaction?s=d:Array.isArray(d)&&d.length==1&&d[0]instanceof Transaction?s=d[0]:s=resolveTransaction(e,asArray$1(d),!1)}return s}function extendTransaction(s){let e=s.startState,o=e.facet(transactionExtender),a=s;for(let c=o.length-1;c>=0;c--){let d=o[c](s);d&&Object.keys(d).length&&(a=mergeTransaction(a,resolveTransactionInner(e,d,s.changes.newLength),!0))}return a==s?s:Transaction.create(e,s.changes,s.selection,a.effects,a.annotations,a.scrollIntoView)}const none$2=[];function asArray$1(s){return s==null?none$2:Array.isArray(s)?s:[s]}var CharCategory=function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(s){}function hasWordChar(s){if(wordChar)return wordChar.test(s);for(let e=0;e<s.length;e++){let o=s[e];if(/\w/.test(o)||o>""&&(o.toUpperCase()!=o.toLowerCase()||nonASCIISingleCaseWordChar.test(o)))return!0}return!1}function makeCategorizer(s){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let o=0;o<s.length;o++)if(e.indexOf(s[o])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,o,a,c,d,h){this.config=e,this.doc=o,this.selection=a,this.values=c,this.status=e.statusTemplate.slice(),this.computeSlot=d,h&&(h._state=this);for(let g=0;g<this.config.dynamicSlots.length;g++)ensureAddr(this,g<<1);this.computeSlot=null}field(e,o=!0){let a=this.config.address[e.id];if(a==null){if(o)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,a),getAddr(this,a)}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let o=this.config,{base:a,compartments:c}=o;for(let g of e.effects)g.is(Compartment.reconfigure)?(o&&(c=new Map,o.compartments.forEach((b,j)=>c.set(j,b)),o=null),c.set(g.value.compartment,g.value.extension)):g.is(StateEffect.reconfigure)?(o=null,a=g.value):g.is(StateEffect.appendConfig)&&(o=null,a=asArray$1(a).concat(g.value));let d;o?d=e.startState.values.slice():(o=Configuration.resolve(a,c,this),d=new EditorState(o,this.doc,this.selection,o.dynamicSlots.map(()=>null),(b,j)=>j.reconfigure(b,this),null).values);let h=e.startState.facet(allowMultipleSelections)?e.newSelection:e.newSelection.asSingle();new EditorState(o,e.newDoc,h,d,(g,b)=>b.update(g,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(o=>({changes:{from:o.from,to:o.to,insert:e},range:EditorSelection.cursor(o.from+e.length)}))}changeByRange(e){let o=this.selection,a=e(o.ranges[0]),c=this.changes(a.changes),d=[a.range],h=asArray$1(a.effects);for(let g=1;g<o.ranges.length;g++){let b=e(o.ranges[g]),j=this.changes(b.changes),$=j.map(c);for(let _e=0;_e<g;_e++)d[_e]=d[_e].map($);let _=c.mapDesc(j,!0);d.push(b.range.map(_)),c=c.compose($),h=StateEffect.mapEffects(h,$).concat(StateEffect.mapEffects(asArray$1(b.effects),_))}return{changes:c,selection:EditorSelection.create(d,o.mainIndex),effects:h}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,o=this.doc.length){return this.doc.sliceString(e,o,this.lineBreak)}facet(e){let o=this.config.address[e.id];return o==null?e.default:(ensureAddr(this,o),getAddr(this,o))}toJSON(e){let o={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let a in e){let c=e[a];c instanceof StateField&&this.config.address[c.id]!=null&&(o[a]=c.spec.toJSON(this.field(e[a]),this))}return o}static fromJSON(e,o={},a){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let c=[];if(a){for(let d in a)if(Object.prototype.hasOwnProperty.call(e,d)){let h=a[d],g=e[d];c.push(h.init(b=>h.spec.fromJSON(g,b)))}}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:o.extensions?c.concat([o.extensions]):c})}static create(e={}){let o=Configuration.resolve(e.extensions||[],new Map),a=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(o.staticFacet(EditorState.lineSeparator)||DefaultSplit)),c=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(c,a.length),o.staticFacet(allowMultipleSelections)||(c=c.asSingle()),new EditorState(o,a,c,o.dynamicSlots.map(()=>null),(d,h)=>h.create(d),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(e,...o){for(let a of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(a,e)){e=a[e];break}return o.length&&(e=e.replace(/\$(\$|\d*)/g,(a,c)=>{if(c=="$")return"$";let d=+(c||1);return!d||d>o.length?a:o[d-1]})),e}languageDataAt(e,o,a=-1){let c=[];for(let d of this.facet(languageData))for(let h of d(this,o,a))Object.prototype.hasOwnProperty.call(h,e)&&c.push(h[e]);return c}charCategorizer(e){let o=this.languageDataAt("wordChars",e);return makeCategorizer(o.length?o[0]:"")}wordAt(e){let{text:o,from:a,length:c}=this.doc.lineAt(e),d=this.charCategorizer(e),h=e-a,g=e-a;for(;h>0;){let b=findClusterBreak(o,h,!1);if(d(o.slice(b,h))!=CharCategory.Word)break;h=b}for(;g<c;){let b=findClusterBreak(o,g);if(d(o.slice(g,b))!=CharCategory.Word)break;g=b}return h==g?null:EditorSelection.range(h+a,g+a)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:s=>s.length?s[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(s,e){let o=Object.keys(s),a=Object.keys(e);return o.length==a.length&&o.every(c=>s[c]==e[c])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(s,e,o={}){let a={};for(let c of s)for(let d of Object.keys(c)){let h=c[d],g=a[d];if(g===void 0)a[d]=h;else if(!(g===h||h===void 0))if(Object.hasOwnProperty.call(o,d))a[d]=o[d](g,h);else throw new Error("Config merge conflict for field "+d)}for(let c in e)a[c]===void 0&&(a[c]=e[c]);return a}class RangeValue{eq(e){return this==e}range(e,o=e){return Range.create(e,o,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;function cmpVal(s,e){return s==e||s.constructor==e.constructor&&s.eq(e)}class Range{constructor(e,o,a){this.from=e,this.to=o,this.value=a}static create(e,o,a){return new Range(e,o,a)}}function cmpRange(s,e){return s.from-e.from||s.value.startSide-e.value.startSide}class Chunk{constructor(e,o,a,c){this.from=e,this.to=o,this.value=a,this.maxPoint=c}get length(){return this.to[this.to.length-1]}findIndex(e,o,a,c=0){let d=a?this.to:this.from;for(let h=c,g=d.length;;){if(h==g)return h;let b=h+g>>1,j=d[b]-e||(a?this.value[b].endSide:this.value[b].startSide)-o;if(b==h)return j>=0?h:g;j>=0?g=b:h=b+1}}between(e,o,a,c){for(let d=this.findIndex(o,-1e9,!0),h=this.findIndex(a,1e9,!1,d);d<h;d++)if(c(this.from[d]+e,this.to[d]+e,this.value[d])===!1)return!1}map(e,o){let a=[],c=[],d=[],h=-1,g=-1;for(let b=0;b<this.value.length;b++){let j=this.value[b],$=this.from[b]+e,_=this.to[b]+e,_e,et;if($==_){let nt=o.mapPos($,j.startSide,j.mapMode);if(nt==null||(_e=et=nt,j.startSide!=j.endSide&&(et=o.mapPos($,j.endSide),et<_e)))continue}else if(_e=o.mapPos($,j.startSide),et=o.mapPos(_,j.endSide),_e>et||_e==et&&j.startSide>0&&j.endSide<=0)continue;(et-_e||j.endSide-j.startSide)<0||(h<0&&(h=_e),j.point&&(g=Math.max(g,et-_e)),a.push(j),c.push(_e-h),d.push(et-h))}return{mapped:a.length?new Chunk(c,d,a,g):null,pos:h}}}class RangeSet{constructor(e,o,a,c){this.chunkPos=e,this.chunk=o,this.nextLayer=a,this.maxPoint=c}static create(e,o,a,c){return new RangeSet(e,o,a,c)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let o of this.chunk)e+=o.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:o=[],sort:a=!1,filterFrom:c=0,filterTo:d=this.length}=e,h=e.filter;if(o.length==0&&!h)return this;if(a&&(o=o.slice().sort(cmpRange)),this.isEmpty)return o.length?RangeSet.of(o):this;let g=new LayerCursor(this,null,-1).goto(0),b=0,j=[],$=new RangeSetBuilder;for(;g.value||b<o.length;)if(b<o.length&&(g.from-o[b].from||g.startSide-o[b].value.startSide)>=0){let _=o[b++];$.addInner(_.from,_.to,_.value)||j.push(_)}else g.rangeIndex==1&&g.chunkIndex<this.chunk.length&&(b==o.length||this.chunkEnd(g.chunkIndex)<o[b].from)&&(!h||c>this.chunkEnd(g.chunkIndex)||d<this.chunkPos[g.chunkIndex])&&$.addChunk(this.chunkPos[g.chunkIndex],this.chunk[g.chunkIndex])?g.nextChunk():((!h||c>g.to||d<g.from||h(g.from,g.to,g.value))&&($.addInner(g.from,g.to,g.value)||j.push(Range.create(g.from,g.to,g.value))),g.next());return $.finishInner(this.nextLayer.isEmpty&&!j.length?RangeSet.empty:this.nextLayer.update({add:j,filter:h,filterFrom:c,filterTo:d}))}map(e){if(e.empty||this.isEmpty)return this;let o=[],a=[],c=-1;for(let h=0;h<this.chunk.length;h++){let g=this.chunkPos[h],b=this.chunk[h],j=e.touchesRange(g,g+b.length);if(j===!1)c=Math.max(c,b.maxPoint),o.push(b),a.push(e.mapPos(g));else if(j===!0){let{mapped:$,pos:_}=b.map(g,e);$&&(c=Math.max(c,$.maxPoint),o.push($),a.push(_))}}let d=this.nextLayer.map(e);return o.length==0?d:new RangeSet(a,o,d||RangeSet.empty,c)}between(e,o,a){if(!this.isEmpty){for(let c=0;c<this.chunk.length;c++){let d=this.chunkPos[c],h=this.chunk[c];if(o>=d&&e<=d+h.length&&h.between(d,e-d,o-d,a)===!1)return}this.nextLayer.between(e,o,a)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,o=0){return HeapCursor.from(e).goto(o)}static compare(e,o,a,c,d=-1){let h=e.filter(_=>_.maxPoint>0||!_.isEmpty&&_.maxPoint>=d),g=o.filter(_=>_.maxPoint>0||!_.isEmpty&&_.maxPoint>=d),b=findSharedChunks(h,g,a),j=new SpanCursor(h,b,d),$=new SpanCursor(g,b,d);a.iterGaps((_,_e,et)=>compare(j,_,$,_e,et,c)),a.empty&&a.length==0&&compare(j,0,$,0,0,c)}static eq(e,o,a=0,c){c==null&&(c=999999999);let d=e.filter($=>!$.isEmpty&&o.indexOf($)<0),h=o.filter($=>!$.isEmpty&&e.indexOf($)<0);if(d.length!=h.length)return!1;if(!d.length)return!0;let g=findSharedChunks(d,h),b=new SpanCursor(d,g,0).goto(a),j=new SpanCursor(h,g,0).goto(a);for(;;){if(b.to!=j.to||!sameValues(b.active,j.active)||b.point&&(!j.point||!cmpVal(b.point,j.point)))return!1;if(b.to>c)return!0;b.next(),j.next()}}static spans(e,o,a,c,d=-1){let h=new SpanCursor(e,null,d).goto(o),g=o,b=h.openStart;for(;;){let j=Math.min(h.to,a);if(h.point){let $=h.activeForPoint(h.to),_=h.pointFrom<o?$.length+1:h.point.startSide<0?$.length:Math.min($.length,b);c.point(g,j,h.point,$,_,h.pointRank),b=Math.min(h.openEnd(j),$.length)}else j>g&&(c.span(g,j,h.active,b),b=h.openEnd(j));if(h.to>a)return b+(h.point&&h.to>a?1:0);g=h.to,h.next()}}static of(e,o=!1){let a=new RangeSetBuilder;for(let c of e instanceof Range?[e]:o?lazySort(e):e)a.add(c.from,c.to,c.value);return a.finish()}static join(e){if(!e.length)return RangeSet.empty;let o=e[e.length-1];for(let a=e.length-2;a>=0;a--)for(let c=e[a];c!=RangeSet.empty;c=c.nextLayer)o=new RangeSet(c.chunkPos,c.chunk,o,Math.max(c.maxPoint,o.maxPoint));return o}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(s){if(s.length>1)for(let e=s[0],o=1;o<s.length;o++){let a=s[o];if(cmpRange(e,a)>0)return s.slice().sort(cmpRange);e=a}return s}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,o,a){this.addInner(e,o,a)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,o,a)}addInner(e,o,a){let c=e-this.lastTo||a.startSide-this.last.endSide;if(c<=0&&(e-this.lastFrom||a.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return c<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(o-this.chunkStart),this.last=a,this.lastFrom=e,this.lastTo=o,this.value.push(a),a.point&&(this.maxPoint=Math.max(this.maxPoint,o-e)),!0)}addChunk(e,o){if((e-this.lastTo||o.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,o.maxPoint),this.chunks.push(o),this.chunkPos.push(e);let a=o.value.length-1;return this.last=o.value[a],this.lastFrom=o.from[a]+e,this.lastTo=o.to[a]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let o=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,o}}function findSharedChunks(s,e,o){let a=new Map;for(let d of s)for(let h=0;h<d.chunk.length;h++)d.chunk[h].maxPoint<=0&&a.set(d.chunk[h],d.chunkPos[h]);let c=new Set;for(let d of e)for(let h=0;h<d.chunk.length;h++){let g=a.get(d.chunk[h]);g!=null&&(o?o.mapPos(g):g)==d.chunkPos[h]&&!(o!=null&&o.touchesRange(g,g+d.chunk[h].length))&&c.add(d.chunk[h])}return c}class LayerCursor{constructor(e,o,a,c=0){this.layer=e,this.skip=o,this.minPoint=a,this.rank=c}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,o=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,o,!1),this}gotoInner(e,o,a){for(;this.chunkIndex<this.layer.chunk.length;){let c=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(c)||this.layer.chunkEnd(this.chunkIndex)<e||c.maxPoint<this.minPoint))break;this.chunkIndex++,a=!1}if(this.chunkIndex<this.layer.chunk.length){let c=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],o,!0);(!a||this.rangeIndex<c)&&this.setRangeIndex(c)}this.next()}forward(e,o){(this.to-e||this.endSide-o)<0&&this.gotoInner(e,o,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],o=this.layer.chunk[this.chunkIndex],a=e+o.from[this.rangeIndex];if(this.from=a,this.to=e+o.to[this.rangeIndex],this.value=o.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,o=null,a=-1){let c=[];for(let d=0;d<e.length;d++)for(let h=e[d];!h.isEmpty;h=h.nextLayer)h.maxPoint>=a&&c.push(new LayerCursor(h,o,a,d));return c.length==1?c[0]:new HeapCursor(c)}get startSide(){return this.value?this.value.startSide:0}goto(e,o=-1e9){for(let a of this.heap)a.goto(e,o);for(let a=this.heap.length>>1;a>=0;a--)heapBubble(this.heap,a);return this.next(),this}forward(e,o){for(let a of this.heap)a.forward(e,o);for(let a=this.heap.length>>1;a>=0;a--)heapBubble(this.heap,a);(this.to-e||this.value.endSide-o)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(s,e){for(let o=s[e];;){let a=(e<<1)+1;if(a>=s.length)break;let c=s[a];if(a+1<s.length&&c.compare(s[a+1])>=0&&(c=s[a+1],a++),o.compare(c)<0)break;s[a]=o,s[e]=c,e=a}}class SpanCursor{constructor(e,o,a){this.minPoint=a,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,o,a)}goto(e,o=-1e9){return this.cursor.goto(e,o),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=o,this.openStart=-1,this.next(),this}forward(e,o){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-o)<0;)this.removeActive(this.minActive);this.cursor.forward(e,o)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let o=0,{value:a,to:c,rank:d}=this.cursor;for(;o<this.activeRank.length&&(d-this.activeRank[o]||c-this.activeTo[o])>0;)o++;insert(this.active,o,a),insert(this.activeTo,o,c),insert(this.activeRank,o,d),e&&insert(e,o,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,o=this.point;this.point=null;let a=this.openStart<0?[]:null;for(;;){let c=this.minActive;if(c>-1&&(this.activeTo[c]-this.cursor.from||this.active[c].endSide-this.cursor.startSide)<0){if(this.activeTo[c]>e){this.to=this.activeTo[c],this.endSide=this.active[c].endSide;break}this.removeActive(c),a&&remove(a,c)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let d=this.cursor.value;if(!d.point)this.addActive(a),this.cursor.next();else if(o&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=d,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=d.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(a){this.openStart=0;for(let c=a.length-1;c>=0&&a[c]<e;c--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let o=[];for(let a=this.active.length-1;a>=0&&!(this.activeRank[a]<this.pointRank);a--)(this.activeTo[a]>e||this.activeTo[a]==e&&this.active[a].endSide>=this.point.endSide)&&o.push(this.active[a]);return o.reverse()}openEnd(e){let o=0;for(let a=this.activeTo.length-1;a>=0&&this.activeTo[a]>e;a--)o++;return o}}function compare(s,e,o,a,c,d){s.goto(e),o.goto(a);let h=a+c,g=a,b=a-e,j=!!d.boundChange;for(let $=!1;;){let _=s.to+b-o.to,_e=_||s.endSide-o.endSide,et=_e<0?s.to+b:o.to,nt=Math.min(et,h);if(s.point||o.point?(s.point&&o.point&&cmpVal(s.point,o.point)&&sameValues(s.activeForPoint(s.to),o.activeForPoint(o.to))||d.comparePoint(g,nt,s.point,o.point),$=!1):($&&d.boundChange(g),nt>g&&!sameValues(s.active,o.active)&&d.compareRange(g,nt,s.active,o.active),j&&nt<h&&(_||s.openEnd(et)!=o.openEnd(et))&&($=!0)),et>h)break;g=et,_e<=0&&s.next(),_e>=0&&o.next()}}function sameValues(s,e){if(s.length!=e.length)return!1;for(let o=0;o<s.length;o++)if(s[o]!=e[o]&&!cmpVal(s[o],e[o]))return!1;return!0}function remove(s,e){for(let o=e,a=s.length-1;o<a;o++)s[o]=s[o+1];s.pop()}function insert(s,e,o){for(let a=s.length-1;a>=e;a--)s[a+1]=s[a];s[e]=o}function findMinIndex(s,e){let o=-1,a=1e9;for(let c=0;c<e.length;c++)(e[c]-a||s[c].endSide-s[o].endSide)<0&&(o=c,a=e[c]);return o}function countColumn(s,e,o=s.length){let a=0;for(let c=0;c<o&&c<s.length;)s.charCodeAt(c)==9?(a+=e-a%e,c++):(a++,c=findClusterBreak(s,c));return a}function findColumn(s,e,o,a){for(let c=0,d=0;;){if(d>=e)return c;if(c==s.length)break;d+=s.charCodeAt(c)==9?o-d%o:1,c=findClusterBreak(s,c)}return a===!0?-1:s.length}const C="",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,o){this.rules=[];let{finish:a}=o||{};function c(h){return/^@/.test(h)?[h]:h.split(/,\s*/)}function d(h,g,b,j){let $=[],_=/^@(\w+)\b/.exec(h[0]),_e=_&&_[1]=="keyframes";if(_&&g==null)return b.push(h[0]+";");for(let et in g){let nt=g[et];if(/&/.test(et))d(et.split(/,\s*/).map(rt=>h.map(it=>rt.replace(/&/,it))).reduce((rt,it)=>rt.concat(it)),nt,b);else if(nt&&typeof nt=="object"){if(!_)throw new RangeError("The value of a property ("+et+") should be a primitive value.");d(c(et),nt,$,_e)}else nt!=null&&$.push(et.replace(/_.*/,"").replace(/[A-Z]/g,rt=>"-"+rt.toLowerCase())+": "+nt+";")}($.length||_e)&&b.push((a&&!_&&!j?h.map(a):h).join(", ")+" {"+$.join(" ")+"}")}for(let h in e)d(c(h),e[h],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,o,a){let c=e[SET],d=a&&a.nonce;c?d&&c.setNonce(d):c=new StyleSet(e,d),c.mount(Array.isArray(o)?o:[o],e)}}let adoptedSet=new Map;class StyleSet{constructor(e,o){let a=e.ownerDocument||e,c=a.defaultView;if(!e.head&&e.adoptedStyleSheets&&c.CSSStyleSheet){let d=adoptedSet.get(a);if(d)return e[SET]=d;this.sheet=new c.CSSStyleSheet,adoptedSet.set(a,this)}else this.styleTag=a.createElement("style"),o&&this.styleTag.setAttribute("nonce",o);this.modules=[],e[SET]=this}mount(e,o){let a=this.sheet,c=0,d=0;for(let h=0;h<e.length;h++){let g=e[h],b=this.modules.indexOf(g);if(b<d&&b>-1&&(this.modules.splice(b,1),d--,b=-1),b==-1){if(this.modules.splice(d++,0,g),a)for(let j=0;j<g.rules.length;j++)a.insertRule(g.rules[j],c++)}else{for(;d<b;)c+=this.modules[d++].rules.length;c+=g.rules.length,d++}}if(a)o.adoptedStyleSheets.indexOf(this.sheet)<0&&(o.adoptedStyleSheets=[this.sheet,...o.adoptedStyleSheets]);else{let h="";for(let b=0;b<this.modules.length;b++)h+=this.modules[b].getRules()+`
`;this.styleTag.textContent=h;let g=o.head||o;this.styleTag.parentNode!=g&&g.insertBefore(this.styleTag,g.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}function crelt(){var s=arguments[0];typeof s=="string"&&(s=document.createElement(s));var e=1,o=arguments[1];if(o&&typeof o=="object"&&o.nodeType==null&&!Array.isArray(o)){for(var a in o)if(Object.prototype.hasOwnProperty.call(o,a)){var c=o[a];typeof c=="string"?s.setAttribute(a,c):c!=null&&(s[a]=c)}e++}for(;e<arguments.length;e++)add(s,arguments[e]);return s}function add(s,e){if(typeof e=="string")s.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)s.appendChild(e);else if(Array.isArray(e))for(var o=0;o<e.length;o++)add(s,e[o]);else throw new RangeError("Unsupported child node: "+e)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,safari,safari_version:safari?+(/\bVersion\/(\d+(\.\d+)?)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function combineAttrs(s,e){for(let o in s)o=="class"&&e.class?e.class+=" "+s.class:o=="style"&&e.style?e.style+=";"+s.style:e[o]=s[o];return e}const noAttrs$1=Object.create(null);function attrsEq(s,e,o){if(s==e)return!0;s||(s=noAttrs$1),e||(e=noAttrs$1);let a=Object.keys(s),c=Object.keys(e);if(a.length-0!=c.length-0)return!1;for(let d of a)if(d!=o&&(c.indexOf(d)==-1||s[d]!==e[d]))return!1;return!0}function setAttrs(s,e){for(let o=s.attributes.length-1;o>=0;o--){let a=s.attributes[o].name;e[a]==null&&s.removeAttribute(a)}for(let o in e){let a=e[o];o=="style"?s.style.cssText=a:s.getAttribute(o)!=a&&s.setAttribute(o,a)}}function updateAttrs(s,e,o){let a=!1;if(e)for(let c in e)o&&c in o||(a=!0,c=="style"?s.style.cssText="":s.removeAttribute(c));if(o)for(let c in o)e&&e[c]==o[c]||(a=!0,c=="style"?s.style.cssText=o[c]:s.setAttribute(c,o[c]));return a}function getAttrs(s){let e=Object.create(null);for(let o=0;o<s.attributes.length;o++){let a=s.attributes[o];e[a.name]=a.value}return e}class WidgetType{eq(e){return!1}updateDOM(e,o){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,o,a){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var BlockType=function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,o,a,c){super(),this.startSide=e,this.endSide=o,this.widget=a,this.spec=c}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let o=Math.max(-1e4,Math.min(1e4,e.side||0)),a=!!e.block;return o+=a&&!e.inlineOrder?o>0?3e8:-4e8:o>0?1e8:-1e8,new PointDecoration(e,o,o,a,e.widget||null,!1)}static replace(e){let o=!!e.block,a,c;if(e.isBlockGap)a=-5e8,c=4e8;else{let{start:d,end:h}=getInclusive(e,o);a=(d?o?-3e8:-1:5e8)-1,c=(h?o?2e8:1:-6e8)+1}return new PointDecoration(e,a,c,o,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,o=!1){return RangeSet.of(e,o)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:o,end:a}=getInclusive(e);super(o?-1:5e8,a?1:-6e8,null,e),this.tagName=e.tagName||"span",this.attrs=e.class&&e.attributes?combineAttrs(e.attributes,{class:e.class}):e.class?{class:e.class}:e.attributes||noAttrs$1}eq(e){return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&attrsEq(this.attrs,e.attrs)}range(e,o=e){if(e>=o)throw new RangeError("Mark decorations may not be empty");return super.range(e,o)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,o=e){if(o!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,o)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,o,a,c,d,h){super(o,a,d,e),this.block=c,this.isReplace=h,this.mapMode=c?o<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,o=e){if(this.isReplace&&(e>o||e==o&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&o!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,o)}}PointDecoration.prototype.point=!0;function getInclusive(s,e=!1){let{inclusiveStart:o,inclusiveEnd:a}=s;return o==null&&(o=s.inclusive),a==null&&(a=s.inclusive),{start:o??e,end:a??e}}function widgetsEq(s,e){return s==e||!!(s&&e&&s.compare(e))}function addRange(s,e,o,a=0){let c=o.length-1;c>=0&&o[c]+a>=s?o[c]=Math.max(o[c],e):o.push(s,e)}class BlockWrapper extends RangeValue{constructor(e,o){super(),this.tagName=e,this.attributes=o}eq(e){return e==this||e instanceof BlockWrapper&&this.tagName==e.tagName&&attrsEq(this.attributes,e.attributes)}static create(e){return new BlockWrapper(e.tagName,e.attributes||noAttrs$1)}static set(e,o=!1){return RangeSet.of(e,o)}}BlockWrapper.prototype.startSide=BlockWrapper.prototype.endSide=-1;function getSelection$1(s){let e;return s.nodeType==11?e=s.getSelection?s:s.ownerDocument:e=s,e.getSelection()}function contains(s,e){return e?s==e||s.contains(e.nodeType!=1?e.parentNode:e):!1}function hasSelection(s,e){if(!e.anchorNode)return!1;try{return contains(s,e.anchorNode)}catch{return!1}}function clientRectsFor(s){return s.nodeType==3?textRange(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function isEquivalentPosition(s,e,o,a){return o?scanFor(s,e,o,a,-1)||scanFor(s,e,o,a,1):!1}function domIndex(s){for(var e=0;;e++)if(s=s.previousSibling,!s)return e}function isBlockElement(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}function scanFor(s,e,o,a,c){for(;;){if(s==o&&e==a)return!0;if(e==(c<0?0:maxOffset(s))){if(s.nodeName=="DIV")return!1;let d=s.parentNode;if(!d||d.nodeType!=1)return!1;e=domIndex(s)+(c<0?0:1),s=d}else if(s.nodeType==1){if(s=s.childNodes[e+(c<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;e=c<0?maxOffset(s):0}else return!1}}function maxOffset(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function flattenRect(s,e){let o=e?s.left:s.right;return{left:o,right:o,top:s.top,bottom:s.bottom}}function windowRect(s){let e=s.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function getScale(s,e){let o=e.width/s.offsetWidth,a=e.height/s.offsetHeight;return(o>.995&&o<1.005||!isFinite(o)||Math.abs(e.width-s.offsetWidth)<1)&&(o=1),(a>.995&&a<1.005||!isFinite(a)||Math.abs(e.height-s.offsetHeight)<1)&&(a=1),{scaleX:o,scaleY:a}}function scrollRectIntoView(s,e,o,a,c,d,h,g){let b=s.ownerDocument,j=b.defaultView||window;for(let $=s,_=!1;$&&!_;)if($.nodeType==1){let _e,et=$==b.body,nt=1,rt=1;if(et)_e=windowRect(j);else{if(/^(fixed|sticky)$/.test(getComputedStyle($).position)&&(_=!0),$.scrollHeight<=$.clientHeight&&$.scrollWidth<=$.clientWidth){$=$.assignedSlot||$.parentNode;continue}let lt=$.getBoundingClientRect();({scaleX:nt,scaleY:rt}=getScale($,lt)),_e={left:lt.left,right:lt.left+$.clientWidth*nt,top:lt.top,bottom:lt.top+$.clientHeight*rt}}let it=0,st=0;if(c=="nearest")e.top<_e.top?(st=e.top-(_e.top+h),o>0&&e.bottom>_e.bottom+st&&(st=e.bottom-_e.bottom+h)):e.bottom>_e.bottom&&(st=e.bottom-_e.bottom+h,o<0&&e.top-st<_e.top&&(st=e.top-(_e.top+h)));else{let lt=e.bottom-e.top,ot=_e.bottom-_e.top;st=(c=="center"&&lt<=ot?e.top+lt/2-ot/2:c=="start"||c=="center"&&o<0?e.top-h:e.bottom-ot+h)-_e.top}if(a=="nearest"?e.left<_e.left?(it=e.left-(_e.left+d),o>0&&e.right>_e.right+it&&(it=e.right-_e.right+d)):e.right>_e.right&&(it=e.right-_e.right+d,o<0&&e.left<_e.left+it&&(it=e.left-(_e.left+d))):it=(a=="center"?e.left+(e.right-e.left)/2-(_e.right-_e.left)/2:a=="start"==g?e.left-d:e.right-(_e.right-_e.left)+d)-_e.left,it||st)if(et)j.scrollBy(it,st);else{let lt=0,ot=0;if(st){let ct=$.scrollTop;$.scrollTop+=st/rt,ot=($.scrollTop-ct)*rt}if(it){let ct=$.scrollLeft;$.scrollLeft+=it/nt,lt=($.scrollLeft-ct)*nt}e={left:e.left-lt,top:e.top-ot,right:e.right-lt,bottom:e.bottom-ot},lt&&Math.abs(lt-it)<1&&(a="nearest"),ot&&Math.abs(ot-st)<1&&(c="nearest")}if(et)break;(e.top<_e.top||e.bottom>_e.bottom||e.left<_e.left||e.right>_e.right)&&(e={left:Math.max(e.left,_e.left),right:Math.min(e.right,_e.right),top:Math.max(e.top,_e.top),bottom:Math.min(e.bottom,_e.bottom)}),$=$.assignedSlot||$.parentNode}else if($.nodeType==11)$=$.host;else break}function scrollableParents(s){let e=s.ownerDocument,o,a;for(let c=s.parentNode;c&&!(c==e.body||o&&a);)if(c.nodeType==1)!a&&c.scrollHeight>c.clientHeight&&(a=c),!o&&c.scrollWidth>c.clientWidth&&(o=c),c=c.assignedSlot||c.parentNode;else if(c.nodeType==11)c=c.host;else break;return{x:o,y:a}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:o,focusNode:a}=e;this.set(o,Math.min(e.anchorOffset,o?maxOffset(o):0),a,Math.min(e.focusOffset,a?maxOffset(a):0))}set(e,o,a,c){this.anchorNode=e,this.anchorOffset=o,this.focusNode=a,this.focusOffset=c}}let preventScrollSupported=null;browser.safari&&browser.safari_version>=26&&(preventScrollSupported=!1);function focusPreventScroll(s){if(s.setActive)return s.setActive();if(preventScrollSupported)return s.focus(preventScrollSupported);let e=[];for(let o=s;o&&(e.push(o,o.scrollTop,o.scrollLeft),o!=o.ownerDocument);o=o.parentNode);if(s.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let o=0;o<e.length;){let a=e[o++],c=e[o++],d=e[o++];a.scrollTop!=c&&(a.scrollTop=c),a.scrollLeft!=d&&(a.scrollLeft=d)}}}let scratchRange;function textRange(s,e,o=e){let a=scratchRange||(scratchRange=document.createRange());return a.setEnd(s,o),a.setStart(s,e),a}function dispatchKey(s,e,o,a){let c={key:e,code:e,keyCode:o,which:o,cancelable:!0};a&&({altKey:c.altKey,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,metaKey:c.metaKey}=a);let d=new KeyboardEvent("keydown",c);d.synthetic=!0,s.dispatchEvent(d);let h=new KeyboardEvent("keyup",c);return h.synthetic=!0,s.dispatchEvent(h),d.defaultPrevented||h.defaultPrevented}function getRoot(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function atElementStart(s,e){let o=e.focusNode,a=e.focusOffset;if(!o||e.anchorNode!=o||e.anchorOffset!=a)return!1;for(a=Math.min(a,maxOffset(o));;)if(a){if(o.nodeType!=1)return!1;let c=o.childNodes[a-1];c.contentEditable=="false"?a--:(o=c,a=maxOffset(o))}else{if(o==s)return!0;a=domIndex(o),o=o.parentNode}}function isScrolledToBottom(s){return s.scrollTop>Math.max(1,s.scrollHeight-s.clientHeight-4)}function textNodeBefore(s,e){for(let o=s,a=e;;){if(o.nodeType==3&&a>0)return{node:o,offset:a};if(o.nodeType==1&&a>0){if(o.contentEditable=="false")return null;o=o.childNodes[a-1],a=maxOffset(o)}else if(o.parentNode&&!isBlockElement(o))a=domIndex(o),o=o.parentNode;else return null}}function textNodeAfter(s,e){for(let o=s,a=e;;){if(o.nodeType==3&&a<o.nodeValue.length)return{node:o,offset:a};if(o.nodeType==1&&a<o.childNodes.length){if(o.contentEditable=="false")return null;o=o.childNodes[a],a=0}else if(o.parentNode&&!isBlockElement(o))a=domIndex(o)+1,o=o.parentNode;else return null}}class DOMPos{constructor(e,o,a=!0){this.node=e,this.offset=o,this.precise=a}static before(e,o){return new DOMPos(e.parentNode,domIndex(e),o)}static after(e,o){return new DOMPos(e.parentNode,domIndex(e)+1,o)}}var Direction=function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(s){let e=[];for(let o=0;o<s.length;o++)e.push(1<<+s[o]);return e}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let s of["()","[]","{}"]){let e=s.charCodeAt(0),o=s.charCodeAt(1);Brackets[e]=o,Brackets[o]=-e}function charType(s){return s<=247?LowTypes[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?ArabicTypes[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8204?256:64336<=s&&s<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,o,a){this.from=e,this.to=o,this.level=a}side(e,o){return this.dir==o==e?this.to:this.from}forward(e,o){return e==(this.dir==o)}static find(e,o,a,c){let d=-1;for(let h=0;h<e.length;h++){let g=e[h];if(g.from<=o&&g.to>=o){if(g.level==a)return h;(d<0||(c!=0?c<0?g.from<o:g.to>o:e[d].level>g.level))&&(d=h)}}if(d<0)throw new RangeError("Index out of range");return d}}function isolatesEq(s,e){if(s.length!=e.length)return!1;for(let o=0;o<s.length;o++){let a=s[o],c=e[o];if(a.from!=c.from||a.to!=c.to||a.direction!=c.direction||!isolatesEq(a.inner,c.inner))return!1}return!0}const types=[];function computeCharTypes(s,e,o,a,c){for(let d=0;d<=a.length;d++){let h=d?a[d-1].to:e,g=d<a.length?a[d].from:o,b=d?256:c;for(let j=h,$=b,_=b;j<g;j++){let _e=charType(s.charCodeAt(j));_e==512?_e=$:_e==8&&_==4&&(_e=16),types[j]=_e==4?2:_e,_e&7&&(_=_e),$=_e}for(let j=h,$=b,_=b;j<g;j++){let _e=types[j];if(_e==128)j<g-1&&$==types[j+1]&&$&24?_e=types[j]=$:types[j]=256;else if(_e==64){let et=j+1;for(;et<g&&types[et]==64;)et++;let nt=j&&$==8||et<o&&types[et]==8?_==1?1:8:256;for(let rt=j;rt<et;rt++)types[rt]=nt;j=et-1}else _e==8&&_==1&&(types[j]=1);$=_e,_e&7&&(_=_e)}}}function processBracketPairs(s,e,o,a,c){let d=c==1?2:1;for(let h=0,g=0,b=0;h<=a.length;h++){let j=h?a[h-1].to:e,$=h<a.length?a[h].from:o;for(let _=j,_e,et,nt;_<$;_++)if(et=Brackets[_e=s.charCodeAt(_)])if(et<0){for(let rt=g-3;rt>=0;rt-=3)if(BracketStack[rt+1]==-et){let it=BracketStack[rt+2],st=it&2?c:it&4?it&1?d:c:0;st&&(types[_]=types[BracketStack[rt]]=st),g=rt;break}}else{if(BracketStack.length==189)break;BracketStack[g++]=_,BracketStack[g++]=_e,BracketStack[g++]=b}else if((nt=types[_])==2||nt==1){let rt=nt==c;b=rt?0:1;for(let it=g-3;it>=0;it-=3){let st=BracketStack[it+2];if(st&2)break;if(rt)BracketStack[it+2]|=2;else{if(st&4)break;BracketStack[it+2]|=4}}}}}function processNeutrals(s,e,o,a){for(let c=0,d=a;c<=o.length;c++){let h=c?o[c-1].to:s,g=c<o.length?o[c].from:e;for(let b=h;b<g;){let j=types[b];if(j==256){let $=b+1;for(;;)if($==g){if(c==o.length)break;$=o[c++].to,g=c<o.length?o[c].from:e}else if(types[$]==256)$++;else break;let _=d==1,_e=($<e?types[$]:a)==1,et=_==_e?_?1:2:a;for(let nt=$,rt=c,it=rt?o[rt-1].to:s;nt>b;)nt==it&&(nt=o[--rt].from,it=rt?o[rt-1].to:s),types[--nt]=et;b=$}else d=j,b++}}}function emitSpans(s,e,o,a,c,d,h){let g=a%2?2:1;if(a%2==c%2)for(let b=e,j=0;b<o;){let $=!0,_=!1;if(j==d.length||b<d[j].from){let rt=types[b];rt!=g&&($=!1,_=rt==16)}let _e=!$&&g==1?[]:null,et=$?a:a+1,nt=b;e:for(;;)if(j<d.length&&nt==d[j].from){if(_)break e;let rt=d[j];if(!$)for(let it=rt.to,st=j+1;;){if(it==o)break e;if(st<d.length&&d[st].from==it)it=d[st++].to;else{if(types[it]==g)break e;break}}if(j++,_e)_e.push(rt);else{rt.from>b&&h.push(new BidiSpan(b,rt.from,et));let it=rt.direction==LTR!=!(et%2);computeSectionOrder(s,it?a+1:a,c,rt.inner,rt.from,rt.to,h),b=rt.to}nt=rt.to}else{if(nt==o||($?types[nt]!=g:types[nt]==g))break;nt++}_e?emitSpans(s,b,nt,a+1,c,_e,h):b<nt&&h.push(new BidiSpan(b,nt,et)),b=nt}else for(let b=o,j=d.length;b>e;){let $=!0,_=!1;if(!j||b>d[j-1].to){let rt=types[b-1];rt!=g&&($=!1,_=rt==16)}let _e=!$&&g==1?[]:null,et=$?a:a+1,nt=b;e:for(;;)if(j&&nt==d[j-1].to){if(_)break e;let rt=d[--j];if(!$)for(let it=rt.from,st=j;;){if(it==e)break e;if(st&&d[st-1].to==it)it=d[--st].from;else{if(types[it-1]==g)break e;break}}if(_e)_e.push(rt);else{rt.to<b&&h.push(new BidiSpan(rt.to,b,et));let it=rt.direction==LTR!=!(et%2);computeSectionOrder(s,it?a+1:a,c,rt.inner,rt.from,rt.to,h),b=rt.from}nt=rt.from}else{if(nt==e||($?types[nt-1]!=g:types[nt-1]==g))break;nt--}_e?emitSpans(s,nt,b,a+1,c,_e,h):nt<b&&h.push(new BidiSpan(nt,b,et)),b=nt}}function computeSectionOrder(s,e,o,a,c,d,h){let g=e%2?2:1;computeCharTypes(s,c,d,a,g),processBracketPairs(s,c,d,a,g),processNeutrals(c,d,a,g),emitSpans(s,c,d,e,o,a,h)}function computeOrder(s,e,o){if(!s)return[new BidiSpan(0,0,e==RTL?1:0)];if(e==LTR&&!o.length&&!BidiRE.test(s))return trivialOrder(s.length);if(o.length)for(;s.length>types.length;)types[types.length]=256;let a=[],c=e==LTR?0:1;return computeSectionOrder(s,c,c,o,0,s.length,a),a}function trivialOrder(s){return[new BidiSpan(0,s,0)]}let movedOver="";function moveVisually(s,e,o,a,c){var d;let h=a.head-s.from,g=BidiSpan.find(e,h,(d=a.bidiLevel)!==null&&d!==void 0?d:-1,a.assoc),b=e[g],j=b.side(c,o);if(h==j){let _e=g+=c?1:-1;if(_e<0||_e>=e.length)return null;b=e[g=_e],h=b.side(!c,o),j=b.side(c,o)}let $=findClusterBreak(s.text,h,b.forward(c,o));($<b.from||$>b.to)&&($=j),movedOver=s.text.slice(Math.min(h,$),Math.max(h,$));let _=g==(c?e.length-1:0)?null:e[g+(c?1:-1)];return _&&$==j&&_.level+(c?0:1)<b.level?EditorSelection.cursor(_.side(!c,o)+s.from,_.forward(c,o)?1:-1,_.level):EditorSelection.cursor($+s.from,b.forward(c,o)?-1:1,b.level)}function autoDirection(s,e,o){for(let a=e;a<o;a++){let c=charType(s.charCodeAt(a));if(c==1)return LTR;if(c==2||c==4)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler=Facet.define(),focusChangeEffect=Facet.define(),clipboardInputFilter=Facet.define(),clipboardOutputFilter=Facet.define(),perLineTextDirection=Facet.define({combine:s=>s.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:s=>s.some(e=>e)}),scrollHandler=Facet.define();class ScrollTarget{constructor(e,o="nearest",a="nearest",c=5,d=5,h=!1){this.range=e,this.y=o,this.x=a,this.yMargin=c,this.xMargin=d,this.isSnapshot=h}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ScrollTarget(EditorSelection.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView$1=StateEffect.define({map:(s,e)=>s.map(e)}),setEditContextFormatting=StateEffect.define();function logException(s,e,o){let a=s.facet(exceptionSink);a.length?a[0](e):window.onerror&&window.onerror(String(e),o,void 0,void 0,e)||(o?console.error(o+":",e):console.error(e))}const editable=Facet.define({combine:s=>s.length?s[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define({combine(s){return s.filter((e,o)=>{for(let a=0;a<o;a++)if(s[a].plugin==e.plugin)return!1;return!0})}});class ViewPlugin{constructor(e,o,a,c,d){this.id=e,this.create=o,this.domEventHandlers=a,this.domEventObservers=c,this.baseExtensions=d(this),this.extension=this.baseExtensions.concat(viewPlugin.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(viewPlugin.of({plugin:this,arg:e}))}static define(e,o){const{eventHandlers:a,eventObservers:c,provide:d,decorations:h}=o||{};return new ViewPlugin(nextPluginID++,e,a,c,g=>{let b=[];return h&&b.push(decorations.of(j=>{let $=j.plugin(g);return $?h($):Decoration.none})),d&&b.push(d(g)),b})}static fromClass(e,o){return ViewPlugin.define((a,c)=>new e(a,c),o)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let o=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(o)}catch(a){if(logException(o.state,a,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(o){logException(e.state,o,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var o;if(!((o=this.value)===null||o===void 0)&&o.destroy)try{this.value.destroy()}catch(a){logException(e.state,a,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),blockWrappers=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(s,e){let o=s.state.facet(bidiIsolatedRanges);if(!o.length)return o;let a=o.map(d=>d instanceof Function?d(s):d),c=[];return RangeSet.spans(a,e.from,e.to,{point(){},span(d,h,g,b){let j=d-e.from,$=h-e.from,_=c;for(let _e=g.length-1;_e>=0;_e--,b--){let et=g[_e].spec.bidiIsolate,nt;if(et==null&&(et=autoDirection(e.text,j,$)),b>0&&_.length&&(nt=_[_.length-1]).to==j&&nt.direction==et)nt.to=$,_=nt.inner;else{let rt={from:j,to:$,direction:et,inner:[]};_.push(rt),_=rt.inner}}}}),c}const scrollMargins=Facet.define();function getScrollMargins(s){let e=0,o=0,a=0,c=0;for(let d of s.state.facet(scrollMargins)){let h=d(s);h&&(h.left!=null&&(e=Math.max(e,h.left)),h.right!=null&&(o=Math.max(o,h.right)),h.top!=null&&(a=Math.max(a,h.top)),h.bottom!=null&&(c=Math.max(c,h.bottom)))}return{left:e,right:o,top:a,bottom:c}}const styleModule=Facet.define();class ChangedRange{constructor(e,o,a,c){this.fromA=e,this.toA=o,this.fromB=a,this.toB=c}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let o=e.length,a=this;for(;o>0;o--){let c=e[o-1];if(!(c.fromA>a.toA)){if(c.toA<a.fromA)break;a=a.join(c),e.splice(o-1,1)}}return e.splice(o,0,a),e}static extendWithRanges(e,o){if(o.length==0)return e;let a=[];for(let c=0,d=0,h=0;;){let g=c<e.length?e[c].fromB:1e9,b=d<o.length?o[d]:1e9,j=Math.min(g,b);if(j==1e9)break;let $=j+h,_=j,_e=$;for(;;)if(d<o.length&&o[d]<=_){let et=o[d+1];d+=2,_=Math.max(_,et);for(let nt=c;nt<e.length&&e[nt].fromB<=_;nt++)h=e[nt].toA-e[nt].toB;_e=Math.max(_e,et+h)}else if(c<e.length&&e[c].fromB<=_){let et=e[c++];_=Math.max(_,et.toB),_e=Math.max(_e,et.toA),h=et.toA-et.toB}else break;a.push(new ChangedRange($,_e,j,_))}return a}}class ViewUpdate{constructor(e,o,a){this.view=e,this.state=o,this.transactions=a,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let d of a)this.changes=this.changes.compose(d.changes);let c=[];this.changes.iterChangedRanges((d,h,g,b)=>c.push(new ChangedRange(d,h,g,b))),this.changedRanges=c}static create(e,o,a){return new ViewUpdate(e,o,a)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const noChildren=[];class Tile{constructor(e,o,a=0){this.dom=e,this.length=o,this.flags=a,this.parent=null,e.cmTile=this}get breakAfter(){return this.flags&1}get children(){return noChildren}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(e){if(this.flags|=2,this.flags&4){this.flags&=-5;let o=this.domAttrs;o&&setAttrs(this.dom,o)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(e){this.dom=e,e.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e,o=this.posAtStart){let a=o;for(let c of this.children){if(c==e)return a;a+=c.length+c.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}covers(e){return!0}coordsIn(e,o){return null}domPosFor(e,o){let a=domIndex(this.dom),c=this.length?e>0:o>0;return new DOMPos(this.parent.dom,a+(c?1:0),e==0||e==this.length)}markDirty(e){this.flags&=-3,e&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let e=this;e;e=e.parent)if(e instanceof DocTile)return e;return null}static get(e){return e.cmTile}}class CompositeTile extends Tile{constructor(e){super(e,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(e){this.children.push(e),e.parent=this}sync(e){if(this.flags&2)return;super.sync(e);let o=this.dom,a=null,c,d=(e==null?void 0:e.node)==o?e:null,h=0;for(let g of this.children){if(g.sync(e),h+=g.length+g.breakAfter,c=a?a.nextSibling:o.firstChild,d&&c!=g.dom&&(d.written=!0),g.dom.parentNode==o)for(;c&&c!=g.dom;)c=rm$1(c);else o.insertBefore(g.dom,c);a=g.dom}for(c=a?a.nextSibling:o.firstChild,d&&c&&(d.written=!0);c;)c=rm$1(c);this.length=h}}function rm$1(s){let e=s.nextSibling;return s.parentNode.removeChild(s),e}class DocTile extends CompositeTile{constructor(e,o){super(o),this.view=e}owns(e){for(;e;e=e.parent)if(e==this)return!0;return!1}isBlock(){return!0}nearest(e){for(;;){if(!e)return null;let o=Tile.get(e);if(o&&this.owns(o))return o;e=e.parentNode}}blockTiles(e){for(let o=[],a=this,c=0,d=0;;)if(c==a.children.length){if(!o.length)return;a=a.parent,a.breakAfter&&d++,c=o.pop()}else{let h=a.children[c++];if(h instanceof BlockWrapperTile)o.push(c),a=h,c=0;else{let g=d+h.length,b=e(h,d);if(b!==void 0)return b;d=g+h.breakAfter}}}resolveBlock(e,o){let a,c=-1,d,h=-1;if(this.blockTiles((g,b)=>{let j=b+g.length;if(e>=b&&e<=j){if(g.isWidget()&&o>=-1&&o<=1){if(g.flags&32)return!0;g.flags&16&&(a=void 0)}(b<e||e==j&&(o<-1?g.length:g.covers(1)))&&(!a||!g.isWidget()&&a.isWidget())&&(a=g,c=e-b),(j>e||e==b&&(o>1?g.length:g.covers(-1)))&&(!d||!g.isWidget()&&d.isWidget())&&(d=g,h=e-b)}}),!a&&!d)throw new Error("No tile at position "+e);return a&&o<0||!d?{tile:a,offset:c}:{tile:d,offset:h}}}class BlockWrapperTile extends CompositeTile{constructor(e,o){super(e),this.wrapper=o}isBlock(){return!0}covers(e){return this.children.length?e<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(e,o){let a=new BlockWrapperTile(o||document.createElement(e.tagName),e);return o||(a.flags|=4),a}}class LineTile extends CompositeTile{constructor(e,o){super(e),this.attrs=o}isLine(){return!0}static start(e,o,a){let c=new LineTile(o||document.createElement("div"),e);return(!o||!a)&&(c.flags|=4),c}get domAttrs(){return this.attrs}resolveInline(e,o,a){let c=null,d=-1,h=null,g=-1;function b($,_){for(let _e=0,et=0;_e<$.children.length&&et<=_;_e++){let nt=$.children[_e],rt=et+nt.length;rt>=_&&(nt.isComposite()?b(nt,_-et):(!h||h.isHidden&&(o>0||a&&onSameLine(h,nt)))&&(rt>_||nt.flags&32)?(h=nt,g=_-et):(et<_||nt.flags&16&&!nt.isHidden)&&(c=nt,d=_-et)),et=rt}}b(this,e);let j=(o<0?c:h)||c||h;return j?{tile:j,offset:j==c?d:g}:null}coordsIn(e,o){let a=this.resolveInline(e,o,!0);return a?a.tile.coordsIn(Math.max(0,a.offset),o):fallbackRect(this)}domIn(e,o){let a=this.resolveInline(e,o);if(a){let{tile:c,offset:d}=a;if(this.dom.contains(c.dom))return c.isText()?new DOMPos(c.dom,Math.min(c.dom.nodeValue.length,d)):c.domPosFor(d,c.flags&16?1:c.flags&32?-1:o);let h=a.tile.parent,g=!1;for(let b of h.children){if(g)return new DOMPos(b.dom,0);b==a.tile&&(g=!0)}}return new DOMPos(this.dom,0)}}function fallbackRect(s){let e=s.dom.lastChild;if(!e)return s.dom.getBoundingClientRect();let o=clientRectsFor(e);return o[o.length-1]||null}function onSameLine(s,e){let o=s.coordsIn(0,1),a=e.coordsIn(0,1);return o&&a&&a.top<o.bottom}class MarkTile extends CompositeTile{constructor(e,o){super(e),this.mark=o}get domAttrs(){return this.mark.attrs}static of(e,o){let a=new MarkTile(o||document.createElement(e.tagName),e);return o||(a.flags|=4),a}}class TextTile extends Tile{constructor(e,o){super(e,o.length),this.text=o}sync(e){this.flags&2||(super.sync(e),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(e,o){let a=this.dom.nodeValue.length;e>a&&(e=a);let c=e,d=e,h=0;e==0&&o<0||e==a&&o>=0?browser.chrome||browser.gecko||(e?(c--,h=1):d<a&&(d++,h=-1)):o<0?c--:d<a&&d++;let g=textRange(this.dom,c,d).getClientRects();if(!g.length)return null;let b=g[(h?h<0:o>=0)?0:g.length-1];return browser.safari&&!h&&b.width==0&&(b=Array.prototype.find.call(g,j=>j.width)||b),h?flattenRect(b,h<0):b||null}static of(e,o){let a=new TextTile(o||document.createTextNode(e),e);return o||(a.flags|=2),a}}class WidgetTile extends Tile{constructor(e,o,a,c){super(e,o,c),this.widget=a}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(e){return this.flags&48?!1:(this.flags&(e<0?64:128))>0}coordsIn(e,o){return this.coordsInWidget(e,o,!1)}coordsInWidget(e,o,a){let c=this.widget.coordsAt(this.dom,e,o);if(c)return c;if(a)return flattenRect(this.dom.getBoundingClientRect(),this.length?e==0:o<=0);{let d=this.dom.getClientRects(),h=null;if(!d.length)return null;let g=this.flags&16?!0:this.flags&32?!1:e>0;for(let b=g?d.length-1:0;h=d[b],!(e>0?b==0:b==d.length-1||h.top<h.bottom);b+=g?-1:1);return flattenRect(h,!g)}}get overrideDOMText(){if(!this.length)return Text.empty;let{root:e}=this;if(!e)return Text.empty;let o=this.posAtStart;return e.view.state.doc.slice(o,o+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(e,o,a,c,d){return d||(d=e.toDOM(o),e.editable||(d.contentEditable="false")),new WidgetTile(d,a,e,c)}}class WidgetBufferTile extends Tile{constructor(e){let o=document.createElement("img");o.className="cm-widgetBuffer",o.setAttribute("aria-hidden","true"),super(o,0,e)}get isHidden(){return!0}get overrideDOMText(){return Text.empty}coordsIn(e){return this.dom.getBoundingClientRect()}}class TilePointer{constructor(e){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=e}advance(e,o,a){let{tile:c,index:d,beforeBreak:h,parents:g}=this;for(;e||o>0;)if(c.isComposite())if(h){if(!e)break;a&&a.break(),e--,h=!1}else if(d==c.children.length){if(!e&&!g.length)break;a&&a.leave(c),h=!!c.breakAfter,{tile:c,index:d}=g.pop(),d++}else{let b=c.children[d],j=b.breakAfter;(o>0?b.length<=e:b.length<e)&&(!a||a.skip(b,0,b.length)!==!1||!b.isComposite)?(h=!!j,d++,e-=b.length):(g.push({tile:c,index:d}),c=b,d=0,a&&b.isComposite()&&a.enter(b))}else if(d==c.length)h=!!c.breakAfter,{tile:c,index:d}=g.pop(),d++;else if(e){let b=Math.min(e,c.length-d);a&&a.skip(c,d,d+b),e-=b,d+=b}else break;return this.tile=c,this.index=d,this.beforeBreak=h,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class OpenWrapper{constructor(e,o,a,c){this.from=e,this.to=o,this.wrapper=a,this.rank=c}}class TileBuilder{constructor(e,o,a){this.cache=e,this.root=o,this.blockWrappers=a,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(e,o,a,c){var d;this.flushBuffer();let h=this.ensureMarks(o,a),g=h.lastChild;if(g&&g.isText()&&!(g.flags&8)){this.cache.reused.set(g,2);let b=h.children[h.children.length-1]=new TextTile(g.dom,g.text+e);b.parent=h}else h.append(c||TextTile.of(e,(d=this.cache.find(TextTile))===null||d===void 0?void 0:d.dom));this.pos+=e.length,this.afterWidget=null}addComposition(e,o){let a=this.curLine;a.dom!=o.line.dom&&(a.setDOM(this.cache.reused.has(o.line)?freeNode(o.line.dom):o.line.dom),this.cache.reused.set(o.line,2));let c=a;for(let g=o.marks.length-1;g>=0;g--){let b=o.marks[g],j=c.lastChild;if(j instanceof MarkTile&&j.mark.eq(b.mark))j.dom!=b.dom&&j.setDOM(freeNode(b.dom)),c=j;else{if(this.cache.reused.get(b)){let _=Tile.get(b.dom);_&&_.setDOM(freeNode(b.dom))}let $=MarkTile.of(b.mark,b.dom);c.append($),c=$}this.cache.reused.set(b,2)}let d=Tile.get(e.text);d&&this.cache.reused.set(d,2);let h=new TextTile(e.text,e.text.nodeValue);h.flags|=8,c.append(h)}addInlineWidget(e,o,a){let c=this.afterWidget&&e.flags&48&&(this.afterWidget.flags&48)==(e.flags&48);c||this.flushBuffer();let d=this.ensureMarks(o,a);!c&&!(e.flags&16)&&d.append(this.getBuffer(1)),d.append(e),this.pos+=e.length,this.afterWidget=e}addMark(e,o,a){this.flushBuffer(),this.ensureMarks(o,a).append(e),this.pos+=e.length,this.afterWidget=null}addBlockWidget(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}continueWidget(e){let o=this.afterWidget||this.lastBlock;o.length+=e,this.pos+=e}addLineStart(e,o){var a;e||(e=lineBaseAttrs);let c=LineTile.start(e,o||((a=this.cache.find(LineTile))===null||a===void 0?void 0:a.dom),!!o);this.getBlockPos().append(this.lastBlock=this.curLine=c)}addLine(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(e){this.blockPosCovered()||this.addLineStart(e)}ensureLine(e){this.curLine||this.addLineStart(e)}ensureMarks(e,o){var a;let c=this.curLine;for(let d=e.length-1;d>=0;d--){let h=e[d],g;if(o>0&&(g=c.lastChild)&&g instanceof MarkTile&&g.mark.eq(h))c=g,o--;else{let b=MarkTile.of(h,(a=this.cache.find(MarkTile,j=>j.mark.eq(h)))===null||a===void 0?void 0:a.dom);c.append(b),c=b,o=0}}return c}endLine(){if(this.curLine){this.flushBuffer();let e=this.curLine.lastChild;(!e||!hasContent(this.curLine,!1)||e.dom.nodeName!="BR"&&e.isWidget()&&!(browser.ios&&hasContent(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(BreakWidget,0,32)||new WidgetTile(BreakWidget.toDOM(),0,BreakWidget,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let e=this.wrappers.length-1;e>=0;e--)this.wrappers[e].to<this.pos&&this.wrappers.splice(e,1);for(let e=this.blockWrappers;e.value&&e.from<=this.pos;e.next())if(e.to>=this.pos){let o=new OpenWrapper(e.from,e.to,e.value,e.rank),a=this.wrappers.length;for(;a>0&&(this.wrappers[a-1].rank-o.rank||this.wrappers[a-1].to-o.to)<0;)a--;this.wrappers.splice(a,0,o)}this.wrapperPos=this.pos}getBlockPos(){var e;this.updateBlockWrappers();let o=this.root;for(let a of this.wrappers){let c=o.lastChild;if(a.from<this.pos&&c instanceof BlockWrapperTile&&c.wrapper.eq(a.wrapper))o=c;else{let d=BlockWrapperTile.of(a.wrapper,(e=this.cache.find(BlockWrapperTile,h=>h.wrapper.eq(a.wrapper)))===null||e===void 0?void 0:e.dom);o.append(d),o=d}}return o}blockPosCovered(){let e=this.lastBlock;return e!=null&&!e.breakAfter&&(!e.isWidget()||(e.flags&160)>0)}getBuffer(e){let o=2|(e<0?16:32),a=this.cache.find(WidgetBufferTile,void 0,1);return a&&(a.flags=o),a||new WidgetBufferTile(o)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class TextStream{constructor(e){this.skipCount=0,this.text="",this.textOff=0,this.cursor=e.iter()}skip(e){this.textOff+e<=this.text.length?this.textOff+=e:(this.skipCount+=e-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(e){if(this.textOff==this.text.length){let{value:c,lineBreak:d,done:h}=this.cursor.next(this.skipCount);if(this.skipCount=0,h)throw new Error("Ran out of text content when drawing inline views");this.text=c;let g=this.textOff=Math.min(e,c.length);return d?null:c.slice(0,g)}let o=Math.min(this.text.length,this.textOff+e),a=this.text.slice(this.textOff,o);return this.textOff=o,a}}const buckets=[WidgetTile,LineTile,TextTile,MarkTile,WidgetBufferTile,BlockWrapperTile,DocTile];for(let s=0;s<buckets.length;s++)buckets[s].bucket=s;class TileCache{constructor(e){this.view=e,this.buckets=buckets.map(()=>[]),this.index=buckets.map(()=>0),this.reused=new Map}add(e){let o=e.constructor.bucket,a=this.buckets[o];a.length<6?a.push(e):a[this.index[o]=(this.index[o]+1)%6]=e}find(e,o,a=2){let c=e.bucket,d=this.buckets[c],h=this.index[c];for(let g=d.length-1;g>=0;g--){let b=(g+h)%d.length,j=d[b];if((!o||o(j))&&!this.reused.has(j))return d.splice(b,1),b<h&&this.index[c]--,this.reused.set(j,a),j}return null}findWidget(e,o,a){let c=this.buckets[0];if(c.length)for(let d=0,h=0;;d++){if(d==c.length){if(h)return null;h=1,d=0}let g=c[d];if(!this.reused.has(g)&&(h==0?g.widget.compare(e):g.widget.constructor==e.constructor&&e.updateDOM(g.dom,this.view)))return c.splice(d,1),d<this.index[0]&&this.index[0]--,g.widget==e&&g.length==o&&(g.flags&497)==a?(this.reused.set(g,1),g):(this.reused.set(g,2),new WidgetTile(g.dom,o,e,g.flags&-498|a))}}reuse(e){return this.reused.set(e,1),e}maybeReuse(e,o=2){if(!this.reused.has(e))return this.reused.set(e,o),e.dom}clear(){for(let e=0;e<this.buckets.length;e++)this.buckets[e].length=this.index[e]=0}}class TileUpdate{constructor(e,o,a,c,d){this.view=e,this.decorations=c,this.disallowBlockEffectsFor=d,this.openWidget=!1,this.openMarks=0,this.cache=new TileCache(e),this.text=new TextStream(e.state.doc),this.builder=new TileBuilder(this.cache,new DocTile(e,e.contentDOM),RangeSet.iter(a)),this.cache.reused.set(o,2),this.old=new TilePointer(o),this.reuseWalker={skip:(h,g,b)=>{if(this.cache.add(h),h.isComposite())return!1},enter:h=>this.cache.add(h),leave:()=>{},break:()=>{}}}run(e,o){let a=o&&this.getCompositionContext(o.text);for(let c=0,d=0,h=0;;){let g=h<e.length?e[h++]:null,b=g?g.fromA:this.old.root.length;if(b>c){let j=b-c;this.preserve(j,!h,!g),c=b,d+=j}if(!g)break;o&&g.fromA<=o.range.fromA&&g.toA>=o.range.toA?(this.forward(g.fromA,o.range.fromA,o.range.fromA<o.range.toA?1:-1),this.emit(d,o.range.fromB),this.cache.clear(),this.builder.addComposition(o,a),this.text.skip(o.range.toB-o.range.fromB),this.forward(o.range.fromA,g.toA),this.emit(o.range.toB,g.toB)):(this.forward(g.fromA,g.toA),this.emit(d,g.toB)),d=g.toB,c=g.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(e,o,a){let c=getMarks(this.old),d=this.openMarks;this.old.advance(e,a?1:-1,{skip:(h,g,b)=>{if(h.isWidget())if(this.openWidget)this.builder.continueWidget(b-g);else{let j=b>0||g<h.length?WidgetTile.of(h.widget,this.view,b-g,h.flags&496,this.cache.maybeReuse(h)):this.cache.reuse(h);j.flags&256?(j.flags&=-2,this.builder.addBlockWidget(j)):(this.builder.ensureLine(null),this.builder.addInlineWidget(j,c,d),d=c.length)}else if(h.isText())this.builder.ensureLine(null),!g&&b==h.length?this.builder.addText(h.text,c,d,this.cache.reuse(h)):(this.cache.add(h),this.builder.addText(h.text.slice(g,b),c,d)),d=c.length;else if(h.isLine())h.flags&=-2,this.cache.reused.set(h,1),this.builder.addLine(h);else if(h instanceof WidgetBufferTile)this.cache.add(h);else if(h instanceof MarkTile)this.builder.ensureLine(null),this.builder.addMark(h,c,d),this.cache.reused.set(h,1),d=c.length;else return!1;this.openWidget=!1},enter:h=>{h.isLine()?this.builder.addLineStart(h.attrs,this.cache.maybeReuse(h)):(this.cache.add(h),h instanceof MarkTile&&c.unshift(h.mark)),this.openWidget=!1},leave:h=>{h.isLine()?c.length&&(c.length=d=0):h instanceof MarkTile&&(c.shift(),d=Math.min(d,c.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(e)}emit(e,o){let a=null,c=this.builder,d=0,h=RangeSet.spans(this.decorations,e,o,{point:(g,b,j,$,_,_e)=>{if(j instanceof PointDecoration){if(this.disallowBlockEffectsFor[_e]){if(j.block)throw new RangeError("Block decorations may not be specified via plugins");if(b>this.view.state.doc.lineAt(g).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(d=$.length,_>$.length)c.continueWidget(b-g);else{let et=j.widget||(j.block?NullWidget.block:NullWidget.inline),nt=widgetFlags(j),rt=this.cache.findWidget(et,b-g,nt)||WidgetTile.of(et,this.view,b-g,nt);j.block?(j.startSide>0&&c.addLineStartIfNotCovered(a),c.addBlockWidget(rt)):(c.ensureLine(a),c.addInlineWidget(rt,$,_))}a=null}else a=addLineDeco(a,j);b>g&&this.text.skip(b-g)},span:(g,b,j,$)=>{for(let _=g;_<b;){let _e=this.text.next(Math.min(512,b-_));_e==null?(c.addLineStartIfNotCovered(a),c.addBreak(),_++):(c.ensureLine(a),c.addText(_e,j,$),_+=_e.length),a=null}}});c.addLineStartIfNotCovered(a),this.openWidget=h>d,this.openMarks=h}forward(e,o,a=1){o-e<=10?this.old.advance(o-e,a,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(o-e-10,-1),this.old.advance(5,a,this.reuseWalker))}getCompositionContext(e){let o=[],a=null;for(let c=e.parentNode;;c=c.parentNode){let d=Tile.get(c);if(c==this.view.contentDOM)break;d instanceof MarkTile?o.push(d):d!=null&&d.isLine()?a=d:c.nodeName=="DIV"&&!a&&c!=this.view.contentDOM?a=new LineTile(c,lineBaseAttrs):o.push(MarkTile.of(new MarkDecoration({tagName:c.nodeName.toLowerCase(),attributes:getAttrs(c)}),c))}return{line:a,marks:o}}}function hasContent(s,e){let o=a=>{for(let c of a.children)if((e?c.isText():c.length)||o(c))return!0;return!1};return o(s)}function widgetFlags(s){let e=s.isReplace?(s.startSide<0?64:0)|(s.endSide>0?128:0):s.startSide>0?32:16;return s.block&&(e|=256),e}const lineBaseAttrs={class:"cm-line"};function addLineDeco(s,e){let o=e.spec.attributes,a=e.spec.class;return!o&&!a||(s||(s={class:"cm-line"}),o&&combineAttrs(o,s),a&&(s.class+=" "+a)),s}function getMarks(s){let e=[];for(let o=s.parents.length;o>1;o--){let a=o==s.parents.length?s.tile:s.parents[o].tile;a instanceof MarkTile&&e.push(a.mark)}return e}function freeNode(s){let e=Tile.get(s);return e&&e.setDOM(s.cloneNode()),s}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span");NullWidget.block=new NullWidget("div");const BreakWidget=new class extends WidgetType{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class DocView{constructor(e){this.view=e,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new DocTile(e,e.contentDOM),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],null)}update(e){var o;let a=e.changedRanges;this.minWidth>0&&a.length&&(a.every(({fromA:$,toA:_})=>_<this.minWidthFrom||$>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let c=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((o=this.domChanged)===null||o===void 0)&&o.newSel?c=this.domChanged.newSel.head:!touchesComposition(e.changes,this.hasComposition)&&!e.selectionSet&&(c=e.state.selection.main.head));let d=c>-1?findCompositionRange(this.view,e.changes,c):null;if(this.domChanged=null,this.hasComposition){let{from:$,to:_}=this.hasComposition;a=new ChangedRange($,_,e.changes.mapPos($,-1),e.changes.mapPos(_,1)).addToSet(a.slice())}this.hasComposition=d?{from:d.range.fromB,to:d.range.toB}:null,(browser.ie||browser.chrome)&&!d&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let h=this.decorations,g=this.blockWrappers;this.updateDeco();let b=findChangedDeco(h,this.decorations,e.changes);b.length&&(a=ChangedRange.extendWithRanges(a,b));let j=findChangedWrappers(g,this.blockWrappers,e.changes);return j.length&&(a=ChangedRange.extendWithRanges(a,j)),d&&!a.some($=>$.fromA<=d.range.fromA&&$.toA>=d.range.toA)&&(a=d.range.addToSet(a.slice())),this.tile.flags&2&&a.length==0?!1:(this.updateInner(a,d),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,o){this.view.viewState.mustMeasureContent=!0;let{observer:a}=this.view;a.ignore(()=>{if(o||e.length){let h=this.tile,g=new TileUpdate(this.view,h,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=g.run(e,o),destroyDropped(h,g.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let d=browser.chrome||browser.ios?{node:a.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(d),d&&(d.written||a.selectionRange.focusNode!=d.node||!this.tile.dom.contains(d.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let c=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let d of this.tile.children)d.isWidget()&&d.widget instanceof BlockGapWidget&&c.push(d.dom);a.updateGaps(c)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let o of e.transactions)for(let a of o.effects)a.is(setEditContextFormatting)&&(this.editContextFormatting=a.value)}updateSelection(e=!1,o=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:a}=this.tile,c=this.view.root.activeElement,d=c==a,h=!d&&!(this.view.state.facet(editable)||a.tabIndex>-1)&&hasSelection(a,this.view.observer.selectionRange)&&!(c&&a.contains(c));if(!(d||o||h))return;let g=this.forceSelection;this.forceSelection=!1;let b=this.view.state.selection.main,j,$;if(b.empty?$=j=this.inlineDOMNearPos(b.anchor,b.assoc||1):($=this.inlineDOMNearPos(b.head,b.head==b.from?1:-1),j=this.inlineDOMNearPos(b.anchor,b.anchor==b.from?1:-1)),browser.gecko&&b.empty&&!this.hasComposition&&betweenUneditable(j)){let _e=document.createTextNode("");this.view.observer.ignore(()=>j.node.insertBefore(_e,j.node.childNodes[j.offset]||null)),j=$=new DOMPos(_e,0),g=!0}let _=this.view.observer.selectionRange;(g||!_.focusNode||(!isEquivalentPosition(j.node,j.offset,_.anchorNode,_.anchorOffset)||!isEquivalentPosition($.node,$.offset,_.focusNode,_.focusOffset))&&!this.suppressWidgetCursorChange(_,b))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&a.contains(_.focusNode)&&inUneditable(_.focusNode,a)&&(a.blur(),a.focus({preventScroll:!0}));let _e=getSelection$1(this.view.root);if(_e)if(b.empty){if(browser.gecko){let et=nextToUneditable(j.node,j.offset);if(et&&et!=3){let nt=(et==1?textNodeBefore:textNodeAfter)(j.node,j.offset);nt&&(j=new DOMPos(nt.node,nt.offset))}}_e.collapse(j.node,j.offset),b.bidiLevel!=null&&_e.caretBidiLevel!==void 0&&(_e.caretBidiLevel=b.bidiLevel)}else if(_e.extend){_e.collapse(j.node,j.offset);try{_e.extend($.node,$.offset)}catch{}}else{let et=document.createRange();b.anchor>b.head&&([j,$]=[$,j]),et.setEnd($.node,$.offset),et.setStart(j.node,j.offset),_e.removeAllRanges(),_e.addRange(et)}h&&this.view.root.activeElement==a&&(a.blur(),c&&c.focus())}),this.view.observer.setSelectionRange(j,$)),this.impreciseAnchor=j.precise?null:new DOMPos(_.anchorNode,_.anchorOffset),this.impreciseHead=$.precise?null:new DOMPos(_.focusNode,_.focusOffset)}suppressWidgetCursorChange(e,o){return this.hasComposition&&o.empty&&isEquivalentPosition(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==o.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,o=e.state.selection.main,a=getSelection$1(e.root),{anchorNode:c,anchorOffset:d}=e.observer.selectionRange;if(!a||!o.empty||!o.assoc||!a.modify)return;let h=this.lineAt(o.head,o.assoc);if(!h)return;let g=h.posAtStart;if(o.head==g||o.head==g+h.length)return;let b=this.coordsAt(o.head,-1),j=this.coordsAt(o.head,1);if(!b||!j||b.bottom>j.top)return;let $=this.domAtPos(o.head+o.assoc,o.assoc);a.collapse($.node,$.offset),a.modify("move",o.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let _=e.observer.selectionRange;e.docView.posFromDOM(_.anchorNode,_.anchorOffset)!=o.from&&a.collapse(c,d)}posFromDOM(e,o){let a=this.tile.nearest(e);if(!a)return this.tile.dom.compareDocumentPosition(e)&2?0:this.view.state.doc.length;let c=a.posAtStart;if(a.isComposite()){let d;if(e==a.dom)d=a.dom.childNodes[o];else{let h=maxOffset(e)==0?0:o==0?-1:1;for(;;){let g=e.parentNode;if(g==a.dom)break;h==0&&g.firstChild!=g.lastChild&&(e==g.firstChild?h=-1:h=1),e=g}h<0?d=e:d=e.nextSibling}if(d==a.dom.firstChild)return c;for(;d&&!Tile.get(d);)d=d.nextSibling;if(!d)return c+a.length;for(let h=0,g=c;;h++){let b=a.children[h];if(b.dom==d)return g;g+=b.length+b.breakAfter}}else return a.isText()?e==a.dom?c+o:c+(o?a.length:0):c}domAtPos(e,o){let{tile:a,offset:c}=this.tile.resolveBlock(e,o);return a.isWidget()?a.domPosFor(e,o):a.domIn(c,o)}inlineDOMNearPos(e,o){let a,c=-1,d=!1,h,g=-1,b=!1;return this.tile.blockTiles((j,$)=>{if(j.isWidget()){if(j.flags&32&&$>=e)return!0;j.flags&16&&(d=!0)}else{let _=$+j.length;if($<=e&&(a=j,c=e-$,d=_<e),_>=e&&!h&&(h=j,g=e-$,b=$>e),$>e&&h)return!0}}),!a&&!h?this.domAtPos(e,o):(d&&h?a=null:b&&a&&(h=null),a&&o<0||!h?a.domIn(c,o):h.domIn(g,o))}coordsAt(e,o){let{tile:a,offset:c}=this.tile.resolveBlock(e,o);return a.isWidget()?a.widget instanceof BlockGapWidget?null:a.coordsInWidget(c,o,!0):a.coordsIn(c,o)}lineAt(e,o){let{tile:a}=this.tile.resolveBlock(e,o);return a.isLine()?a:null}coordsForChar(e){let{tile:o,offset:a}=this.tile.resolveBlock(e,1);if(!o.isLine())return null;function c(d,h){if(d.isComposite())for(let g of d.children){if(g.length>=h){let b=c(g,h);if(b)return b}if(h-=g.length,h<0)break}else if(d.isText()&&h<d.length){let g=findClusterBreak(d.text,h);if(g==h)return null;let b=textRange(d.dom,h,g).getClientRects();for(let j=0;j<b.length;j++){let $=b[j];if(j==b.length-1||$.top<$.bottom&&$.left<$.right)return $}}return null}return c(o,a)}measureVisibleLineHeights(e){let o=[],{from:a,to:c}=e,d=this.view.contentDOM.clientWidth,h=d>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,g=-1,b=this.view.textDirection==Direction.LTR,j=0,$=(_,_e,et)=>{for(let nt=0;nt<_.children.length&&!(_e>c);nt++){let rt=_.children[nt],it=_e+rt.length,st=rt.dom.getBoundingClientRect(),{height:lt}=st;if(et&&!nt&&(j+=st.top-et.top),rt instanceof BlockWrapperTile)it>a&&$(rt,_e,st);else if(_e>=a&&(j>0&&o.push(-j),o.push(lt+j),j=0,h)){let ot=rt.dom.lastChild,ct=ot?clientRectsFor(ot):[];if(ct.length){let ut=ct[ct.length-1],at=b?ut.right-st.left:st.right-ut.left;at>g&&(g=at,this.minWidth=d,this.minWidthFrom=_e,this.minWidthTo=it)}}et&&nt==_.children.length-1&&(j+=et.bottom-st.bottom),_e=it+rt.breakAfter}};return $(this.tile,0,null),o}textDirectionAt(e){let{tile:o}=this.tile.resolveBlock(e,1);return getComputedStyle(o.dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){let e=this.tile.blockTiles(h=>{if(h.isLine()&&h.children.length&&h.length<=20){let g=0,b;for(let j of h.children){if(!j.isText()||/[^ -~]/.test(j.text))return;let $=clientRectsFor(j.dom);if($.length!=1)return;g+=$[0].width,b=$[0].height}if(g)return{lineHeight:h.dom.getBoundingClientRect().height,charWidth:g/h.length,textHeight:b}}});if(e)return e;let o=document.createElement("div"),a,c,d;return o.className="cm-line",o.style.width="99999px",o.style.position="absolute",o.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(o);let h=clientRectsFor(o.firstChild)[0];a=o.getBoundingClientRect().height,c=h&&h.width?h.width/27:7,d=h&&h.height?h.height:a,o.remove()}),{lineHeight:a,charWidth:c,textHeight:d}}computeBlockGapDeco(){let e=[],o=this.view.viewState;for(let a=0,c=0;;c++){let d=c==o.viewports.length?null:o.viewports[c],h=d?d.from-1:this.view.state.doc.length;if(h>a){let g=(o.lineBlockAt(h).bottom-o.lineBlockAt(a).top)/this.view.scaleY;e.push(Decoration.replace({widget:new BlockGapWidget(g),block:!0,inclusive:!0,isBlockGap:!0}).range(a,h))}if(!d)break;a=d.to+1}return Decoration.set(e)}updateDeco(){let e=1,o=this.view.state.facet(decorations).map(d=>(this.dynamicDecorationMap[e++]=typeof d=="function")?d(this.view):d),a=!1,c=this.view.state.facet(outerDecorations).map((d,h)=>{let g=typeof d=="function";return g&&(a=!0),g?d(this.view):d});for(c.length&&(this.dynamicDecorationMap[e++]=a,o.push(RangeSet.join(c))),this.decorations=[this.editContextFormatting,...o,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;this.blockWrappers=this.view.state.facet(blockWrappers).map(d=>typeof d=="function"?d(this.view):d)}scrollIntoView(e){if(e.isSnapshot){let j=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=j.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let j of this.view.state.facet(scrollHandler))try{if(j(this.view,e.range,e))return!0}catch($){logException(this.view.state,$,"scroll handler")}let{range:o}=e,a=this.coordsAt(o.head,o.empty?o.assoc:o.head>o.anchor?-1:1),c;if(!a)return;!o.empty&&(c=this.coordsAt(o.anchor,o.anchor>o.head?-1:1))&&(a={left:Math.min(a.left,c.left),top:Math.min(a.top,c.top),right:Math.max(a.right,c.right),bottom:Math.max(a.bottom,c.bottom)});let d=getScrollMargins(this.view),h={left:a.left-d.left,top:a.top-d.top,right:a.right+d.right,bottom:a.bottom+d.bottom},{offsetWidth:g,offsetHeight:b}=this.view.scrollDOM;scrollRectIntoView(this.view.scrollDOM,h,o.head<o.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,g),-g),Math.max(Math.min(e.yMargin,b),-b),this.view.textDirection==Direction.LTR)}lineHasWidget(e){let o=a=>a.isWidget()||a.children.some(o);return o(this.tile.resolveBlock(e,1).tile)}destroy(){destroyDropped(this.tile)}}function destroyDropped(s,e){let o=e==null?void 0:e.get(s);if(o!=1){o==null&&s.destroy();for(let a of s.children)destroyDropped(a,e)}}function betweenUneditable(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}function findCompositionNode(s,e){let o=s.observer.selectionRange;if(!o.focusNode)return null;let a=textNodeBefore(o.focusNode,o.focusOffset),c=textNodeAfter(o.focusNode,o.focusOffset),d=a||c;if(c&&a&&c.node!=a.node){let g=Tile.get(c.node);if(!g||g.isText()&&g.text!=c.node.nodeValue)d=c;else if(s.docView.lastCompositionAfterCursor){let b=Tile.get(a.node);!b||b.isText()&&b.text!=a.node.nodeValue||(d=c)}}if(s.docView.lastCompositionAfterCursor=d!=a,!d)return null;let h=e-d.offset;return{from:h,to:h+d.node.nodeValue.length,node:d.node}}function findCompositionRange(s,e,o){let a=findCompositionNode(s,o);if(!a)return null;let{node:c,from:d,to:h}=a,g=c.nodeValue;if(/[\n\r]/.test(g)||s.state.doc.sliceString(a.from,a.to)!=g)return null;let b=e.invertedDesc;return{range:new ChangedRange(b.mapPos(d),b.mapPos(h),d,h),text:c}}function nextToUneditable(s,e){return s.nodeType!=1?0:(e&&s.childNodes[e-1].contentEditable=="false"?1:0)|(e<s.childNodes.length&&s.childNodes[e].contentEditable=="false"?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(e,o){addRange(e,o,this.changes)}comparePoint(e,o){addRange(e,o,this.changes)}boundChange(e){addRange(e,e,this.changes)}};function findChangedDeco(s,e,o){let a=new DecorationComparator$1;return RangeSet.compare(s,e,o,a),a.changes}class WrapperComparator{constructor(){this.changes=[]}compareRange(e,o){addRange(e,o,this.changes)}comparePoint(){}boundChange(e){addRange(e,e,this.changes)}}function findChangedWrappers(s,e,o){let a=new WrapperComparator;return RangeSet.compare(s,e,o,a),a.changes}function inUneditable(s,e){for(let o=s;o&&o!=e;o=o.assignedSlot||o.parentNode)if(o.nodeType==1&&o.contentEditable=="false")return!0;return!1}function touchesComposition(s,e){let o=!1;return e&&s.iterChangedRanges((a,c)=>{a<e.to&&c>e.from&&(o=!0)}),o}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function groupAt(s,e,o=1){let a=s.charCategorizer(e),c=s.doc.lineAt(e),d=e-c.from;if(c.length==0)return EditorSelection.cursor(e);d==0?o=1:d==c.length&&(o=-1);let h=d,g=d;o<0?h=findClusterBreak(c.text,d,!1):g=findClusterBreak(c.text,d);let b=a(c.text.slice(h,g));for(;h>0;){let j=findClusterBreak(c.text,h,!1);if(a(c.text.slice(j,h))!=b)break;h=j}for(;g<c.length;){let j=findClusterBreak(c.text,g);if(a(c.text.slice(g,j))!=b)break;g=j}return EditorSelection.range(h+c.from,g+c.from)}function posAtCoordsImprecise(s,e,o,a,c){let d=Math.round((a-e.left)*s.defaultCharacterWidth);if(s.lineWrapping&&o.height>s.defaultLineHeight*1.5){let g=s.viewState.heightOracle.textHeight,b=Math.floor((c-o.top-(s.defaultLineHeight-g)*.5)/g);d+=b*s.viewState.heightOracle.lineLength}let h=s.state.sliceDoc(o.from,o.to);return o.from+findColumn(h,d,s.state.tabSize)}function blockAt(s,e,o){let a=s.lineBlockAt(e);if(Array.isArray(a.type)){let c;for(let d of a.type){if(d.from>e)break;if(!(d.to<e)){if(d.from<e&&d.to>e)return d;(!c||d.type==BlockType.Text&&(c.type!=d.type||(o<0?d.from<e:d.to>e)))&&(c=d)}}return c||a}return a}function moveToLineBoundary(s,e,o,a){let c=blockAt(s,e.head,e.assoc||-1),d=!a||c.type!=BlockType.Text||!(s.lineWrapping||c.widgetLineBreaks)?null:s.coordsAtPos(e.assoc<0&&e.head>c.from?e.head-1:e.head);if(d){let h=s.dom.getBoundingClientRect(),g=s.textDirectionAt(c.from),b=s.posAtCoords({x:o==(g==Direction.LTR)?h.right-1:h.left+1,y:(d.top+d.bottom)/2});if(b!=null)return EditorSelection.cursor(b,o?-1:1)}return EditorSelection.cursor(o?c.to:c.from,o?-1:1)}function moveByChar(s,e,o,a){let c=s.state.doc.lineAt(e.head),d=s.bidiSpans(c),h=s.textDirectionAt(c.from);for(let g=e,b=null;;){let j=moveVisually(c,d,h,g,o),$=movedOver;if(!j){if(c.number==(o?s.state.doc.lines:1))return g;$=`
`,c=s.state.doc.line(c.number+(o?1:-1)),d=s.bidiSpans(c),j=s.visualLineSide(c,!o)}if(b){if(!b($))return g}else{if(!a)return j;b=a($)}g=j}}function byGroup(s,e,o){let a=s.state.charCategorizer(e),c=a(o);return d=>{let h=a(d);return c==CharCategory.Space&&(c=h),c==h}}function moveVertically(s,e,o,a){let c=e.head,d=o?1:-1;if(c==(o?s.state.doc.length:0))return EditorSelection.cursor(c,e.assoc);let h=e.goalColumn,g,b=s.contentDOM.getBoundingClientRect(),j=s.coordsAtPos(c,e.assoc||-1),$=s.documentTop;if(j)h==null&&(h=j.left-b.left),g=d<0?j.top:j.bottom;else{let nt=s.viewState.lineBlockAt(c);h==null&&(h=Math.min(b.right-b.left,s.defaultCharacterWidth*(c-nt.from))),g=(d<0?nt.top:nt.bottom)+$}let _=b.left+h,_e=a??s.viewState.heightOracle.textHeight>>1,et=posAtCoords(s,{x:_,y:g+_e*d},!1,d);return EditorSelection.cursor(et.pos,et.assoc,void 0,h)}function skipAtomicRanges(s,e,o){for(;;){let a=0;for(let c of s)c.between(e-1,e+1,(d,h,g)=>{if(e>d&&e<h){let b=a||o||(e-d<h-e?-1:1);e=b<0?d:h,a=b}});if(!a)return e}}function skipAtomsForSelection(s,e){let o=null;for(let a=0;a<e.ranges.length;a++){let c=e.ranges[a],d=null;if(c.empty){let h=skipAtomicRanges(s,c.from,0);h!=c.from&&(d=EditorSelection.cursor(h,-1))}else{let h=skipAtomicRanges(s,c.from,-1),g=skipAtomicRanges(s,c.to,1);(h!=c.from||g!=c.to)&&(d=EditorSelection.range(c.from==c.anchor?h:g,c.from==c.head?h:g))}d&&(o||(o=e.ranges.slice()),o[a]=d)}return o?EditorSelection.create(o,e.mainIndex):e}function skipAtoms(s,e,o){let a=skipAtomicRanges(s.state.facet(atomicRanges).map(c=>c(s)),o.from,e.head>o.from?-1:1);return a==o.from?o:EditorSelection.cursor(a,a<o.from?1:-1)}class PosAssoc{constructor(e,o){this.pos=e,this.assoc=o}}function posAtCoords(s,e,o,a){let c=s.contentDOM.getBoundingClientRect(),d=c.top+s.viewState.paddingTop,{x:h,y:g}=e,b=g-d,j;for(;;){if(b<0)return new PosAssoc(0,1);if(b>s.viewState.docHeight)return new PosAssoc(s.state.doc.length,-1);if(j=s.elementAtHeight(b),a==null)break;if(j.type==BlockType.Text){let _e=s.docView.coordsAt(a<0?j.from:j.to,a);if(_e&&(a<0?_e.top<=b+d:_e.bottom>=b+d))break}let _=s.viewState.heightOracle.textHeight/2;b=a>0?j.bottom+_:j.top-_}if(s.viewport.from>=j.to||s.viewport.to<=j.from){if(o)return null;if(j.type==BlockType.Text){let _=posAtCoordsImprecise(s,c,j,h,g);return new PosAssoc(_,_==j.from?1:-1)}}if(j.type!=BlockType.Text)return b<(j.top+j.bottom)/2?new PosAssoc(j.from,1):new PosAssoc(j.to,-1);let $=s.docView.lineAt(j.from,2);return(!$||$.length!=j.length)&&($=s.docView.lineAt(j.from,-2)),posAtCoordsInline(s,$,j.from,h,g)}function posAtCoordsInline(s,e,o,a,c){let d=-1,h=null,g=1e9,b=1e9,j=c,$=c,_=(_e,et)=>{for(let nt=0;nt<_e.length;nt++){let rt=_e[nt];if(rt.top==rt.bottom)continue;let it=rt.left>a?rt.left-a:rt.right<a?a-rt.right:0,st=rt.top>c?rt.top-c:rt.bottom<c?c-rt.bottom:0;rt.top<=$&&rt.bottom>=j&&(j=Math.min(rt.top,j),$=Math.max(rt.bottom,$),st=0),(d<0||(st-b||it-g)<0)&&(d>=0&&b&&g<it&&h.top<=$-2&&h.bottom>=j+2?b=0:(d=et,g=it,b=st,h=rt))}};if(e.isText()){for(let et=0;et<e.length;){let nt=findClusterBreak(e.text,et);if(_(textRange(e.dom,et,nt).getClientRects(),et),!g&&!b)break;et=nt}return a>(h.left+h.right)/2==(dirAt(s,d+o)==Direction.LTR)?new PosAssoc(o+findClusterBreak(e.text,d),-1):new PosAssoc(o+d,1)}else{if(!e.length)return new PosAssoc(o,1);for(let rt=0;rt<e.children.length;rt++){let it=e.children[rt];if(it.flags&48)continue;let st=(it.dom.nodeType==1?it.dom:textRange(it.dom,0,it.length)).getClientRects();if(_(st,rt),!g&&!b)break}let _e=e.children[d],et=e.posBefore(_e,o);return _e.isComposite()||_e.isText()?posAtCoordsInline(s,_e,et,Math.max(h.left,Math.min(h.right,a)),c):a>(h.left+h.right)/2==(dirAt(s,d+o)==Direction.LTR)?new PosAssoc(et+_e.length,-1):new PosAssoc(et,1)}}function dirAt(s,e){let o=s.state.doc.lineAt(e);return s.bidiSpans(o)[BidiSpan.find(s.bidiSpans(o),e-o.from,-1,1)].dir}const LineBreakPlaceholder="";class DOMReader{constructor(e,o){this.points=e,this.view=o,this.text="",this.lineSeparator=o.state.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,o){if(!e)return this;let a=e.parentNode;for(let c=e;;){this.findPointBefore(a,c);let d=this.text.length;this.readNode(c);let h=Tile.get(c),g=c.nextSibling;if(g==o){h!=null&&h.breakAfter&&!g&&a!=this.view.contentDOM&&this.lineBreak();break}let b=Tile.get(g);(h&&b?h.breakAfter:(h?h.breakAfter:isBlockElement(c))||isBlockElement(g)&&(c.nodeName!="BR"||h!=null&&h.isWidget())&&this.text.length>d)&&!isEmptyToEnd(g,o)&&this.lineBreak(),c=g}return this.findPointBefore(a,o),this}readTextNode(e){let o=e.nodeValue;for(let a of this.points)a.node==e&&(a.pos=this.text.length+Math.min(a.offset,o.length));for(let a=0,c=this.lineSeparator?null:/\r\n?|\n/g;;){let d=-1,h=1,g;if(this.lineSeparator?(d=o.indexOf(this.lineSeparator,a),h=this.lineSeparator.length):(g=c.exec(o))&&(d=g.index,h=g[0].length),this.append(o.slice(a,d<0?o.length:d)),d<0)break;if(this.lineBreak(),h>1)for(let b of this.points)b.node==e&&b.pos>this.text.length&&(b.pos-=h-1);a=d+h}}readNode(e){let o=Tile.get(e),a=o&&o.overrideDOMText;if(a!=null){this.findPointInside(e,a.length);for(let c=a.iter();!c.next().done;)c.lineBreak?this.lineBreak():this.append(c.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,o){for(let a of this.points)a.node==e&&e.childNodes[a.offset]==o&&(a.pos=this.text.length)}findPointInside(e,o){for(let a of this.points)(e.nodeType==3?a.node==e:e.contains(a.node))&&(a.pos=this.text.length+(isAtEnd(e,a.node,a.offset)?o:0))}}function isAtEnd(s,e,o){for(;;){if(!e||o<maxOffset(e))return!1;if(e==s)return!0;o=domIndex(e)+1,e=e.parentNode}}function isEmptyToEnd(s,e){let o;for(;!(s==e||!s);s=s.nextSibling){let a=Tile.get(s);if(!(a!=null&&a.isWidget()))return!1;a&&(o||(o=[])).push(a)}if(o)for(let a of o){let c=a.overrideDOMText;if(c!=null&&c.length)return!1}return!0}class DOMPoint{constructor(e,o){this.node=e,this.offset=o,this.pos=-1}}class DOMChange{constructor(e,o,a,c){this.typeOver=c,this.bounds=null,this.text="",this.domChanged=o>-1;let{impreciseHead:d,impreciseAnchor:h}=e.docView;if(e.state.readOnly&&o>-1)this.newSel=null;else if(o>-1&&(this.bounds=domBoundsAround(e.docView.tile,o,a,0))){let g=d||h?[]:selectionPoints(e),b=new DOMReader(g,e);b.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=b.text,this.newSel=selectionFromPoints(g,this.bounds.from)}else{let g=e.observer.selectionRange,b=d&&d.node==g.focusNode&&d.offset==g.focusOffset||!contains(e.contentDOM,g.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(g.focusNode,g.focusOffset),j=h&&h.node==g.anchorNode&&h.offset==g.anchorOffset||!contains(e.contentDOM,g.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(g.anchorNode,g.anchorOffset),$=e.viewport;if((browser.ios||browser.chrome)&&e.state.selection.main.empty&&b!=j&&($.from>0||$.to<e.state.doc.length)){let _=Math.min(b,j),_e=Math.max(b,j),et=$.from-_,nt=$.to-_e;(et==0||et==1||_==0)&&(nt==0||nt==-1||_e==e.state.doc.length)&&(b=0,j=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(EditorSelection.range(j,b)):this.newSel=EditorSelection.single(j,b)}}}function domBoundsAround(s,e,o,a){if(s.isComposite()){let c=-1,d=-1,h=-1,g=-1;for(let b=0,j=a,$=a;b<s.children.length;b++){let _=s.children[b],_e=j+_.length;if(j<e&&_e>o)return domBoundsAround(_,e,o,j);if(_e>=e&&c==-1&&(c=b,d=j),j>o&&_.dom.parentNode==s.dom){h=b,g=$;break}$=_e,j=_e+_.breakAfter}return{from:d,to:g<0?a+s.length:g,startDOM:(c?s.children[c-1].dom.nextSibling:null)||s.dom.firstChild,endDOM:h<s.children.length&&h>=0?s.children[h].dom:null}}else return s.isText()?{from:a,to:a+s.length,startDOM:s.dom,endDOM:s.dom.nextSibling}:null}function applyDOMChange(s,e){let o,{newSel:a}=e,c=s.state.selection.main,d=s.inputState.lastKeyTime>Date.now()-100?s.inputState.lastKeyCode:-1;if(e.bounds){let{from:h,to:g}=e.bounds,b=c.from,j=null;(d===8||browser.android&&e.text.length<g-h)&&(b=c.to,j="end");let $=findDiff(s.state.doc.sliceString(h,g,LineBreakPlaceholder),e.text,b-h,j);$&&(browser.chrome&&d==13&&$.toB==$.from+2&&e.text.slice($.from,$.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&$.toB--,o={from:h+$.from,to:h+$.toA,insert:Text.of(e.text.slice($.from,$.toB).split(LineBreakPlaceholder))})}else a&&(!s.hasFocus&&s.state.facet(editable)||sameSelPos(a,c))&&(a=null);if(!o&&!a)return!1;if(!o&&e.typeOver&&!c.empty&&a&&a.main.empty?o={from:c.from,to:c.to,insert:s.state.doc.slice(c.from,c.to)}:(browser.mac||browser.android)&&o&&o.from==o.to&&o.from==c.head-1&&/^\. ?$/.test(o.insert.toString())&&s.contentDOM.getAttribute("autocorrect")=="off"?(a&&o.insert.length==2&&(a=EditorSelection.single(a.main.anchor-1,a.main.head-1)),o={from:o.from,to:o.to,insert:Text.of([o.insert.toString().replace("."," ")])}):o&&o.from>=c.from&&o.to<=c.to&&(o.from!=c.from||o.to!=c.to)&&c.to-c.from-(o.to-o.from)<=4?o={from:c.from,to:c.to,insert:s.state.doc.slice(c.from,o.from).append(o.insert).append(s.state.doc.slice(o.to,c.to))}:s.state.doc.lineAt(c.from).to<c.to&&s.docView.lineHasWidget(c.to)&&s.inputState.insertingTextAt>Date.now()-50?o={from:c.from,to:c.to,insert:s.state.toText(s.inputState.insertingText)}:browser.chrome&&o&&o.from==o.to&&o.from==c.head&&o.insert.toString()==`
 `&&s.lineWrapping&&(a&&(a=EditorSelection.single(a.main.anchor-1,a.main.head-1)),o={from:c.from,to:c.to,insert:Text.of([" "])}),o)return applyDOMChangeInner(s,o,a,d);if(a&&!sameSelPos(a,c)){let h=!1,g="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(h=!0),g=s.inputState.lastSelectionOrigin,g=="select.pointer"&&(a=skipAtomsForSelection(s.state.facet(atomicRanges).map(b=>b(s)),a))),s.dispatch({selection:a,scrollIntoView:h,userEvent:g}),!0}else return!1}function applyDOMChangeInner(s,e,o,a=-1){if(browser.ios&&s.inputState.flushIOSKey(e))return!0;let c=s.state.selection.main;if(browser.android&&(e.to==c.to&&(e.from==c.from||e.from==c.from-1&&s.state.sliceDoc(e.from,c.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&dispatchKey(s.contentDOM,"Enter",13)||(e.from==c.from-1&&e.to==c.to&&e.insert.length==0||a==8&&e.insert.length<e.to-e.from&&e.to>c.head)&&dispatchKey(s.contentDOM,"Backspace",8)||e.from==c.from&&e.to==c.to+1&&e.insert.length==0&&dispatchKey(s.contentDOM,"Delete",46)))return!0;let d=e.insert.toString();s.inputState.composing>=0&&s.inputState.composing++;let h,g=()=>h||(h=applyDefaultInsert(s,e,o));return s.state.facet(inputHandler).some(b=>b(s,e.from,e.to,d,g))||s.dispatch(g()),!0}function applyDefaultInsert(s,e,o){let a,c=s.state,d=c.selection.main,h=-1;if(e.from==e.to&&e.from<d.from||e.from>d.to){let b=e.from<d.from?-1:1,j=b<0?d.from:d.to,$=skipAtomicRanges(c.facet(atomicRanges).map(_=>_(s)),j,b);e.from==$&&(h=$)}if(h>-1)a={changes:e,selection:EditorSelection.cursor(e.from+e.insert.length,-1)};else if(e.from>=d.from&&e.to<=d.to&&e.to-e.from>=(d.to-d.from)/3&&(!o||o.main.empty&&o.main.from==e.from+e.insert.length)&&s.inputState.composing<0){let b=d.from<e.from?c.sliceDoc(d.from,e.from):"",j=d.to>e.to?c.sliceDoc(e.to,d.to):"";a=c.replaceSelection(s.state.toText(b+e.insert.sliceString(0,void 0,s.state.lineBreak)+j))}else{let b=c.changes(e),j=o&&o.main.to<=b.newLength?o.main:void 0;if(c.selection.ranges.length>1&&(s.inputState.composing>=0||s.inputState.compositionPendingChange)&&e.to<=d.to+10&&e.to>=d.to-10){let $=s.state.sliceDoc(e.from,e.to),_,_e=o&&findCompositionNode(s,o.main.head);if(_e){let nt=e.insert.length-(e.to-e.from);_={from:_e.from,to:_e.to-nt}}else _=s.state.doc.lineAt(d.head);let et=d.to-e.to;a=c.changeByRange(nt=>{if(nt.from==d.from&&nt.to==d.to)return{changes:b,range:j||nt.map(b)};let rt=nt.to-et,it=rt-$.length;if(s.state.sliceDoc(it,rt)!=$||rt>=_.from&&it<=_.to)return{range:nt};let st=c.changes({from:it,to:rt,insert:e.insert}),lt=nt.to-d.to;return{changes:st,range:j?EditorSelection.range(Math.max(0,j.anchor+lt),Math.max(0,j.head+lt)):nt.map(st)}})}else a={changes:b,selection:j&&c.selection.replaceRange(j)}}let g="input.type";return(s.composing||s.inputState.compositionPendingChange&&s.inputState.compositionEndedAt>Date.now()-50)&&(s.inputState.compositionPendingChange=!1,g+=".compose",s.inputState.compositionFirstChange&&(g+=".start",s.inputState.compositionFirstChange=!1)),c.update(a,{userEvent:g,scrollIntoView:!0})}function findDiff(s,e,o,a){let c=Math.min(s.length,e.length),d=0;for(;d<c&&s.charCodeAt(d)==e.charCodeAt(d);)d++;if(d==c&&s.length==e.length)return null;let h=s.length,g=e.length;for(;h>0&&g>0&&s.charCodeAt(h-1)==e.charCodeAt(g-1);)h--,g--;if(a=="end"){let b=Math.max(0,d-Math.min(h,g));o-=h+b-d}if(h<d&&s.length<e.length){let b=o<=d&&o>=h?d-o:0;d-=b,g=d+(g-h),h=d}else if(g<d){let b=o<=d&&o>=g?d-o:0;d-=b,h=d+(h-g),g=d}return{from:d,toA:h,toB:g}}function selectionPoints(s){let e=[];if(s.root.activeElement!=s.contentDOM)return e;let{anchorNode:o,anchorOffset:a,focusNode:c,focusOffset:d}=s.observer.selectionRange;return o&&(e.push(new DOMPoint(o,a)),(c!=o||d!=a)&&e.push(new DOMPoint(c,d))),e}function selectionFromPoints(s,e){if(s.length==0)return null;let o=s[0].pos,a=s.length==2?s[1].pos:o;return o>-1&&a>-1?EditorSelection.single(o+e,a+e):null}function sameSelPos(s,e){return e.head==s.main.head&&e.anchor==s.main.anchor}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null),browser.gecko&&firefoxCopyCutHack(e.contentDOM.ownerDocument)}handleEvent(e){!eventBelongsToEditor(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,o){let a=this.handlers[e];if(a){for(let c of a.observers)c(this.view,o);for(let c of a.handlers){if(o.defaultPrevented)break;if(c(this.view,o)){o.preventDefault();break}}}}ensureHandlers(e){let o=computeHandlers(e),a=this.handlers,c=this.view.contentDOM;for(let d in o)if(d!="scroll"){let h=!o[d].handlers.length,g=a[d];g&&h!=!g.handlers.length&&(c.removeEventListener(d,this.handleEvent),g=null),g||c.addEventListener(d,this.handleEvent,{passive:h})}for(let d in a)d!="scroll"&&!o[d]&&c.removeEventListener(d,this.handleEvent);this.handlers=o}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&modifierCodes.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let o;return browser.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((o=PendingKeys.find(a=>a.keyCode==e.keyCode))&&!e.ctrlKey||EmacsyPendingKeys.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=o||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let o=this.pendingIOSKey;return!o||o.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,o.key,o.keyCode,o instanceof KeyboardEvent?o:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(s,e){return(o,a)=>{try{return e.call(s,a,o)}catch(c){logException(o.state,c)}}}function computeHandlers(s){let e=Object.create(null);function o(a){return e[a]||(e[a]={observers:[],handlers:[]})}for(let a of s){let c=a.spec,d=c&&c.plugin.domEventHandlers,h=c&&c.plugin.domEventObservers;if(d)for(let g in d){let b=d[g];b&&o(g).handlers.push(bindHandler(a.value,b))}if(h)for(let g in h){let b=h[g];b&&o(g).observers.push(bindHandler(a.value,b))}}for(let a in handlers)o(a).handlers.push(handlers[a]);for(let a in observers)o(a).observers.push(observers[a]);return e}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(s){return Math.max(0,s)*.7+8}function dist(s,e){return Math.max(Math.abs(s.clientX-e.clientX),Math.abs(s.clientY-e.clientY))}class MouseSelection{constructor(e,o,a,c){this.view=e,this.startEvent=o,this.style=a,this.mustSelect=c,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=o,this.scrollParents=scrollableParents(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(h=>h(e));let d=e.contentDOM.ownerDocument;d.addEventListener("mousemove",this.move=this.move.bind(this)),d.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=o.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,o),this.dragging=isInPrimarySelection(e,o)&&getClickType(o)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&dist(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let o=0,a=0,c=0,d=0,h=this.view.win.innerWidth,g=this.view.win.innerHeight;this.scrollParents.x&&({left:c,right:h}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:d,bottom:g}=this.scrollParents.y.getBoundingClientRect());let b=getScrollMargins(this.view);e.clientX-b.left<=c+dragScrollMargin?o=-dragScrollSpeed(c-e.clientX):e.clientX+b.right>=h-dragScrollMargin&&(o=dragScrollSpeed(e.clientX-h)),e.clientY-b.top<=d+dragScrollMargin?a=-dragScrollSpeed(d-e.clientY):e.clientY+b.bottom>=g-dragScrollMargin&&(a=dragScrollSpeed(e.clientY-g)),this.setScrollSpeed(o,a)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,o){this.scrollSpeed={x:e,y:o},e||o?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:o}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),o&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=o,o=0),(e||o)&&this.view.win.scrollBy(e,o),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:o}=this,a=skipAtomsForSelection(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!a.eq(o.state.selection,this.dragging===!1))&&this.view.dispatch({selection:a,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(o=>o.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(s,e){let o=s.state.facet(clickAddsSelectionRange);return o.length?o[0](e):browser.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(s,e){let o=s.state.facet(dragMovesSelection$1);return o.length?o[0](e):browser.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(s,e){let{main:o}=s.state.selection;if(o.empty)return!1;let a=getSelection$1(s.root);if(!a||a.rangeCount==0)return!0;let c=a.getRangeAt(0).getClientRects();for(let d=0;d<c.length;d++){let h=c[d];if(h.left<=e.clientX&&h.right>=e.clientX&&h.top<=e.clientY&&h.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(s,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let o=e.target,a;o!=s.contentDOM;o=o.parentNode)if(!o||o.nodeType==11||(a=Tile.get(o))&&a.isWidget()&&!a.isHidden&&a.widget.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(s){let e=s.dom.parentNode;if(!e)return;let o=e.appendChild(document.createElement("textarea"));o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(()=>{s.focus(),o.remove(),doPaste(s,o.value)},50)}function textFilter(s,e,o){for(let a of s.facet(e))o=a(o,s);return o}function doPaste(s,e){e=textFilter(s.state,clipboardInputFilter,e);let{state:o}=s,a,c=1,d=o.toText(e),h=d.lines==o.selection.ranges.length;if(lastLinewiseCopy!=null&&o.selection.ranges.every(b=>b.empty)&&lastLinewiseCopy==d.toString()){let b=-1;a=o.changeByRange(j=>{let $=o.doc.lineAt(j.from);if($.from==b)return{range:j};b=$.from;let _=o.toText((h?d.line(c++).text:e)+o.lineBreak);return{changes:{from:$.from,insert:_},range:EditorSelection.cursor(j.from+_.length)}})}else h?a=o.changeByRange(b=>{let j=d.line(c++);return{changes:{from:b.from,to:b.to,insert:j.text},range:EditorSelection.cursor(b.from+j.length)}}):a=o.replaceSelection(d);s.dispatch(a,{userEvent:"input.paste",scrollIntoView:!0})}observers.scroll=s=>{s.inputState.lastScrollTop=s.scrollDOM.scrollTop,s.inputState.lastScrollLeft=s.scrollDOM.scrollLeft};handlers.keydown=(s,e)=>(s.inputState.setSelectionOrigin("select"),e.keyCode==27&&s.inputState.tabFocusMode!=0&&(s.inputState.tabFocusMode=Date.now()+2e3),!1);observers.touchstart=(s,e)=>{s.inputState.lastTouchTime=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};observers.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};handlers.mousedown=(s,e)=>{if(s.observer.flush(),s.inputState.lastTouchTime>Date.now()-2e3)return!1;let o=null;for(let a of s.state.facet(mouseSelectionStyle))if(o=a(s,e),o)break;if(!o&&e.button==0&&(o=basicMouseSelection(s,e)),o){let a=!s.hasFocus;s.inputState.startMouseSelection(new MouseSelection(s,e,o,a)),a&&s.observer.ignore(()=>{focusPreventScroll(s.contentDOM);let d=s.root.activeElement;d&&!d.contains(s.contentDOM)&&d.blur()});let c=s.inputState.mouseSelection;if(c)return c.start(e),c.dragging===!1}else s.inputState.setSelectionOrigin("select.pointer");return!1};function rangeForClick(s,e,o,a){if(a==1)return EditorSelection.cursor(e,o);if(a==2)return groupAt(s.state,e,o);{let c=s.docView.lineAt(e,o),d=s.state.doc.lineAt(c?c.posAtEnd:e),h=c?c.posAtStart:d.from,g=c?c.posAtEnd:d.to;return g<s.state.doc.length&&g==d.to&&g++,EditorSelection.range(h,g)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(s){if(!BadMouseDetail)return s.detail;let e=lastMouseDown,o=lastMouseDownTime;return lastMouseDown=s,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||o>Date.now()-400&&Math.abs(e.clientX-s.clientX)<2&&Math.abs(e.clientY-s.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(s,e){let o=s.posAndSideAtCoords({x:e.clientX,y:e.clientY},!1),a=getClickType(e),c=s.state.selection;return{update(d){d.docChanged&&(o.pos=d.changes.mapPos(o.pos),c=c.map(d.changes))},get(d,h,g){let b=s.posAndSideAtCoords({x:d.clientX,y:d.clientY},!1),j,$=rangeForClick(s,b.pos,b.assoc,a);if(o.pos!=b.pos&&!h){let _=rangeForClick(s,o.pos,o.assoc,a),_e=Math.min(_.from,$.from),et=Math.max(_.to,$.to);$=_e<$.from?EditorSelection.range(_e,et):EditorSelection.range(et,_e)}return h?c.replaceRange(c.main.extend($.from,$.to)):g&&a==1&&c.ranges.length>1&&(j=removeRangeAround(c,b.pos))?j:g?c.addRange($):EditorSelection.create([$])}}}function removeRangeAround(s,e){for(let o=0;o<s.ranges.length;o++){let{from:a,to:c}=s.ranges[o];if(a<=e&&c>=e)return EditorSelection.create(s.ranges.slice(0,o).concat(s.ranges.slice(o+1)),s.mainIndex==o?0:s.mainIndex-(s.mainIndex>o?1:0))}return null}handlers.dragstart=(s,e)=>{let{selection:{main:o}}=s.state;if(e.target.draggable){let c=s.docView.tile.nearest(e.target);if(c&&c.isWidget()){let d=c.posAtStart,h=d+c.length;(d>=o.to||h<=o.from)&&(o=EditorSelection.range(d,h))}}let{inputState:a}=s;return a.mouseSelection&&(a.mouseSelection.dragging=!0),a.draggedContent=o,e.dataTransfer&&(e.dataTransfer.setData("Text",textFilter(s.state,clipboardOutputFilter,s.state.sliceDoc(o.from,o.to))),e.dataTransfer.effectAllowed="copyMove"),!1};handlers.dragend=s=>(s.inputState.draggedContent=null,!1);function dropText(s,e,o,a){if(o=textFilter(s.state,clipboardInputFilter,o),!o)return;let c=s.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:d}=s.inputState,h=a&&d&&dragMovesSelection(s,e)?{from:d.from,to:d.to}:null,g={from:c,insert:o},b=s.state.changes(h?[h,g]:g);s.focus(),s.dispatch({changes:b,selection:{anchor:b.mapPos(c,-1),head:b.mapPos(c,1)},userEvent:h?"move.drop":"input.drop"}),s.inputState.draggedContent=null}handlers.drop=(s,e)=>{if(!e.dataTransfer)return!1;if(s.state.readOnly)return!0;let o=e.dataTransfer.files;if(o&&o.length){let a=Array(o.length),c=0,d=()=>{++c==o.length&&dropText(s,e,a.filter(h=>h!=null).join(s.state.lineBreak),!1)};for(let h=0;h<o.length;h++){let g=new FileReader;g.onerror=d,g.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(g.result)||(a[h]=g.result),d()},g.readAsText(o[h])}return!0}else{let a=e.dataTransfer.getData("Text");if(a)return dropText(s,e,a,!0),!0}return!1};handlers.paste=(s,e)=>{if(s.state.readOnly)return!0;s.observer.flush();let o=brokenClipboardAPI?null:e.clipboardData;return o?(doPaste(s,o.getData("text/plain")||o.getData("text/uri-list")),!0):(capturePaste(s),!1)};function captureCopy(s,e){let o=s.dom.parentNode;if(!o)return;let a=o.appendChild(document.createElement("textarea"));a.style.cssText="position: fixed; left: -10000px; top: 10px",a.value=e,a.focus(),a.selectionEnd=e.length,a.selectionStart=0,setTimeout(()=>{a.remove(),s.focus()},50)}function copiedRange(s){let e=[],o=[],a=!1;for(let c of s.selection.ranges)c.empty||(e.push(s.sliceDoc(c.from,c.to)),o.push(c));if(!e.length){let c=-1;for(let{from:d}of s.selection.ranges){let h=s.doc.lineAt(d);h.number>c&&(e.push(h.text),o.push({from:h.from,to:Math.min(s.doc.length,h.to+1)})),c=h.number}a=!0}return{text:textFilter(s,clipboardOutputFilter,e.join(s.lineBreak)),ranges:o,linewise:a}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(s,e)=>{let o=getSelection$1(s.root);if(o&&!hasSelection(s.contentDOM,o))return!1;let{text:a,ranges:c,linewise:d}=copiedRange(s.state);if(!a&&!d)return!1;lastLinewiseCopy=d?a:null,e.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:c,scrollIntoView:!0,userEvent:"delete.cut"});let h=brokenClipboardAPI?null:e.clipboardData;return h?(h.clearData(),h.setData("text/plain",a),!0):(captureCopy(s,a),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(s,e){let o=[];for(let a of s.facet(focusChangeEffect)){let c=a(s,e);c&&o.push(c)}return o.length?s.update({effects:o,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(s){setTimeout(()=>{let e=s.hasFocus;if(e!=s.inputState.notifiedFocused){let o=focusChangeTransaction(s.state,e);o?s.dispatch(o):s.update([])}},10)}observers.focus=s=>{s.inputState.lastFocusTime=Date.now(),!s.scrollDOM.scrollTop&&(s.inputState.lastScrollTop||s.inputState.lastScrollLeft)&&(s.scrollDOM.scrollTop=s.inputState.lastScrollTop,s.scrollDOM.scrollLeft=s.inputState.lastScrollLeft),updateForFocusChange(s)};observers.blur=s=>{s.observer.clearSelectionRange(),updateForFocusChange(s)};observers.compositionstart=observers.compositionupdate=s=>{s.observer.editContext||(s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0))};observers.compositionend=s=>{s.observer.editContext||(s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionPendingKey=!0,s.inputState.compositionPendingChange=s.observer.pendingRecords().length>0,s.inputState.compositionFirstChange=null,browser.chrome&&browser.android?s.observer.flushSoon():s.inputState.compositionPendingChange?Promise.resolve().then(()=>s.observer.flush()):setTimeout(()=>{s.inputState.composing<0&&s.docView.hasComposition&&s.update([])},50))};observers.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(s,e)=>{var o,a;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(s.inputState.insertingText=e.data,s.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&s.observer.editContext){let d=(o=e.dataTransfer)===null||o===void 0?void 0:o.getData("text/plain"),h=e.getTargetRanges();if(d&&h.length){let g=h[0],b=s.posAtDOM(g.startContainer,g.startOffset),j=s.posAtDOM(g.endContainer,g.endOffset);return applyDOMChangeInner(s,{from:b,to:j,insert:s.state.toText(d)},null),!0}}let c;if(browser.chrome&&browser.android&&(c=PendingKeys.find(d=>d.inputType==e.inputType))&&(s.observer.delayAndroidKey(c.key,c.keyCode),c.key=="Backspace"||c.key=="Delete")){let d=((a=window.visualViewport)===null||a===void 0?void 0:a.height)||0;setTimeout(()=>{var h;(((h=window.visualViewport)===null||h===void 0?void 0:h.height)||0)>d+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}return browser.ios&&e.inputType=="deleteContentForward"&&s.observer.flushSoon(),browser.safari&&e.inputType=="insertText"&&s.inputState.composing>=0&&setTimeout(()=>observers.compositionend(s,e),20),!1};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(s){appliedFirefoxHack.has(s)||(appliedFirefoxHack.add(s),s.addEventListener("copy",()=>{}),s.addEventListener("cut",()=>{}))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,o){let a=this.doc.lineAt(o).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(a+=Math.max(0,Math.ceil((o-e-a*this.lineLength*.5)/this.lineLength))),this.lineHeight*a}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let o=!1;for(let a=0;a<e.length;a++){let c=e[a];c<0?a++:this.heightSamples[Math.floor(c*10)]||(o=!0,this.heightSamples[Math.floor(c*10)]=!0)}return o}refresh(e,o,a,c,d,h){let g=wrappingWhiteSpace.indexOf(e)>-1,b=Math.abs(o-this.lineHeight)>.3||this.lineWrapping!=g||Math.abs(a-this.charWidth)>.1;if(this.lineWrapping=g,this.lineHeight=o,this.charWidth=a,this.textHeight=c,this.lineLength=d,b){this.heightSamples={};for(let j=0;j<h.length;j++){let $=h[j];$<0?j++:this.heightSamples[Math.floor($*10)]=!0}}return b}}class MeasuredHeights{constructor(e,o){this.from=e,this.heights=o,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,o,a,c,d){this.from=e,this.length=o,this.top=a,this.height=c,this._content=d}get type(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let o=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,o)}}var QueryType$1=function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(e,o,a=2){this.length=e,this.height=o,this.flags=a}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Epsilon&&(heightChangeFlag=!0),this.height=e)}replace(e,o,a){return HeightMap.of(a)}decomposeLeft(e,o){o.push(this)}decomposeRight(e,o){o.push(this)}applyChanges(e,o,a,c){let d=this,h=a.doc;for(let g=c.length-1;g>=0;g--){let{fromA:b,toA:j,fromB:$,toB:_}=c[g],_e=d.lineAt(b,QueryType$1.ByPosNoHeight,a.setDoc(o),0,0),et=_e.to>=j?_e:d.lineAt(j,QueryType$1.ByPosNoHeight,a,0,0);for(_+=et.to-j,j=et.to;g>0&&_e.from<=c[g-1].toA;)b=c[g-1].fromA,$=c[g-1].fromB,g--,b<_e.from&&(_e=d.lineAt(b,QueryType$1.ByPosNoHeight,a,0,0));$+=_e.from-b,b=_e.from;let nt=NodeBuilder.build(a.setDoc(h),e,$,_);d=replace(d,d.replace(b,j,nt))}return d.updateHeight(a,0)}static empty(){return new HeightMapText(0,0,0)}static of(e){if(e.length==1)return e[0];let o=0,a=e.length,c=0,d=0;for(;;)if(o==a)if(c>d*2){let g=e[o-1];g.break?e.splice(--o,1,g.left,null,g.right):e.splice(--o,1,g.left,g.right),a+=1+g.break,c-=g.size}else if(d>c*2){let g=e[a];g.break?e.splice(a,1,g.left,null,g.right):e.splice(a,1,g.left,g.right),a+=2+g.break,d-=g.size}else break;else if(c<d){let g=e[o++];g&&(c+=g.size)}else{let g=e[--a];g&&(d+=g.size)}let h=0;return e[o-1]==null?(h=1,o--):e[o]==null&&(h=1,a++),new HeightMapBranch(HeightMap.of(e.slice(0,o)),h,HeightMap.of(e.slice(a)))}}function replace(s,e){return s==e?s:(s.constructor!=e.constructor&&(heightChangeFlag=!0),e)}HeightMap.prototype.size=1;const SpaceDeco=Decoration.replace({});class HeightMapBlock extends HeightMap{constructor(e,o,a){super(e,o),this.deco=a,this.spaceAbove=0}mainBlock(e,o){return new BlockInfo(o,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(e,o,a,c){return this.spaceAbove&&e<a+this.spaceAbove?new BlockInfo(c,0,a,this.spaceAbove,SpaceDeco):this.mainBlock(a,c)}lineAt(e,o,a,c,d){let h=this.mainBlock(c,d);return this.spaceAbove?this.blockAt(0,a,c,d).join(h):h}forEachLine(e,o,a,c,d,h){e<=d+this.length&&o>=d&&h(this.lineAt(0,QueryType$1.ByPos,a,c,d))}setMeasuredHeight(e){let o=e.heights[e.index++];o<0?(this.spaceAbove=-o,o=e.heights[e.index++]):this.spaceAbove=0,this.setHeight(o)}updateHeight(e,o=0,a=!1,c){return c&&c.from<=o&&c.more&&this.setMeasuredHeight(c),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,o,a){super(e,o,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=a}mainBlock(e,o){return new BlockInfo(o,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(e,o,a){let c=a[0];return a.length==1&&(c instanceof HeightMapText||c instanceof HeightMapGap&&c.flags&4)&&Math.abs(this.length-c.length)<10?(c instanceof HeightMapGap?c=new HeightMapText(c.length,this.height,this.spaceAbove):c.height=this.height,this.outdated||(c.outdated=!1),c):HeightMap.of(a)}updateHeight(e,o=0,a=!1,c){return c&&c.from<=o&&c.more?this.setMeasuredHeight(c):(a||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,o){let a=e.doc.lineAt(o).number,c=e.doc.lineAt(o+this.length).number,d=c-a+1,h,g=0;if(e.lineWrapping){let b=Math.min(this.height,e.lineHeight*d);h=b/d,this.length>d+1&&(g=(this.height-b)/(this.length-d-1))}else h=this.height/d;return{firstLine:a,lastLine:c,perLine:h,perChar:g}}blockAt(e,o,a,c){let{firstLine:d,lastLine:h,perLine:g,perChar:b}=this.heightMetrics(o,c);if(o.lineWrapping){let j=c+(e<o.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-a)/this.height))*this.length)),$=o.doc.lineAt(j),_=g+$.length*b,_e=Math.max(a,e-_/2);return new BlockInfo($.from,$.length,_e,_,0)}else{let j=Math.max(0,Math.min(h-d,Math.floor((e-a)/g))),{from:$,length:_}=o.doc.line(d+j);return new BlockInfo($,_,a+g*j,g,0)}}lineAt(e,o,a,c,d){if(o==QueryType$1.ByHeight)return this.blockAt(e,a,c,d);if(o==QueryType$1.ByPosNoHeight){let{from:et,to:nt}=a.doc.lineAt(e);return new BlockInfo(et,nt-et,0,0,0)}let{firstLine:h,perLine:g,perChar:b}=this.heightMetrics(a,d),j=a.doc.lineAt(e),$=g+j.length*b,_=j.number-h,_e=c+g*_+b*(j.from-d-_);return new BlockInfo(j.from,j.length,Math.max(c,Math.min(_e,c+this.height-$)),$,0)}forEachLine(e,o,a,c,d,h){e=Math.max(e,d),o=Math.min(o,d+this.length);let{firstLine:g,perLine:b,perChar:j}=this.heightMetrics(a,d);for(let $=e,_=c;$<=o;){let _e=a.doc.lineAt($);if($==e){let nt=_e.number-g;_+=b*nt+j*(e-d-nt)}let et=b+j*_e.length;h(new BlockInfo(_e.from,_e.length,_,et,0)),_+=et,$=_e.to+1}}replace(e,o,a){let c=this.length-o;if(c>0){let d=a[a.length-1];d instanceof HeightMapGap?a[a.length-1]=new HeightMapGap(d.length+c):a.push(null,new HeightMapGap(c-1))}if(e>0){let d=a[0];d instanceof HeightMapGap?a[0]=new HeightMapGap(e+d.length):a.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(a)}decomposeLeft(e,o){o.push(new HeightMapGap(e-1),null)}decomposeRight(e,o){o.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,o=0,a=!1,c){let d=o+this.length;if(c&&c.from<=o+this.length&&c.more){let h=[],g=Math.max(o,c.from),b=-1;for(c.from>o&&h.push(new HeightMapGap(c.from-o-1).updateHeight(e,o));g<=d&&c.more;){let $=e.doc.lineAt(g).length;h.length&&h.push(null);let _=c.heights[c.index++],_e=0;_<0&&(_e=-_,_=c.heights[c.index++]),b==-1?b=_:Math.abs(_-b)>=Epsilon&&(b=-2);let et=new HeightMapText($,_,_e);et.outdated=!1,h.push(et),g+=$+1}g<=d&&h.push(null,new HeightMapGap(d-g).updateHeight(e,g));let j=HeightMap.of(h);return(b<0||Math.abs(j.height-this.height)>=Epsilon||Math.abs(b-this.heightMetrics(e,o).perLine)>=Epsilon)&&(heightChangeFlag=!0),replace(this,j)}else(a||this.outdated)&&(this.setHeight(e.heightForGap(o,o+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,o,a){super(e.length+o+a.length,e.height+a.height,o|(e.outdated||a.outdated?2:0)),this.left=e,this.right=a,this.size=e.size+a.size}get break(){return this.flags&1}blockAt(e,o,a,c){let d=a+this.left.height;return e<d?this.left.blockAt(e,o,a,c):this.right.blockAt(e,o,d,c+this.left.length+this.break)}lineAt(e,o,a,c,d){let h=c+this.left.height,g=d+this.left.length+this.break,b=o==QueryType$1.ByHeight?e<h:e<g,j=b?this.left.lineAt(e,o,a,c,d):this.right.lineAt(e,o,a,h,g);if(this.break||(b?j.to<g:j.from>g))return j;let $=o==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return b?j.join(this.right.lineAt(g,$,a,h,g)):this.left.lineAt(g,$,a,c,d).join(j)}forEachLine(e,o,a,c,d,h){let g=c+this.left.height,b=d+this.left.length+this.break;if(this.break)e<b&&this.left.forEachLine(e,o,a,c,d,h),o>=b&&this.right.forEachLine(e,o,a,g,b,h);else{let j=this.lineAt(b,QueryType$1.ByPos,a,c,d);e<j.from&&this.left.forEachLine(e,j.from-1,a,c,d,h),j.to>=e&&j.from<=o&&h(j),o>j.to&&this.right.forEachLine(j.to+1,o,a,g,b,h)}}replace(e,o,a){let c=this.left.length+this.break;if(o<c)return this.balanced(this.left.replace(e,o,a),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-c,o-c,a));let d=[];e>0&&this.decomposeLeft(e,d);let h=d.length;for(let g of a)d.push(g);if(e>0&&mergeGaps(d,h-1),o<this.length){let g=d.length;this.decomposeRight(o,d),mergeGaps(d,g)}return HeightMap.of(d)}decomposeLeft(e,o){let a=this.left.length;if(e<=a)return this.left.decomposeLeft(e,o);o.push(this.left),this.break&&(a++,e>=a&&o.push(null)),e>a&&this.right.decomposeLeft(e-a,o)}decomposeRight(e,o){let a=this.left.length,c=a+this.break;if(e>=c)return this.right.decomposeRight(e-c,o);e<a&&this.left.decomposeRight(e,o),this.break&&e<c&&o.push(null),o.push(this.right)}balanced(e,o){return e.size>2*o.size||o.size>2*e.size?HeightMap.of(this.break?[e,null,o]:[e,o]):(this.left=replace(this.left,e),this.right=replace(this.right,o),this.setHeight(e.height+o.height),this.outdated=e.outdated||o.outdated,this.size=e.size+o.size,this.length=e.length+this.break+o.length,this)}updateHeight(e,o=0,a=!1,c){let{left:d,right:h}=this,g=o+d.length+this.break,b=null;return c&&c.from<=o+d.length&&c.more?b=d=d.updateHeight(e,o,a,c):d.updateHeight(e,o,a),c&&c.from<=g+h.length&&c.more?b=h=h.updateHeight(e,g,a,c):h.updateHeight(e,g,a),b?this.balanced(d,h):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(s,e){let o,a;s[e]==null&&(o=s[e-1])instanceof HeightMapGap&&(a=s[e+1])instanceof HeightMapGap&&s.splice(e-1,3,new HeightMapGap(o.length+1+a.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,o){this.pos=e,this.oracle=o,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,o){if(this.lineStart>-1){let a=Math.min(o,this.lineEnd),c=this.nodes[this.nodes.length-1];c instanceof HeightMapText?c.length+=a-this.pos:(a>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(a-this.pos,-1,0)),this.writtenTo=a,o>a&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=o}point(e,o,a){if(e<o||a.heightRelevant){let c=a.widget?a.widget.estimatedHeight:0,d=a.widget?a.widget.lineBreaks:0;c<0&&(c=this.oracle.lineHeight);let h=o-e;a.block?this.addBlock(new HeightMapBlock(h,c,a)):(h||d||c>=relevantWidgetHeight)&&this.addLineDeco(c,d,h)}else o>e&&this.span(e,o);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:o}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=o,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1,0)),this.writtenTo=this.pos}blankContent(e,o){let a=new HeightMapGap(o-e);return this.oracle.doc.lineAt(e).to==o&&(a.flags|=4),a}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let o=new HeightMapText(0,-1,0);return this.nodes.push(o),o}addBlock(e){this.enterLine();let o=e.deco;o&&o.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,o&&o.endSide>0&&(this.covering=e)}addLineDeco(e,o,a){let c=this.ensureLine();c.length+=a,c.collapsed+=a,c.widgetHeight=Math.max(c.widgetHeight,e),c.breaks+=o,this.writtenTo=this.pos=this.pos+a}finish(e){let o=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(o instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1,0)):(this.writtenTo<this.pos||o==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let a=e;for(let c of this.nodes)c instanceof HeightMapText&&c.updateHeight(this.oracle,a),a+=c?c.length:1;return this.nodes}static build(e,o,a,c){let d=new NodeBuilder(a,e);return RangeSet.spans(o,a,c,d,0),d.finish(a)}}function heightRelevantDecoChanges(s,e,o){let a=new DecorationComparator;return RangeSet.compare(s,e,o,a,0),a.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,o,a,c){(e<o||a&&a.heightRelevant||c&&c.heightRelevant)&&addRange(e,o,this.changes,5)}}function visiblePixelRange(s,e){let o=s.getBoundingClientRect(),a=s.ownerDocument,c=a.defaultView||window,d=Math.max(0,o.left),h=Math.min(c.innerWidth,o.right),g=Math.max(0,o.top),b=Math.min(c.innerHeight,o.bottom);for(let j=s.parentNode;j&&j!=a.body;)if(j.nodeType==1){let $=j,_=window.getComputedStyle($);if(($.scrollHeight>$.clientHeight||$.scrollWidth>$.clientWidth)&&_.overflow!="visible"){let _e=$.getBoundingClientRect();d=Math.max(d,_e.left),h=Math.min(h,_e.right),g=Math.max(g,_e.top),b=Math.min(j==s.parentNode?c.innerHeight:b,_e.bottom)}j=_.position=="absolute"||_.position=="fixed"?$.offsetParent:$.parentNode}else if(j.nodeType==11)j=j.host;else break;return{left:d-o.left,right:Math.max(d,h)-o.left,top:g-(o.top+e),bottom:Math.max(g,b)-(o.top+e)}}function inWindow(s){let e=s.getBoundingClientRect(),o=s.ownerDocument.defaultView||window;return e.left<o.innerWidth&&e.right>0&&e.top<o.innerHeight&&e.bottom>0}function fullPixelRange(s,e){let o=s.getBoundingClientRect();return{left:0,right:o.right-o.left,top:e,bottom:o.bottom-(o.top+e)}}class LineGap{constructor(e,o,a,c){this.from=e,this.to=o,this.size=a,this.displaySize=c}static same(e,o){if(e.length!=o.length)return!1;for(let a=0;a<e.length;a++){let c=e[a],d=o[a];if(c.from!=d.from||c.to!=d.to||c.size!=d.size)return!1}return!0}draw(e,o){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(o?e.scaleY:e.scaleX),o)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,o){super(),this.size=e,this.vertical=o}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let o=e.facet(contentAttributes).some(a=>typeof a!="function"&&a.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(o),this.stateDeco=staticDeco(e),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);for(let a=0;a<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());a++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(a=>a.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:o}=this.state.selection;for(let a=0;a<=1;a++){let c=a?o.head:o.anchor;if(!e.some(({from:d,to:h})=>c>=d&&c<=h)){let{from:d,to:h}=this.lineBlockAt(c);e.push(new Viewport(d,h))}}return this.viewports=e.sort((a,c)=>a.from-c.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(scaleBlock(e,this.scaler))})}update(e,o=null){this.state=e.state;let a=this.stateDeco;this.stateDeco=staticDeco(this.state);let c=e.changedRanges,d=ChangedRange.extendWithRanges(c,heightRelevantDecoChanges(a,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),h=this.heightMap.height,g=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),d),(this.heightMap.height!=h||heightChangeFlag)&&(e.flags|=2),g?(this.scrollAnchorPos=e.changes.mapPos(g.from,-1),this.scrollAnchorHeight=g.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=h);let b=d.length?this.mapViewport(this.viewport,e.changes):this.viewport;(o&&(o.range.head<b.from||o.range.head>b.to)||!this.viewportIsAppropriate(b))&&(b=this.getViewport(0,o));let j=b.from!=this.viewport.from||b.to!=this.viewport.to;this.viewport=b,e.flags|=this.updateForViewport(),(j||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),o&&(this.scrollTarget=o),!this.mustEnforceCursorAssoc&&(e.selectionSet||e.focusChanged)&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let o=e.contentDOM,a=window.getComputedStyle(o),c=this.heightOracle,d=a.whiteSpace;this.defaultTextDirection=a.direction=="rtl"?Direction.RTL:Direction.LTR;let h=this.heightOracle.mustRefreshForWrapping(d)||this.mustMeasureContent,g=o.getBoundingClientRect(),b=h||this.mustMeasureContent||this.contentDOMHeight!=g.height;this.contentDOMHeight=g.height,this.mustMeasureContent=!1;let j=0,$=0;if(g.width&&g.height){let{scaleX:ct,scaleY:ut}=getScale(o,g);(ct>.005&&Math.abs(this.scaleX-ct)>.005||ut>.005&&Math.abs(this.scaleY-ut)>.005)&&(this.scaleX=ct,this.scaleY=ut,j|=16,h=b=!0)}let _=(parseInt(a.paddingTop)||0)*this.scaleY,_e=(parseInt(a.paddingBottom)||0)*this.scaleY;(this.paddingTop!=_||this.paddingBottom!=_e)&&(this.paddingTop=_,this.paddingBottom=_e,j|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(c.lineWrapping&&(b=!0),this.editorWidth=e.scrollDOM.clientWidth,j|=16);let et=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=et&&(this.scrollAnchorHeight=-1,this.scrollTop=et),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let nt=(this.printing?fullPixelRange:visiblePixelRange)(o,this.paddingTop),rt=nt.top-this.pixelViewport.top,it=nt.bottom-this.pixelViewport.bottom;this.pixelViewport=nt;let st=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(st!=this.inView&&(this.inView=st,st&&(b=!0)),!this.inView&&!this.scrollTarget&&!inWindow(e.dom))return 0;let lt=g.width;if((this.contentDOMWidth!=lt||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=g.width,this.editorHeight=e.scrollDOM.clientHeight,j|=16),b){let ct=e.docView.measureVisibleLineHeights(this.viewport);if(c.mustRefreshForHeights(ct)&&(h=!0),h||c.lineWrapping&&Math.abs(lt-this.contentDOMWidth)>c.charWidth){let{lineHeight:ut,charWidth:at,textHeight:dt}=e.docView.measureTextSize();h=ut>0&&c.refresh(d,ut,at,dt,Math.max(5,lt/at),ct),h&&(e.docView.minWidth=0,j|=16)}rt>0&&it>0?$=Math.max(rt,it):rt<0&&it<0&&($=Math.min(rt,it)),clearHeightChangeFlag();for(let ut of this.viewports){let at=ut.from==this.viewport.from?ct:e.docView.measureVisibleLineHeights(ut);this.heightMap=(h?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(c,0,h,new MeasuredHeights(ut.from,at))}heightChangeFlag&&(j|=2)}let ot=!this.viewportIsAppropriate(this.viewport,$)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return ot&&(j&2&&(j|=this.updateScaler()),this.viewport=this.getViewport($,this.scrollTarget),j|=this.updateForViewport()),(j&2||ot)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(h?[]:this.lineGaps,e)),j|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),j}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,o){let a=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),c=this.heightMap,d=this.heightOracle,{visibleTop:h,visibleBottom:g}=this,b=new Viewport(c.lineAt(h-a*1e3,QueryType$1.ByHeight,d,0,0).from,c.lineAt(g+(1-a)*1e3,QueryType$1.ByHeight,d,0,0).to);if(o){let{head:j}=o.range;if(j<b.from||j>b.to){let $=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),_=c.lineAt(j,QueryType$1.ByPos,d,0,0),_e;o.y=="center"?_e=(_.top+_.bottom)/2-$/2:o.y=="start"||o.y=="nearest"&&j<b.from?_e=_.top:_e=_.bottom-$,b=new Viewport(c.lineAt(_e-1e3/2,QueryType$1.ByHeight,d,0,0).from,c.lineAt(_e+$+1e3/2,QueryType$1.ByHeight,d,0,0).to)}}return b}mapViewport(e,o){let a=o.mapPos(e.from,-1),c=o.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(a,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(c,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:o},a=0){if(!this.inView)return!0;let{top:c}=this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:d}=this.heightMap.lineAt(o,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:h,visibleBottom:g}=this;return(e==0||c<=h-Math.max(10,Math.min(-a,250)))&&(o==this.state.doc.length||d>=g+Math.max(10,Math.min(a,250)))&&c>h-2*1e3&&d<g+2*1e3}mapLineGaps(e,o){if(!e.length||o.empty)return e;let a=[];for(let c of e)o.touchesRange(c.from,c.to)||a.push(new LineGap(o.mapPos(c.from),o.mapPos(c.to),c.size,c.displaySize));return a}ensureLineGaps(e,o){let a=this.heightOracle.lineWrapping,c=a?1e4:2e3,d=c>>1,h=c<<1;if(this.defaultTextDirection!=Direction.LTR&&!a)return[];let g=[],b=($,_,_e,et)=>{if(_-$<d)return;let nt=this.state.selection.main,rt=[nt.from];nt.empty||rt.push(nt.to);for(let st of rt)if(st>$&&st<_){b($,st-10,_e,et),b(st+10,_,_e,et);return}let it=find(e,st=>st.from>=_e.from&&st.to<=_e.to&&Math.abs(st.from-$)<d&&Math.abs(st.to-_)<d&&!rt.some(lt=>st.from<lt&&st.to>lt));if(!it){if(_<_e.to&&o&&a&&o.visibleRanges.some(ot=>ot.from<=_&&ot.to>=_)){let ot=o.moveToLineBoundary(EditorSelection.cursor(_),!1,!0).head;ot>$&&(_=ot)}let st=this.gapSize(_e,$,_,et),lt=a||st<2e6?st:2e6;it=new LineGap($,_,st,lt)}g.push(it)},j=$=>{if($.length<h||$.type!=BlockType.Text)return;let _=lineStructure($.from,$.to,this.stateDeco);if(_.total<h)return;let _e=this.scrollTarget?this.scrollTarget.range.head:null,et,nt;if(a){let rt=c/this.heightOracle.lineLength*this.heightOracle.lineHeight,it,st;if(_e!=null){let lt=findFraction(_,_e),ot=((this.visibleBottom-this.visibleTop)/2+rt)/$.height;it=lt-ot,st=lt+ot}else it=(this.visibleTop-$.top-rt)/$.height,st=(this.visibleBottom-$.top+rt)/$.height;et=findPosition(_,it),nt=findPosition(_,st)}else{let rt=_.total*this.heightOracle.charWidth,it=c*this.heightOracle.charWidth,st=0;if(rt>2e6)for(let at of e)at.from>=$.from&&at.from<$.to&&at.size!=at.displaySize&&at.from*this.heightOracle.charWidth+st<this.pixelViewport.left&&(st=at.size-at.displaySize);let lt=this.pixelViewport.left+st,ot=this.pixelViewport.right+st,ct,ut;if(_e!=null){let at=findFraction(_,_e),dt=((ot-lt)/2+it)/rt;ct=at-dt,ut=at+dt}else ct=(lt-it)/rt,ut=(ot+it)/rt;et=findPosition(_,ct),nt=findPosition(_,ut)}et>$.from&&b($.from,et,$,_),nt<$.to&&b(nt,$.to,$,_)};for(let $ of this.viewportLines)Array.isArray($.type)?$.type.forEach(j):j($);return g}gapSize(e,o,a,c){let d=findFraction(c,a)-findFraction(c,o);return this.heightOracle.lineWrapping?e.height*d:c.total*this.heightOracle.charWidth*d}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(o=>o.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let o=this.stateDeco;this.lineGaps.length&&(o=o.concat(this.lineGapDeco));let a=[];RangeSet.spans(o,this.viewport.from,this.viewport.to,{span(d,h){a.push({from:d,to:h})},point(){}},20);let c=0;if(a.length!=this.visibleRanges.length)c=12;else for(let d=0;d<a.length&&!(c&8);d++){let h=this.visibleRanges[d],g=a[d];(h.from!=g.from||h.to!=g.to)&&(c|=4,e&&e.mapPos(h.from,-1)==g.from&&e.mapPos(h.to,1)==g.to||(c|=8))}return this.visibleRanges=a,c}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(o=>o.from<=e&&o.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(o=>o.top<=e&&o.bottom>=e)||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let o=this.lineBlockAtHeight(e+8);return o.from>=this.viewport.from||this.viewportLines[0].top-e>200?o:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,o){this.from=e,this.to=o}}function lineStructure(s,e,o){let a=[],c=s,d=0;return RangeSet.spans(o,s,e,{span(){},point(h,g){h>c&&(a.push({from:c,to:h}),d+=h-c),c=g}},20),c<e&&(a.push({from:c,to:e}),d+=e-c),{total:d,ranges:a}}function findPosition({total:s,ranges:e},o){if(o<=0)return e[0].from;if(o>=1)return e[e.length-1].to;let a=Math.floor(s*o);for(let c=0;;c++){let{from:d,to:h}=e[c],g=h-d;if(a<=g)return d+a;a-=g}}function findFraction(s,e){let o=0;for(let{from:a,to:c}of s.ranges){if(e<=c){o+=e-a;break}o+=c-a}return o/s.total}function find(s,e){for(let o of s)if(e(o))return o}const IdScaler={toDOM(s){return s},fromDOM(s){return s},scale:1,eq(s){return s==this}};function staticDeco(s){let e=s.facet(decorations).filter(a=>typeof a!="function"),o=s.facet(outerDecorations).filter(a=>typeof a!="function");return o.length&&e.push(RangeSet.join(o)),e}class BigScaler{constructor(e,o,a){let c=0,d=0,h=0;this.viewports=a.map(({from:g,to:b})=>{let j=o.lineAt(g,QueryType$1.ByPos,e,0,0).top,$=o.lineAt(b,QueryType$1.ByPos,e,0,0).bottom;return c+=$-j,{from:g,to:b,top:j,bottom:$,domTop:0,domBottom:0}}),this.scale=(7e6-c)/(o.height-c);for(let g of this.viewports)g.domTop=h+(g.top-d)*this.scale,h=g.domBottom=g.domTop+(g.bottom-g.top),d=g.bottom}toDOM(e){for(let o=0,a=0,c=0;;o++){let d=o<this.viewports.length?this.viewports[o]:null;if(!d||e<d.top)return c+(e-a)*this.scale;if(e<=d.bottom)return d.domTop+(e-d.top);a=d.bottom,c=d.domBottom}}fromDOM(e){for(let o=0,a=0,c=0;;o++){let d=o<this.viewports.length?this.viewports[o]:null;if(!d||e<d.domTop)return a+(e-c)/this.scale;if(e<=d.domBottom)return d.top+(e-d.domTop);a=d.bottom,c=d.domBottom}}eq(e){return e instanceof BigScaler?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((o,a)=>o.from==e.viewports[a].from&&o.to==e.viewports[a].to):!1}}function scaleBlock(s,e){if(e.scale==1)return s;let o=e.toDOM(s.top),a=e.toDOM(s.bottom);return new BlockInfo(s.from,s.length,o,a-o,Array.isArray(s._content)?s._content.map(c=>scaleBlock(c,e)):s._content)}const theme=Facet.define({combine:s=>s.join(" ")}),darkTheme=Facet.define({combine:s=>s.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(s,e,o){return new StyleModule(e,{finish(a){return/&/.test(a)?a.replace(/&\w*/,c=>{if(c=="&")return s;if(!o||!o[c])throw new RangeError(`Unsupported selector: ${c}`);return o[c]}):s+" "+a}})}const baseTheme$1$2=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(o=>{for(let a of o)this.queue.push(a);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&o.some(a=>a.type=="childList"&&a.removedNodes.length||a.type=="characterData"&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&browser.android&&e.constructor.EDIT_CONTEXT!==!1&&!(browser.chrome&&browser.chrome_version<126)&&(this.editContext=new EditContextManager(e),e.state.facet(editable)&&(e.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=o=>{this.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var o;((o=this.view.docView)===null||o===void 0?void 0:o.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(o=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),o.length>0&&o[o.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(o=>{o.length>0&&o[o.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((o,a)=>o!=e[a]))){this.gapIntersection.disconnect();for(let o of e)this.gapIntersection.observe(o);this.gaps=e}}onSelectionChange(e){let o=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:a}=this,c=this.selectionRange;if(a.state.facet(editable)?a.root.activeElement!=this.dom:!hasSelection(this.dom,c))return;let d=c.anchorNode&&a.docView.tile.nearest(c.anchorNode);if(d&&d.isWidget()&&d.widget.ignoreEvent(e)){o||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!a.state.selection.main.empty&&c.focusNode&&isEquivalentPosition(c.focusNode,c.focusOffset,c.anchorNode,c.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,o=getSelection$1(e.root);if(!o)return!1;let a=browser.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&safariSelectionRangeHack(this.view,o)||o;if(!a||this.selectionRange.eq(a))return!1;let c=hasSelection(this.dom,a);return c&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,a)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(a),c&&(this.selectionChanged=!0),!0)}setSelectionRange(e,o){this.selectionRange.set(e.node,e.offset,o.node,o.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,o=null;for(let a=this.dom;a;)if(a.nodeType==1)!o&&e<this.scrollTargets.length&&this.scrollTargets[e]==a?e++:o||(o=this.scrollTargets.slice(0,e)),o&&o.push(a),a=a.assignedSlot||a.parentNode;else if(a.nodeType==11)a=a.host;else break;if(e<this.scrollTargets.length&&!o&&(o=this.scrollTargets.slice(0,e)),o){for(let a of this.scrollTargets)a.removeEventListener("scroll",this.onScroll);for(let a of this.scrollTargets=o)a.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,o){var a;if(!this.delayedAndroidKey){let c=()=>{let d=this.delayedAndroidKey;d&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=d.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&d.force&&dispatchKey(this.dom,d.key,d.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(c)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:o,force:this.lastChange<Date.now()-50||!!(!((a=this.delayedAndroidKey)===null||a===void 0)&&a.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let o=-1,a=-1,c=!1;for(let d of e){let h=this.readMutation(d);h&&(h.typeOver&&(c=!0),o==-1?{from:o,to:a}=h:(o=Math.min(h.from,o),a=Math.max(h.to,a)))}return{from:o,to:a,typeOver:c}}readChange(){let{from:e,to:o,typeOver:a}=this.processRecords(),c=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(e<0&&!c)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let d=new DOMChange(this.view,e,o,a);return this.view.docView.domChanged={newSel:d.newSel?d.newSel.main:null},d}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let o=this.readChange();if(!o)return this.view.requestMeasure(),!1;let a=this.view.state,c=applyDOMChange(this.view,o);return this.view.state==a&&(o.domChanged||o.newSel&&!sameSelPos(this.view.state.selection,o.newSel.main))&&this.view.update([]),c}readMutation(e){let o=this.view.docView.tile.nearest(e.target);if(!o||o.isWidget())return null;if(o.markDirty(e.type=="attributes"),e.type=="childList"){let a=findChild(o,e.previousSibling||e.target.previousSibling,-1),c=findChild(o,e.nextSibling||e.target.nextSibling,1);return{from:a?o.posAfter(a):o.posAtStart,to:c?o.posBefore(c):o.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:o.posAtStart,to:o.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(editable)!=e.state.facet(editable)&&(e.view.contentDOM.editContext=e.state.facet(editable)?this.editContext.editContext:null))}destroy(){var e,o,a;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(o=this.gapIntersection)===null||o===void 0||o.disconnect(),(a=this.resizeScroll)===null||a===void 0||a.disconnect();for(let c of this.scrollTargets)c.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(s,e,o){for(;e;){let a=Tile.get(e);if(a&&a.parent==s)return a;let c=e.parentNode;e=c!=s.dom?c:o>0?e.nextSibling:e.previousSibling}return null}function buildSelectionRangeFromRange(s,e){let o=e.startContainer,a=e.startOffset,c=e.endContainer,d=e.endOffset,h=s.docView.domAtPos(s.state.selection.main.anchor,1);return isEquivalentPosition(h.node,h.offset,c,d)&&([o,a,c,d]=[c,d,o,a]),{anchorNode:o,anchorOffset:a,focusNode:c,focusOffset:d}}function safariSelectionRangeHack(s,e){if(e.getComposedRanges){let c=e.getComposedRanges(s.root)[0];if(c)return buildSelectionRangeFromRange(s,c)}let o=null;function a(c){c.preventDefault(),c.stopImmediatePropagation(),o=c.getTargetRanges()[0]}return s.contentDOM.addEventListener("beforeinput",a,!0),s.dom.ownerDocument.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",a,!0),o?buildSelectionRangeFromRange(s,o):null}class EditContextManager{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let o=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=a=>{let c=e.state.selection.main,{anchor:d,head:h}=c,g=this.toEditorPos(a.updateRangeStart),b=this.toEditorPos(a.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:a.updateRangeStart,editorBase:g,drifted:!1});let j=b-g>a.text.length;g==this.from&&d<this.from?g=d:b==this.to&&d>this.to&&(b=d);let $=findDiff(e.state.sliceDoc(g,b),a.text,(j?c.from:c.to)-g,j?"end":null);if(!$){let _e=EditorSelection.single(this.toEditorPos(a.selectionStart),this.toEditorPos(a.selectionEnd));sameSelPos(_e,c)||e.dispatch({selection:_e,userEvent:"select"});return}let _={from:$.from+g,to:$.toA+g,insert:Text.of(a.text.slice($.from,$.toB).split(`
`))};if((browser.mac||browser.android)&&_.from==h-1&&/^\. ?$/.test(a.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(_={from:g,to:b,insert:Text.of([a.text.replace("."," ")])}),this.pendingContextChange=_,!e.state.readOnly){let _e=this.to-this.from+(_.to-_.from+_.insert.length);applyDOMChangeInner(e,_,EditorSelection.single(this.toEditorPos(a.selectionStart,_e),this.toEditorPos(a.selectionEnd,_e)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),_.from<_.to&&!_.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(o.text.slice(Math.max(0,a.updateRangeStart-1),Math.min(o.text.length,a.updateRangeStart+1)))&&this.handlers.compositionend(a)},this.handlers.characterboundsupdate=a=>{let c=[],d=null;for(let h=this.toEditorPos(a.rangeStart),g=this.toEditorPos(a.rangeEnd);h<g;h++){let b=e.coordsForChar(h);d=b&&new DOMRect(b.left,b.top,b.right-b.left,b.bottom-b.top)||d||new DOMRect,c.push(d)}o.updateCharacterBounds(a.rangeStart,c)},this.handlers.textformatupdate=a=>{let c=[];for(let d of a.getTextFormats()){let h=d.underlineStyle,g=d.underlineThickness;if(!/none/i.test(h)&&!/none/i.test(g)){let b=this.toEditorPos(d.rangeStart),j=this.toEditorPos(d.rangeEnd);if(b<j){let $=`text-decoration: underline ${/^[a-z]/.test(h)?h+" ":h=="Dashed"?"dashed ":h=="Squiggle"?"wavy ":""}${/thin/i.test(g)?1:2}px`;c.push(Decoration.mark({attributes:{style:$}}).range(b,j))}}}e.dispatch({effects:setEditContextFormatting.of(Decoration.set(c))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:a}=this.composing;this.composing=null,a&&this.reset(e.state)}};for(let a in this.handlers)o.addEventListener(a,this.handlers[a]);this.measureReq={read:a=>{this.editContext.updateControlBounds(a.contentDOM.getBoundingClientRect());let c=getSelection$1(a.root);c&&c.rangeCount&&this.editContext.updateSelectionBounds(c.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let o=0,a=!1,c=this.pendingContextChange;return e.changes.iterChanges((d,h,g,b,j)=>{if(a)return;let $=j.length-(h-d);if(c&&h>=c.to)if(c.from==d&&c.to==h&&c.insert.eq(j)){c=this.pendingContextChange=null,o+=$,this.to+=$;return}else c=null,this.revertPending(e.state);if(d+=o,h+=o,h<=this.from)this.from+=$,this.to+=$;else if(d<this.to){if(d<this.from||h>this.to||this.to-this.from+j.length>3e4){a=!0;return}this.editContext.updateText(this.toContextPos(d),this.toContextPos(h),j.toString()),this.to+=$}o+=$}),c&&!a&&this.revertPending(e.state),!a}update(e){let o=this.pendingContextChange,a=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(a.from,a.to)&&e.transactions.some(c=>!c.isUserEvent("input.type")&&c.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||o)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:o}=e.selection.main;this.from=Math.max(0,o-1e4),this.to=Math.min(e.doc.length,o+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let o=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(o.from),this.toContextPos(o.from+o.insert.length),e.doc.sliceString(o.from,o.to))}setSelection(e){let{main:o}=e.selection,a=this.toContextPos(Math.max(this.from,Math.min(this.to,o.anchor))),c=this.toContextPos(o.head);(this.editContext.selectionStart!=a||this.editContext.selectionEnd!=c)&&this.editContext.updateSelection(a,c)}rangeIsValid(e){let{head:o}=e.selection.main;return!(this.from>0&&o-this.from<500||this.to<e.doc.length&&this.to-o<500||this.to-this.from>1e4*3)}toEditorPos(e,o=this.to-this.from){e=Math.min(e,o);let a=this.composing;return a&&a.drifted?a.editorBase+(e-a.contextBase):e+this.from}toContextPos(e){let o=this.composing;return o&&o.drifted?o.contextBase+(e-o.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var o;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:a}=e;this.dispatchTransactions=e.dispatchTransactions||a&&(c=>c.forEach(d=>a(d,this)))||(c=>this.update(c)),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),e.scrollTo&&e.scrollTo.is(scrollIntoView$1)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map(c=>new PluginInstance(c));for(let c of this.plugins)c.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((o=document.fonts)===null||o===void 0)&&o.ready&&document.fonts.ready.then(()=>{this.viewState.mustMeasureContent=!0,this.requestMeasure()})}dispatch(...e){let o=e.length==1&&e[0]instanceof Transaction?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(o,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let o=!1,a=!1,c,d=this.state;for(let _e of e){if(_e.startState!=d)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");d=_e.state}if(this.destroyed){this.viewState.state=d;return}let h=this.hasFocus,g=0,b=null;e.some(_e=>_e.annotation(isFocusChange))?(this.inputState.notifiedFocused=h,g=1):h!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=h,b=focusChangeTransaction(d,h),b||(g=1));let j=this.observer.delayedAndroidKey,$=null;if(j?(this.observer.clearDelayedAndroidKey(),$=this.observer.readChange(),($&&!this.state.doc.eq(d.doc)||!this.state.selection.eq(d.selection))&&($=null)):this.observer.clear(),d.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(d);c=ViewUpdate.create(this,d,e),c.flags|=g;let _=this.viewState.scrollTarget;try{this.updateState=2;for(let _e of e){if(_&&(_=_.map(_e.changes)),_e.scrollIntoView){let{main:et}=_e.state.selection;_=new ScrollTarget(et.empty?et:EditorSelection.cursor(et.head,et.head>et.anchor?-1:1))}for(let et of _e.effects)et.is(scrollIntoView$1)&&(_=et.value.clip(this.state))}this.viewState.update(c,_),this.bidiCache=CachedOrder.update(this.bidiCache,c.changes),c.empty||(this.updatePlugins(c),this.inputState.update(c)),o=this.docView.update(c),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),a=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(o,e.some(_e=>_e.isUserEvent("select.pointer")))}finally{this.updateState=0}if(c.startState.facet(theme)!=c.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(o||a||_||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),o&&this.docViewUpdate(),!c.empty)for(let _e of this.state.facet(updateListener))try{_e(c)}catch(et){logException(this.state,et,"update listener")}(b||$)&&Promise.resolve().then(()=>{b&&this.state==b.startState&&this.dispatch(b),$&&!applyDOMChange(this,$)&&j.force&&dispatchKey(this.contentDOM,j.key,j.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let o=this.hasFocus;try{for(let a of this.plugins)a.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(a=>new PluginInstance(a)),this.pluginMap.clear();for(let a of this.plugins)a.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}o&&this.focus(),this.requestMeasure()}updatePlugins(e){let o=e.startState.facet(viewPlugin),a=e.state.facet(viewPlugin);if(o!=a){let c=[];for(let d of a){let h=o.indexOf(d);if(h<0)c.push(new PluginInstance(d));else{let g=this.plugins[h];g.mustUpdate=e,c.push(g)}}for(let d of this.plugins)d.mustUpdate!=e&&d.destroy(this);this.plugins=c,this.pluginMap.clear()}else for(let c of this.plugins)c.mustUpdate=e;for(let c=0;c<this.plugins.length;c++)this.plugins[c].update(this);o!=a&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let o=e.value;if(o&&o.docViewUpdate)try{o.docViewUpdate(this)}catch(a){logException(this.state,a,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let o=null,a=this.scrollDOM,c=a.scrollTop*this.scaleY,{scrollAnchorPos:d,scrollAnchorHeight:h}=this.viewState;Math.abs(c-this.viewState.scrollTop)>1&&(h=-1),this.viewState.scrollAnchorHeight=-1;try{for(let g=0;;g++){if(h<0)if(isScrolledToBottom(a))d=-1,h=this.viewState.heightMap.height;else{let et=this.viewState.scrollAnchorAt(c);d=et.from,h=et.top}this.updateState=1;let b=this.viewState.measure(this);if(!b&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(g>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let j=[];b&4||([this.measureRequests,j]=[j,this.measureRequests]);let $=j.map(et=>{try{return et.read(this)}catch(nt){return logException(this.state,nt),BadMeasure}}),_=ViewUpdate.create(this,this.state,[]),_e=!1;_.flags|=b,o?o.flags|=b:o=_,this.updateState=2,_.empty||(this.updatePlugins(_),this.inputState.update(_),this.updateAttrs(),_e=this.docView.update(_),_e&&this.docViewUpdate());for(let et=0;et<j.length;et++)if($[et]!=BadMeasure)try{let nt=j[et];nt.write&&nt.write($[et],this)}catch(nt){logException(this.state,nt)}if(_e&&this.docView.updateSelection(!0),!_.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,h=-1;continue}else{let nt=(d<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(d).top)-h;if(nt>1||nt<-1){c=c+nt,a.scrollTop=c/this.scaleY,h=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(o&&!o.empty)for(let g of this.state.facet(updateListener))g(o)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),o={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(o["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,o);let a=this.observer.ignore(()=>{let c=updateAttrs(this.contentDOM,this.contentAttrs,o),d=updateAttrs(this.dom,this.editorAttrs,e);return c||d});return this.editorAttrs=e,this.contentAttrs=o,a}showAnnouncements(e){let o=!0;for(let a of e)for(let c of a.effects)if(c.is(EditorView.announce)){o&&(this.announceDOM.textContent=""),o=!1;let d=this.announceDOM.appendChild(document.createElement("div"));d.textContent=c.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let e=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$2).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let o=0;o<this.measureRequests.length;o++)if(this.measureRequests[o].key===e.key){this.measureRequests[o]=e;return}}this.measureRequests.push(e)}}plugin(e){let o=this.pluginMap.get(e);return(o===void 0||o&&o.plugin!=e)&&this.pluginMap.set(e,o=this.plugins.find(a=>a.plugin==e)||null),o&&o.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,o,a){return skipAtoms(this,e,moveByChar(this,e,o,a))}moveByGroup(e,o){return skipAtoms(this,e,moveByChar(this,e,o,a=>byGroup(this,e.head,a)))}visualLineSide(e,o){let a=this.bidiSpans(e),c=this.textDirectionAt(e.from),d=a[o?a.length-1:0];return EditorSelection.cursor(d.side(o,c)+e.from,d.forward(!o,c)?1:-1)}moveToLineBoundary(e,o,a=!0){return moveToLineBoundary(this,e,o,a)}moveVertically(e,o,a){return skipAtoms(this,e,moveVertically(this,e,o,a))}domAtPos(e,o=1){return this.docView.domAtPos(e,o)}posAtDOM(e,o=0){return this.docView.posFromDOM(e,o)}posAtCoords(e,o=!0){this.readMeasured();let a=posAtCoords(this,e,o);return a&&a.pos}posAndSideAtCoords(e,o=!0){return this.readMeasured(),posAtCoords(this,e,o)}coordsAtPos(e,o=1){this.readMeasured();let a=this.docView.coordsAt(e,o);if(!a||a.left==a.right)return a;let c=this.state.doc.lineAt(e),d=this.bidiSpans(c),h=d[BidiSpan.find(d,e-c.from,-1,o)];return flattenRect(a,h.dir==Direction.LTR==o>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let o=this.textDirectionAt(e.from),a;for(let d of this.bidiCache)if(d.from==e.from&&d.dir==o&&(d.fresh||isolatesEq(d.isolates,a=getIsolatedRanges(this,e))))return d.order;a||(a=getIsolatedRanges(this,e));let c=computeOrder(e.text,o,a);return this.bidiCache.push(new CachedOrder(e.from,e.to,o,a,!0,c)),c}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,o={}){return scrollIntoView$1.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,o.y,o.x,o.yMargin,o.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:o}=this.scrollDOM,a=this.viewState.scrollAnchorAt(e);return scrollIntoView$1.of(new ScrollTarget(EditorSelection.cursor(a.from),"start","start",a.top-e,o,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ViewPlugin.define(()=>({}),{eventObservers:e})}static theme(e,o){let a=StyleModule.newName(),c=[theme.of(a),styleModule.of(buildTheme(`.${a}`,e))];return o&&o.dark&&c.push(darkTheme.of(!0)),c}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var o;let a=e.querySelector(".cm-content"),c=a&&Tile.get(a)||Tile.get(e);return((o=c==null?void 0:c.root)===null||o===void 0?void 0:o.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler;EditorView.clipboardInputFilter=clipboardInputFilter;EditorView.clipboardOutputFilter=clipboardOutputFilter;EditorView.scrollHandler=scrollHandler;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.blockWrappers=blockWrappers;EditorView.outerDecorations=outerDecorations;EditorView.atomicRanges=atomicRanges;EditorView.bidiIsolatedRanges=bidiIsolatedRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.cspNonce=Facet.define({combine:s=>s.length?s[0]:""});EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,o,a,c,d,h){this.from=e,this.to=o,this.dir=a,this.isolates=c,this.fresh=d,this.order=h}static update(e,o){if(o.empty&&!e.some(d=>d.fresh))return e;let a=[],c=e.length?e[e.length-1].dir:Direction.LTR;for(let d=Math.max(0,e.length-10);d<e.length;d++){let h=e[d];h.dir==c&&!o.touchesRange(h.from,h.to)&&a.push(new CachedOrder(o.mapPos(h.from,1),o.mapPos(h.to,-1),h.dir,h.isolates,!1,h.order))}return a}}function attrsFromFacet(s,e,o){for(let a=s.state.facet(e),c=a.length-1;c>=0;c--){let d=a[c],h=typeof d=="function"?d(s):d;h&&combineAttrs(h,o)}return o}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(s,e){const o=s.split(/-(?!$)/);let a=o[o.length-1];a=="Space"&&(a=" ");let c,d,h,g;for(let b=0;b<o.length-1;++b){const j=o[b];if(/^(cmd|meta|m)$/i.test(j))g=!0;else if(/^a(lt)?$/i.test(j))c=!0;else if(/^(c|ctrl|control)$/i.test(j))d=!0;else if(/^s(hift)?$/i.test(j))h=!0;else if(/^mod$/i.test(j))e=="mac"?g=!0:d=!0;else throw new Error("Unrecognized modifier name: "+j)}return c&&(a="Alt-"+a),d&&(a="Ctrl-"+a),g&&(a="Meta-"+a),h&&(a="Shift-"+a),a}function modifiers(s,e,o){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),o!==!1&&e.shiftKey&&(s="Shift-"+s),s}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(s,e){return runHandlers(getKeymap(e.state),s,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(s){let e=s.facet(keymap),o=Keymaps.get(e);return o||Keymaps.set(e,o=buildKeymap(e.reduce((a,c)=>a.concat(c),[]))),o}function runScopeHandlers(s,e,o){return runHandlers(getKeymap(s.state),e,s,o)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(s,e=currentPlatform){let o=Object.create(null),a=Object.create(null),c=(h,g)=>{let b=a[h];if(b==null)a[h]=g;else if(b!=g)throw new Error("Key binding "+h+" is used both as a regular binding and as a multi-stroke prefix")},d=(h,g,b,j,$)=>{var _,_e;let et=o[h]||(o[h]=Object.create(null)),nt=g.split(/ (?!$)/).map(st=>normalizeKeyName(st,e));for(let st=1;st<nt.length;st++){let lt=nt.slice(0,st).join(" ");c(lt,!0),et[lt]||(et[lt]={preventDefault:!0,stopPropagation:!1,run:[ot=>{let ct=storedPrefix={view:ot,prefix:lt,scope:h};return setTimeout(()=>{storedPrefix==ct&&(storedPrefix=null)},PrefixTimeout),!0}]})}let rt=nt.join(" ");c(rt,!1);let it=et[rt]||(et[rt]={preventDefault:!1,stopPropagation:!1,run:((_e=(_=et._any)===null||_===void 0?void 0:_.run)===null||_e===void 0?void 0:_e.slice())||[]});b&&it.run.push(b),j&&(it.preventDefault=!0),$&&(it.stopPropagation=!0)};for(let h of s){let g=h.scope?h.scope.split(" "):["editor"];if(h.any)for(let j of g){let $=o[j]||(o[j]=Object.create(null));$._any||($._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:_}=h;for(let _e in $)$[_e].run.push(et=>_(et,currentKeyEvent))}let b=h[e]||h.key;if(b)for(let j of g)d(j,b,h.run,h.preventDefault,h.stopPropagation),h.shift&&d(j,"Shift-"+b,h.shift,h.preventDefault,h.stopPropagation)}return o}let currentKeyEvent=null;function runHandlers(s,e,o,a){currentKeyEvent=e;let c=keyName(e),d=codePointAt(c,0),h=codePointSize(d)==c.length&&c!=" ",g="",b=!1,j=!1,$=!1;storedPrefix&&storedPrefix.view==o&&storedPrefix.scope==a&&(g=storedPrefix.prefix+" ",modifierCodes.indexOf(e.keyCode)<0&&(j=!0,storedPrefix=null));let _=new Set,_e=it=>{if(it){for(let st of it.run)if(!_.has(st)&&(_.add(st),st(o)))return it.stopPropagation&&($=!0),!0;it.preventDefault&&(it.stopPropagation&&($=!0),j=!0)}return!1},et=s[a],nt,rt;return et&&(_e(et[g+modifiers(c,e,!h)])?b=!0:h&&(e.altKey||e.metaKey||e.ctrlKey)&&!(browser.windows&&e.ctrlKey&&e.altKey)&&!(browser.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(nt=base[e.keyCode])&&nt!=c?(_e(et[g+modifiers(nt,e,!0)])||e.shiftKey&&(rt=shift[e.keyCode])!=c&&rt!=nt&&_e(et[g+modifiers(rt,e,!1)]))&&(b=!0):h&&e.shiftKey&&_e(et[g+modifiers(c,e,!0)])&&(b=!0),!b&&_e(et._any)&&(b=!0)),j&&(b=!0),b&&$&&e.stopPropagation(),currentKeyEvent=null,b}class RectangleMarker{constructor(e,o,a,c,d){this.className=e,this.left=o,this.top=a,this.width=c,this.height=d}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,o){return o.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,o,a){if(a.empty){let c=e.coordsAtPos(a.head,a.assoc||1);if(!c)return[];let d=getBase(e);return[new RectangleMarker(o,c.left-d.left,c.top-d.top,null,c.bottom-c.top)]}else return rectanglesForRange(e,o,a)}}function getBase(s){let e=s.scrollDOM.getBoundingClientRect();return{left:(s.textDirection==Direction.LTR?e.left:e.right-s.scrollDOM.clientWidth*s.scaleX)-s.scrollDOM.scrollLeft*s.scaleX,top:e.top-s.scrollDOM.scrollTop*s.scaleY}}function wrappedLine(s,e,o,a){let c=s.coordsAtPos(e,o*2);if(!c)return a;let d=s.dom.getBoundingClientRect(),h=(c.top+c.bottom)/2,g=s.posAtCoords({x:d.left+1,y:h}),b=s.posAtCoords({x:d.right-1,y:h});return g==null||b==null?a:{from:Math.max(a.from,Math.min(g,b)),to:Math.min(a.to,Math.max(g,b))}}function rectanglesForRange(s,e,o){if(o.to<=s.viewport.from||o.from>=s.viewport.to)return[];let a=Math.max(o.from,s.viewport.from),c=Math.min(o.to,s.viewport.to),d=s.textDirection==Direction.LTR,h=s.contentDOM,g=h.getBoundingClientRect(),b=getBase(s),j=h.querySelector(".cm-line"),$=j&&window.getComputedStyle(j),_=g.left+($?parseInt($.paddingLeft)+Math.min(0,parseInt($.textIndent)):0),_e=g.right-($?parseInt($.paddingRight):0),et=blockAt(s,a,1),nt=blockAt(s,c,-1),rt=et.type==BlockType.Text?et:null,it=nt.type==BlockType.Text?nt:null;if(rt&&(s.lineWrapping||et.widgetLineBreaks)&&(rt=wrappedLine(s,a,1,rt)),it&&(s.lineWrapping||nt.widgetLineBreaks)&&(it=wrappedLine(s,c,-1,it)),rt&&it&&rt.from==it.from&&rt.to==it.to)return lt(ot(o.from,o.to,rt));{let ut=rt?ot(o.from,null,rt):ct(et,!1),at=it?ot(null,o.to,it):ct(nt,!0),dt=[];return(rt||et).to<(it||nt).from-(rt&&it?1:0)||et.widgetLineBreaks>1&&ut.bottom+s.defaultLineHeight/2<at.top?dt.push(st(_,ut.bottom,_e,at.top)):ut.bottom<at.top&&s.elementAtHeight((ut.bottom+at.top)/2).type==BlockType.Text&&(ut.bottom=at.top=(ut.bottom+at.top)/2),lt(ut).concat(dt).concat(lt(at))}function st(ut,at,dt,ft){return new RectangleMarker(e,ut-b.left,at-b.top,dt-ut,ft-at)}function lt({top:ut,bottom:at,horizontal:dt}){let ft=[];for(let xt=0;xt<dt.length;xt+=2)ft.push(st(dt[xt],ut,dt[xt+1],at));return ft}function ot(ut,at,dt){let ft=1e9,xt=-1e9,Ct=[];function yt(ht,wt,St,bt,mt){let gt=s.coordsAtPos(ht,ht==dt.to?-2:2),pt=s.coordsAtPos(St,St==dt.from?2:-2);!gt||!pt||(ft=Math.min(gt.top,pt.top,ft),xt=Math.max(gt.bottom,pt.bottom,xt),mt==Direction.LTR?Ct.push(d&&wt?_:gt.left,d&&bt?_e:pt.right):Ct.push(!d&&bt?_:pt.left,!d&&wt?_e:gt.right))}let Et=ut??dt.from,Tt=at??dt.to;for(let ht of s.visibleRanges)if(ht.to>Et&&ht.from<Tt)for(let wt=Math.max(ht.from,Et),St=Math.min(ht.to,Tt);;){let bt=s.state.doc.lineAt(wt);for(let mt of s.bidiSpans(bt)){let gt=mt.from+bt.from,pt=mt.to+bt.from;if(gt>=St)break;pt>wt&&yt(Math.max(gt,wt),ut==null&&gt<=Et,Math.min(pt,St),at==null&&pt>=Tt,mt.dir)}if(wt=bt.to+1,wt>=St)break}return Ct.length==0&&yt(Et,ut==null,Tt,at==null,s.textDirection),{top:ft,bottom:xt,horizontal:Ct}}function ct(ut,at){let dt=g.top+(at?ut.top:ut.bottom);return{top:dt,bottom:dt,horizontal:[]}}}function sameMarker(s,e){return s.constructor==e.constructor&&s.eq(e)}class LayerView{constructor(e,o){this.view=e,this.layer=o,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),o.above&&this.dom.classList.add("cm-layer-above"),o.class&&this.dom.classList.add(o.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),o.mount&&o.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let o=0,a=e.facet(layerOrder);for(;o<a.length&&a[o]!=this.layer;)o++;this.dom.style.zIndex=String((this.layer.above?150:-1)-o)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:o}=this.view;(e!=this.scaleX||o!=this.scaleY)&&(this.scaleX=e,this.scaleY=o,this.dom.style.transform=`scale(${1/e}, ${1/o})`)}draw(e){if(e.length!=this.drawn.length||e.some((o,a)=>!sameMarker(o,this.drawn[a]))){let o=this.dom.firstChild,a=0;for(let c of e)c.update&&o&&c.constructor&&this.drawn[a].constructor&&c.update(o,this.drawn[a])?(o=o.nextSibling,a++):this.dom.insertBefore(c.draw(),o);for(;o;){let c=o.nextSibling;o.remove(),o=c}this.drawn=e,browser.safari&&browser.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(s){return[ViewPlugin.define(e=>new LayerView(e,s)),layerOrder.of(s)]}const selectionConfig=Facet.define({combine(s){return combineConfig(s,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,o)=>Math.min(e,o),drawRangeCursor:(e,o)=>e||o})}});function drawSelection(s={}){return[selectionConfig.of(s),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(s){return s.startState.facet(selectionConfig)!=s.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(s){let{state:e}=s,o=e.facet(selectionConfig),a=[];for(let c of e.selection.ranges){let d=c==e.selection.main;if(c.empty||o.drawRangeCursor){let h=d?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",g=c.empty?c:EditorSelection.cursor(c.head,c.head>c.anchor?-1:1);for(let b of RectangleMarker.forRange(s,h,g))a.push(b)}}return a},update(s,e){s.transactions.some(a=>a.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let o=configChanged(s);return o&&setBlinkRate(s.state,e),s.docChanged||s.selectionSet||o},mount(s,e){setBlinkRate(e.state,s)},class:"cm-cursorLayer"});function setBlinkRate(s,e){e.style.animationDuration=s.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(s){return s.state.selection.ranges.map(e=>e.empty?[]:RectangleMarker.forRange(s,"cm-selectionBackground",e)).reduce((e,o)=>e.concat(o))},update(s,e){return s.docChanged||s.selectionSet||s.viewportChanged||configChanged(s)},class:"cm-selectionLayer"}),hideNativeSelection=Prec.highest(EditorView.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}}));function iterMatches(s,e,o,a,c){e.lastIndex=0;for(let d=s.iterRange(o,a),h=o,g;!d.next().done;h+=d.value.length)if(!d.lineBreak)for(;g=e.exec(d.value);)c(h+g.index,g)}function matchRanges(s,e){let o=s.visibleRanges;if(o.length==1&&o[0].from==s.viewport.from&&o[0].to==s.viewport.to)return o;let a=[];for(let{from:c,to:d}of o)c=Math.max(s.state.doc.lineAt(c).from,c-e),d=Math.min(s.state.doc.lineAt(d).to,d+e),a.length&&a[a.length-1].to>=c?a[a.length-1].to=d:a.push({from:c,to:d});return a}class MatchDecorator{constructor(e){const{regexp:o,decoration:a,decorate:c,boundary:d,maxLength:h=1e3}=e;if(!o.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=o,c)this.addMatch=(g,b,j,$)=>c($,j,j+g[0].length,g,b);else if(typeof a=="function")this.addMatch=(g,b,j,$)=>{let _=a(g,b,j);_&&$(j,j+g[0].length,_)};else if(a)this.addMatch=(g,b,j,$)=>$(j,j+g[0].length,a);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=d,this.maxLength=h}createDeco(e){let o=new RangeSetBuilder,a=o.add.bind(o);for(let{from:c,to:d}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,c,d,(h,g)=>this.addMatch(g,e,h,a));return o.finish()}updateDeco(e,o){let a=1e9,c=-1;return e.docChanged&&e.changes.iterChanges((d,h,g,b)=>{b>=e.view.viewport.from&&g<=e.view.viewport.to&&(a=Math.min(g,a),c=Math.max(b,c))}),e.viewportMoved||c-a>1e3?this.createDeco(e.view):c>-1?this.updateRange(e.view,o.map(e.changes),a,c):o}updateRange(e,o,a,c){for(let d of e.visibleRanges){let h=Math.max(d.from,a),g=Math.min(d.to,c);if(g>=h){let b=e.state.doc.lineAt(h),j=b.to<g?e.state.doc.lineAt(g):b,$=Math.max(d.from,b.from),_=Math.min(d.to,j.to);if(this.boundary){for(;h>b.from;h--)if(this.boundary.test(b.text[h-1-b.from])){$=h;break}for(;g<j.to;g++)if(this.boundary.test(j.text[g-j.from])){_=g;break}}let _e=[],et,nt=(rt,it,st)=>_e.push(st.range(rt,it));if(b==j)for(this.regexp.lastIndex=$-b.from;(et=this.regexp.exec(b.text))&&et.index<_-b.from;)this.addMatch(et,e,et.index+b.from,nt);else iterMatches(e.state.doc,this.regexp,$,_,(rt,it)=>this.addMatch(it,e,rt,nt));o=o.update({filterFrom:$,filterTo:_,filter:(rt,it)=>rt<$||it>_,add:_e})}}return o}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
--\u2028\u2029\uFEFF-]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var s;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let e=document.body.style;_supportsTabSize=((s=e.tabSize)!==null&&s!==void 0?s:e.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(s){let e=combineConfig(s,{render:null,specialChars:Specials,addSpecialChars:null});return(e.replaceTabs=!supportsTabSize())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,UnicodeRegexpSupport)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,UnicodeRegexpSupport)),e}});function highlightSpecialChars(s={}){return[specialCharConfig.of(s),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(s){this.view=s,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(s.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(s)}makeDecorator(s){return new MatchDecorator({regexp:s.specialChars,decoration:(e,o,a)=>{let{doc:c}=o.state,d=codePointAt(e[0],0);if(d==9){let h=c.lineAt(a),g=o.state.tabSize,b=countColumn(h.text,g,a-h.from);return Decoration.replace({widget:new TabWidget((g-b%g)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[d]||(this.decorationCache[d]=Decoration.replace({widget:new SpecialCharWidget(s,d)}))},boundary:s.replaceTabs?void 0:/[^]/})}update(s){let e=s.state.facet(specialCharConfig);s.startState.facet(specialCharConfig)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(s.view)):this.decorations=this.decorator.updateDeco(s,this.decorations)}},{decorations:s=>s.decorations}))}const DefaultPlaceholder="";function placeholder$1(s){return s>=32?DefaultPlaceholder:s==10?"":String.fromCharCode(9216+s)}class SpecialCharWidget extends WidgetType{constructor(e,o){super(),this.options=e,this.code=o}eq(e){return e.code==this.code}toDOM(e){let o=placeholder$1(this.code),a=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),c=this.options.render&&this.options.render(this.code,a,o);if(c)return c;let d=document.createElement("span");return d.textContent=o,d.title=a,d.setAttribute("aria-label",a),d.className="cm-specialChar",d}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.docChanged||s.selectionSet)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=-1,o=[];for(let a of s.state.selection.ranges){let c=s.lineBlockAt(a.head);c.from>e&&(o.push(lineDeco.range(c.from)),e=c.from)}return Decoration.set(o)}},{decorations:s=>s.decorations});class Placeholder extends WidgetType{constructor(e){super(),this.content=e}toDOM(e){let o=document.createElement("span");return o.className="cm-placeholder",o.style.pointerEvents="none",o.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),o.setAttribute("aria-hidden","true"),o}coordsAt(e){let o=e.firstChild?clientRectsFor(e.firstChild):[];if(!o.length)return null;let a=window.getComputedStyle(e.parentNode),c=flattenRect(o[0],a.direction!="rtl"),d=parseInt(a.lineHeight);return c.bottom-c.top>d*1.5?{left:c.left,right:c.right,top:c.top,bottom:c.top+d}:c}ignoreEvent(){return!1}}function placeholder(s){let e=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.placeholder=s?Decoration.set([Decoration.widget({widget:new Placeholder(s),side:1}).range(0)]):Decoration.none}get decorations(){return this.view.state.doc.length?Decoration.none:this.placeholder}},{decorations:o=>o.decorations});return typeof s=="string"?[e,EditorView.contentAttributes.of({"aria-placeholder":s})]:e}const MaxOff=2e3;function rectangleFor(s,e,o){let a=Math.min(e.line,o.line),c=Math.max(e.line,o.line),d=[];if(e.off>MaxOff||o.off>MaxOff||e.col<0||o.col<0){let h=Math.min(e.off,o.off),g=Math.max(e.off,o.off);for(let b=a;b<=c;b++){let j=s.doc.line(b);j.length<=g&&d.push(EditorSelection.range(j.from+h,j.to+g))}}else{let h=Math.min(e.col,o.col),g=Math.max(e.col,o.col);for(let b=a;b<=c;b++){let j=s.doc.line(b),$=findColumn(j.text,h,s.tabSize,!0);if($<0)d.push(EditorSelection.cursor(j.to));else{let _=findColumn(j.text,g,s.tabSize);d.push(EditorSelection.range(j.from+$,j.from+_))}}}return d}function absoluteColumn(s,e){let o=s.coordsAtPos(s.viewport.from);return o?Math.round(Math.abs((o.left-e)/s.defaultCharacterWidth)):-1}function getPos(s,e){let o=s.posAtCoords({x:e.clientX,y:e.clientY},!1),a=s.state.doc.lineAt(o),c=o-a.from,d=c>MaxOff?-1:c==a.length?absoluteColumn(s,e.clientX):countColumn(a.text,s.state.tabSize,o-a.from);return{line:a.number,col:d,off:c}}function rectangleSelectionStyle(s,e){let o=getPos(s,e),a=s.state.selection;return o?{update(c){if(c.docChanged){let d=c.changes.mapPos(c.startState.doc.line(o.line).from),h=c.state.doc.lineAt(d);o={line:h.number,col:o.col,off:Math.min(o.off,h.length)},a=a.map(c.changes)}},get(c,d,h){let g=getPos(s,c);if(!g)return a;let b=rectangleFor(s.state,o,g);return b.length?h?EditorSelection.create(b.concat(a.ranges)):EditorSelection.create(b):a}}:null}function rectangularSelection(s){let e=o=>o.altKey&&o.button==0;return EditorView.mouseSelectionStyle.of((o,a)=>e(a)?rectangleSelectionStyle(o,a):null)}const keys={Alt:[18,s=>!!s.altKey],Control:[17,s=>!!s.ctrlKey],Shift:[16,s=>!!s.shiftKey],Meta:[91,s=>!!s.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(s={}){let[e,o]=keys[s.key||"Alt"],a=ViewPlugin.fromClass(class{constructor(c){this.view=c,this.isDown=!1}set(c){this.isDown!=c&&(this.isDown=c,this.view.update([]))}},{eventObservers:{keydown(c){this.set(c.keyCode==e||o(c))},keyup(c){(c.keyCode==e||!o(c))&&this.set(!1)},mousemove(c){this.set(o(c))}}});return[a,EditorView.contentAttributes.of(c=>{var d;return!((d=c.plugin(a))===null||d===void 0)&&d.isDown?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(e,o,a,c){this.facet=o,this.createTooltipView=a,this.removeTooltipView=c,this.input=e.state.facet(o),this.tooltips=this.input.filter(h=>h);let d=null;this.tooltipViews=this.tooltips.map(h=>d=a(h,d))}update(e,o){var a;let c=e.state.facet(this.facet),d=c.filter(b=>b);if(c===this.input){for(let b of this.tooltipViews)b.update&&b.update(e);return!1}let h=[],g=o?[]:null;for(let b=0;b<d.length;b++){let j=d[b],$=-1;if(j){for(let _=0;_<this.tooltips.length;_++){let _e=this.tooltips[_];_e&&_e.create==j.create&&($=_)}if($<0)h[b]=this.createTooltipView(j,b?h[b-1]:null),g&&(g[b]=!!j.above);else{let _=h[b]=this.tooltipViews[$];g&&(g[b]=o[$]),_.update&&_.update(e)}}}for(let b of this.tooltipViews)h.indexOf(b)<0&&(this.removeTooltipView(b),(a=b.destroy)===null||a===void 0||a.call(b));return o&&(g.forEach((b,j)=>o[j]=b),o.length=g.length),this.input=c,this.tooltips=d,this.tooltipViews=h,!0}}function windowSpace(s){let e=s.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const tooltipConfig=Facet.define({combine:s=>{var e,o,a;return{position:browser.ios?"absolute":((e=s.find(c=>c.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((o=s.find(c=>c.parent))===null||o===void 0?void 0:o.parent)||null,tooltipSpace:((a=s.find(c=>c.tooltipSpace))===null||a===void 0?void 0:a.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(s){this.view=s,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(tooltipConfig);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new TooltipViewManager(s,showTooltip,(o,a)=>this.createTooltip(o,a),o=>{this.resizeObserver&&this.resizeObserver.unobserve(o.dom),o.dom.remove()}),this.above=this.manager.tooltips.map(o=>!!o.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(o=>{Date.now()>this.lastTransaction-50&&o.length>0&&o[o.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),s.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(s,this.above);e&&this.observeIntersection();let o=e||s.geometryChanged,a=s.state.facet(tooltipConfig);if(a.position!=this.position&&!this.madeAbsolute){this.position=a.position;for(let c of this.manager.tooltipViews)c.dom.style.position=this.position;o=!0}if(a.parent!=this.parent){this.parent&&this.container.remove(),this.parent=a.parent,this.createContainer();for(let c of this.manager.tooltipViews)this.container.appendChild(c.dom);o=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);o&&this.maybeMeasure()}createTooltip(s,e){let o=s.create(this.view),a=e?e.dom:null;if(o.dom.classList.add("cm-tooltip"),s.arrow&&!o.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let c=document.createElement("div");c.className="cm-tooltip-arrow",o.dom.appendChild(c)}return o.dom.style.position=this.position,o.dom.style.top=Outside,o.dom.style.left="0px",this.container.insertBefore(o.dom,a),o.mount&&o.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(o.dom),o}destroy(){var s,e,o;this.view.win.removeEventListener("resize",this.measureSoon);for(let a of this.manager.tooltipViews)a.dom.remove(),(s=a.destroy)===null||s===void 0||s.call(a);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(o=this.intersectionObserver)===null||o===void 0||o.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=1,e=1,o=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:d}=this.manager.tooltipViews[0];if(browser.safari){let h=d.getBoundingClientRect();o=Math.abs(h.top+1e4)>1||Math.abs(h.left)>1}else o=!!d.offsetParent&&d.offsetParent!=this.container.ownerDocument.body}if(o||this.position=="absolute")if(this.parent){let d=this.parent.getBoundingClientRect();d.width&&d.height&&(s=d.width/this.parent.offsetWidth,e=d.height/this.parent.offsetHeight)}else({scaleX:s,scaleY:e}=this.view.viewState);let a=this.view.scrollDOM.getBoundingClientRect(),c=getScrollMargins(this.view);return{visible:{left:a.left+c.left,top:a.top+c.top,right:a.right-c.right,bottom:a.bottom-c.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((d,h)=>{let g=this.manager.tooltipViews[h];return g.getCoords?g.getCoords(d.pos):this.view.coordsAtPos(d.pos)}),size:this.manager.tooltipViews.map(({dom:d})=>d.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:s,scaleY:e,makeAbsolute:o}}writeMeasure(s){var e;if(s.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let g of this.manager.tooltipViews)g.dom.style.position="absolute"}let{visible:o,space:a,scaleX:c,scaleY:d}=s,h=[];for(let g=0;g<this.manager.tooltips.length;g++){let b=this.manager.tooltips[g],j=this.manager.tooltipViews[g],{dom:$}=j,_=s.pos[g],_e=s.size[g];if(!_||b.clip!==!1&&(_.bottom<=Math.max(o.top,a.top)||_.top>=Math.min(o.bottom,a.bottom)||_.right<Math.max(o.left,a.left)-.1||_.left>Math.min(o.right,a.right)+.1)){$.style.top=Outside;continue}let et=b.arrow?j.dom.querySelector(".cm-tooltip-arrow"):null,nt=et?7:0,rt=_e.right-_e.left,it=(e=knownHeight.get(j))!==null&&e!==void 0?e:_e.bottom-_e.top,st=j.offset||noOffset,lt=this.view.textDirection==Direction.LTR,ot=_e.width>a.right-a.left?lt?a.left:a.right-_e.width:lt?Math.max(a.left,Math.min(_.left-(et?14:0)+st.x,a.right-rt)):Math.min(Math.max(a.left,_.left-rt+(et?14:0)-st.x),a.right-rt),ct=this.above[g];!b.strictSide&&(ct?_.top-it-nt-st.y<a.top:_.bottom+it+nt+st.y>a.bottom)&&ct==a.bottom-_.bottom>_.top-a.top&&(ct=this.above[g]=!ct);let ut=(ct?_.top-a.top:a.bottom-_.bottom)-nt;if(ut<it&&j.resize!==!1){if(ut<this.view.defaultLineHeight){$.style.top=Outside;continue}knownHeight.set(j,it),$.style.height=(it=ut)/d+"px"}else $.style.height&&($.style.height="");let at=ct?_.top-it-nt-st.y:_.bottom+nt+st.y,dt=ot+rt;if(j.overlap!==!0)for(let ft of h)ft.left<dt&&ft.right>ot&&ft.top<at+it&&ft.bottom>at&&(at=ct?ft.top-it-2-nt:ft.bottom+nt+2);if(this.position=="absolute"?($.style.top=(at-s.parent.top)/d+"px",setLeftStyle($,(ot-s.parent.left)/c)):($.style.top=at/d+"px",setLeftStyle($,ot/c)),et){let ft=_.left+(lt?st.x:-st.x)-(ot+14-7);et.style.left=ft/c+"px"}j.overlap!==!0&&h.push({left:ot,top:at,right:dt,bottom:at+it}),$.classList.toggle("cm-tooltip-above",ct),$.classList.toggle("cm-tooltip-below",!ct),j.positioned&&j.positioned(s.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=Outside}},{eventObservers:{scroll(){this.maybeMeasure()}}});function setLeftStyle(s,e){let o=parseInt(s.style.left,10);(isNaN(o)||Math.abs(e-o)>1)&&(s.style.left=e+"px")}const baseTheme$3=EditorView.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$3]});function getTooltip(s,e){let o=s.plugin(tooltipPlugin);if(!o)return null;let a=o.manager.tooltips.indexOf(e);return a<0?null:o.manager.tooltipViews[a]}const panelConfig=Facet.define({combine(s){let e,o;for(let a of s)e=e||a.topContainer,o=o||a.bottomContainer;return{topContainer:e,bottomContainer:o}}});function getPanel(s,e){let o=s.plugin(panelPlugin),a=o?o.specs.indexOf(e):-1;return a>-1?o.panels[a]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(s){this.input=s.state.facet(showPanel),this.specs=this.input.filter(o=>o),this.panels=this.specs.map(o=>o(s));let e=s.state.facet(panelConfig);this.top=new PanelGroup(s,!0,e.topContainer),this.bottom=new PanelGroup(s,!1,e.bottomContainer),this.top.sync(this.panels.filter(o=>o.top)),this.bottom.sync(this.panels.filter(o=>!o.top));for(let o of this.panels)o.dom.classList.add("cm-panel"),o.mount&&o.mount()}update(s){let e=s.state.facet(panelConfig);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new PanelGroup(s.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(s.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let o=s.state.facet(showPanel);if(o!=this.input){let a=o.filter(b=>b),c=[],d=[],h=[],g=[];for(let b of a){let j=this.specs.indexOf(b),$;j<0?($=b(s.view),g.push($)):($=this.panels[j],$.update&&$.update(s)),c.push($),($.top?d:h).push($)}this.specs=a,this.panels=c,this.top.sync(d),this.bottom.sync(h);for(let b of g)b.dom.classList.add("cm-panel"),b.mount&&b.mount()}else for(let a of this.panels)a.update&&a.update(s)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:s=>EditorView.scrollMargins.of(e=>{let o=e.plugin(s);return o&&{top:o.top.scrollMargin(),bottom:o.bottom.scrollMargin()}})});class PanelGroup{constructor(e,o,a){this.view=e,this.top=o,this.container=a,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let o of this.panels)o.destroy&&e.indexOf(o)<0&&o.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let o=this.container||this.view.dom;o.insertBefore(this.dom,this.top?o.firstChild:null)}let e=this.dom.firstChild;for(let o of this.panels)if(o.dom.parentNode==this.dom){for(;e!=o.dom;)e=rm(e);e=e.nextSibling}else this.dom.insertBefore(o.dom,e);for(;e;)e=rm(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function rm(s){let e=s.nextSibling;return s.remove(),e}const showPanel=Facet.define({enables:panelPlugin});function showDialog(s,e){let o,a=new Promise(h=>o=h),c=h=>createDialog(h,e,o);s.state.field(dialogField,!1)?s.dispatch({effects:openDialogEffect.of(c)}):s.dispatch({effects:StateEffect.appendConfig.of(dialogField.init(()=>[c]))});let d=closeDialogEffect.of(c);return{close:d,result:a.then(h=>((s.win.queueMicrotask||(b=>s.win.setTimeout(b,10)))(()=>{s.state.field(dialogField).indexOf(c)>-1&&s.dispatch({effects:d})}),h))}}const dialogField=StateField.define({create(){return[]},update(s,e){for(let o of e.effects)o.is(openDialogEffect)?s=[o.value].concat(s):o.is(closeDialogEffect)&&(s=s.filter(a=>a!=o.value));return s},provide:s=>showPanel.computeN([s],e=>e.field(s))}),openDialogEffect=StateEffect.define(),closeDialogEffect=StateEffect.define();function createDialog(s,e,o){let a=e.content?e.content(s,()=>h(null)):null;if(!a){if(a=crelt("form"),e.input){let g=crelt("input",e.input);/^(text|password|number|email|tel|url)$/.test(g.type)&&g.classList.add("cm-textfield"),g.name||(g.name="input"),a.appendChild(crelt("label",(e.label||"")+": ",g))}else a.appendChild(document.createTextNode(e.label||""));a.appendChild(document.createTextNode(" ")),a.appendChild(crelt("button",{class:"cm-button",type:"submit"},e.submitLabel||"OK"))}let c=a.nodeName=="FORM"?[a]:a.querySelectorAll("form");for(let g=0;g<c.length;g++){let b=c[g];b.addEventListener("keydown",j=>{j.keyCode==27?(j.preventDefault(),h(null)):j.keyCode==13&&(j.preventDefault(),h(b))}),b.addEventListener("submit",j=>{j.preventDefault(),h(b)})}let d=crelt("div",a,crelt("button",{onclick:()=>h(null),"aria-label":s.state.phrase("close"),class:"cm-dialog-close",type:"button"},[""]));e.class&&(d.className=e.class),d.classList.add("cm-dialog");function h(g){d.contains(d.ownerDocument.activeElement)&&s.focus(),o(g)}return{dom:d,top:e.top,mount:()=>{if(e.focus){let g;typeof e.focus=="string"?g=a.querySelector(e.focus):g=a.querySelector("input")||a.querySelector("button"),g&&"select"in g?g.select():g&&"focus"in g&&g.focus()}}}}class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),gutterWidgetClass=Facet.define(),defaults={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},activeGutters=Facet.define();function gutter(s){return[gutters(),activeGutters.of({...defaults,...s})]}const unfixGutters=Facet.define({combine:s=>s.some(e=>e)});function gutters(s){return[gutterView]}const gutterView=ViewPlugin.fromClass(class{constructor(s){this.view=s,this.domAfter=null,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=s.state.facet(activeGutters).map(e=>new SingleGutterView(s,e)),this.fixed=!s.state.facet(unfixGutters);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(s){if(this.updateGutters(s)){let e=this.prevViewport,o=s.view.viewport,a=Math.min(e.to,o.to)-Math.max(e.from,o.from);this.syncGutters(a<(o.to-o.from)*.8)}if(s.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=s.view.viewport}syncGutters(s){let e=this.dom.nextSibling;s&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let o=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),a=[],c=this.gutters.map(d=>new UpdateContext(d,this.view.viewport,-this.view.documentPadding.top));for(let d of this.view.viewportLineBlocks)if(a.length&&(a=[]),Array.isArray(d.type)){let h=!0;for(let g of d.type)if(g.type==BlockType.Text&&h){advanceCursor(o,a,g.from);for(let b of c)b.line(this.view,g,a);h=!1}else if(g.widget)for(let b of c)b.widget(this.view,g)}else if(d.type==BlockType.Text){advanceCursor(o,a,d.from);for(let h of c)h.line(this.view,d,a)}else if(d.widget)for(let h of c)h.widget(this.view,d);for(let d of c)d.finish();s&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(s){let e=s.startState.facet(activeGutters),o=s.state.facet(activeGutters),a=s.docChanged||s.heightChanged||s.viewportChanged||!RangeSet.eq(s.startState.facet(gutterLineClass),s.state.facet(gutterLineClass),s.view.viewport.from,s.view.viewport.to);if(e==o)for(let c of this.gutters)c.update(s)&&(a=!0);else{a=!0;let c=[];for(let d of o){let h=e.indexOf(d);h<0?c.push(new SingleGutterView(this.view,d)):(this.gutters[h].update(s),c.push(this.gutters[h]))}for(let d of this.gutters)d.dom.remove(),c.indexOf(d)<0&&d.destroy();for(let d of c)d.config.side=="after"?this.getDOMAfter().appendChild(d.dom):this.dom.appendChild(d.dom);this.gutters=c}return a}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:s=>EditorView.scrollMargins.of(e=>{let o=e.plugin(s);if(!o||o.gutters.length==0||!o.fixed)return null;let a=o.dom.offsetWidth*e.scaleX,c=o.domAfter?o.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==Direction.LTR?{left:a,right:c}:{right:a,left:c}})});function asArray(s){return Array.isArray(s)?s:[s]}function advanceCursor(s,e,o){for(;s.value&&s.from<=o;)s.from==o&&e.push(s.value),s.next()}class UpdateContext{constructor(e,o,a){this.gutter=e,this.height=a,this.i=0,this.cursor=RangeSet.iter(e.markers,o.from)}addElement(e,o,a){let{gutter:c}=this,d=(o.top-this.height)/e.scaleY,h=o.height/e.scaleY;if(this.i==c.elements.length){let g=new GutterElement(e,h,d,a);c.elements.push(g),c.dom.appendChild(g.dom)}else c.elements[this.i].update(e,h,d,a);this.height=o.bottom,this.i++}line(e,o,a){let c=[];advanceCursor(this.cursor,c,o.from),a.length&&(c=c.concat(a));let d=this.gutter.config.lineMarker(e,o,c);d&&c.unshift(d);let h=this.gutter;c.length==0&&!h.config.renderEmptyElements||this.addElement(e,o,c)}widget(e,o){let a=this.gutter.config.widgetMarker(e,o.widget,o),c=a?[a]:null;for(let d of e.state.facet(gutterWidgetClass)){let h=d(e,o.widget,o);h&&(c||(c=[])).push(h)}c&&this.addElement(e,o,c)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let o=e.elements.pop();e.dom.removeChild(o.dom),o.destroy()}}}class SingleGutterView{constructor(e,o){this.view=e,this.config=o,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let a in o.domEventHandlers)this.dom.addEventListener(a,c=>{let d=c.target,h;if(d!=this.dom&&this.dom.contains(d)){for(;d.parentNode!=this.dom;)d=d.parentNode;let b=d.getBoundingClientRect();h=(b.top+b.bottom)/2}else h=c.clientY;let g=e.lineBlockAtHeight(h-e.documentTop);o.domEventHandlers[a](e,g,c)&&c.preventDefault()});this.markers=asArray(o.markers(e)),o.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[o.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let o=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let c=this.config.updateSpacer(this.spacer.markers[0],e);c!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[c])}let a=e.view.viewport;return!RangeSet.eq(this.markers,o,a.from,a.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,o,a,c){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,o,a,c)}update(e,o,a,c){this.height!=o&&(this.height=o,this.dom.style.height=o+"px"),this.above!=a&&(this.dom.style.marginTop=(this.above=a)?a+"px":""),sameMarkers(this.markers,c)||this.setMarkers(e,c)}setMarkers(e,o){let a="cm-gutterElement",c=this.dom.firstChild;for(let d=0,h=0;;){let g=h,b=d<o.length?o[d++]:null,j=!1;if(b){let $=b.elementClass;$&&(a+=" "+$);for(let _=h;_<this.markers.length;_++)if(this.markers[_].compare(b)){g=_,j=!0;break}}else g=this.markers.length;for(;h<g;){let $=this.markers[h++];if($.toDOM){$.destroy(c);let _=c.nextSibling;c.remove(),c=_}}if(!b)break;b.toDOM&&(j?c=c.nextSibling:this.dom.insertBefore(b.toDOM(e),c)),j&&h++}this.dom.className=a,this.markers=o}destroy(){this.setMarkers(null,[])}}function sameMarkers(s,e){if(s.length!=e.length)return!1;for(let o=0;o<s.length;o++)if(!s[o].compare(e[o]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberWidgetMarker=Facet.define(),lineNumberConfig=Facet.define({combine(s){return combineConfig(s,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,o){let a=Object.assign({},e);for(let c in o){let d=a[c],h=o[c];a[c]=d?(g,b,j)=>d(g,b,j)||h(g,b,j):h}return a}})}});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(s,e){return s.state.facet(lineNumberConfig).formatNumber(e,s.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],s=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(lineNumberMarkers)},lineMarker(e,o,a){return a.some(c=>c.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(o.from).number))},widgetMarker:(e,o,a)=>{for(let c of e.state.facet(lineNumberWidgetMarker)){let d=c(e,o,a);if(d)return d}return null},lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer(e,o){let a=formatNumber(o.view,maxLineNumber(o.view.state.doc.lines));return a==e.number?e:new NumberMarker(a)},domEventHandlers:s.facet(lineNumberConfig).domEventHandlers,side:"before"}));function lineNumbers(s={}){return[lineNumberConfig.of(s),gutters(),lineNumberGutter]}function maxLineNumber(s){let e=9;for(;e<s;)e=e*10+9;return e}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],s=>{let e=[],o=-1;for(let a of s.selection.ranges){let c=s.doc.lineAt(a.head).from;c>o&&(o=c,e.push(activeLineGutterMarker.range(c)))}return RangeSet.of(e)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}let nextTagID=0;class Tag{constructor(e,o,a,c){this.name=e,this.set=o,this.base=a,this.modified=c,this.id=nextTagID++}toString(){let{name:e}=this;for(let o of this.modified)o.name&&(e=`${o.name}(${e})`);return e}static define(e,o){let a=typeof e=="string"?e:"?";if(e instanceof Tag&&(o=e),o!=null&&o.base)throw new Error("Can not derive from a modified tag");let c=new Tag(a,[],null,[]);if(c.set.push(c),o)for(let d of o.set)c.set.push(d);return c}static defineModifier(e){let o=new Modifier(e);return a=>a.modified.indexOf(o)>-1?a:Modifier.get(a.base||a,a.modified.concat(o).sort((c,d)=>c.id-d.id))}}let nextModifierID=0;class Modifier{constructor(e){this.name=e,this.instances=[],this.id=nextModifierID++}static get(e,o){if(!o.length)return e;let a=o[0].instances.find(g=>g.base==e&&sameArray(o,g.modified));if(a)return a;let c=[],d=new Tag(e.name,c,e,o);for(let g of o)g.instances.push(d);let h=powerSet(o);for(let g of e.set)if(!g.modified.length)for(let b of h)c.push(Modifier.get(g,b));return d}}function sameArray(s,e){return s.length==e.length&&s.every((o,a)=>o==e[a])}function powerSet(s){let e=[[]];for(let o=0;o<s.length;o++)for(let a=0,c=e.length;a<c;a++)e.push(e[a].concat(s[o]));return e.sort((o,a)=>a.length-o.length)}function styleTags(s){let e=Object.create(null);for(let o in s){let a=s[o];Array.isArray(a)||(a=[a]);for(let c of o.split(" "))if(c){let d=[],h=2,g=c;for(let _=0;;){if(g=="..."&&_>0&&_+3==c.length){h=1;break}let _e=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(g);if(!_e)throw new RangeError("Invalid path: "+c);if(d.push(_e[0]=="*"?"":_e[0][0]=='"'?JSON.parse(_e[0]):_e[0]),_+=_e[0].length,_==c.length)break;let et=c[_++];if(_==c.length&&et=="!"){h=0;break}if(et!="/")throw new RangeError("Invalid path: "+c);g=c.slice(_)}let b=d.length-1,j=d[b];if(!j)throw new RangeError("Invalid path: "+c);let $=new Rule(a,h,b>0?d.slice(0,b):null);e[j]=$.sort(e[j])}}return ruleNodeProp.add(e)}const ruleNodeProp=new NodeProp({combine(s,e){let o,a,c;for(;s||e;){if(!s||e&&s.depth>=e.depth?(c=e,e=e.next):(c=s,s=s.next),o&&o.mode==c.mode&&!c.context&&!o.context)continue;let d=new Rule(c.tags,c.mode,c.context);o?o.next=d:a=d,o=d}return a}});class Rule{constructor(e,o,a,c){this.tags=e,this.mode=o,this.context=a,this.next=c}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(s,e){let o=Object.create(null);for(let d of s)if(!Array.isArray(d.tag))o[d.tag.id]=d.class;else for(let h of d.tag)o[h.id]=d.class;let{scope:a,all:c=null}=e||{};return{style:d=>{let h=c;for(let g of d)for(let b of g.set){let j=o[b.id];if(j){h=h?h+" "+j:j;break}}return h},scope:a}}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let s in tags){let e=tags[s];e instanceof Tag&&(e.name=s)}tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a;const languageDataProp=new NodeProp,sublanguageProp=new NodeProp;class Language{constructor(e,o,a=[],c=""){this.data=e,this.name=c,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=o,this.extension=[language.of(this),EditorState.languageData.of((d,h,g)=>{let b=topNodeAt(d,h,g),j=b.type.prop(languageDataProp);if(!j)return[];let $=d.facet(j),_=b.type.prop(sublanguageProp);if(_){let _e=b.resolve(h-b.from,g);for(let et of _)if(et.test(_e,d)){let nt=d.facet(et.facet);return et.type=="replace"?nt:nt.concat($)}}return $})].concat(a)}isActiveAt(e,o,a=-1){return topNodeAt(e,o,a).type.prop(languageDataProp)==this.data}findRegions(e){let o=e.facet(language);if((o==null?void 0:o.data)==this.data)return[{from:0,to:e.doc.length}];if(!o||!o.allowsNesting)return[];let a=[],c=(d,h)=>{if(d.prop(languageDataProp)==this.data){a.push({from:h,to:h+d.length});return}let g=d.prop(NodeProp.mounted);if(g){if(g.tree.prop(languageDataProp)==this.data){if(g.overlay)for(let b of g.overlay)a.push({from:b.from+h,to:b.to+h});else a.push({from:h,to:h+d.length});return}else if(g.overlay){let b=a.length;if(c(g.tree,g.overlay[0].from+h),a.length>b)return}}for(let b=0;b<d.children.length;b++){let j=d.children[b];j instanceof Tree&&c(j,d.positions[b]+h)}};return c(syntaxTree(e),0),a}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function topNodeAt(s,e,o){let a=s.facet(language),c=syntaxTree(s).topNode;if(!a||a.allowsNesting)for(let d=c;d;d=d.enter(e,o,IterMode.ExcludeBuffers|IterMode.EnterBracketed))d.type.isTop&&(c=d);return c}function syntaxTree(s){let e=s.field(Language.state,!1);return e?e.tree:Tree.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,o){let a=this.cursorPos-this.string.length;return e<a||o>=this.cursorPos?this.doc.sliceString(e,o):this.string.slice(e-a,o-a)}}let currentContext=null;class ParseContext{constructor(e,o,a=[],c,d,h,g,b){this.parser=e,this.state=o,this.fragments=a,this.tree=c,this.treeLen=d,this.viewport=h,this.skipped=g,this.scheduleOn=b,this.parse=null,this.tempSkipped=[]}static create(e,o,a){return new ParseContext(e,o,[],Tree.empty,0,a,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,o){return o!=null&&o>=this.state.doc.length&&(o=void 0),this.tree!=Tree.empty&&this.isDone(o??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var a;if(typeof e=="number"){let c=Date.now()+e;e=()=>Date.now()>c}for(this.parse||(this.parse=this.startParse()),o!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>o)&&o<this.state.doc.length&&this.parse.stopAt(o);;){let c=this.parse.advance();if(c)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(c,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(a=this.parse.stoppedAt)!==null&&a!==void 0?a:this.state.doc.length,this.tree=c,this.parse=null,this.treeLen<(o??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,o;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(o=this.parse.advance()););}),this.treeLen=e,this.tree=o,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let o=currentContext;currentContext=this;try{return e()}finally{currentContext=o}}withoutTempSkipped(e){for(let o;o=this.tempSkipped.pop();)e=cutFragments(e,o.from,o.to);return e}changes(e,o){let{fragments:a,tree:c,treeLen:d,viewport:h,skipped:g}=this;if(this.takeTree(),!e.empty){let b=[];if(e.iterChangedRanges((j,$,_,_e)=>b.push({fromA:j,toA:$,fromB:_,toB:_e})),a=TreeFragment.applyChanges(a,b),c=Tree.empty,d=0,h={from:e.mapPos(h.from,-1),to:e.mapPos(h.to,1)},this.skipped.length){g=[];for(let j of this.skipped){let $=e.mapPos(j.from,1),_=e.mapPos(j.to,-1);$<_&&g.push({from:$,to:_})}}}return new ParseContext(this.parser,o,a,c,d,h,g,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let o=this.skipped.length;for(let a=0;a<this.skipped.length;a++){let{from:c,to:d}=this.skipped[a];c<e.to&&d>e.from&&(this.fragments=cutFragments(this.fragments,c,d),this.skipped.splice(a--,1))}return this.skipped.length>=o?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,o){this.skipped.push({from:e,to:o})}static getSkippingParser(e){return new class extends Parser{createParse(o,a,c){let d=c[0].from,h=c[c.length-1].to;return{parsedPos:d,advance(){let b=currentContext;if(b){for(let j of c)b.tempSkipped.push(j);e&&(b.scheduleOn=b.scheduleOn?Promise.all([b.scheduleOn,e]):e)}return this.parsedPos=h,new Tree(NodeType.none,[],[],h-d)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let o=this.fragments;return this.treeLen>=e&&o.length&&o[0].from==0&&o[0].to>=e}static get(){return currentContext}}function cutFragments(s,e,o){return TreeFragment.applyChanges(s,[{fromA:e,toA:o,fromB:e,toB:o}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let o=this.context.changes(e.changes,e.state),a=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),o.viewport.to);return o.work(20,a)||o.takeTree(),new LanguageState(o)}static init(e){let o=Math.min(3e3,e.doc.length),a=ParseContext.create(e.facet(language).parser,e,{from:0,to:o});return a.work(20,o)||a.takeTree(),new LanguageState(a)}}Language.state=StateField.define({create:LanguageState.init,update(s,e){for(let o of e.effects)if(o.is(Language.setState))return o.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):s.apply(e)}});let requestIdle=s=>{let e=setTimeout(()=>s(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=s=>{let e=-1,o=setTimeout(()=>{e=requestIdleCallback(s,{timeout:400})},100);return()=>e<0?clearTimeout(o):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&(!((_a=navigator.scheduling)===null||_a===void 0)&&_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let o=this.view.state.field(Language.state).context;(o.updateViewport(e.view.viewport)||this.view.viewport.to>o.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(o)}scheduleWork(){if(this.working)return;let{state:e}=this.view,o=e.field(Language.state);(o.tree!=o.context.tree||!o.context.isDone(e.doc.length))&&(this.working=requestIdle(this.work))}work(e){this.working=null;let o=Date.now();if(this.chunkEnd<o&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=o+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:a,viewport:{to:c}}=this.view,d=a.field(Language.state);if(d.tree==d.context.tree&&d.context.isDone(c+1e5))return;let h=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),g=d.context.treeLen<c&&a.doc.length>c+1e3,b=d.context.work(()=>isInputPending&&isInputPending()||Date.now()>h,c+(g?0:1e5));this.chunkBudget-=Date.now()-o,(b||this.chunkBudget<=0)&&(d.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(d.context))})),this.chunkBudget>0&&!(b&&!g)&&this.scheduleWork(),this.checkAsyncSchedule(d.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(o=>logException(this.view.state,o)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(s){return s.length?s[0]:null},enables:s=>[Language.state,parseWorker,EditorView.contentAttributes.compute([s],e=>{let o=e.facet(s);return o&&o.name?{"data-language":o.name}:{}})]}),indentService=Facet.define(),indentUnit=Facet.define({combine:s=>{if(!s.length)return"  ";let e=s[0];if(!e||/\S/.test(e)||Array.from(e).some(o=>o!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return e}});function getIndentUnit(s){let e=s.facet(indentUnit);return e.charCodeAt(0)==9?s.tabSize*e.length:e.length}function indentString(s,e){let o="",a=s.tabSize,c=s.facet(indentUnit)[0];if(c=="	"){for(;e>=a;)o+="	",e-=a;c=" "}for(let d=0;d<e;d++)o+=c;return o}function getIndentation(s,e){s instanceof EditorState&&(s=new IndentContext(s));for(let a of s.state.facet(indentService)){let c=a(s,e);if(c!==void 0)return c}let o=syntaxTree(s.state);return o.length>=e?syntaxIndentation(s,o,e):null}class IndentContext{constructor(e,o={}){this.state=e,this.options=o,this.unit=getIndentUnit(e)}lineAt(e,o=1){let a=this.state.doc.lineAt(e),{simulateBreak:c,simulateDoubleBreak:d}=this.options;return c!=null&&c>=a.from&&c<=a.to?d&&c==e?{text:"",from:e}:(o<0?c<e:c<=e)?{text:a.text.slice(c-a.from),from:c}:{text:a.text.slice(0,c-a.from),from:a.from}:a}textAfterPos(e,o=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:a,from:c}=this.lineAt(e,o);return a.slice(e-c,Math.min(a.length,e+100-c))}column(e,o=1){let{text:a,from:c}=this.lineAt(e,o),d=this.countColumn(a,e-c),h=this.options.overrideIndentation?this.options.overrideIndentation(c):-1;return h>-1&&(d+=h-this.countColumn(a,a.search(/\S|$/))),d}countColumn(e,o=e.length){return countColumn(e,this.state.tabSize,o)}lineIndent(e,o=1){let{text:a,from:c}=this.lineAt(e,o),d=this.options.overrideIndentation;if(d){let h=d(c);if(h>-1)return h}return this.countColumn(a,a.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(s,e,o){let a=e.resolveStack(o),c=e.resolveInner(o,-1).resolve(o,0).enterUnfinishedNodesBefore(o);if(c!=a.node){let d=[];for(let h=c;h&&!(h.from<a.node.from||h.to>a.node.to||h.from==a.node.from&&h.type==a.node.type);h=h.parent)d.push(h);for(let h=d.length-1;h>=0;h--)a={node:d[h],next:a}}return indentFor(a,s,o)}function indentFor(s,e,o){for(let a=s;a;a=a.next){let c=indentStrategy(a.node);if(c)return c(TreeIndentContext.create(e,o,a))}return 0}function ignoreClosed(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function indentStrategy(s){let e=s.type.prop(indentNodeProp);if(e)return e;let o=s.firstChild,a;if(o&&(a=o.type.prop(NodeProp.closedBy))){let c=s.lastChild,d=c&&a.indexOf(c.name)>-1;return h=>delimitedStrategy(h,!0,1,void 0,d&&!ignoreClosed(h)?c.from:void 0)}return s.parent==null?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,o,a){super(e.state,e.options),this.base=e,this.pos=o,this.context=a}get node(){return this.context.node}static create(e,o,a){return new TreeIndentContext(e,o,a)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let o=this.state.doc.lineAt(e.from);for(;;){let a=e.resolve(o.from);for(;a.parent&&a.parent.from==a.from;)a=a.parent;if(isParent(a,e))break;o=this.state.doc.lineAt(a.from)}return this.lineIndent(o.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(s,e){for(let o=e;o;o=o.parent)if(s==o)return!0;return!1}function bracketedAligned(s){let e=s.node,o=e.childAfter(e.from),a=e.lastChild;if(!o)return null;let c=s.options.simulateBreak,d=s.state.doc.lineAt(o.from),h=c==null||c<=d.from?d.to:Math.min(d.to,c);for(let g=o.to;;){let b=e.childAfter(g);if(!b||b==a)return null;if(!b.type.isSkipped){if(b.from>=h)return null;let j=/^ */.exec(d.text.slice(o.to-d.from))[0].length;return{from:o.from,to:o.to+j}}g=b.to}}function delimitedStrategy(s,e,o,a,c){let d=s.textAfter,h=d.match(/^\s*/)[0].length,g=a&&d.slice(h,h+a.length)==a||c==s.pos+h,b=bracketedAligned(s);return b?g?s.column(b.from):s.column(b.to):s.baseIndent+(g?0:s.unit*o)}const foldService=Facet.define(),foldNodeProp=new NodeProp;function syntaxFolding(s,e,o){let a=syntaxTree(s);if(a.length<o)return null;let c=a.resolveStack(o,1),d=null;for(let h=c;h;h=h.next){let g=h.node;if(g.to<=o||g.from>o)continue;if(d&&g.from<e)break;let b=g.type.prop(foldNodeProp);if(b&&(g.to<a.length-50||a.length==s.doc.length||!isUnfinished(g))){let j=b(g,s);j&&j.from<=o&&j.from>=e&&j.to>o&&(d=j)}}return d}function isUnfinished(s){let e=s.lastChild;return e&&e.to==s.to&&e.type.isError}function foldable(s,e,o){for(let a of s.facet(foldService)){let c=a(s,e,o);if(c)return c}return syntaxFolding(s,e,o)}function mapRange(s,e){let o=e.mapPos(s.from,1),a=e.mapPos(s.to,-1);return o>=a?void 0:{from:o,to:a}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(s){let e=[];for(let{head:o}of s.state.selection.ranges)e.some(a=>a.from<=o&&a.to>=o)||e.push(s.lineBlockAt(o));return e}const foldState=StateField.define({create(){return Decoration.none},update(s,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((o,a)=>s=clearTouchedFolds(s,o,a)),s=s.map(e.changes);for(let o of e.effects)if(o.is(foldEffect)&&!foldExists(s,o.value.from,o.value.to)){let{preparePlaceholder:a}=e.state.facet(foldConfig),c=a?Decoration.replace({widget:new PreparedFoldWidget(a(e.state,o.value))}):foldWidget;s=s.update({add:[c.range(o.value.from,o.value.to)]})}else o.is(unfoldEffect)&&(s=s.update({filter:(a,c)=>o.value.from!=a||o.value.to!=c,filterFrom:o.value.from,filterTo:o.value.to}));return e.selection&&(s=clearTouchedFolds(s,e.selection.main.head)),s},provide:s=>EditorView.decorations.from(s),toJSON(s,e){let o=[];return s.between(0,e.doc.length,(a,c)=>{o.push(a,c)}),o},fromJSON(s){if(!Array.isArray(s)||s.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let o=0;o<s.length;){let a=s[o++],c=s[o++];if(typeof a!="number"||typeof c!="number")throw new RangeError("Invalid JSON for fold state");e.push(foldWidget.range(a,c))}return Decoration.set(e,!0)}});function clearTouchedFolds(s,e,o=e){let a=!1;return s.between(e,o,(c,d)=>{c<o&&d>e&&(a=!0)}),a?s.update({filterFrom:e,filterTo:o,filter:(c,d)=>c>=o||d<=e}):s}function findFold(s,e,o){var a;let c=null;return(a=s.field(foldState,!1))===null||a===void 0||a.between(e,o,(d,h)=>{(!c||c.from>d)&&(c={from:d,to:h})}),c}function foldExists(s,e,o){let a=!1;return s.between(e,e,(c,d)=>{c==e&&d==o&&(a=!0)}),a}function maybeEnable(s,e){return s.field(foldState,!1)?e:e.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=s=>{for(let e of selectedLines(s)){let o=foldable(s.state,e.from,e.to);if(o)return s.dispatch({effects:maybeEnable(s.state,[foldEffect.of(o),announceFold(s,o)])}),!0}return!1},unfoldCode=s=>{if(!s.state.field(foldState,!1))return!1;let e=[];for(let o of selectedLines(s)){let a=findFold(s.state,o.from,o.to);a&&e.push(unfoldEffect.of(a),announceFold(s,a,!1))}return e.length&&s.dispatch({effects:e}),e.length>0};function announceFold(s,e,o=!0){let a=s.state.doc.lineAt(e.from).number,c=s.state.doc.lineAt(e.to).number;return EditorView.announce.of(`${s.state.phrase(o?"Folded lines":"Unfolded lines")} ${a} ${s.state.phrase("to")} ${c}.`)}const foldAll=s=>{let{state:e}=s,o=[];for(let a=0;a<e.doc.length;){let c=s.lineBlockAt(a),d=foldable(e,c.from,c.to);d&&o.push(foldEffect.of(d)),a=(d?s.lineBlockAt(d.to):c).to+1}return o.length&&s.dispatch({effects:maybeEnable(s.state,o)}),!!o.length},unfoldAll=s=>{let e=s.state.field(foldState,!1);if(!e||!e.size)return!1;let o=[];return e.between(0,s.state.doc.length,(a,c)=>{o.push(unfoldEffect.of({from:a,to:c}))}),s.dispatch({effects:o}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:""},foldConfig=Facet.define({combine(s){return combineConfig(s,defaultConfig)}});function codeFolding(s){return[foldState,baseTheme$1$1]}function widgetToDOM(s,e){let{state:o}=s,a=o.facet(foldConfig),c=h=>{let g=s.lineBlockAt(s.posAtDOM(h.target)),b=findFold(s.state,g.from,g.to);b&&s.dispatch({effects:unfoldEffect.of(b)}),h.preventDefault()};if(a.placeholderDOM)return a.placeholderDOM(s,c,e);let d=document.createElement("span");return d.textContent=a.placeholderText,d.setAttribute("aria-label",o.phrase("folded code")),d.title=o.phrase("unfold"),d.className="cm-foldPlaceholder",d.onclick=c,d}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(s){return widgetToDOM(s,null)}}});class PreparedFoldWidget extends WidgetType{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return widgetToDOM(e,this.value)}}const foldGutterDefaults={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,o){super(),this.config=e,this.open=o}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let o=document.createElement("span");return o.textContent=this.open?this.config.openText:this.config.closedText,o.title=e.state.phrase(this.open?"Fold line":"Unfold line"),o}}function foldGutter(s={}){let e={...foldGutterDefaults,...s},o=new FoldMarker(e,!0),a=new FoldMarker(e,!1),c=ViewPlugin.fromClass(class{constructor(h){this.from=h.viewport.from,this.markers=this.buildMarkers(h)}update(h){(h.docChanged||h.viewportChanged||h.startState.facet(language)!=h.state.facet(language)||h.startState.field(foldState,!1)!=h.state.field(foldState,!1)||syntaxTree(h.startState)!=syntaxTree(h.state)||e.foldingChanged(h))&&(this.markers=this.buildMarkers(h.view))}buildMarkers(h){let g=new RangeSetBuilder;for(let b of h.viewportLineBlocks){let j=findFold(h.state,b.from,b.to)?a:foldable(h.state,b.from,b.to)?o:null;j&&g.add(b.from,b.from,j)}return g.finish()}}),{domEventHandlers:d}=e;return[c,gutter({class:"cm-foldGutter",markers(h){var g;return((g=h.plugin(c))===null||g===void 0?void 0:g.markers)||RangeSet.empty},initialSpacer(){return new FoldMarker(e,!1)},domEventHandlers:{...d,click:(h,g,b)=>{if(d.click&&d.click(h,g,b))return!0;let j=findFold(h.state,g.from,g.to);if(j)return h.dispatch({effects:unfoldEffect.of(j)}),!0;let $=foldable(h.state,g.from,g.to);return $?(h.dispatch({effects:foldEffect.of($)}),!0):!1}}}),codeFolding()]}const baseTheme$1$1=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,o){this.specs=e;let a;function c(g){let b=StyleModule.newName();return(a||(a=Object.create(null)))["."+b]=g,b}const d=typeof o.all=="string"?o.all:o.all?c(o.all):void 0,h=o.scope;this.scope=h instanceof Language?g=>g.prop(languageDataProp)==h.data:h?g=>g==h:void 0,this.style=tagHighlighter(e.map(g=>({tag:g.tag,class:g.class||c(Object.assign({},g,{tag:null}))})),{all:d}).style,this.module=a?new StyleModule(a):null,this.themeType=o.themeType}static define(e,o){return new HighlightStyle(e,o||{})}}const baseTheme$2=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(s){return combineConfig(s,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(s){let e=[],o=s.matched?matchingMark:nonmatchingMark;return e.push(o.range(s.start.from,s.start.to)),s.end&&e.push(o.range(s.end.from,s.end.to)),e}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(s,e){if(!e.docChanged&&!e.selection)return s;let o=[],a=e.state.facet(bracketMatchingConfig);for(let c of e.state.selection.ranges){if(!c.empty)continue;let d=matchBrackets(e.state,c.head,-1,a)||c.head>0&&matchBrackets(e.state,c.head-1,1,a)||a.afterCursor&&(matchBrackets(e.state,c.head,1,a)||c.head<e.state.doc.length&&matchBrackets(e.state,c.head+1,-1,a));d&&(o=o.concat(a.renderMatch(d,e.state)))}return Decoration.set(o,!0)},provide:s=>EditorView.decorations.from(s)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$2];function bracketMatching(s={}){return[bracketMatchingConfig.of(s),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(s,e,o){let a=s.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(a)return a;if(s.name.length==1){let c=o.indexOf(s.name);if(c>-1&&c%2==(e<0?1:0))return[o[c+e]]}return null}function findHandle(s){let e=s.type.prop(bracketMatchingHandle);return e?e(s.node):s}function matchBrackets(s,e,o,a={}){let c=a.maxScanDistance||DefaultScanDist,d=a.brackets||DefaultBrackets,h=syntaxTree(s),g=h.resolveInner(e,o);for(let b=g;b;b=b.parent){let j=matchingNodes(b.type,o,d);if(j&&b.from<b.to){let $=findHandle(b);if($&&(o>0?e>=$.from&&e<$.to:e>$.from&&e<=$.to))return matchMarkedBrackets(s,e,o,b,$,j,d)}}return matchPlainBrackets(s,e,o,h,g.type,c,d)}function matchMarkedBrackets(s,e,o,a,c,d,h){let g=a.parent,b={from:c.from,to:c.to},j=0,$=g==null?void 0:g.cursor();if($&&(o<0?$.childBefore(a.from):$.childAfter(a.to)))do if(o<0?$.to<=a.from:$.from>=a.to){if(j==0&&d.indexOf($.type.name)>-1&&$.from<$.to){let _=findHandle($);return{start:b,end:_?{from:_.from,to:_.to}:void 0,matched:!0}}else if(matchingNodes($.type,o,h))j++;else if(matchingNodes($.type,-o,h)){if(j==0){let _=findHandle($);return{start:b,end:_&&_.from<_.to?{from:_.from,to:_.to}:void 0,matched:!1}}j--}}while(o<0?$.prevSibling():$.nextSibling());return{start:b,matched:!1}}function matchPlainBrackets(s,e,o,a,c,d,h){let g=o<0?s.sliceDoc(e-1,e):s.sliceDoc(e,e+1),b=h.indexOf(g);if(b<0||b%2==0!=o>0)return null;let j={from:o<0?e-1:e,to:o>0?e+1:e},$=s.doc.iterRange(e,o>0?s.doc.length:0),_=0;for(let _e=0;!$.next().done&&_e<=d;){let et=$.value;o<0&&(_e+=et.length);let nt=e+_e*o;for(let rt=o>0?0:et.length-1,it=o>0?et.length:-1;rt!=it;rt+=o){let st=h.indexOf(et[rt]);if(!(st<0||a.resolveInner(nt+rt,1).type!=c))if(st%2==0==o>0)_++;else{if(_==1)return{start:j,end:{from:nt+rt,to:nt+rt+1},matched:st>>1==b>>1};_--}}o>0&&(_e+=et.length)}return $.done?{start:j,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[s,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[s]=createTokenType(noTokens,e);function warnForPart(s,e){warned.indexOf(s)>-1||(warned.push(s),console.warn(e))}function createTokenType(s,e){let o=[];for(let g of e.split(" ")){let b=[];for(let j of g.split(".")){let $=s[j]||tags[j];$?typeof $=="function"?b.length?b=b.map($):warnForPart(j,`Modifier ${j} used at start of tag`):b.length?warnForPart(j,`Tag ${j} used as modifier`):b=Array.isArray($)?$:[$]:warnForPart(j,`Unknown highlighting tag ${j}`)}for(let j of b)o.push(j)}if(!o.length)return 0;let a=e.replace(/ /g,"_"),c=a+" "+o.map(g=>g.id),d=byTag[c];if(d)return d.id;let h=byTag[c]=NodeType.define({id:typeArray.length,name:a,props:[styleTags({[a]:o})]});return typeArray.push(h),h.id}Direction.RTL,Direction.LTR;HighlightStyle.define([{tag:tags.link,color:"#2563eb",textDecoration:"underline"},{tag:tags.keyword,color:"#7c3aed"},{tag:tags.function(tags.keyword),color:"#db2777"},{tag:tags.variableName,color:"#059669"},{tag:tags.labelName,color:"#d97706"},{tag:tags.string,color:"#0891b2"},{tag:tags.comment,color:"#6b7280",fontStyle:"italic"},{tag:tags.operator,color:"#ef4444"}]);const patterns={passageLink:/\[\[[^\]]+\]\]/g,macro:/\(([a-zA-Z_][a-zA-Z0-9_-]*):([^)]*)\)/g,variable:/[$_][a-zA-Z_][a-zA-Z0-9_]*/g,hook:/[|<]([a-zA-Z_][a-zA-Z0-9_]*)[>|]/g,string:/"[^"]*"|'[^']*'/g,comment:/<!--[\s\S]*?-->/g},passageLinkDeco=Decoration.mark({class:"cm-passage-link"}),macroDeco=Decoration.mark({class:"cm-macro"}),variableDeco=Decoration.mark({class:"cm-variable"}),hookDeco=Decoration.mark({class:"cm-hook"}),stringDeco=Decoration.mark({class:"cm-string"}),commentDeco=Decoration.mark({class:"cm-comment"});function findMatches(s,e,o,a=0){const c=[];let d;const h=new RegExp(e.source,e.flags);for(;(d=h.exec(s))!==null;)c.push({from:a+d.index,to:a+d.index+d[0].length,deco:o});return c}function createDecorations(s){const e=new RangeSetBuilder,o=s.state.doc.toString(),a=[];a.push(...findMatches(o,patterns.comment,commentDeco)),a.push(...findMatches(o,patterns.passageLink,passageLinkDeco)),a.push(...findMatches(o,patterns.macro,macroDeco)),a.push(...findMatches(o,patterns.variable,variableDeco)),a.push(...findMatches(o,patterns.hook,hookDeco)),a.push(...findMatches(o,patterns.string,stringDeco)),a.sort((d,h)=>d.from-h.from);let c=0;for(const d of a)d.from>=c&&(e.add(d.from,d.to,d.deco),c=d.to);return e.finish()}const twineSyntaxPlugin=ViewPlugin.fromClass(class{constructor(s){cr(this,"decorations");this.decorations=createDecorations(s)}update(s){(s.docChanged||s.viewportChanged)&&(this.decorations=createDecorations(s.view))}},{decorations:s=>s.decorations}),twineEditorTheme=EditorView.theme({"&":{fontSize:"14px",fontFamily:"'Fira Code', 'Consolas', monospace"},".cm-content":{padding:"12px",minHeight:"200px"},".cm-line":{padding:"2px 0"},".cm-passage-link":{color:"#2563eb",textDecoration:"underline",cursor:"pointer"},".cm-macro":{color:"#7c3aed",fontWeight:"500"},".cm-macro-name":{color:"#db2777"},".cm-variable":{color:"#059669",fontWeight:"500"},".cm-hook":{color:"#d97706",fontStyle:"italic"},".cm-string":{color:"#0891b2"},".cm-comment":{color:"#6b7280",fontStyle:"italic"},".cm-gutters":{backgroundColor:"#f9fafb",borderRight:"1px solid #e5e7eb"},".cm-activeLineGutter":{backgroundColor:"#f3f4f6"},".cm-activeLine":{backgroundColor:"#f9fafb"},".cm-selectionBackground":{backgroundColor:"#dbeafe !important"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"#bfdbfe !important"},".cm-tooltip":{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},".cm-tooltip-autocomplete":{"& > ul":{maxHeight:"200px"},"& > ul > li":{padding:"4px 8px"},"& > ul > li[aria-selected]":{backgroundColor:"#eff6ff",color:"#1d4ed8"}}}),macroDefinitions=[{name:"if",syntax:"(if: condition)[content]",description:"Displays content if condition is true",example:"(if: $visited > 0)[You have been here before.]"},{name:"else-if",syntax:"(else-if: condition)[content]",description:"Alternative condition after if",example:"(else-if: $score >= 50)[You passed!]"},{name:"else",syntax:"(else:)[content]",description:"Fallback content when no conditions match",example:"(else:)[Try again next time.]"},{name:"set",syntax:"(set: $variable to value)",description:"Sets a variable to a value",example:'(set: $playerName to "Hero")'},{name:"print",syntax:"(print: $variable)",description:"Displays the value of a variable",example:"(print: $playerName)"},{name:"link",syntax:'(link: "text")[action]',description:"Creates a clickable link with custom text",example:'(link: "Click me")[(set: $clicked to true)]'},{name:"link-goto",syntax:'(link-goto: "text", "passage")',description:"Creates a link that goes to another passage",example:'(link-goto: "Go to forest", "Forest Path")'},{name:"goto",syntax:'(goto: "passage")',description:"Immediately goes to another passage",example:'(goto: "Game Over")'},{name:"display",syntax:'(display: "passage")',description:"Embeds another passage content here",example:'(display: "Common Header")'},{name:"hidden",syntax:"|name>[content]",description:"Hidden hook that can be shown later",example:"|secret>[This is hidden initially]"},{name:"show",syntax:"(show: ?hookName)",description:"Shows a hidden hook",example:"(show: ?secret)"},{name:"hide",syntax:"(hide: ?hookName)",description:"Hides a visible hook",example:"(hide: ?message)"},{name:"replace",syntax:"(replace: ?hookName)[new content]",description:"Replaces hook content",example:"(replace: ?status)[Updated status]"},{name:"append",syntax:"(append: ?hookName)[content]",description:"Appends content to a hook",example:"(append: ?log)[New entry added]"},{name:"prepend",syntax:"(prepend: ?hookName)[content]",description:"Prepends content to a hook",example:"(prepend: ?list)[First item]"},{name:"live",syntax:"(live: time)[content]",description:"Re-runs content periodically",example:"(live: 2s)[(print: $timer)]"},{name:"stop",syntax:"(stop:)",description:"Stops a live macro",example:"(if: $timer <= 0)[(stop:)]"},{name:"transition",syntax:'(transition: "type")[content]',description:"Applies transition effect",example:'(transition: "fade")[Welcome!]'},{name:"text-style",syntax:'(text-style: "style")[text]',description:"Applies text styling",example:'(text-style: "bold")[Important!]'},{name:"text-color",syntax:"(text-color: color)[text]",description:"Changes text color",example:"(text-color: red)[Warning!]"},{name:"background",syntax:"(background: color)[content]",description:"Sets background color",example:"(background: yellow)[Highlighted]"},{name:"alert",syntax:'(alert: "message")',description:"Shows an alert dialog",example:'(alert: "Save complete!")'},{name:"prompt",syntax:'(prompt: "message", "default")',description:"Shows a prompt dialog",example:'(set: $name to (prompt: "Your name?", "Player"))'},{name:"confirm",syntax:'(confirm: "message")',description:"Shows a confirm dialog",example:'(if: (confirm: "Are you sure?"))[(goto: "Exit")]'},{name:"random",syntax:"(random: min, max)",description:"Generates a random number",example:"(set: $roll to (random: 1, 6))"},{name:"either",syntax:"(either: ...values)",description:"Randomly selects one value",example:'(print: (either: "heads", "tails"))'},{name:"cond",syntax:"(cond: condition, ifTrue, ifFalse)",description:"Conditional expression",example:'(print: (cond: $score > 50, "Pass", "Fail"))'}];function extractPassageRefs(s){const e=[],o=/\[\[([^\]|\->]+)(?:->|\|)#(\d{1,6})\]\]/g;let a;for(;(a=o.exec(s))!==null;){const g=a[2];e.some(b=>b.type==="id"&&b.value===g)||e.push({type:"id",value:g,displayText:a[1].trim()})}const c=/\[\[#(\d{1,6})\]\]/g;for(;(a=c.exec(s))!==null;){const g=a[1];e.some(b=>b.type==="id"&&b.value===g)||e.push({type:"id",value:g})}const d=/\[\[([^\]|\->]+)(?:->|\|)([^\]#][^\]]*)\]\]/g;for(;(a=d.exec(s))!==null;){const g=a[2].trim();e.some(b=>b.type==="name"&&b.value===g)||e.push({type:"name",value:g,displayText:a[1].trim()})}const h=/\[\[([^\]#|\->]+)\]\]/g;for(;(a=h.exec(s))!==null;){const g=a[1].trim();e.some(b=>b.type==="name"&&b.value===g)||e.push({type:"name",value:g})}return e}function extractPassageLinks(s){return extractPassageRefs(s).filter(o=>o.type==="name").map(o=>o.value)}function extractVariables(s){const e=[];let o;for(;(o=patterns.variable.exec(s))!==null;)e.includes(o[0])||e.push(o[0]);return e}const nodeTypes$1={branch:BranchNode},StoryMapModalContent=({isOpen:s,onClose:e,storyId:o,currentPassageId:a})=>{const c=useNavigate(),[d,h,g]=useNodesState([]),[b,j,$]=useEdgesState([]),[_,_e]=reactExports.useState(!0);reactExports.useEffect(()=>{s&&o&&et()},[s,o]);const et=async()=>{try{_e(!0);const it=(await api.get(`/stories/structure/${o}`)).data;console.log("Current Passage ID:",a);const st=it.passages.map(at=>{const dt=at.passage_type==="branch",ft=at.id===a;return console.log(`Passage ${at.name} (${at.id}): isCurrentPassage=${ft}`),{id:at.id,type:dt?"branch":void 0,position:{x:at.position_x,y:at.position_y},data:{label:at.name,passage:at,isCurrentPassage:ft},style:dt?void 0:{width:at.width,minHeight:at.height,padding:"10px",backgroundColor:at.passage_type==="start"?"#D1FAE5":at.passage_type==="end"?"#FEE2E2":"#FFFFFF",border:ft?"4px solid #7C3AED":"2px solid #E5E7EB",borderRadius:"8px",boxShadow:ft?"0 0 20px rgba(124, 58, 237, 0.5)":void 0,cursor:"pointer"}}}),lt=new Map(it.passages.map(at=>[at.id,at])),ot=it.links.map(at=>{const dt=lt.get(at.source_passage_id),ft=(dt==null?void 0:dt.passage_type)==="branch",xt=ft?`choice-${at.link_order}`:void 0;return{id:at.id,source:at.source_passage_id,target:at.target_passage_id,sourceHandle:xt,label:ft?`${at.link_order+1}`:at.name||"",type:"smoothstep",animated:at.condition_type!=="always",style:ft?{stroke:"#F59E0B",strokeWidth:2}:void 0,data:{conditionType:at.condition_type,conditionValue:at.condition_value}}}),ct=[],ut=new Set(it.links.map(at=>`${at.source_passage_id}-${at.target_passage_id}`));it.passages.forEach(at=>{extractPassageLinks(at.content||"").forEach(ft=>{const xt=it.passages.find(Ct=>Ct.name===ft);if(xt&&xt.id!==at.id){const Ct=`${at.id}-${xt.id}`;ut.has(Ct)||(ut.add(Ct),ct.push({id:`content-${Ct}`,source:at.id,target:xt.id,type:"smoothstep",style:{strokeDasharray:"5,5",stroke:"#9CA3AF"},animated:!1}))}})}),h(st),j([...ot,...ct]),_e(!1)}catch(rt){console.error("Failed to fetch story map:",rt),_e(!1)}},nt=(rt,it)=>{c(`/passage/${it.id}`),e()};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-[90vw] h-[90vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Map$1,{className:"w-5 h-5 text-primary-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:" "})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-6 h-6 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative",children:_?jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})}):jsxRuntimeExports.jsxs(ReactFlowWithFitView,{nodes:d,edges:b,onNodesChange:g,onEdgesChange:$,onNodeClick:nt,nodeTypes:nodeTypes$1,currentPassageId:a,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!1,panOnDrag:!0,zoomOnScroll:!0,zoomOnPinch:!0,panOnScroll:!1,selectionOnDrag:!1,selectNodesOnDrag:!1,children:[jsxRuntimeExports.jsx(Background,{}),jsxRuntimeExports.jsx(Controls,{})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 border-4 border-primary-600 rounded"}),jsxRuntimeExports.jsx("span",{children:" "})]})})})]})})},ReactFlowWithFitView=({currentPassageId:s,children:e,...o})=>{const{fitView:a}=useReactFlow();return reactExports.useEffect(()=>{s&&setTimeout(()=>{a({nodes:[{id:s}],duration:800,padding:.3})},100)},[s,a]),jsxRuntimeExports.jsx(index,{...o,children:e})},StoryMapModal=s=>s.isOpen?jsxRuntimeExports.jsx(ReactFlowProvider,{children:jsxRuntimeExports.jsx(StoryMapModalContent,{...s})}):null,PassagePage=()=>{const s=useNavigate(),{passageId:e}=useParams(),[o]=useSearchParams(),{currentPassage:a,currentStory:c,fetchBookmarks:d,isLoading:h,loadPassageById:g,loadPassageByNumber:b}=useStoryStore(),{isAuthenticated:j}=useAuthStore(),{leftSidebarCollapsed:$,rightSidebarCollapsed:_}=useUIStore(),[_e,et]=reactExports.useState(!1),it=$&&_?"max-w-6xl":$!==_?"max-w-5xl":"max-w-4xl";return reactExports.useEffect(()=>{const st=o.get("number"),lt=o.get("story");if(st&&lt){b(parseInt(st,10),lt);return}if(e){g(e,!1);return}if(!c||!a){s("/");return}},[e,o]),reactExports.useEffect(()=>{j&&c&&d()},[j,c]),reactExports.useEffect(()=>{if(a&&c){const st=a.passage;if(st.passage_number){const lt=`/passage?number=${st.passage_number}&story=${c.id}`,ot=`${window.location.pathname}${window.location.search}`;ot!==lt&&(console.log("Updating URL to:",lt,"from:",ot),s(lt,{replace:!0}))}else{const lt=`/passage/${st.id}`;window.location.pathname!==lt&&!o.get("number")&&(console.log("Using ID-based URL:",lt),s(lt,{replace:!0}))}}},[a==null?void 0:a.passage.id,a==null?void 0:a.passage.passage_number,c==null?void 0:c.id,s,o]),!a||!c?null:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-violet-50/30",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("div",{className:"pt-16 flex min-h-screen",children:[jsxRuntimeExports.jsx(LeftSidebar,{}),jsxRuntimeExports.jsxs("main",{className:"flex-1 flex flex-col min-w-0 relative pb-[88px]",children:[jsxRuntimeExports.jsx(Minimap,{}),jsxRuntimeExports.jsxs("button",{onClick:()=>et(!0),className:"absolute top-4 right-4 z-20 group",title:"  ",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full blur-lg opacity-40 group-hover:opacity-70 transition-opacity duration-300"}),jsxRuntimeExports.jsx("div",{className:"relative w-12 h-12 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group-hover:scale-110 group-active:scale-95",children:jsxRuntimeExports.jsx(Map$1,{className:"w-5 h-5 transition-transform duration-300 group-hover:rotate-12"})}),jsxRuntimeExports.jsxs("span",{className:"absolute top-full mt-3 right-0 px-3 py-1.5 bg-gray-900 text-white text-xs font-medium rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap shadow-lg pointer-events-none transform translate-y-1 group-hover:translate-y-0",children:[" ",jsxRuntimeExports.jsx("span",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-900 rotate-45"})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 p-8 overflow-y-auto",children:h?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-500 to-purple-500 rounded-full blur-xl opacity-30 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"relative w-16 h-16 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg",children:jsxRuntimeExports.jsx(Loader2,{className:"w-8 h-8 text-white animate-spin"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 font-medium",children:"Loading passage..."}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 text-sm",children:"Please wait a moment"})]})]}):jsxRuntimeExports.jsx("div",{className:`mx-auto ${it}`,children:jsxRuntimeExports.jsx(PassageView,{context:a})})})]}),jsxRuntimeExports.jsx(RightSidebar,{})]}),jsxRuntimeExports.jsx(PassageNav,{context:a}),c&&a&&jsxRuntimeExports.jsx(StoryMapModal,{isOpen:_e,onClose:()=>et(!1),storyId:c.id,currentPassageId:a.passage.id})]})},STORY_ICONS=[{name:"book-open",icon:BookOpen},{name:"lightbulb",icon:Lightbulb},{name:"target",icon:Target},{name:"rocket",icon:Rocket},{name:"brain",icon:Brain},{name:"code",icon:Code$1},{name:"gamepad2",icon:Gamepad2},{name:"map",icon:Map$1},{name:"compass",icon:Compass},{name:"star",icon:Star},{name:"heart",icon:Heart},{name:"zap",icon:Zap},{name:"award",icon:Award},{name:"sparkles",icon:Sparkles},{name:"image",icon:Image$1}],getIconComponent=s=>{const e=STORY_ICONS.find(o=>o.name===s);return(e==null?void 0:e.icon)||BookOpen},AdminDashboard=()=>{const[s,e]=reactExports.useState(null),[o,a]=reactExports.useState([]),[c,d]=reactExports.useState([]),[h,g]=reactExports.useState(""),[b,j]=reactExports.useState(null),[$,_]=reactExports.useState(null),[_e,et]=reactExports.useState(""),[nt,rt]=reactExports.useState(!0),[it,st]=reactExports.useState(null),[lt,ot]=reactExports.useState(null),[ct,ut]=reactExports.useState(!1),[at,dt]=reactExports.useState(null),[ft,xt]=reactExports.useState(null),[Ct,yt]=reactExports.useState(null),[Et,Tt]=reactExports.useState(""),[ht,wt]=reactExports.useState(""),St=reactExports.useRef(null);reactExports.useEffect(()=>{bt()},[]),reactExports.useEffect(()=>{mt()},[h]);const bt=async()=>{try{const[Nt,Ot]=await Promise.all([api.get("/admin/stats/overview"),api.get("/admin/stories")]);e(Nt.data),a(Ot.data)}catch(Nt){console.error("Failed to fetch admin data:",Nt)}finally{rt(!1)}},mt=async()=>{try{const Nt=h?{story_id:h}:{},Ot=await api.get("/admin/feedback/all",{params:Nt});d(Ot.data)}catch(Nt){console.error("Failed to fetch feedbacks:",Nt)}},gt=async Nt=>{if(_e.trim())try{await api.post(`/feedback/${Nt}/reply`,{content:_e,is_anonymous:!1}),et(""),_(null),mt()}catch(Ot){console.error("Failed to reply:",Ot)}},pt=async Nt=>{if(confirm("  ?"))try{await api.delete(`/feedback/${Nt}`),mt()}catch(Ot){console.error("Failed to delete feedback:",Ot)}},kt=async()=>{const Nt=prompt("Enter story name:");if(Nt)try{await api.post("/admin/stories",{name:Nt}),bt()}catch(Ot){console.error("Failed to create story:",Ot)}},Rt=async Nt=>{try{await api.delete(`/admin/stories/${Nt}`),xt(null),bt()}catch(Ot){console.error("Failed to delete story:",Ot)}},At=async(Nt,Ot)=>{try{await api.put(`/admin/stories/${Nt}`,{icon:Ot}),a(Wt=>Wt.map(Ft=>Ft.id===Nt?{...Ft,icon:Ot}:Ft)),dt(null)}catch(Wt){console.error("Failed to update story icon:",Wt)}},Mt=Nt=>{yt(Nt.id),Tt(Nt.name),wt(Nt.description||"")},Dt=()=>{yt(null),Tt(""),wt("")},$t=async Nt=>{try{await api.put(`/admin/stories/${Nt}`,{name:Et,description:ht}),a(Ot=>Ot.map(Wt=>Wt.id===Nt?{...Wt,name:Et,description:ht}:Wt)),Dt()}catch(Ot){console.error("Failed to update story:",Ot),alert("Failed to update story. Please try again.")}},_t=async(Nt,Ot)=>{try{await api.put(`/admin/stories/${Nt}`,{is_active:!Ot}),a(Wt=>Wt.map(Ft=>Ft.id===Nt?{...Ft,is_active:!Ot}:Ft))}catch(Wt){console.error("Failed to toggle story status:",Wt),alert("Failed to update story status. Please try again.")}},Pt=(Nt,Ot)=>{st(Ot),St.current=Nt.currentTarget,Nt.dataTransfer.effectAllowed="move",Nt.dataTransfer.setData("text/html",Nt.currentTarget.outerHTML),setTimeout(()=>{St.current&&(St.current.style.opacity="0.5")},0)},Ht=async()=>{if(St.current&&(St.current.style.opacity="1"),it!==null&&lt!==null&&it!==lt){const Nt=[...o],[Ot]=Nt.splice(it,1);Nt.splice(lt,0,Ot),a(Nt),ut(!0);try{const Wt=Nt.map(Ft=>Ft.id);await api.put("/admin/stories/reorder",{story_ids:Wt})}catch(Wt){console.error("Failed to reorder stories:",Wt),bt()}finally{ut(!1)}}st(null),ot(null),St.current=null},Kt=(Nt,Ot)=>{Nt.preventDefault(),Nt.dataTransfer.dropEffect="move",it!==null&&Ot!==lt&&ot(Ot)},Ut=()=>{};return nt?jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"})})}):jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsxs("div",{className:"py-8 max-w-6xl mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),jsxRuntimeExports.jsxs(Button,{onClick:kt,children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-2"}),"New Story"]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-8",children:[jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-5 h-5 text-blue-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-gray-900",children:(s==null?void 0:s.total_users)||0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Users"})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(BookOpen,{className:"w-5 h-5 text-green-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-gray-900",children:(s==null?void 0:s.total_stories)||0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Stories"})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5 text-purple-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-gray-900",children:(s==null?void 0:s.total_passages)||0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Passages"})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(Eye,{className:"w-5 h-5 text-orange-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-gray-900",children:(s==null?void 0:s.total_visits)||0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Visits"})]})]})}),jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(MessageSquare,{className:"w-5 h-5 text-pink-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-gray-900",children:(s==null?void 0:s.total_feedbacks)||0}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:""})]})]})})]}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold",children:"Stories"}),ct&&jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-600 border-t-transparent"}),"Saving order..."]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"       .     ."}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[o.map((Nt,Ot)=>{const Wt=getIconComponent(Nt.icon||"book-open");return jsxRuntimeExports.jsxs("div",{draggable:!0,onDragStart:Ft=>Pt(Ft,Ot),onDragEnd:Ht,onDragOver:Ft=>Kt(Ft,Ot),onDragLeave:Ut,className:`flex items-center justify-between p-4 rounded-lg cursor-move transition-all ${lt===Ot&&it!==Ot?"border-2 border-primary-500 border-dashed bg-primary-50":"border-2 border-transparent"} ${it===Ot?"opacity-50":""} ${Nt.is_active?"bg-gray-50":"bg-gray-100 opacity-60"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(GripVertical,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Ft=>{Ft.stopPropagation(),dt(at===Nt.id?null:Nt.id)},className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center hover:bg-primary-200 transition-colors",title:"Change icon",children:jsxRuntimeExports.jsx(Wt,{className:"w-5 h-5 text-primary-600"})}),at===Nt.id&&jsxRuntimeExports.jsxs("div",{className:"absolute top-12 left-0 z-50 bg-white rounded-lg shadow-lg border border-gray-200 p-2 w-48",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Select Icon"}),jsxRuntimeExports.jsx("button",{onClick:Ft=>{Ft.stopPropagation(),dt(null)},className:"p-1 hover:bg-gray-100 rounded",children:jsxRuntimeExports.jsx(X,{className:"w-3 h-3 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-5 gap-1",children:STORY_ICONS.map(({name:Ft,icon:qt})=>jsxRuntimeExports.jsx("button",{onClick:en=>{en.stopPropagation(),At(Nt.id,Ft)},className:`p-2 rounded hover:bg-gray-100 transition-colors ${Nt.icon===Ft?"bg-primary-100":""}`,title:Ft,children:jsxRuntimeExports.jsx(qt,{className:"w-4 h-4 text-gray-600"})},Ft))})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:Ct===Nt.id?jsxRuntimeExports.jsxs("div",{className:"space-y-2",onClick:Ft=>Ft.stopPropagation(),children:[jsxRuntimeExports.jsx("input",{type:"text",value:Et,onChange:Ft=>Tt(Ft.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary-500",placeholder:"Story name",autoFocus:!0}),jsxRuntimeExports.jsx("textarea",{value:ht,onChange:Ft=>wt(Ft.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary-500 resize-none",placeholder:"Story description",rows:2}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{size:"sm",onClick:()=>$t(Nt.id),children:""}),jsxRuntimeExports.jsx(Button,{size:"sm",variant:"secondary",onClick:Dt,children:""})]})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:Nt.name}),!Nt.is_active&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-200 text-gray-600 rounded",children:""})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:Nt.description||"No description"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:Ft=>{Ft.stopPropagation(),_t(Nt.id,Nt.is_active)},className:`px-3 py-1.5 text-xs font-medium rounded-lg transition-colors ${Nt.is_active?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:Nt.is_active?"Click to deactivate":"Click to activate",children:Nt.is_active?" ":" "}),Ct!==Nt.id&&jsxRuntimeExports.jsx("button",{onClick:Ft=>{Ft.stopPropagation(),Mt(Nt)},className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Edit title and description",children:jsxRuntimeExports.jsx(Settings,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Link$2,{to:`/admin/stories/${Nt.id}`,children:jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"sm",children:"Editor"})}),jsxRuntimeExports.jsx("div",{className:"relative",children:ft===Nt.id?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-red-50 rounded-lg px-2 py-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-red-700",children:"Delete?"}),jsxRuntimeExports.jsx("button",{onClick:()=>Rt(Nt.id),className:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Yes"}),jsxRuntimeExports.jsx("button",{onClick:()=>xt(null),className:"px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"No"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>xt(Nt.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete story",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})})]})]},Nt.id)}),o.length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 py-8",children:"No stories yet. Create your first story!"})]})]}),jsxRuntimeExports.jsxs(Card,{className:"mt-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MessageSquare,{className:"w-5 h-5 text-gray-600"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold",children:""}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500",children:["(",c.length,")"]})]}),jsxRuntimeExports.jsxs("select",{value:h,onChange:Nt=>g(Nt.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary-500",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Stories"}),o.map(Nt=>jsxRuntimeExports.jsx("option",{value:Nt.id,children:Nt.name},Nt.id))]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:[c.map(Nt=>jsxRuntimeExports.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 bg-gray-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-800",children:Nt.is_anonymous?"Anonymous":Nt.user_name||"User"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-400",children:new Date(Nt.created_at).toLocaleString()}),(Nt.reply_count||0)>0&&jsxRuntimeExports.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:[Nt.reply_count," replies"]})]}),Nt.passage_name&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"bg-gray-200 px-2 py-0.5 rounded",children:Nt.story_name}),jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsx("span",{className:"bg-primary-100 text-primary-700 px-2 py-0.5 rounded",children:Nt.passage_name})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:()=>j(b===Nt.id?null:Nt.id),className:"p-1 text-gray-400 hover:text-gray-600",children:b===Nt.id?jsxRuntimeExports.jsx(ChevronUp,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>pt(Nt.id),className:"p-1 text-gray-400 hover:text-red-600",title:"Delete",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-gray-700",children:Nt.content}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>_($===Nt.id?null:Nt.id),className:"flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700",children:[jsxRuntimeExports.jsx(Reply,{className:"w-3 h-3"}),"Reply"]}),Nt.passage_id&&jsxRuntimeExports.jsxs(Link$2,{to:`/admin/stories/${Nt.story_id}`,className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700",children:[jsxRuntimeExports.jsx(ExternalLink,{className:"w-3 h-3"}),"Go to Editor"]})]}),$===Nt.id&&jsxRuntimeExports.jsxs("div",{className:"mt-3 flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:_e,onChange:Ot=>et(Ot.target.value),placeholder:"Write a reply...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-primary-500",onKeyDown:Ot=>{Ot.key==="Enter"&&!Ot.shiftKey&&(Ot.preventDefault(),gt(Nt.id))}}),jsxRuntimeExports.jsx(Button,{size:"sm",onClick:()=>gt(Nt.id),disabled:!_e.trim(),children:"Send"})]})]}),b===Nt.id&&Nt.replies&&Nt.replies.length>0&&jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 bg-white p-4 space-y-3",children:Nt.replies.map(Ot=>jsxRuntimeExports.jsxs("div",{className:"pl-4 border-l-2 border-primary-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:Ot.is_anonymous?"Anonymous":Ot.user_name||"User"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-400",children:new Date(Ot.created_at).toLocaleString()}),jsxRuntimeExports.jsx("button",{onClick:()=>pt(Ot.id),className:"p-1 text-gray-400 hover:text-red-600",children:jsxRuntimeExports.jsx(Trash2,{className:"w-3 h-3"})})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Ot.content})]},Ot.id))})]},Nt.id)),c.length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 py-8",children:"  ."})]})]})]})})},TextAlign=Extension.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:s=>{const e=s.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:s=>s.textAlign?{style:`text-align: ${s.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:s=>({commands:e})=>this.options.alignments.includes(s)?this.options.types.map(o=>e.updateAttributes(o,{textAlign:s})).every(o=>o):!1,unsetTextAlign:()=>({commands:s})=>this.options.types.map(e=>s.resetAttributes(e,"textAlign")).every(e=>e),toggleTextAlign:s=>({editor:e,commands:o})=>this.options.alignments.includes(s)?e.isActive({textAlign:s})?o.unsetTextAlign():o.setTextAlign(s):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),inputRegex=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,pasteRegex=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Highlight=Mark.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:s=>s.getAttribute("data-color")||s.style.backgroundColor,renderHTML:s=>s.color?{"data-color":s.color,style:`background-color: ${s.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:s}){return["mark",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{setHighlight:s=>({commands:e})=>e.setMark(this.name,s),toggleHighlight:s=>({commands:e})=>e.toggleMark(this.name,s),unsetHighlight:()=>({commands:s})=>s.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[markInputRule({find:inputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex,type:this.type})]}}),mergeNestedSpanStyles=s=>{if(!s.children.length)return;const e=s.querySelectorAll("span");e&&e.forEach(o=>{var a,c;const d=o.getAttribute("style"),h=(c=(a=o.parentElement)===null||a===void 0?void 0:a.closest("span"))===null||c===void 0?void 0:c.getAttribute("style");o.setAttribute("style",`${h};${d}`)})},TextStyle=Mark.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!1}},parseHTML(){return[{tag:"span",getAttrs:s=>s.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&mergeNestedSpanStyles(s),{}):!1}]},renderHTML({HTMLAttributes:s}){return["span",mergeAttributes(this.options.HTMLAttributes,s),0]},addCommands(){return{removeEmptyTextStyle:()=>({tr:s})=>{const{selection:e}=s;return s.doc.nodesBetween(e.from,e.to,(o,a)=>{if(o.isTextblock)return!0;o.marks.filter(c=>c.type===this.type).some(c=>Object.values(c.attrs).some(d=>!!d))||s.removeMark(a,a+o.nodeSize,this.type)}),!0}}}}),Color=Extension.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:s=>{var e;return(e=s.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:s=>s.color?{style:`color: ${s.color}`}:{}}}}]},addCommands(){return{setColor:s=>({chain:e})=>e().setMark("textStyle",{color:s}).run(),unsetColor:()=>({chain:s})=>s().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),CustomImage=Image.extend({inline:!0,group:"inline",addAttributes(){var s;return{...(s=this.parent)==null?void 0:s.call(this),width:{default:null,parseHTML:e=>e.getAttribute("width")||e.style.width,renderHTML:e=>e.width?{width:e.width}:{}},align:{default:"baseline",parseHTML:e=>e.style.verticalAlign||"baseline",renderHTML:e=>({style:`vertical-align: ${e.align||"baseline"}; margin: 0 0.25rem;`})}}}}),IMAGE_SIZE_PRESETS=[{label:"25%",value:"25%"},{label:"50%",value:"50%"},{label:"75%",value:"75%"},{label:"100%",value:"100%"}],TEXT_COLORS=[{name:"",color:"#000000"},{name:"",color:"#6B7280"},{name:"",color:"#DC2626"},{name:"",color:"#EA580C"},{name:"",color:"#CA8A04"},{name:"",color:"#16A34A"},{name:"",color:"#2563EB"},{name:"",color:"#7C3AED"},{name:"",color:"#DB2777"}],HIGHLIGHT_COLORS=[{name:"",color:""},{name:"",color:"#FEF08A"},{name:"",color:"#BBF7D0"},{name:"",color:"#BFDBFE"},{name:"",color:"#E9D5FF"},{name:"",color:"#FBCFE8"},{name:"",color:"#FECACA"},{name:"",color:"#FED7AA"}],SHORTCUTS={bold:"Ctrl+B",italic:"Ctrl+I",strike:"Ctrl+Shift+S",code:"Ctrl+E",bulletList:"Ctrl+Shift+8",orderedList:"Ctrl+Shift+7",blockquote:"Ctrl+Shift+B",undo:"Ctrl+Z",redo:"Ctrl+Y"},TipTapEditor=({content:s,onChange:e,onImageUpload:o})=>{const[a,c]=reactExports.useState(!1),[d,h]=reactExports.useState(""),[g,b]=reactExports.useState(""),[j,$]=reactExports.useState(null),[_,_e]=reactExports.useState(!1),[et,nt]=reactExports.useState(!1),[rt,it]=reactExports.useState(""),[st,lt]=reactExports.useState("50%"),[ot,ct]=reactExports.useState("baseline"),ut=reactExports.useRef(!1),at=useEditor({extensions:[StarterKit.configure({hardBreak:{keepMarks:!0}}),CustomImage.configure({HTMLAttributes:{class:"rounded-lg max-w-full"}}),Link.configure({openOnClick:!1,HTMLAttributes:{class:"text-primary-600 underline hover:text-primary-700",rel:"noopener noreferrer"}}),Table.configure({resizable:!0,HTMLAttributes:{class:"border-collapse table-auto w-full"}}),TableRow,TableHeader.configure({HTMLAttributes:{class:"bg-gray-100 font-semibold"}}),TableCell.configure({HTMLAttributes:{class:"border border-gray-300 p-2"}}),TextAlign.configure({types:["heading","paragraph"]}),Highlight.configure({multicolor:!0}),TextStyle,Color,Gapcursor],content:"",onUpdate:({editor:pt})=>{ut.current=!0;const Rt=pt.getHTML().replace(/></g,`>
<`).replace(/(<p>)/g,`
$1`).replace(/(<\/p>)/g,`$1
`).replace(/(<br>)/g,`$1
`).replace(/(<\/li>)/g,`$1
`).replace(/(<\/h[1-6]>)/g,`$1
`).trim();e(Rt)},editorProps:{attributes:{class:"passage-content focus:outline-none min-h-[300px] p-4",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false","data-gramm":"false","data-gramm_editor":"false","data-enable-grammarly":"false"},handlePaste:(pt,kt)=>{const Rt=kt.clipboardData;if(!Rt)return!1;const At=Array.from(Rt.items||[]),Mt=Array.from(Rt.files||[]);for(const Dt of At)if(Dt.type.startsWith("image/")){kt.preventDefault();const $t=Dt.getAsFile();return $t&&o?(console.log("Pasting image from clipboard items:",$t.name,$t.type),o($t).then(_t=>{const{state:Pt}=pt,{tr:Ht}=Pt,Kt=Pt.selection.from,Ut=Pt.schema.nodes.image.create({src:_t});pt.dispatch(Ht.insert(Kt,Ut))}).catch(_t=>{console.error("Failed to upload pasted image:",_t),alert("  : "+((_t==null?void 0:_t.message)||_t))})):o||(console.warn("onImageUpload prop is not provided"),alert("    .")),!0}for(const Dt of Mt)if(Dt.type.startsWith("image/"))return kt.preventDefault(),o&&(console.log("Pasting image from clipboard files:",Dt.name,Dt.type),o(Dt).then($t=>{const{state:_t}=pt,{tr:Pt}=_t,Ht=_t.selection.from,Kt=_t.schema.nodes.image.create({src:$t});pt.dispatch(Pt.insert(Ht,Kt))}).catch($t=>{console.error("Failed to upload pasted image:",$t),alert("  : "+(($t==null?void 0:$t.message)||$t))})),!0;return!1},handleDrop:(pt,kt)=>{var At;const Rt=(At=kt.dataTransfer)==null?void 0:At.files;if(!Rt||Rt.length===0)return!1;for(const Mt of Rt)if(Mt.type.startsWith("image/"))return kt.preventDefault(),o&&o(Mt).then(Dt=>{const{state:$t}=pt,{tr:_t}=$t,Pt=pt.posAtCoords({left:kt.clientX,top:kt.clientY}),Ht=(Pt==null?void 0:Pt.pos)??$t.selection.from,Kt=$t.schema.nodes.image.create({src:Dt});pt.dispatch(_t.insert(Ht,Kt))}).catch(Dt=>{console.error("Failed to upload dropped image:",Dt)}),!0;return!1}}});if(reactExports.useEffect(()=>{at&&s&&!ut.current&&at.getHTML()!==s&&at.commands.setContent(s),ut.current=!1},[s,at]),!at)return null;reactExports.useEffect(()=>{const pt=kt=>{kt.target.closest(".color-picker-dropdown")||$(null)};if(j)return document.addEventListener("mousedown",pt),()=>document.removeEventListener("mousedown",pt)},[j]);const dt=async()=>{if(o){const pt=document.createElement("input");pt.type="file",pt.accept="image/*",pt.onchange=async kt=>{var At;const Rt=(At=kt.target.files)==null?void 0:At[0];if(Rt)try{const Mt=await o(Rt);it(Mt),lt("50%"),ct("baseline"),nt(!0)}catch(Mt){console.error("Failed to upload image:",Mt);const Dt=Mt instanceof Error?Mt.message:String(Mt);alert("  : "+Dt)}},pt.click()}else it(""),lt("50%"),ct("baseline"),nt(!0)},ft=reactExports.useCallback(()=>{if(!at||!rt)return;const pt=`<img src="${rt}" />`;at.chain().focus().insertContent(pt).run(),at.chain().focus().updateAttributes("image",{width:st,align:ot}).run(),nt(!1),it(""),lt("50%"),ct("baseline")},[at,rt,st,ot]),xt=reactExports.useCallback(pt=>{at&&at.chain().focus().updateAttributes("image",{width:pt}).run()},[at]),Ct=reactExports.useCallback(pt=>{at&&at.chain().focus().updateAttributes("image",{align:pt}).run()},[at]),yt=reactExports.useCallback(()=>{if(!at)return;const pt=at.getAttributes("link").href||"",{from:kt,to:Rt}=at.state.selection,At=at.state.doc.textBetween(kt,Rt,"");h(pt),b(At),c(!0)},[at]),Et=reactExports.useCallback(()=>{if(at){if(d==="")at.chain().focus().extendMarkRange("link").unsetLink().run();else{const{from:pt,to:kt}=at.state.selection;pt===kt&&g?at.chain().focus().insertContent(`<a href="${d}">${g}</a>`).run():at.chain().focus().extendMarkRange("link").setLink({href:d}).run()}c(!1),h(""),b("")}},[at,d,g]),Tt=reactExports.useCallback(()=>{at&&(at.chain().focus().extendMarkRange("link").unsetLink().run(),c(!1))},[at]),ht=reactExports.useCallback(pt=>{pt.preventDefault(),pt.dataTransfer.types.includes("Files")&&_e(!0)},[]),wt=reactExports.useCallback(pt=>{pt.preventDefault(),_e(!1)},[]),St=reactExports.useCallback(pt=>{_e(!1)},[]),bt=({onClick:pt,isActive:kt,disabled:Rt,children:At,title:Mt,shortcut:Dt})=>jsxRuntimeExports.jsxs("button",{type:"button",onClick:pt,disabled:Rt,title:Dt?`${Mt} (${Dt})`:Mt,className:`
        relative group p-1.5 rounded-md transition-all duration-150
        ${kt?"bg-primary-100 text-primary-700 shadow-sm":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}
        ${Rt?"opacity-40 cursor-not-allowed":"cursor-pointer"}
      `,children:[At,jsxRuntimeExports.jsxs("span",{className:`\r
        absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1\r
        text-xs font-medium text-white bg-gray-900 rounded-md\r
        opacity-0 invisible group-hover:opacity-100 group-hover:visible\r
        transition-all duration-150 whitespace-nowrap z-50\r
        pointer-events-none\r
      `,children:[Mt,Dt&&jsxRuntimeExports.jsx("span",{className:"ml-1 text-gray-400",children:Dt}),jsxRuntimeExports.jsx("span",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]}),mt=()=>jsxRuntimeExports.jsx("div",{className:"w-px h-6 bg-gray-200 mx-1"}),gt=({children:pt,label:kt})=>jsxRuntimeExports.jsx("div",{className:"flex items-center gap-0.5",title:kt,children:pt});return jsxRuntimeExports.jsxs("div",{className:`
      border rounded-lg overflow-hidden transition-all duration-200
      ${_?"border-primary-500 border-2 bg-primary-50":"border-gray-300 hover:border-gray-400"}
    `,onDragOver:ht,onDragLeave:wt,onDrop:St,children:[jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border-b border-gray-200 px-2 py-1.5 flex flex-wrap items-center gap-1",children:[jsxRuntimeExports.jsxs(gt,{label:" ",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleBold().run(),isActive:at.isActive("bold"),title:"",shortcut:SHORTCUTS.bold,children:jsxRuntimeExports.jsx(Bold$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleItalic().run(),isActive:at.isActive("italic"),title:"",shortcut:SHORTCUTS.italic,children:jsxRuntimeExports.jsx(Italic$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleStrike().run(),isActive:at.isActive("strike"),title:"",shortcut:SHORTCUTS.strike,children:jsxRuntimeExports.jsx(Strikethrough,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleCode().run(),isActive:at.isActive("code"),title:" ",shortcut:SHORTCUTS.code,children:jsxRuntimeExports.jsx(Code$1,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:"",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleHeading({level:1}).run(),isActive:at.isActive("heading",{level:1}),title:" 1",children:jsxRuntimeExports.jsx(Heading1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleHeading({level:2}).run(),isActive:at.isActive("heading",{level:2}),title:" 2",children:jsxRuntimeExports.jsx(Heading2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleHeading({level:3}).run(),isActive:at.isActive("heading",{level:3}),title:" 3",children:jsxRuntimeExports.jsx(Heading3,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:"  ",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleBulletList().run(),isActive:at.isActive("bulletList"),title:" ",shortcut:SHORTCUTS.bulletList,children:jsxRuntimeExports.jsx(List,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleOrderedList().run(),isActive:at.isActive("orderedList"),title:" ",shortcut:SHORTCUTS.orderedList,children:jsxRuntimeExports.jsx(ListOrdered,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().toggleBlockquote().run(),isActive:at.isActive("blockquote"),title:"",shortcut:SHORTCUTS.blockquote,children:jsxRuntimeExports.jsx(Quote,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().setHorizontalRule().run(),title:"",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:"",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().setTextAlign("left").run(),isActive:at.isActive({textAlign:"left"}),title:" ",children:jsxRuntimeExports.jsx(AlignLeft,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().setTextAlign("center").run(),isActive:at.isActive({textAlign:"center"}),title:" ",children:jsxRuntimeExports.jsx(AlignCenter,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().setTextAlign("right").run(),isActive:at.isActive({textAlign:"right"}),title:" ",children:jsxRuntimeExports.jsx(AlignRight,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().setTextAlign("justify").run(),isActive:at.isActive({textAlign:"justify"}),title:" ",children:jsxRuntimeExports.jsx(AlignJustify,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:"",children:[jsxRuntimeExports.jsxs("div",{className:"relative color-picker-dropdown",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>$(j==="text"?null:"text"),isActive:j==="text",title:" ",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Palette,{className:"w-4 h-4"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-3 h-3 ml-0.5"})]})}),j==="text"&&jsxRuntimeExports.jsxs("div",{className:"absolute top-full left-0 mt-1 p-2 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-[160px]",children:[jsxRuntimeExports.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:" "}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-5 gap-1",children:TEXT_COLORS.map(pt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{at.chain().focus().setColor(pt.color).run(),$(null)},className:"w-6 h-6 rounded border border-gray-200 hover:scale-110 transition-transform",style:{backgroundColor:pt.color},title:pt.name},pt.color))})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative color-picker-dropdown",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>$(j==="highlight"?null:"highlight"),isActive:j==="highlight"||at.isActive("highlight"),title:" ",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Highlighter,{className:"w-4 h-4"}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-3 h-3 ml-0.5"})]})}),j==="highlight"&&jsxRuntimeExports.jsxs("div",{className:"absolute top-full left-0 mt-1 p-2 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-[160px]",children:[jsxRuntimeExports.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"  "}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-1",children:HIGHLIGHT_COLORS.map(pt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{pt.color?at.chain().focus().toggleHighlight({color:pt.color}).run():at.chain().focus().unsetHighlight().run(),$(null)},className:`w-6 h-6 rounded border transition-transform hover:scale-110 ${pt.color?"border-gray-200":"border-gray-300 flex items-center justify-center"}`,style:{backgroundColor:pt.color||"#fff"},title:pt.name,children:!pt.color&&jsxRuntimeExports.jsx(X,{className:"w-3 h-3 text-gray-400"})},pt.color||"none"))})]})]})]}),jsxRuntimeExports.jsx(mt,{}),at.isActive("image")&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(gt,{label:" ",children:IMAGE_SIZE_PRESETS.map(pt=>jsxRuntimeExports.jsx(bt,{onClick:()=>xt(pt.value),title:`${pt.label} `,children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:pt.label})},pt.value))}),jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:" ",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>Ct("baseline"),isActive:at.getAttributes("image").align==="baseline",title:" ",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:""})}),jsxRuntimeExports.jsx(bt,{onClick:()=>Ct("middle"),isActive:at.getAttributes("image").align==="middle",title:" ",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:""})}),jsxRuntimeExports.jsx(bt,{onClick:()=>Ct("top"),isActive:at.getAttributes("image").align==="top",title:" ",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:""})}),jsxRuntimeExports.jsx(bt,{onClick:()=>Ct("bottom"),isActive:at.getAttributes("image").align==="bottom",title:" ",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:""})})]}),jsxRuntimeExports.jsx(mt,{})]}),jsxRuntimeExports.jsxs(gt,{label:"",children:[jsxRuntimeExports.jsx(bt,{onClick:yt,isActive:at.isActive("link"),title:" ",children:jsxRuntimeExports.jsx(Link$1,{className:"w-4 h-4"})}),at.isActive("link")&&jsxRuntimeExports.jsx(bt,{onClick:Tt,title:" ",children:jsxRuntimeExports.jsx(Unlink,{className:"w-4 h-4 text-red-500"})}),jsxRuntimeExports.jsx(bt,{onClick:dt,title:" ",children:jsxRuntimeExports.jsx(Image$1,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),title:" ",children:jsxRuntimeExports.jsx(Table$1,{className:"w-4 h-4"})})]}),at.isActive("table")&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(mt,{}),jsxRuntimeExports.jsxs(gt,{label:" ",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().addColumnAfter().run(),title:" ",children:jsxRuntimeExports.jsx(Columns,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().addRowAfter().run(),title:" ",children:jsxRuntimeExports.jsx(Rows,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().mergeCells().run(),title:" ",children:jsxRuntimeExports.jsx(Merge,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().splitCell().run(),title:" ",children:jsxRuntimeExports.jsx(Split,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().deleteColumn().run(),title:" ",children:jsxRuntimeExports.jsx(Columns,{className:"w-4 h-4 text-red-500"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().deleteRow().run(),title:" ",children:jsxRuntimeExports.jsx(Rows,{className:"w-4 h-4 text-red-500"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().deleteTable().run(),title:" ",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 text-red-500"})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),jsxRuntimeExports.jsxs(gt,{label:" ",children:[jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().undo().run(),disabled:!at.can().undo(),title:" ",shortcut:SHORTCUTS.undo,children:jsxRuntimeExports.jsx(Undo,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(bt,{onClick:()=>at.chain().focus().redo().run(),disabled:!at.can().redo(),title:" ",shortcut:SHORTCUTS.redo,children:jsxRuntimeExports.jsx(Redo,{className:"w-4 h-4"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative max-h-[60vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[_&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-primary-50/80 z-10 pointer-events-none",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2 text-primary-600",children:[jsxRuntimeExports.jsx(Image$1,{className:"w-8 h-8"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"  "})]})}),jsxRuntimeExports.jsx(EditorContent,{editor:at,className:"passage-content focus:outline-none [&_.ProseMirror]:min-h-[280px] [&_.ProseMirror]:outline-none"})]}),a&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:" "}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>c(!1),className:"p-1 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-5 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:" "}),jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:pt=>b(pt.target.value),placeholder:" ",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"URL"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:"url",value:d,onChange:pt=>h(pt.target.value),placeholder:"https://example.com",className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors",onKeyDown:pt=>{pt.key==="Enter"&&(pt.preventDefault(),Et())},autoFocus:!0}),jsxRuntimeExports.jsx(ExternalLink,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-2 px-5 py-4 bg-gray-50 border-t border-gray-200",children:[(at==null?void 0:at.isActive("link"))&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Tt,className:"px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:" "}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:""}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Et,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-lg transition-colors flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),""]})]})]})}),et&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:" "}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{nt(!1),it("")},className:"p-1 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"p-5 space-y-4",children:[!o&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:" URL"}),jsxRuntimeExports.jsx("input",{type:"url",value:rt,onChange:pt=>it(pt.target.value),placeholder:"https://example.com/image.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors",autoFocus:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:IMAGE_SIZE_PRESETS.map(pt=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>lt(pt.value),className:`
                        flex-1 px-3 py-2 text-sm font-medium rounded-lg border transition-all
                        ${st===pt.value?"bg-primary-100 border-primary-500 text-primary-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}
                      `,children:pt.label},pt.value))}),jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:st,onChange:pt=>lt(pt.target.value),placeholder:": 300px, 50%, auto",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"(300px)  (50%)  "})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct("baseline"),className:`
                      px-3 py-2 rounded-lg border transition-all text-center
                      ${ot==="baseline"?"bg-primary-100 border-primary-500 text-primary-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}
                    `,children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:""})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct("middle"),className:`
                      px-3 py-2 rounded-lg border transition-all text-center
                      ${ot==="middle"?"bg-primary-100 border-primary-500 text-primary-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}
                    `,children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:""})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct("top"),className:`
                      px-3 py-2 rounded-lg border transition-all text-center
                      ${ot==="top"?"bg-primary-100 border-primary-500 text-primary-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}
                    `,children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:""})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct("bottom"),className:`
                      px-3 py-2 rounded-lg border transition-all text-center
                      ${ot==="bottom"?"bg-primary-100 border-primary-500 text-primary-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}
                    `,children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:""})})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-end gap-2 px-5 py-4 bg-gray-50 border-t border-gray-200",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{nt(!1),it("")},className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:""}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:ft,disabled:!rt,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors flex items-center gap-1.5",children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),""]})]})]})})]})},toggleComment=s=>{let{state:e}=s,o=e.doc.lineAt(e.selection.main.from),a=getConfig(s.state,o.from);return a.line?toggleLineComment(s):a.block?toggleBlockCommentByLine(s):!1};function command(s,e){return({state:o,dispatch:a})=>{if(o.readOnly)return!1;let c=s(e,o);return c?(a(o.update(c)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((s,e)=>changeBlockComment(s,e,selectedLineRanges(e)),0);function getConfig(s,e){let o=s.languageDataAt("commentTokens",e,1);return o.length?o[0]:{}}const SearchMargin=50;function findBlockComment(s,{open:e,close:o},a,c){let d=s.sliceDoc(a-SearchMargin,a),h=s.sliceDoc(c,c+SearchMargin),g=/\s*$/.exec(d)[0].length,b=/^\s*/.exec(h)[0].length,j=d.length-g;if(d.slice(j-e.length,j)==e&&h.slice(b,b+o.length)==o)return{open:{pos:a-g,margin:g&&1},close:{pos:c+b,margin:b&&1}};let $,_;c-a<=2*SearchMargin?$=_=s.sliceDoc(a,c):($=s.sliceDoc(a,a+SearchMargin),_=s.sliceDoc(c-SearchMargin,c));let _e=/^\s*/.exec($)[0].length,et=/\s*$/.exec(_)[0].length,nt=_.length-et-o.length;return $.slice(_e,_e+e.length)==e&&_.slice(nt,nt+o.length)==o?{open:{pos:a+_e+e.length,margin:/\s/.test($.charAt(_e+e.length))?1:0},close:{pos:c-et-o.length,margin:/\s/.test(_.charAt(nt-1))?1:0}}:null}function selectedLineRanges(s){let e=[];for(let o of s.selection.ranges){let a=s.doc.lineAt(o.from),c=o.to<=a.to?a:s.doc.lineAt(o.to);c.from>a.from&&c.from==o.to&&(c=o.to==a.to+1?a:s.doc.lineAt(o.to-1));let d=e.length-1;d>=0&&e[d].to>a.from?e[d].to=c.to:e.push({from:a.from+/^\s*/.exec(a.text)[0].length,to:c.to})}return e}function changeBlockComment(s,e,o=e.selection.ranges){let a=o.map(d=>getConfig(e,d.from).block);if(!a.every(d=>d))return null;let c=o.map((d,h)=>findBlockComment(e,a[h],d.from,d.to));if(s!=2&&!c.every(d=>d))return{changes:e.changes(o.map((d,h)=>c[h]?[]:[{from:d.from,insert:a[h].open+" "},{from:d.to,insert:" "+a[h].close}]))};if(s!=1&&c.some(d=>d)){let d=[];for(let h=0,g;h<c.length;h++)if(g=c[h]){let b=a[h],{open:j,close:$}=g;d.push({from:j.pos-b.open.length,to:j.pos+j.margin},{from:$.pos-$.margin,to:$.pos+b.close.length})}return{changes:d}}return null}function changeLineComment(s,e,o=e.selection.ranges){let a=[],c=-1;for(let{from:d,to:h}of o){let g=a.length,b=1e9,j=getConfig(e,d).line;if(j){for(let $=d;$<=h;){let _=e.doc.lineAt($);if(_.from>c&&(d==h||h>_.from)){c=_.from;let _e=/^\s*/.exec(_.text)[0].length,et=_e==_.length,nt=_.text.slice(_e,_e+j.length)==j?_e:-1;_e<_.text.length&&_e<b&&(b=_e),a.push({line:_,comment:nt,token:j,indent:_e,empty:et,single:!1})}$=_.to+1}if(b<1e9)for(let $=g;$<a.length;$++)a[$].indent<a[$].line.text.length&&(a[$].indent=b);a.length==g+1&&(a[g].single=!0)}}if(s!=2&&a.some(d=>d.comment<0&&(!d.empty||d.single))){let d=[];for(let{line:g,token:b,indent:j,empty:$,single:_}of a)(_||!$)&&d.push({from:g.from+j,insert:b+" "});let h=e.changes(d);return{changes:h,selection:e.selection.map(h,1)}}else if(s!=1&&a.some(d=>d.comment>=0)){let d=[];for(let{line:h,comment:g,token:b}of a)if(g>=0){let j=h.from+g,$=j+b.length;h.text[$-h.from]==" "&&$++,d.push({from:j,to:$})}return{changes:d}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(s){return combineConfig(s,{minDepth:100,newGroupDelay:500,joinToEvent:(e,o)=>o},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,o)=>(a,c)=>e(a,c)||o(a,c)})}}),historyField_=StateField.define({create(){return HistoryState.empty},update(s,e){let o=e.state.facet(historyConfig),a=e.annotation(fromHistory);if(a){let b=HistEvent.fromTransaction(e,a.selection),j=a.side,$=j==0?s.undone:s.done;return b?$=updateBranch($,$.length,o.minDepth,b):$=addSelection($,e.startState.selection),new HistoryState(j==0?a.rest:$,j==0?$:a.rest)}let c=e.annotation(isolateHistory);if((c=="full"||c=="before")&&(s=s.isolate()),e.annotation(Transaction.addToHistory)===!1)return e.changes.empty?s:s.addMapping(e.changes.desc);let d=HistEvent.fromTransaction(e),h=e.annotation(Transaction.time),g=e.annotation(Transaction.userEvent);return d?s=s.addChanges(d,h,g,o,e):e.selection&&(s=s.addSelection(e.startState.selection,h,g,o.newGroupDelay)),(c=="full"||c=="after")&&(s=s.isolate()),s},toJSON(s){return{done:s.done.map(e=>e.toJSON()),undone:s.undone.map(e=>e.toJSON())}},fromJSON(s){return new HistoryState(s.done.map(HistEvent.fromJSON),s.undone.map(HistEvent.fromJSON))}});function history(s={}){return[historyField_,historyConfig.of(s),EditorView.domEventHandlers({beforeinput(e,o){let a=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;return a?(e.preventDefault(),a(o)):!1}})]}function cmd(s,e){return function({state:o,dispatch:a}){if(!e&&o.readOnly)return!1;let c=o.field(historyField_,!1);if(!c)return!1;let d=c.pop(s,o,e);return d?(a(d),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,o,a,c,d){this.changes=e,this.effects=o,this.mapped=a,this.startSelection=c,this.selectionsAfter=d}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,o,a;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(o=this.mapped)===null||o===void 0?void 0:o.toJSON(),startSelection:(a=this.startSelection)===null||a===void 0?void 0:a.toJSON(),selectionsAfter:this.selectionsAfter.map(c=>c.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,o){let a=none$1;for(let c of e.startState.facet(invertedEffects)){let d=c(e);d.length&&(a=a.concat(d))}return!a.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),a,void 0,o||e.startState.selection,none$1)}static selection(e){return new HistEvent(void 0,none$1,void 0,void 0,e)}}function updateBranch(s,e,o,a){let c=e+1>o+20?e-o-1:0,d=s.slice(c,e);return d.push(a),d}function isAdjacent(s,e){let o=[],a=!1;return s.iterChangedRanges((c,d)=>o.push(c,d)),e.iterChangedRanges((c,d,h,g)=>{for(let b=0;b<o.length;){let j=o[b++],$=o[b++];g>=j&&h<=$&&(a=!0)}}),a}function eqSelectionShape(s,e){return s.ranges.length==e.ranges.length&&s.ranges.filter((o,a)=>o.empty!=e.ranges[a].empty).length===0}function conc(s,e){return s.length?e.length?s.concat(e):s:e}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(s,e){if(s.length){let o=s[s.length-1],a=o.selectionsAfter.slice(Math.max(0,o.selectionsAfter.length-MaxSelectionsPerEvent));return a.length&&a[a.length-1].eq(e)?s:(a.push(e),updateBranch(s,s.length-1,1e9,o.setSelAfter(a)))}else return[HistEvent.selection([e])]}function popSelection(s){let e=s[s.length-1],o=s.slice();return o[s.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),o}function addMappingToBranch(s,e){if(!s.length)return s;let o=s.length,a=none$1;for(;o;){let c=mapEvent(s[o-1],e,a);if(c.changes&&!c.changes.empty||c.effects.length){let d=s.slice(0,o);return d[o-1]=c,d}else e=c.mapped,o--,a=c.selectionsAfter}return a.length?[HistEvent.selection(a)]:none$1}function mapEvent(s,e,o){let a=conc(s.selectionsAfter.length?s.selectionsAfter.map(g=>g.map(e)):none$1,o);if(!s.changes)return HistEvent.selection(a);let c=s.changes.map(e),d=e.mapDesc(s.changes,!0),h=s.mapped?s.mapped.composeDesc(d):d;return new HistEvent(c,StateEffect.mapEffects(s.effects,e),h,s.startSelection.map(d),a)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,o,a=0,c=void 0){this.done=e,this.undone=o,this.prevTime=a,this.prevUserEvent=c}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,o,a,c,d){let h=this.done,g=h[h.length-1];return g&&g.changes&&!g.changes.empty&&e.changes&&(!a||joinableUserEvent.test(a))&&(!g.selectionsAfter.length&&o-this.prevTime<c.newGroupDelay&&c.joinToEvent(d,isAdjacent(g.changes,e.changes))||a=="input.type.compose")?h=updateBranch(h,h.length-1,c.minDepth,new HistEvent(e.changes.compose(g.changes),conc(StateEffect.mapEffects(e.effects,g.changes),g.effects),g.mapped,g.startSelection,none$1)):h=updateBranch(h,h.length,c.minDepth,e),new HistoryState(h,none$1,o,a)}addSelection(e,o,a,c){let d=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return d.length>0&&o-this.prevTime<c&&a==this.prevUserEvent&&a&&/^select($|\.)/.test(a)&&eqSelectionShape(d[d.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,o,a)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,o,a){let c=e==0?this.done:this.undone;if(c.length==0)return null;let d=c[c.length-1],h=d.selectionsAfter[0]||o.selection;if(a&&d.selectionsAfter.length)return o.update({selection:d.selectionsAfter[d.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(c),selection:h}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(d.changes){let g=c.length==1?none$1:c.slice(0,c.length-1);return d.mapped&&(g=addMappingToBranch(g,d.mapped)),o.update({changes:d.changes,selection:d.startSelection,effects:d.effects,annotations:fromHistory.of({side:e,rest:g,selection:h}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(s,e){return EditorSelection.create(s.ranges.map(e),s.mainIndex)}function setSel(s,e){return s.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:s,dispatch:e},o){let a=updateSel(s.selection,o);return a.eq(s.selection,!0)?!1:(e(setSel(s,a)),!0)}function rangeEnd(s,e){return EditorSelection.cursor(e?s.to:s.from)}function cursorByChar(s,e){return moveSel(s,o=>o.empty?s.moveByChar(o,e):rangeEnd(o,e))}function ltrAtCursor(s){return s.textDirectionAt(s.state.selection.main.head)==Direction.LTR}const cursorCharLeft=s=>cursorByChar(s,!ltrAtCursor(s)),cursorCharRight=s=>cursorByChar(s,ltrAtCursor(s));function cursorByGroup(s,e){return moveSel(s,o=>o.empty?s.moveByGroup(o,e):rangeEnd(o,e))}const cursorGroupLeft=s=>cursorByGroup(s,!ltrAtCursor(s)),cursorGroupRight=s=>cursorByGroup(s,ltrAtCursor(s));function interestingNode(s,e,o){if(e.type.prop(o))return!0;let a=e.to-e.from;return a&&(a>2||/[^\s,.;:]/.test(s.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(s,e,o){let a=syntaxTree(s).resolveInner(e.head),c=o?NodeProp.closedBy:NodeProp.openedBy;for(let b=e.head;;){let j=o?a.childAfter(b):a.childBefore(b);if(!j)break;interestingNode(s,j,c)?a=j:b=o?j.to:j.from}let d=a.type.prop(c),h,g;return d&&(h=o?matchBrackets(s,a.from,1):matchBrackets(s,a.to,-1))&&h.matched?g=o?h.end.to:h.end.from:g=o?a.to:a.from,EditorSelection.cursor(g,o?-1:1)}const cursorSyntaxLeft=s=>moveSel(s,e=>moveBySyntax(s.state,e,!ltrAtCursor(s))),cursorSyntaxRight=s=>moveSel(s,e=>moveBySyntax(s.state,e,ltrAtCursor(s)));function cursorByLine(s,e){return moveSel(s,o=>{if(!o.empty)return rangeEnd(o,e);let a=s.moveVertically(o,e);return a.head!=o.head?a:s.moveToLineBoundary(o,e)})}const cursorLineUp=s=>cursorByLine(s,!1),cursorLineDown=s=>cursorByLine(s,!0);function pageInfo(s){let e=s.scrollDOM.clientHeight<s.scrollDOM.scrollHeight-2,o=0,a=0,c;if(e){for(let d of s.state.facet(EditorView.scrollMargins)){let h=d(s);h!=null&&h.top&&(o=Math.max(h==null?void 0:h.top,o)),h!=null&&h.bottom&&(a=Math.max(h==null?void 0:h.bottom,a))}c=s.scrollDOM.clientHeight-o-a}else c=(s.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:o,marginBottom:a,selfScroll:e,height:Math.max(s.defaultLineHeight,c-5)}}function cursorByPage(s,e){let o=pageInfo(s),{state:a}=s,c=updateSel(a.selection,h=>h.empty?s.moveVertically(h,e,o.height):rangeEnd(h,e));if(c.eq(a.selection))return!1;let d;if(o.selfScroll){let h=s.coordsAtPos(a.selection.main.head),g=s.scrollDOM.getBoundingClientRect(),b=g.top+o.marginTop,j=g.bottom-o.marginBottom;h&&h.top>b&&h.bottom<j&&(d=EditorView.scrollIntoView(c.main.head,{y:"start",yMargin:h.top-b}))}return s.dispatch(setSel(a,c),{effects:d}),!0}const cursorPageUp=s=>cursorByPage(s,!1),cursorPageDown=s=>cursorByPage(s,!0);function moveByLineBoundary(s,e,o){let a=s.lineBlockAt(e.head),c=s.moveToLineBoundary(e,o);if(c.head==e.head&&c.head!=(o?a.to:a.from)&&(c=s.moveToLineBoundary(e,o,!1)),!o&&c.head==a.from&&a.length){let d=/^\s*/.exec(s.state.sliceDoc(a.from,Math.min(a.from+100,a.to)))[0].length;d&&e.head!=a.from+d&&(c=EditorSelection.cursor(a.from+d))}return c}const cursorLineBoundaryForward=s=>moveSel(s,e=>moveByLineBoundary(s,e,!0)),cursorLineBoundaryBackward=s=>moveSel(s,e=>moveByLineBoundary(s,e,!1)),cursorLineBoundaryLeft=s=>moveSel(s,e=>moveByLineBoundary(s,e,!ltrAtCursor(s))),cursorLineBoundaryRight=s=>moveSel(s,e=>moveByLineBoundary(s,e,ltrAtCursor(s))),cursorLineStart=s=>moveSel(s,e=>EditorSelection.cursor(s.lineBlockAt(e.head).from,1)),cursorLineEnd=s=>moveSel(s,e=>EditorSelection.cursor(s.lineBlockAt(e.head).to,-1));function toMatchingBracket(s,e,o){let a=!1,c=updateSel(s.selection,d=>{let h=matchBrackets(s,d.head,-1)||matchBrackets(s,d.head,1)||d.head>0&&matchBrackets(s,d.head-1,1)||d.head<s.doc.length&&matchBrackets(s,d.head+1,-1);if(!h||!h.end)return d;a=!0;let g=h.start.from==d.head?h.end.to:h.end.from;return EditorSelection.cursor(g)});return a?(e(setSel(s,c)),!0):!1}const cursorMatchingBracket=({state:s,dispatch:e})=>toMatchingBracket(s,e);function extendSel(s,e){let o=updateSel(s.state.selection,a=>{let c=e(a);return EditorSelection.range(a.anchor,c.head,c.goalColumn,c.bidiLevel||void 0)});return o.eq(s.state.selection)?!1:(s.dispatch(setSel(s.state,o)),!0)}function selectByChar(s,e){return extendSel(s,o=>s.moveByChar(o,e))}const selectCharLeft=s=>selectByChar(s,!ltrAtCursor(s)),selectCharRight=s=>selectByChar(s,ltrAtCursor(s));function selectByGroup(s,e){return extendSel(s,o=>s.moveByGroup(o,e))}const selectGroupLeft=s=>selectByGroup(s,!ltrAtCursor(s)),selectGroupRight=s=>selectByGroup(s,ltrAtCursor(s)),selectSyntaxLeft=s=>extendSel(s,e=>moveBySyntax(s.state,e,!ltrAtCursor(s))),selectSyntaxRight=s=>extendSel(s,e=>moveBySyntax(s.state,e,ltrAtCursor(s)));function selectByLine(s,e){return extendSel(s,o=>s.moveVertically(o,e))}const selectLineUp=s=>selectByLine(s,!1),selectLineDown=s=>selectByLine(s,!0);function selectByPage(s,e){return extendSel(s,o=>s.moveVertically(o,e,pageInfo(s).height))}const selectPageUp=s=>selectByPage(s,!1),selectPageDown=s=>selectByPage(s,!0),selectLineBoundaryForward=s=>extendSel(s,e=>moveByLineBoundary(s,e,!0)),selectLineBoundaryBackward=s=>extendSel(s,e=>moveByLineBoundary(s,e,!1)),selectLineBoundaryLeft=s=>extendSel(s,e=>moveByLineBoundary(s,e,!ltrAtCursor(s))),selectLineBoundaryRight=s=>extendSel(s,e=>moveByLineBoundary(s,e,ltrAtCursor(s))),selectLineStart=s=>extendSel(s,e=>EditorSelection.cursor(s.lineBlockAt(e.head).from)),selectLineEnd=s=>extendSel(s,e=>EditorSelection.cursor(s.lineBlockAt(e.head).to)),cursorDocStart=({state:s,dispatch:e})=>(e(setSel(s,{anchor:0})),!0),cursorDocEnd=({state:s,dispatch:e})=>(e(setSel(s,{anchor:s.doc.length})),!0),selectDocStart=({state:s,dispatch:e})=>(e(setSel(s,{anchor:s.selection.main.anchor,head:0})),!0),selectDocEnd=({state:s,dispatch:e})=>(e(setSel(s,{anchor:s.selection.main.anchor,head:s.doc.length})),!0),selectAll=({state:s,dispatch:e})=>(e(s.update({selection:{anchor:0,head:s.doc.length},userEvent:"select"})),!0),selectLine=({state:s,dispatch:e})=>{let o=selectedLineBlocks(s).map(({from:a,to:c})=>EditorSelection.range(a,Math.min(c+1,s.doc.length)));return e(s.update({selection:EditorSelection.create(o),userEvent:"select"})),!0},selectParentSyntax=({state:s,dispatch:e})=>{let o=updateSel(s.selection,a=>{let c=syntaxTree(s),d=c.resolveStack(a.from,1);if(a.empty){let h=c.resolveStack(a.from,-1);h.node.from>=d.node.from&&h.node.to<=d.node.to&&(d=h)}for(let h=d;h;h=h.next){let{node:g}=h;if((g.from<a.from&&g.to>=a.to||g.to>a.to&&g.from<=a.from)&&h.next)return EditorSelection.range(g.to,g.from)}return a});return o.eq(s.selection)?!1:(e(setSel(s,o)),!0)};function addCursorVertically(s,e){let{state:o}=s,a=o.selection,c=o.selection.ranges.slice();for(let d of o.selection.ranges){let h=o.doc.lineAt(d.head);if(e?h.to<s.state.doc.length:h.from>0)for(let g=d;;){let b=s.moveVertically(g,e);if(b.head<h.from||b.head>h.to){c.some(j=>j.head==b.head)||c.push(b);break}else{if(b.head==g.head)break;g=b}}}return c.length==a.ranges.length?!1:(s.dispatch(setSel(o,EditorSelection.create(c,c.length-1))),!0)}const addCursorAbove=s=>addCursorVertically(s,!1),addCursorBelow=s=>addCursorVertically(s,!0),simplifySelection=({state:s,dispatch:e})=>{let o=s.selection,a=null;return o.ranges.length>1?a=EditorSelection.create([o.main]):o.main.empty||(a=EditorSelection.create([EditorSelection.cursor(o.main.head)])),a?(e(setSel(s,a)),!0):!1};function deleteBy(s,e){if(s.state.readOnly)return!1;let o="delete.selection",{state:a}=s,c=a.changeByRange(d=>{let{from:h,to:g}=d;if(h==g){let b=e(d);b<h?(o="delete.backward",b=skipAtomic(s,b,!1)):b>h&&(o="delete.forward",b=skipAtomic(s,b,!0)),h=Math.min(h,b),g=Math.max(g,b)}else h=skipAtomic(s,h,!1),g=skipAtomic(s,g,!0);return h==g?{range:d}:{changes:{from:h,to:g},range:EditorSelection.cursor(h,h<d.head?-1:1)}});return c.changes.empty?!1:(s.dispatch(a.update(c,{scrollIntoView:!0,userEvent:o,effects:o=="delete.selection"?EditorView.announce.of(a.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(s,e,o){if(s instanceof EditorView)for(let a of s.state.facet(EditorView.atomicRanges).map(c=>c(s)))a.between(e,e,(c,d)=>{c<e&&d>e&&(e=o?d:c)});return e}const deleteByChar=(s,e,o)=>deleteBy(s,a=>{let c=a.from,{state:d}=s,h=d.doc.lineAt(c),g,b;if(o&&!e&&c>h.from&&c<h.from+200&&!/[^ \t]/.test(g=h.text.slice(0,c-h.from))){if(g[g.length-1]=="	")return c-1;let j=countColumn(g,d.tabSize),$=j%getIndentUnit(d)||getIndentUnit(d);for(let _=0;_<$&&g[g.length-1-_]==" ";_++)c--;b=c}else b=findClusterBreak(h.text,c-h.from,e,e)+h.from,b==c&&h.number!=(e?d.doc.lines:1)?b+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(h.text.slice(b-h.from,c-h.from))&&(b=findClusterBreak(h.text,b-h.from,!1,!1)+h.from);return b}),deleteCharBackward=s=>deleteByChar(s,!1,!0),deleteCharForward=s=>deleteByChar(s,!0,!1),deleteByGroup=(s,e)=>deleteBy(s,o=>{let a=o.head,{state:c}=s,d=c.doc.lineAt(a),h=c.charCategorizer(a);for(let g=null;;){if(a==(e?d.to:d.from)){a==o.head&&d.number!=(e?c.doc.lines:1)&&(a+=e?1:-1);break}let b=findClusterBreak(d.text,a-d.from,e)+d.from,j=d.text.slice(Math.min(a,b)-d.from,Math.max(a,b)-d.from),$=h(j);if(g!=null&&$!=g)break;(j!=" "||a!=o.head)&&(g=$),a=b}return a}),deleteGroupBackward=s=>deleteByGroup(s,!1),deleteGroupForward=s=>deleteByGroup(s,!0),deleteToLineEnd=s=>deleteBy(s,e=>{let o=s.lineBlockAt(e.head).to;return e.head<o?o:Math.min(s.state.doc.length,e.head+1)}),deleteLineBoundaryBackward=s=>deleteBy(s,e=>{let o=s.moveToLineBoundary(e,!1).head;return e.head>o?o:Math.max(0,e.head-1)}),deleteLineBoundaryForward=s=>deleteBy(s,e=>{let o=s.moveToLineBoundary(e,!0).head;return e.head<o?o:Math.min(s.state.doc.length,e.head+1)}),splitLine=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let o=s.changeByRange(a=>({changes:{from:a.from,to:a.to,insert:Text.of(["",""])},range:EditorSelection.cursor(a.from)}));return e(s.update(o,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let o=s.changeByRange(a=>{if(!a.empty||a.from==0||a.from==s.doc.length)return{range:a};let c=a.from,d=s.doc.lineAt(c),h=c==d.from?c-1:findClusterBreak(d.text,c-d.from,!1)+d.from,g=c==d.to?c+1:findClusterBreak(d.text,c-d.from,!0)+d.from;return{changes:{from:h,to:g,insert:s.doc.slice(c,g).append(s.doc.slice(h,c))},range:EditorSelection.cursor(g)}});return o.changes.empty?!1:(e(s.update(o,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(s){let e=[],o=-1;for(let a of s.selection.ranges){let c=s.doc.lineAt(a.from),d=s.doc.lineAt(a.to);if(!a.empty&&a.to==d.from&&(d=s.doc.lineAt(a.to-1)),o>=c.number){let h=e[e.length-1];h.to=d.to,h.ranges.push(a)}else e.push({from:c.from,to:d.to,ranges:[a]});o=d.number+1}return e}function moveLine(s,e,o){if(s.readOnly)return!1;let a=[],c=[];for(let d of selectedLineBlocks(s)){if(o?d.to==s.doc.length:d.from==0)continue;let h=s.doc.lineAt(o?d.to+1:d.from-1),g=h.length+1;if(o){a.push({from:d.to,to:h.to},{from:d.from,insert:h.text+s.lineBreak});for(let b of d.ranges)c.push(EditorSelection.range(Math.min(s.doc.length,b.anchor+g),Math.min(s.doc.length,b.head+g)))}else{a.push({from:h.from,to:d.from},{from:d.to,insert:s.lineBreak+h.text});for(let b of d.ranges)c.push(EditorSelection.range(b.anchor-g,b.head-g))}}return a.length?(e(s.update({changes:a,scrollIntoView:!0,selection:EditorSelection.create(c,s.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:s,dispatch:e})=>moveLine(s,e,!1),moveLineDown=({state:s,dispatch:e})=>moveLine(s,e,!0);function copyLine(s,e,o){if(s.readOnly)return!1;let a=[];for(let d of selectedLineBlocks(s))o?a.push({from:d.from,insert:s.doc.slice(d.from,d.to)+s.lineBreak}):a.push({from:d.to,insert:s.lineBreak+s.doc.slice(d.from,d.to)});let c=s.changes(a);return e(s.update({changes:c,selection:s.selection.map(c,o?1:-1),scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:s,dispatch:e})=>copyLine(s,e,!1),copyLineDown=({state:s,dispatch:e})=>copyLine(s,e,!0),deleteLine=s=>{if(s.state.readOnly)return!1;let{state:e}=s,o=e.changes(selectedLineBlocks(e).map(({from:c,to:d})=>(c>0?c--:d<e.doc.length&&d++,{from:c,to:d}))),a=updateSel(e.selection,c=>{let d;if(s.lineWrapping){let h=s.lineBlockAt(c.head),g=s.coordsAtPos(c.head,c.assoc||1);g&&(d=h.bottom+s.documentTop-g.bottom+s.defaultLineHeight/2)}return s.moveVertically(c,!0,d)}).map(o);return s.dispatch({changes:o,selection:a,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(s,e){if(/\(\)|\[\]|\{\}/.test(s.sliceDoc(e-1,e+1)))return{from:e,to:e};let o=syntaxTree(s).resolveInner(e),a=o.childBefore(e),c=o.childAfter(e),d;return a&&c&&a.to<=e&&c.from>=e&&(d=a.type.prop(NodeProp.closedBy))&&d.indexOf(c.name)>-1&&s.doc.lineAt(a.to).from==s.doc.lineAt(c.from).from&&!/\S/.test(s.sliceDoc(a.to,c.from))?{from:a.to,to:c.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(s){return({state:e,dispatch:o})=>{if(e.readOnly)return!1;let a=e.changeByRange(c=>{let{from:d,to:h}=c,g=e.doc.lineAt(d),b=!s&&d==h&&isBetweenBrackets(e,d);s&&(d=h=(h<=g.to?g:e.doc.lineAt(h)).to);let j=new IndentContext(e,{simulateBreak:d,simulateDoubleBreak:!!b}),$=getIndentation(j,d);for($==null&&($=countColumn(/^\s*/.exec(e.doc.lineAt(d).text)[0],e.tabSize));h<g.to&&/\s/.test(g.text[h-g.from]);)h++;b?{from:d,to:h}=b:d>g.from&&d<g.from+100&&!/\S/.test(g.text.slice(0,d))&&(d=g.from);let _=["",indentString(e,$)];return b&&_.push(indentString(e,j.lineIndent(g.from,-1))),{changes:{from:d,to:h,insert:Text.of(_)},range:EditorSelection.cursor(d+1+_[1].length)}});return o(e.update(a,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(s,e){let o=-1;return s.changeByRange(a=>{let c=[];for(let h=a.from;h<=a.to;){let g=s.doc.lineAt(h);g.number>o&&(a.empty||a.to>g.from)&&(e(g,c,a),o=g.number),h=g.to+1}let d=s.changes(c);return{changes:c,range:EditorSelection.range(d.mapPos(a.anchor,1),d.mapPos(a.head,1))}})}const indentSelection=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let o=Object.create(null),a=new IndentContext(s,{overrideIndentation:d=>{let h=o[d];return h??-1}}),c=changeBySelectedLine(s,(d,h,g)=>{let b=getIndentation(a,d.from);if(b==null)return;/\S/.test(d.text)||(b=0);let j=/^\s*/.exec(d.text)[0],$=indentString(s,b);(j!=$||g.from<d.from+j.length)&&(o[d.from]=b,h.push({from:d.from,to:d.from+j.length,insert:$}))});return c.changes.empty||e(s.update(c,{userEvent:"indent"})),!0},indentMore=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(changeBySelectedLine(s,(o,a)=>{a.push({from:o.from,insert:s.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(changeBySelectedLine(s,(o,a)=>{let c=/^\s*/.exec(o.text)[0];if(!c)return;let d=countColumn(c,s.tabSize),h=0,g=indentString(s,Math.max(0,d-getIndentUnit(s)));for(;h<c.length&&h<g.length&&c.charCodeAt(h)==g.charCodeAt(h);)h++;a.push({from:o.from+h,to:o.from+c.length,insert:g.slice(h)})}),{userEvent:"delete.dedent"})),!0),toggleTabFocusMode=s=>(s.setTabFocusMode(),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent,shift:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward,preventDefault:!0},{key:"Delete",run:deleteCharForward,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward,preventDefault:!0},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward,preventDefault:!0},{mac:"Mod-Delete",run:deleteLineBoundaryForward,preventDefault:!0}].concat(emacsStyleKeymap.map(s=>({mac:s.key,run:s.run,shift:s.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Mod-Alt-ArrowUp",run:addCursorAbove},{key:"Mod-Alt-ArrowDown",run:addCursorBelow},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment},{key:"Ctrl-m",mac:"Shift-Alt-m",run:toggleTabFocusMode}].concat(standardKeymap),indentWithTab={key:"Tab",run:indentMore,shift:indentLess},basicNormalize=typeof String.prototype.normalize=="function"?s=>s.normalize("NFKD"):s=>s;class SearchCursor{constructor(e,o,a=0,c=e.length,d,h){this.test=h,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(a,c),this.bufferStart=a,this.normalize=d?g=>d(basicNormalize(g)):basicNormalize,this.query=this.normalize(o)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let o=fromCodePoint(e),a=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);let c=this.normalize(o);if(c.length)for(let d=0,h=a;;d++){let g=c.charCodeAt(d),b=this.match(g,h,this.bufferPos+this.bufferStart);if(d==c.length-1){if(b)return this.value=b,this;break}h==a&&d<o.length&&o.charCodeAt(d)==g&&h++}}}match(e,o,a){let c=null;for(let d=0;d<this.matches.length;d+=2){let h=this.matches[d],g=!1;this.query.charCodeAt(h)==e&&(h==this.query.length-1?c={from:this.matches[d+1],to:a}:(this.matches[d]++,g=!0)),g||(this.matches.splice(d,2),d-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?c={from:o,to:a}:this.matches.push(1,o)),c&&this.test&&!this.test(c.from,c.to,this.buffer,this.bufferStart)&&(c=null),c}}typeof Symbol<"u"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(e,o,a,c=0,d=e.length){if(this.text=e,this.to=d,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(o))return new MultilineRegExpCursor(e,o,a,c,d);this.re=new RegExp(o,baseFlags+(a!=null&&a.ignoreCase?"i":"")),this.test=a==null?void 0:a.test,this.iter=e.iter();let h=e.lineAt(c);this.curLineStart=h.from,this.matchPos=toCharEnd(e,c),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let o=this.matchPos<=this.to&&this.re.exec(this.curLine);if(o){let a=this.curLineStart+o.index,c=a+o[0].length;if(this.matchPos=toCharEnd(this.text,c+(a==c?1:0)),a==this.curLineStart+this.curLine.length&&this.nextLine(),(a<c||a>this.value.to)&&(!this.test||this.test(a,c,o)))return this.value={from:a,to:c,match:o},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const flattened=new WeakMap;class FlattenedDoc{constructor(e,o){this.from=e,this.text=o}get to(){return this.from+this.text.length}static get(e,o,a){let c=flattened.get(e);if(!c||c.from>=a||c.to<=o){let g=new FlattenedDoc(o,e.sliceString(o,a));return flattened.set(e,g),g}if(c.from==o&&c.to==a)return c;let{text:d,from:h}=c;return h>o&&(d=e.sliceString(o,h)+d,h=o),c.to<a&&(d+=e.sliceString(c.to,a)),flattened.set(e,new FlattenedDoc(h,d)),new FlattenedDoc(o,d.slice(o-h,a-h))}}class MultilineRegExpCursor{constructor(e,o,a,c,d){this.text=e,this.to=d,this.done=!1,this.value=empty,this.matchPos=toCharEnd(e,c),this.re=new RegExp(o,baseFlags+(a!=null&&a.ignoreCase?"i":"")),this.test=a==null?void 0:a.test,this.flat=FlattenedDoc.get(e,c,this.chunkEnd(c+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,o=this.re.exec(this.flat.text);if(o&&!o[0]&&o.index==e&&(this.re.lastIndex=e+1,o=this.re.exec(this.flat.text)),o){let a=this.flat.from+o.index,c=a+o[0].length;if((this.flat.to>=this.to||o.index+o[0].length<=this.flat.text.length-10)&&(!this.test||this.test(a,c,o)))return this.value={from:a,to:c,match:o},this.matchPos=toCharEnd(this.text,c+(a==c?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function validRegExp(s){try{return new RegExp(s,baseFlags),!0}catch{return!1}}function toCharEnd(s,e){if(e>=s.length)return e;let o=s.lineAt(e),a;for(;e<o.to&&(a=o.text.charCodeAt(e-o.from))>=56320&&a<57344;)e++;return e}const gotoLine=s=>{let{state:e}=s,o=String(e.doc.lineAt(s.state.selection.main.head).number),{close:a,result:c}=showDialog(s,{label:e.phrase("Go to line"),input:{type:"text",name:"line",value:o},focus:!0,submitLabel:e.phrase("go")});return c.then(d=>{let h=d&&/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(d.elements.line.value);if(!h){s.dispatch({effects:a});return}let g=e.doc.lineAt(e.selection.main.head),[,b,j,$,_]=h,_e=$?+$.slice(1):0,et=j?+j:g.number;if(j&&_){let it=et/100;b&&(it=it*(b=="-"?-1:1)+g.number/e.doc.lines),et=Math.round(e.doc.lines*it)}else j&&b&&(et=et*(b=="-"?-1:1)+g.number);let nt=e.doc.line(Math.max(1,Math.min(e.doc.lines,et))),rt=EditorSelection.cursor(nt.from+Math.max(0,Math.min(_e,nt.length)));s.dispatch({effects:[a,EditorView.scrollIntoView(rt.from,{y:"center"})],selection:rt})}),!0},defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine(s){return combineConfig(s,defaultHighlightOptions,{highlightWordAroundCursor:(e,o)=>e||o,minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(s){return[defaultTheme,matchHighlighter]}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(s,e,o,a){return(o==0||s(e.sliceDoc(o-1,o))!=CharCategory.Word)&&(a==e.doc.length||s(e.sliceDoc(a,a+1))!=CharCategory.Word)}function insideWord(s,e,o,a){return s(e.sliceDoc(o,o+1))==CharCategory.Word&&s(e.sliceDoc(a-1,a))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.selectionSet||s.docChanged||s.viewportChanged)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=s.state.facet(highlightConfig),{state:o}=s,a=o.selection;if(a.ranges.length>1)return Decoration.none;let c=a.main,d,h=null;if(c.empty){if(!e.highlightWordAroundCursor)return Decoration.none;let b=o.wordAt(c.head);if(!b)return Decoration.none;h=o.charCategorizer(c.head),d=o.sliceDoc(b.from,b.to)}else{let b=c.to-c.from;if(b<e.minSelectionLength||b>200)return Decoration.none;if(e.wholeWords){if(d=o.sliceDoc(c.from,c.to),h=o.charCategorizer(c.head),!(insideWordBoundaries(h,o,c.from,c.to)&&insideWord(h,o,c.from,c.to)))return Decoration.none}else if(d=o.sliceDoc(c.from,c.to),!d)return Decoration.none}let g=[];for(let b of s.visibleRanges){let j=new SearchCursor(o.doc,d,b.from,b.to);for(;!j.next().done;){let{from:$,to:_}=j.value;if((!h||insideWordBoundaries(h,o,$,_))&&(c.empty&&$<=c.from&&_>=c.to?g.push(mainMatchDeco.range($,_)):($>=c.to||_<=c.from)&&g.push(matchDeco.range($,_)),g.length>e.maxMatches))return Decoration.none}}return Decoration.set(g)}},{decorations:s=>s.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:s,dispatch:e})=>{let{selection:o}=s,a=EditorSelection.create(o.ranges.map(c=>s.wordAt(c.head)||EditorSelection.cursor(c.head)),o.mainIndex);return a.eq(o)?!1:(e(s.update({selection:a})),!0)};function findNextOccurrence(s,e){let{main:o,ranges:a}=s.selection,c=s.wordAt(o.head),d=c&&c.from==o.from&&c.to==o.to;for(let h=!1,g=new SearchCursor(s.doc,e,a[a.length-1].to);;)if(g.next(),g.done){if(h)return null;g=new SearchCursor(s.doc,e,0,Math.max(0,a[a.length-1].from-1)),h=!0}else{if(h&&a.some(b=>b.from==g.value.from))continue;if(d){let b=s.wordAt(g.value.from);if(!b||b.from!=g.value.from||b.to!=g.value.to)continue}return g.value}}const selectNextOccurrence=({state:s,dispatch:e})=>{let{ranges:o}=s.selection;if(o.some(d=>d.from===d.to))return selectWord({state:s,dispatch:e});let a=s.sliceDoc(o[0].from,o[0].to);if(s.selection.ranges.some(d=>s.sliceDoc(d.from,d.to)!=a))return!1;let c=findNextOccurrence(s,a);return c?(e(s.update({selection:s.selection.addRange(EditorSelection.range(c.from,c.to),!1),effects:EditorView.scrollIntoView(c.to)})),!0):!1},searchConfigFacet=Facet.define({combine(s){return combineConfig(s,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>EditorView.scrollIntoView(e)})}});class SearchQuery{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord,this.test=e.test}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(o,a)=>a=="n"?`
`:a=="r"?"\r":a=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord&&this.test==e.test}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,o=0,a){let c=e.doc?e:EditorState.create({doc:e});return a==null&&(a=c.doc.length),this.regexp?regexpCursor(this,c,o,a):stringCursor(this,c,o,a)}}class QueryType{constructor(e){this.spec=e}}function wrapStringTest(s,e,o){return(a,c,d,h)=>{if(o&&!o(a,c,d,h))return!1;let g=a>=h&&c<=h+d.length?d.slice(a-h,c-h):e.doc.sliceString(a,c);return s(g,e,a,c)}}function stringCursor(s,e,o,a){let c;return s.wholeWord&&(c=stringWordTest(e.doc,e.charCategorizer(e.selection.main.head))),s.test&&(c=wrapStringTest(s.test,e,c)),new SearchCursor(e.doc,s.unquoted,o,a,s.caseSensitive?void 0:d=>d.toLowerCase(),c)}function stringWordTest(s,e){return(o,a,c,d)=>((d>o||d+c.length<a)&&(d=Math.max(0,o-2),c=s.sliceString(d,Math.min(s.length,a+2))),(e(charBefore(c,o-d))!=CharCategory.Word||e(charAfter(c,o-d))!=CharCategory.Word)&&(e(charAfter(c,a-d))!=CharCategory.Word||e(charBefore(c,a-d))!=CharCategory.Word))}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,o,a){let c=stringCursor(this.spec,e,a,e.doc.length).nextOverlapping();if(c.done){let d=Math.min(e.doc.length,o+this.spec.unquoted.length);c=stringCursor(this.spec,e,0,d).nextOverlapping()}return c.done||c.value.from==o&&c.value.to==a?null:c.value}prevMatchInRange(e,o,a){for(let c=a;;){let d=Math.max(o,c-1e4-this.spec.unquoted.length),h=stringCursor(this.spec,e,d,c),g=null;for(;!h.nextOverlapping().done;)g=h.value;if(g)return g;if(d==o)return null;c-=1e4}}prevMatch(e,o,a){let c=this.prevMatchInRange(e,0,o);return c||(c=this.prevMatchInRange(e,Math.max(0,a-this.spec.unquoted.length),e.doc.length)),c&&(c.from!=o||c.to!=a)?c:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,o){let a=stringCursor(this.spec,e,0,e.doc.length),c=[];for(;!a.next().done;){if(c.length>=o)return null;c.push(a.value)}return c}highlight(e,o,a,c){let d=stringCursor(this.spec,e,Math.max(0,o-this.spec.unquoted.length),Math.min(a+this.spec.unquoted.length,e.doc.length));for(;!d.next().done;)c(d.value.from,d.value.to)}}function wrapRegexpTest(s,e,o){return(a,c,d)=>(!o||o(a,c,d))&&s(d[0],e,a,c)}function regexpCursor(s,e,o,a){let c;return s.wholeWord&&(c=regexpWordTest(e.charCategorizer(e.selection.main.head))),s.test&&(c=wrapRegexpTest(s.test,e,c)),new RegExpCursor(e.doc,s.search,{ignoreCase:!s.caseSensitive,test:c},o,a)}function charBefore(s,e){return s.slice(findClusterBreak(s,e,!1),e)}function charAfter(s,e){return s.slice(e,findClusterBreak(s,e))}function regexpWordTest(s){return(e,o,a)=>!a[0].length||(s(charBefore(a.input,a.index))!=CharCategory.Word||s(charAfter(a.input,a.index))!=CharCategory.Word)&&(s(charAfter(a.input,a.index+a[0].length))!=CharCategory.Word||s(charBefore(a.input,a.index+a[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(e,o,a){let c=regexpCursor(this.spec,e,a,e.doc.length).next();return c.done&&(c=regexpCursor(this.spec,e,0,o).next()),c.done?null:c.value}prevMatchInRange(e,o,a){for(let c=1;;c++){let d=Math.max(o,a-c*1e4),h=regexpCursor(this.spec,e,d,a),g=null;for(;!h.next().done;)g=h.value;if(g&&(d==o||g.from>d+10))return g;if(d==o)return null}}prevMatch(e,o,a){return this.prevMatchInRange(e,0,o)||this.prevMatchInRange(e,a,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(o,a)=>{if(a=="&")return e.match[0];if(a=="$")return"$";for(let c=a.length;c>0;c--){let d=+a.slice(0,c);if(d>0&&d<e.match.length)return e.match[d]+a.slice(c)}return o})}matchAll(e,o){let a=regexpCursor(this.spec,e,0,e.doc.length),c=[];for(;!a.next().done;){if(c.length>=o)return null;c.push(a.value)}return c}highlight(e,o,a,c){let d=regexpCursor(this.spec,e,Math.max(0,o-250),Math.min(a+250,e.doc.length));for(;!d.next().done;)c(d.value.from,d.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel=StateEffect.define(),searchState=StateField.define({create(s){return new SearchState(defaultQuery(s).create(),null)},update(s,e){for(let o of e.effects)o.is(setSearchQuery)?s=new SearchState(o.value.create(),s.panel):o.is(togglePanel)&&(s=new SearchState(s.query,o.value?createSearchPanel:null));return s},provide:s=>showPanel.from(s,e=>e.panel)});class SearchState{constructor(e,o){this.query=e,this.panel=o}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(s){this.view=s,this.decorations=this.highlight(s.state.field(searchState))}update(s){let e=s.state.field(searchState);(e!=s.startState.field(searchState)||s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:s,panel:e}){if(!e||!s.spec.valid)return Decoration.none;let{view:o}=this,a=new RangeSetBuilder;for(let c=0,d=o.visibleRanges,h=d.length;c<h;c++){let{from:g,to:b}=d[c];for(;c<h-1&&b>d[c+1].from-2*250;)b=d[++c].to;s.highlight(o.state,g,b,(j,$)=>{let _=o.state.selection.ranges.some(_e=>_e.from==j&&_e.to==$);a.add(j,$,_?selectedMatchMark:matchMark)})}return a.finish()}},{decorations:s=>s.decorations});function searchCommand(s){return e=>{let o=e.state.field(searchState,!1);return o&&o.query.spec.valid?s(e,o):openSearchPanel(e)}}const findNext=searchCommand((s,{query:e})=>{let{to:o}=s.state.selection.main,a=e.nextMatch(s.state,o,o);if(!a)return!1;let c=EditorSelection.single(a.from,a.to),d=s.state.facet(searchConfigFacet);return s.dispatch({selection:c,effects:[announceMatch(s,a),d.scrollToMatch(c.main,s)],userEvent:"select.search"}),selectSearchInput(s),!0}),findPrevious=searchCommand((s,{query:e})=>{let{state:o}=s,{from:a}=o.selection.main,c=e.prevMatch(o,a,a);if(!c)return!1;let d=EditorSelection.single(c.from,c.to),h=s.state.facet(searchConfigFacet);return s.dispatch({selection:d,effects:[announceMatch(s,c),h.scrollToMatch(d.main,s)],userEvent:"select.search"}),selectSearchInput(s),!0}),selectMatches=searchCommand((s,{query:e})=>{let o=e.matchAll(s.state,1e3);return!o||!o.length?!1:(s.dispatch({selection:EditorSelection.create(o.map(a=>EditorSelection.range(a.from,a.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:s,dispatch:e})=>{let o=s.selection;if(o.ranges.length>1||o.main.empty)return!1;let{from:a,to:c}=o.main,d=[],h=0;for(let g=new SearchCursor(s.doc,s.sliceDoc(a,c));!g.next().done;){if(d.length>1e3)return!1;g.value.from==a&&(h=d.length),d.push(EditorSelection.range(g.value.from,g.value.to))}return e(s.update({selection:EditorSelection.create(d,h),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((s,{query:e})=>{let{state:o}=s,{from:a,to:c}=o.selection.main;if(o.readOnly)return!1;let d=e.nextMatch(o,a,a);if(!d)return!1;let h=d,g=[],b,j,$=[];h.from==a&&h.to==c&&(j=o.toText(e.getReplacement(h)),g.push({from:h.from,to:h.to,insert:j}),h=e.nextMatch(o,h.from,h.to),$.push(EditorView.announce.of(o.phrase("replaced match on line $",o.doc.lineAt(a).number)+".")));let _=s.state.changes(g);return h&&(b=EditorSelection.single(h.from,h.to).map(_),$.push(announceMatch(s,h)),$.push(o.facet(searchConfigFacet).scrollToMatch(b.main,s))),s.dispatch({changes:_,selection:b,effects:$,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((s,{query:e})=>{if(s.state.readOnly)return!1;let o=e.matchAll(s.state,1e9).map(c=>{let{from:d,to:h}=c;return{from:d,to:h,insert:e.getReplacement(c)}});if(!o.length)return!1;let a=s.state.phrase("replaced $ matches",o.length)+".";return s.dispatch({changes:o,effects:EditorView.announce.of(a),userEvent:"input.replace.all"}),!0});function createSearchPanel(s){return s.state.facet(searchConfigFacet).createPanel(s)}function defaultQuery(s,e){var o,a,c,d,h;let g=s.selection.main,b=g.empty||g.to>g.from+100?"":s.sliceDoc(g.from,g.to);if(e&&!b)return e;let j=s.facet(searchConfigFacet);return new SearchQuery({search:((o=e==null?void 0:e.literal)!==null&&o!==void 0?o:j.literal)?b:b.replace(/\n/g,"\\n"),caseSensitive:(a=e==null?void 0:e.caseSensitive)!==null&&a!==void 0?a:j.caseSensitive,literal:(c=e==null?void 0:e.literal)!==null&&c!==void 0?c:j.literal,regexp:(d=e==null?void 0:e.regexp)!==null&&d!==void 0?d:j.regexp,wholeWord:(h=e==null?void 0:e.wholeWord)!==null&&h!==void 0?h:j.wholeWord})}function getSearchInput(s){let e=getPanel(s,createSearchPanel);return e&&e.dom.querySelector("[main-field]")}function selectSearchInput(s){let e=getSearchInput(s);e&&e==s.root.activeElement&&e.select()}const openSearchPanel=s=>{let e=s.state.field(searchState,!1);if(e&&e.panel){let o=getSearchInput(s);if(o&&o!=s.root.activeElement){let a=defaultQuery(s.state,e.query.spec);a.valid&&s.dispatch({effects:setSearchQuery.of(a)}),o.focus(),o.select()}}else s.dispatch({effects:[togglePanel.of(!0),e?setSearchQuery.of(defaultQuery(s.state,e.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=s=>{let e=s.state.field(searchState,!1);if(!e||!e.panel)return!1;let o=getPanel(s,createSearchPanel);return o&&o.dom.contains(s.root.activeElement)&&s.focus(),s.dispatch({effects:togglePanel.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Mod-Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(e){this.view=e;let o=this.query=e.state.field(searchState).query.spec;this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:o.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:o.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:o.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:o.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:o.wholeWord,onchange:this.commit});function a(c,d,h){return crelt("button",{class:"cm-button",name:c,onclick:d,type:"button"},h)}this.dom=crelt("div",{onkeydown:c=>this.keydown(c),class:"cm-search"},[this.searchField,a("next",()=>findNext(e),[phrase(e,"next")]),a("prev",()=>findPrevious(e),[phrase(e,"previous")]),a("select",()=>selectMatches(e),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")]),crelt("label",null,[this.wordField,phrase(e,"by word")]),...e.state.readOnly?[]:[crelt("br"),this.replaceField,a("replace",()=>replaceNext(e),[phrase(e,"replace")]),a("replaceAll",()=>replaceAll(e),[phrase(e,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(e),"aria-label":phrase(e,"close"),type:"button"},[""])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:setSearchQuery.of(e)}))}keydown(e){runScopeHandlers(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?findPrevious:findNext)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),replaceNext(this.view))}update(e){for(let o of e.transactions)for(let a of o.effects)a.is(setSearchQuery)&&!a.value.eq(this.query)&&this.setQuery(a.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(s,e){return s.state.phrase(e)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(s,{from:e,to:o}){let a=s.state.doc.lineAt(e),c=s.state.doc.lineAt(o).to,d=Math.max(a.from,e-AnnounceMargin),h=Math.min(c,o+AnnounceMargin),g=s.state.sliceDoc(d,h);if(d!=a.from){for(let b=0;b<AnnounceMargin;b++)if(!Break.test(g[b+1])&&Break.test(g[b])){g=g.slice(b);break}}if(h!=c){for(let b=g.length-1;b>g.length-AnnounceMargin;b--)if(!Break.test(g[b-1])&&Break.test(g[b])){g=g.slice(0,b);break}}return EditorView.announce.of(`${s.state.phrase("current match")}. ${g} ${s.state.phrase("on line")} ${a.number}.`)}const baseTheme$1=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.low(searchHighlighter),baseTheme$1];class CompletionContext{constructor(e,o,a,c){this.state=e,this.pos=o,this.explicit=a,this.view=c,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let o=syntaxTree(this.state).resolveInner(this.pos,-1);for(;o&&e.indexOf(o.name)<0;)o=o.parent;return o?{from:o.from,to:this.pos,text:this.state.sliceDoc(o.from,this.pos),type:o.type}:null}matchBefore(e){let o=this.state.doc.lineAt(this.pos),a=Math.max(o.from,this.pos-250),c=o.text.slice(a-o.from,this.pos-o.from),d=c.search(ensureAnchor(e,!1));return d<0?null:{from:a+d,to:this.pos,text:c.slice(d)}}get aborted(){return this.abortListeners==null}addEventListener(e,o,a){e=="abort"&&this.abortListeners&&(this.abortListeners.push(o),a&&a.onDocChange&&(this.abortOnDocChange=!0))}}function toSet(s){let e=Object.keys(s).join(""),o=/\w/.test(e);return o&&(e=e.replace(/\w/g,"")),`[${o?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(s){let e=Object.create(null),o=Object.create(null);for(let{label:c}of s){e[c[0]]=!0;for(let d=1;d<c.length;d++)o[c[d]]=!0}let a=toSet(e)+toSet(o)+"*$";return[new RegExp("^"+a),new RegExp(a)]}function completeFromList(s){let e=s.map(c=>typeof c=="string"?{label:c}:c),[o,a]=e.every(c=>/^\w+$/.test(c.label))?[/\w*$/,/\w+$/]:prefixMatch(e);return c=>{let d=c.matchBefore(a);return d||c.explicit?{from:d?d.from:c.pos,options:e,validFor:o}:null}}class Option{constructor(e,o,a,c){this.completion=e,this.source=o,this.match=a,this.score=c}}function cur(s){return s.selection.main.from}function ensureAnchor(s,e){var o;let{source:a}=s,c=e&&a[0]!="^",d=a[a.length-1]!="$";return!c&&!d?s:new RegExp(`${c?"^":""}(?:${a})${d?"$":""}`,(o=s.flags)!==null&&o!==void 0?o:s.ignoreCase?"i":"")}const pickedCompletion=Annotation.define();function insertCompletionText(s,e,o,a){let{main:c}=s.selection,d=o-c.from,h=a-c.from;return{...s.changeByRange(g=>{if(g!=c&&o!=a&&s.sliceDoc(g.from+d,g.from+h)!=s.sliceDoc(o,a))return{range:g};let b=s.toText(e);return{changes:{from:g.from+d,to:a==c.from?g.to:g.from+h,insert:b},range:EditorSelection.cursor(g.from+d+b.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const SourceCache=new WeakMap;function asSource(s){if(!Array.isArray(s))return s;let e=SourceCache.get(s);return e||SourceCache.set(s,e=completeFromList(s)),e}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let o=0;o<e.length;){let a=codePointAt(e,o),c=codePointSize(a);this.chars.push(a);let d=e.slice(o,o+c),h=d.toUpperCase();this.folded.push(codePointAt(h==d?d.toLowerCase():h,0)),o+=c}this.astral=e.length!=this.chars.length}ret(e,o){return this.score=e,this.matched=o,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:o,folded:a,any:c,precise:d,byWord:h}=this;if(o.length==1){let lt=codePointAt(e,0),ot=codePointSize(lt),ct=ot==e.length?0:-100;if(lt!=o[0])if(lt==a[0])ct+=-200;else return null;return this.ret(ct,[0,ot])}let g=e.indexOf(this.pattern);if(g==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let b=o.length,j=0;if(g<0){for(let lt=0,ot=Math.min(e.length,200);lt<ot&&j<b;){let ct=codePointAt(e,lt);(ct==o[j]||ct==a[j])&&(c[j++]=lt),lt+=codePointSize(ct)}if(j<b)return null}let $=0,_=0,_e=!1,et=0,nt=-1,rt=-1,it=/[a-z]/.test(e),st=!0;for(let lt=0,ot=Math.min(e.length,200),ct=0;lt<ot&&_<b;){let ut=codePointAt(e,lt);g<0&&($<b&&ut==o[$]&&(d[$++]=lt),et<b&&(ut==o[et]||ut==a[et]?(et==0&&(nt=lt),rt=lt+1,et++):et=0));let at,dt=ut<255?ut>=48&&ut<=57||ut>=97&&ut<=122?2:ut>=65&&ut<=90?1:0:(at=fromCodePoint(ut))!=at.toLowerCase()?1:at!=at.toUpperCase()?2:0;(!lt||dt==1&&it||ct==0&&dt!=0)&&(o[_]==ut||a[_]==ut&&(_e=!0)?h[_++]=lt:h.length&&(st=!1)),ct=dt,lt+=codePointSize(ut)}return _==b&&h[0]==0&&st?this.result(-100+(_e?-200:0),h,e):et==b&&nt==0?this.ret(-200-e.length+(rt==e.length?0:-100),[0,rt]):g>-1?this.ret(-700-e.length,[g,g+this.pattern.length]):et==b?this.ret(-900-e.length,[nt,rt]):_==b?this.result(-100+(_e?-200:0)+-700+(st?0:-1100),h,e):o.length==2?null:this.result((c[0]?-700:0)+-200+-1100,c,e)}result(e,o,a){let c=[],d=0;for(let h of o){let g=h+(this.astral?codePointSize(codePointAt(a,h)):1);d&&c[d-1]==h?c[d-1]=g:(c[d++]=h,c[d++]=g)}return this.ret(e-a.length,c)}}class StrictMatcher{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let o=e.slice(0,this.pattern.length),a=o==this.pattern?0:o.toLowerCase()==this.folded?-200:null;return a==null?null:(this.matched=[0,o.length],this.score=a+(e.length==this.pattern.length?0:-100),this)}}const completionConfig=Facet.define({combine(s){return combineConfig(s,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,filterStrict:!1,compareCompletions:(e,o)=>(e.sortText||e.label).localeCompare(o.sortText||o.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,o)=>e&&o,closeOnBlur:(e,o)=>e&&o,icons:(e,o)=>e&&o,tooltipClass:(e,o)=>a=>joinClass(e(a),o(a)),optionClass:(e,o)=>a=>joinClass(e(a),o(a)),addToOptions:(e,o)=>e.concat(o),filterStrict:(e,o)=>e||o})}});function joinClass(s,e){return s?e?s+" "+e:s:e}function defaultPositionInfo(s,e,o,a,c,d){let h=s.textDirection==Direction.RTL,g=h,b=!1,j="top",$,_,_e=e.left-c.left,et=c.right-e.right,nt=a.right-a.left,rt=a.bottom-a.top;if(g&&_e<Math.min(nt,et)?g=!1:!g&&et<Math.min(nt,_e)&&(g=!0),nt<=(g?_e:et))$=Math.max(c.top,Math.min(o.top,c.bottom-rt))-e.top,_=Math.min(400,g?_e:et);else{b=!0,_=Math.min(400,(h?e.right:c.right-e.left)-30);let lt=c.bottom-e.bottom;lt>=rt||lt>e.top?$=o.bottom-e.top:(j="bottom",$=e.bottom-o.top)}let it=(e.bottom-e.top)/d.offsetHeight,st=(e.right-e.left)/d.offsetWidth;return{style:`${j}: ${$/it}px; max-width: ${_/st}px`,class:"cm-completionInfo-"+(b?h?"left-narrow":"right-narrow":g?"left":"right")}}function optionContent(s){let e=s.addToOptions.slice();return s.icons&&e.push({render(o){let a=document.createElement("div");return a.classList.add("cm-completionIcon"),o.type&&a.classList.add(...o.type.split(/\s+/g).map(c=>"cm-completionIcon-"+c)),a.setAttribute("aria-hidden","true"),a},position:20}),e.push({render(o,a,c,d){let h=document.createElement("span");h.className="cm-completionLabel";let g=o.displayLabel||o.label,b=0;for(let j=0;j<d.length;){let $=d[j++],_=d[j++];$>b&&h.appendChild(document.createTextNode(g.slice(b,$)));let _e=h.appendChild(document.createElement("span"));_e.appendChild(document.createTextNode(g.slice($,_))),_e.className="cm-completionMatchedText",b=_}return b<g.length&&h.appendChild(document.createTextNode(g.slice(b))),h},position:50},{render(o){if(!o.detail)return null;let a=document.createElement("span");return a.className="cm-completionDetail",a.textContent=o.detail,a},position:80}),e.sort((o,a)=>o.position-a.position).map(o=>o.render)}function rangeAroundSelected(s,e,o){if(s<=o)return{from:0,to:s};if(e<0&&(e=0),e<=s>>1){let c=Math.floor(e/o);return{from:c*o,to:(c+1)*o}}let a=Math.floor((s-e)/o);return{from:s-(a+1)*o,to:s-a*o}}class CompletionTooltip{constructor(e,o,a){this.view=e,this.stateField=o,this.applyCompletion=a,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:b=>this.placeInfo(b),key:this},this.space=null,this.currentClass="";let c=e.state.field(o),{options:d,selected:h}=c.open,g=e.state.facet(completionConfig);this.optionContent=optionContent(g),this.optionClass=g.optionClass,this.tooltipClass=g.tooltipClass,this.range=rangeAroundSelected(d.length,h,g.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",b=>{let{options:j}=e.state.field(o).open;for(let $=b.target,_;$&&$!=this.dom;$=$.parentNode)if($.nodeName=="LI"&&(_=/-(\d+)$/.exec($.id))&&+_[1]<j.length){this.applyCompletion(e,j[+_[1]]),b.preventDefault();return}}),this.dom.addEventListener("focusout",b=>{let j=e.state.field(this.stateField,!1);j&&j.tooltip&&e.state.facet(completionConfig).closeOnBlur&&b.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})}),this.showOptions(d,c.id)}mount(){this.updateSel()}showOptions(e,o){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,o,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var o;let a=e.state.field(this.stateField),c=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),a!=c){let{options:d,selected:h,disabled:g}=a.open;(!c.open||c.open.options!=d)&&(this.range=rangeAroundSelected(d.length,h,e.state.facet(completionConfig).maxRenderedOptions),this.showOptions(d,a.id)),this.updateSel(),g!=((o=c.open)===null||o===void 0?void 0:o.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!g)}}updateTooltipClass(e){let o=this.tooltipClass(e);if(o!=this.currentClass){for(let a of this.currentClass.split(" "))a&&this.dom.classList.remove(a);for(let a of o.split(" "))a&&this.dom.classList.add(a);this.currentClass=o}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),o=e.open;(o.selected>-1&&o.selected<this.range.from||o.selected>=this.range.to)&&(this.range=rangeAroundSelected(o.options.length,o.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.showOptions(o.options,e.id));let a=this.updateSelectedOption(o.selected);if(a){this.destroyInfo();let{completion:c}=o.options[o.selected],{info:d}=c;if(!d)return;let h=typeof d=="string"?document.createTextNode(d):d(c);if(!h)return;"then"in h?h.then(g=>{g&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(g,c)}).catch(g=>logException(this.view.state,g,"completion info")):(this.addInfoPane(h,c),a.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,o){this.destroyInfo();let a=this.info=document.createElement("div");if(a.className="cm-tooltip cm-completionInfo",a.id="cm-completionInfo-"+Math.floor(Math.random()*65535).toString(16),e.nodeType!=null)a.appendChild(e),this.infoDestroy=null;else{let{dom:c,destroy:d}=e;a.appendChild(c),this.infoDestroy=d||null}this.dom.appendChild(a),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let o=null;for(let a=this.list.firstChild,c=this.range.from;a;a=a.nextSibling,c++)a.nodeName!="LI"||!a.id?c--:c==e?a.hasAttribute("aria-selected")||(a.setAttribute("aria-selected","true"),o=a):a.hasAttribute("aria-selected")&&(a.removeAttribute("aria-selected"),a.removeAttribute("aria-describedby"));return o&&scrollIntoView(this.list,o),o}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let o=this.dom.getBoundingClientRect(),a=this.info.getBoundingClientRect(),c=e.getBoundingClientRect(),d=this.space;if(!d){let h=this.dom.ownerDocument.documentElement;d={left:0,top:0,right:h.clientWidth,bottom:h.clientHeight}}return c.top>Math.min(d.bottom,o.bottom)-10||c.bottom<Math.max(d.top,o.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,o,c,a,d,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,o,a){const c=document.createElement("ul");c.id=o,c.setAttribute("role","listbox"),c.setAttribute("aria-expanded","true"),c.setAttribute("aria-label",this.view.state.phrase("Completions")),c.addEventListener("mousedown",h=>{h.target==c&&h.preventDefault()});let d=null;for(let h=a.from;h<a.to;h++){let{completion:g,match:b}=e[h],{section:j}=g;if(j){let _e=typeof j=="string"?j:j.name;if(_e!=d&&(h>a.from||a.from==0))if(d=_e,typeof j!="string"&&j.header)c.appendChild(j.header(j));else{let et=c.appendChild(document.createElement("completion-section"));et.textContent=_e}}const $=c.appendChild(document.createElement("li"));$.id=o+"-"+h,$.setAttribute("role","option");let _=this.optionClass(g);_&&($.className=_);for(let _e of this.optionContent){let et=_e(g,this.view.state,this.view,b);et&&$.appendChild(et)}}return a.from&&c.classList.add("cm-completionListIncompleteTop"),a.to<e.length&&c.classList.add("cm-completionListIncompleteBottom"),c}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(s,e){return o=>new CompletionTooltip(o,s,e)}function scrollIntoView(s,e){let o=s.getBoundingClientRect(),a=e.getBoundingClientRect(),c=o.height/s.offsetHeight;a.top<o.top?s.scrollTop-=(o.top-a.top)/c:a.bottom>o.bottom&&(s.scrollTop+=(a.bottom-o.bottom)/c)}function score(s){return(s.boost||0)*100+(s.apply?10:0)+(s.info?5:0)+(s.type?1:0)}function sortOptions(s,e){let o=[],a=null,c=null,d=$=>{o.push($);let{section:_}=$.completion;if(_){a||(a=[]);let _e=typeof _=="string"?_:_.name;a.some(et=>et.name==_e)||a.push(typeof _=="string"?{name:_e}:_)}},h=e.facet(completionConfig);for(let $ of s)if($.hasResult()){let _=$.result.getMatch;if($.result.filter===!1)for(let _e of $.result.options)d(new Option(_e,$.source,_?_(_e):[],1e9-o.length));else{let _e=e.sliceDoc($.from,$.to),et,nt=h.filterStrict?new StrictMatcher(_e):new FuzzyMatcher(_e);for(let rt of $.result.options)if(et=nt.match(rt.label)){let it=rt.displayLabel?_?_(rt,et.matched):[]:et.matched,st=et.score+(rt.boost||0);if(d(new Option(rt,$.source,it,st)),typeof rt.section=="object"&&rt.section.rank==="dynamic"){let{name:lt}=rt.section;c||(c=Object.create(null)),c[lt]=Math.max(st,c[lt]||-1e9)}}}}if(a){let $=Object.create(null),_=0,_e=(et,nt)=>(et.rank==="dynamic"&&nt.rank==="dynamic"?c[nt.name]-c[et.name]:0)||(typeof et.rank=="number"?et.rank:1e9)-(typeof nt.rank=="number"?nt.rank:1e9)||(et.name<nt.name?-1:1);for(let et of a.sort(_e))_-=1e5,$[et.name]=_;for(let et of o){let{section:nt}=et.completion;nt&&(et.score+=$[typeof nt=="string"?nt:nt.name])}}let g=[],b=null,j=h.compareCompletions;for(let $ of o.sort((_,_e)=>_e.score-_.score||j(_.completion,_e.completion))){let _=$.completion;!b||b.label!=_.label||b.detail!=_.detail||b.type!=null&&_.type!=null&&b.type!=_.type||b.apply!=_.apply||b.boost!=_.boost?g.push($):score($.completion)>score(b)&&(g[g.length-1]=$),b=$.completion}return g}class CompletionDialog{constructor(e,o,a,c,d,h){this.options=e,this.attrs=o,this.tooltip=a,this.timestamp=c,this.selected=d,this.disabled=h}setSelected(e,o){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(o,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,o,a,c,d,h){if(c&&!h&&e.some(j=>j.isPending))return c.setDisabled();let g=sortOptions(e,o);if(!g.length)return c&&e.some(j=>j.isPending)?c.setDisabled():null;let b=o.facet(completionConfig).selectOnOpen?0:-1;if(c&&c.selected!=b&&c.selected!=-1){let j=c.options[c.selected].completion;for(let $=0;$<g.length;$++)if(g[$].completion==j){b=$;break}}return new CompletionDialog(g,makeAttrs(a,b),{pos:e.reduce((j,$)=>$.hasResult()?Math.min(j,$.from):j,1e8),create:createTooltip,above:d.aboveCursor},c?c.timestamp:Date.now(),b,!1)}map(e){return new CompletionDialog(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new CompletionDialog(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class CompletionState{constructor(e,o,a){this.active=e,this.id=o,this.open=a}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:o}=e,a=o.facet(completionConfig),d=(a.override||o.languageDataAt("autocomplete",cur(o)).map(asSource)).map(b=>(this.active.find($=>$.source==b)||new ActiveSource(b,this.active.some($=>$.state!=0)?1:0)).update(e,a));d.length==this.active.length&&d.every((b,j)=>b==this.active[j])&&(d=this.active);let h=this.open,g=e.effects.some(b=>b.is(setActiveEffect));h&&e.docChanged&&(h=h.map(e.changes)),e.selection||d.some(b=>b.hasResult()&&e.changes.touchesRange(b.from,b.to))||!sameResults(d,this.active)||g?h=CompletionDialog.build(d,o,this.id,h,a,g):h&&h.disabled&&!d.some(b=>b.isPending)&&(h=null),!h&&d.every(b=>!b.isPending)&&d.some(b=>b.hasResult())&&(d=d.map(b=>b.hasResult()?new ActiveSource(b.source,0):b));for(let b of e.effects)b.is(setSelectedEffect)&&(h=h&&h.setSelected(b.value,this.id));return d==this.active&&h==this.open?this:new CompletionState(d,this.id,h)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?baseAttrs:noAttrs}}function sameResults(s,e){if(s==e)return!0;for(let o=0,a=0;;){for(;o<s.length&&!s[o].hasResult();)o++;for(;a<e.length&&!e[a].hasResult();)a++;let c=o==s.length,d=a==e.length;if(c||d)return c==d;if(s[o++].result!=e[a++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"},noAttrs={};function makeAttrs(s,e){let o={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":s};return e>-1&&(o["aria-activedescendant"]=s+"-"+e),o}const none=[];function getUpdateType(s,e){if(s.isUserEvent("input.complete")){let a=s.annotation(pickedCompletion);if(a&&e.activateOnCompletion(a))return 12}let o=s.isUserEvent("input.type");return o&&e.activateOnTyping?5:o?1:s.isUserEvent("delete.backward")?2:s.selection?8:s.docChanged?16:0}class ActiveSource{constructor(e,o,a=!1){this.source=e,this.state=o,this.explicit=a}hasResult(){return!1}get isPending(){return this.state==1}update(e,o){let a=getUpdateType(e,o),c=this;(a&8||a&16&&this.touches(e))&&(c=new ActiveSource(c.source,0)),a&4&&c.state==0&&(c=new ActiveSource(this.source,1)),c=c.updateFor(e,a);for(let d of e.effects)if(d.is(startCompletionEffect))c=new ActiveSource(c.source,1,d.value);else if(d.is(closeCompletionEffect))c=new ActiveSource(c.source,0);else if(d.is(setActiveEffect))for(let h of d.value)h.source==c.source&&(c=h);return c}updateFor(e,o){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(cur(e.state))}}class ActiveResult extends ActiveSource{constructor(e,o,a,c,d,h){super(e,3,o),this.limit=a,this.result=c,this.from=d,this.to=h}hasResult(){return!0}updateFor(e,o){var a;if(!(o&3))return this.map(e.changes);let c=this.result;c.map&&!e.changes.empty&&(c=c.map(c,e.changes));let d=e.changes.mapPos(this.from),h=e.changes.mapPos(this.to,1),g=cur(e.state);if(g>h||!c||o&2&&(cur(e.startState)==this.from||g<this.limit))return new ActiveSource(this.source,o&4?1:0);let b=e.changes.mapPos(this.limit);return checkValid(c.validFor,e.state,d,h)?new ActiveResult(this.source,this.explicit,b,c,d,h):c.update&&(c=c.update(c,d,h,new CompletionContext(e.state,g,!1)))?new ActiveResult(this.source,this.explicit,b,c,c.from,(a=c.to)!==null&&a!==void 0?a:cur(e.state)):new ActiveSource(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new ActiveResult(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new ActiveSource(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function checkValid(s,e,o,a){if(!s)return!1;let c=e.sliceDoc(o,a);return typeof s=="function"?s(c,o,a,e):ensureAnchor(s,!0).test(c)}const setActiveEffect=StateEffect.define({map(s,e){return s.map(o=>o.map(e))}}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create(){return CompletionState.start()},update(s,e){return s.update(e)},provide:s=>[showTooltip.from(s,e=>e.tooltip),EditorView.contentAttributes.from(s,e=>e.attrs)]});function applyCompletion(s,e){const o=e.completion.apply||e.completion.label;let a=s.state.field(completionState).active.find(c=>c.source==e.source);return a instanceof ActiveResult?(typeof o=="string"?s.dispatch({...insertCompletionText(s.state,o,a.from,a.to),annotations:pickedCompletion.of(e.completion)}):o(s,e.completion,a.from,a.to),!0):!1}const createTooltip=completionTooltip(completionState,applyCompletion);function moveCompletionSelection(s,e="option"){return o=>{let a=o.state.field(completionState,!1);if(!a||!a.open||a.open.disabled||Date.now()-a.open.timestamp<o.state.facet(completionConfig).interactionDelay)return!1;let c=1,d;e=="page"&&(d=getTooltip(o,a.open.tooltip))&&(c=Math.max(2,Math.floor(d.dom.offsetHeight/d.dom.querySelector("li").offsetHeight)-1));let{length:h}=a.open.options,g=a.open.selected>-1?a.open.selected+c*(s?1:-1):s?0:h-1;return g<0?g=e=="page"?0:h-1:g>=h&&(g=e=="page"?h-1:0),o.dispatch({effects:setSelectedEffect.of(g)}),!0}}const acceptCompletion=s=>{let e=s.state.field(completionState,!1);return s.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<s.state.facet(completionConfig).interactionDelay?!1:applyCompletion(s,e.open.options[e.open.selected])},startCompletion=s=>s.state.field(completionState,!1)?(s.dispatch({effects:startCompletionEffect.of(!0)}),!0):!1,closeCompletion=s=>{let e=s.state.field(completionState,!1);return!e||!e.active.some(o=>o.state!=0)?!1:(s.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(e,o){this.active=e,this.context=o,this.time=Date.now(),this.updates=[],this.done=void 0}}const MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(s){this.view=s,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of s.state.field(completionState).active)e.isPending&&this.startQuery(e)}update(s){let e=s.state.field(completionState),o=s.state.facet(completionConfig);if(!s.selectionSet&&!s.docChanged&&s.startState.field(completionState)==e)return;let a=s.transactions.some(d=>{let h=getUpdateType(d,o);return h&8||(d.selection||d.docChanged)&&!(h&3)});for(let d=0;d<this.running.length;d++){let h=this.running[d];if(a||h.context.abortOnDocChange&&s.docChanged||h.updates.length+s.transactions.length>MaxUpdateCount&&Date.now()-h.time>MinAbortTime){for(let g of h.context.abortListeners)try{g()}catch(b){logException(this.view.state,b)}h.context.abortListeners=null,this.running.splice(d--,1)}else h.updates.push(...s.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),s.transactions.some(d=>d.effects.some(h=>h.is(startCompletionEffect)))&&(this.pendingStart=!0);let c=this.pendingStart?50:o.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(d=>d.isPending&&!this.running.some(h=>h.active.source==d.source))?setTimeout(()=>this.startUpdate(),c):-1,this.composing!=0)for(let d of s.transactions)d.isUserEvent("input.type")?this.composing=2:this.composing==2&&d.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:s}=this.view,e=s.field(completionState);for(let o of e.active)o.isPending&&!this.running.some(a=>a.active.source==o.source)&&this.startQuery(o);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}startQuery(s){let{state:e}=this.view,o=cur(e),a=new CompletionContext(e,o,s.explicit,this.view),c=new RunningQuery(s,a);this.running.push(c),Promise.resolve(s.source(a)).then(d=>{c.context.aborted||(c.done=d||null,this.scheduleAccept())},d=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,d)})}scheduleAccept(){this.running.every(s=>s.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}accept(){var s;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],o=this.view.state.facet(completionConfig),a=this.view.state.field(completionState);for(let c=0;c<this.running.length;c++){let d=this.running[c];if(d.done===void 0)continue;if(this.running.splice(c--,1),d.done){let g=cur(d.updates.length?d.updates[0].startState:this.view.state),b=Math.min(g,d.done.from+(d.active.explicit?0:1)),j=new ActiveResult(d.active.source,d.active.explicit,b,d.done,d.done.from,(s=d.done.to)!==null&&s!==void 0?s:g);for(let $ of d.updates)j=j.update($,o);if(j.hasResult()){e.push(j);continue}}let h=a.active.find(g=>g.source==d.active.source);if(h&&h.isPending)if(d.done==null){let g=new ActiveSource(d.active.source,0);for(let b of d.updates)g=g.update(b,o);g.isPending||e.push(g)}else this.startQuery(h)}(e.length||a.open&&a.open.disabled)&&this.view.dispatch({effects:setActiveEffect.of(e)})}},{eventHandlers:{blur(s){let e=this.view.state.field(completionState,!1);if(e&&e.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let o=e.open&&getTooltip(this.view,e.open.tooltip);(!o||!o.dom.contains(s.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:closeCompletionEffect.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}}),windows=typeof navigator=="object"&&/Win/.test(navigator.platform),commitCharacters=Prec.highest(EditorView.domEventHandlers({keydown(s,e){let o=e.state.field(completionState,!1);if(!o||!o.open||o.open.disabled||o.open.selected<0||s.key.length>1||s.ctrlKey&&!(windows&&s.altKey)||s.metaKey)return!1;let a=o.open.options[o.open.selected],c=o.active.find(h=>h.source==a.source),d=a.completion.commitCharacters||c.result.commitCharacters;return d&&d.indexOf(s.key)>-1&&applyCompletion(e,a),!1}})),baseTheme=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1;closedBracket.endSide=-1;function autocompletion(s={}){return[commitCharacters,completionState,completionConfig.of(s),completionPlugin,completionKeymapExt,baseTheme]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{mac:"Alt-`",run:startCompletion},{mac:"Alt-i",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],s=>s.facet(completionConfig).defaultKeymap?[completionKeymap]:[])),PassageCodeEditor=({content:s,onChange:e,passages:o=[],variables:a=[],placeholder:c="Enter passage content..."})=>{const d=reactExports.useRef(null),h=reactExports.useRef(null),[g,b]=reactExports.useState(!1),[j,$]=reactExports.useState(""),_=reactExports.useCallback(it=>{const st=it.matchBefore(/\[\[[^\]]*$/);if(st){const ct=st.text.slice(2),ut=ct.startsWith("#");let at;if(ut){const dt=ct.slice(1);at=o.filter(ft=>{var xt;return(xt=ft.passage_number)==null?void 0:xt.toString().includes(dt)})}else at=o.filter(dt=>dt.name.toLowerCase().includes(ct.toLowerCase()));return at.length===0?null:{from:st.from+2,options:at.map(dt=>{const ft=dt.passage_number?`#${dt.passage_number.toString().padStart(6,"0")}`:"";return ut&&ft?{label:`${ft} - ${dt.name}`,type:"class",info:`Go to: ${dt.name}`,apply:`${ft}]]`}:{label:`${dt.name}${ft?` (${ft})`:""}`,type:"class",info:`Go to: ${dt.name}`,apply:`${dt.name}]]`}})}}const lt=it.matchBefore(/\$[a-zA-Z_]*/);if(lt){const ct=lt.text.slice(1),ut=[...a,"$playerName","$score","$visited","$time","$chapter"],dt=[...new Set(ut)].filter(ft=>ft.toLowerCase().includes(ct.toLowerCase()));return dt.length===0?null:{from:lt.from,options:dt.map(ft=>({label:ft,type:"variable",info:"Story variable"}))}}const ot=it.matchBefore(/\([a-zA-Z_-]*$/);if(ot){const ct=ot.text.slice(1),ut=macroDefinitions.filter(at=>at.name.toLowerCase().includes(ct.toLowerCase()));return ut.length===0?null:{from:ot.from+1,options:ut.map(at=>({label:at.name,type:"function",info:at.description,detail:at.syntax,apply:`${at.name}: `}))}}return null},[o,a]);reactExports.useEffect(()=>{if(!d.current)return;const it=[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history(),foldGutter(),drawSelection(),EditorState.allowMultipleSelections.of(!0),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),bracketMatching(),autocompletion({override:[_],activateOnTyping:!0,maxRenderedOptions:20}),keymap.of([...defaultKeymap,...historyKeymap,...foldKeymap,...searchKeymap,...completionKeymap,indentWithTab]),placeholder(c),twineSyntaxPlugin,twineEditorTheme,EditorView.updateListener.of(ot=>{if(ot.docChanged){const ct=ot.state.doc.toString();e(ct)}})],st=EditorState.create({doc:s,extensions:it}),lt=new EditorView({state:st,parent:d.current});return h.current=lt,()=>{lt.destroy(),h.current=null}},[]),reactExports.useEffect(()=>{if(h.current){const it=h.current.state.doc.toString();it!==s&&h.current.dispatch({changes:{from:0,to:it.length,insert:s}})}},[s]);const _e=reactExports.useCallback(it=>{if(!h.current)return;const st=h.current,{from:lt}=st.state.selection.main;st.dispatch({changes:{from:lt,insert:it},selection:{anchor:lt+it.length}}),st.focus()},[]),et=reactExports.useCallback(it=>{_e(it.syntax),b(!1)},[_e]),nt=reactExports.useCallback(it=>{_e(`[[${it}]]`)},[_e]),rt=macroDefinitions.filter(it=>it.name.toLowerCase().includes(j.toLowerCase())||it.description.toLowerCase().includes(j.toLowerCase()));return jsxRuntimeExports.jsxs("div",{className:"passage-code-editor",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-t-lg p-2 flex flex-wrap gap-1 items-center",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e("[["),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 font-mono",title:"Insert passage link",children:"[[Link]]"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e("(if: condition)["),className:"px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded hover:bg-purple-200 font-mono",title:"Insert if condition",children:"(if:)"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e("(set: $var to "),className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 font-mono",title:"Set variable",children:"(set:)"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e("(print: $"),className:"px-2 py-1 text-xs bg-cyan-100 text-cyan-700 rounded hover:bg-cyan-200 font-mono",title:"Print variable",children:"(print:)"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e('(link-goto: "", "")'),className:"px-2 py-1 text-xs bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 font-mono",title:"Link with goto",children:"(link-goto:)"}),jsxRuntimeExports.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>b(!g),className:`px-3 py-1 text-xs rounded font-medium ${g?"bg-primary-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"All Macros"}),o.length>0&&jsxRuntimeExports.jsxs("div",{className:"relative group",children:[jsxRuntimeExports.jsxs("button",{type:"button",className:"px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-medium",children:["Passages (",o.length,")"]}),jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden group-hover:block max-h-60 overflow-y-auto min-w-[200px]",children:o.map(it=>jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>nt(it.name),className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`w-2 h-2 rounded-full ${it.passage_type==="start"?"bg-green-500":it.passage_type==="end"?"bg-red-500":"bg-blue-500"}`}),it.name]},it.id))})]})]}),g&&jsxRuntimeExports.jsxs("div",{className:"border-x border-gray-200 bg-white p-3 max-h-64 overflow-y-auto",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search macros...",value:j,onChange:it=>$(it.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-3 text-sm"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:rt.map(it=>jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>et(it),className:"text-left p-2 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-primary-300",children:[jsxRuntimeExports.jsxs("div",{className:"font-mono text-sm text-primary-600",children:["(",it.name,":)"]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:it.description})]},it.name))})]}),jsxRuntimeExports.jsx("div",{ref:d,className:"border border-t-0 border-gray-200 rounded-b-lg overflow-hidden bg-white"}),jsxRuntimeExports.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{className:"font-mono text-blue-600",children:"[[passage name]]"})," -   "]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{className:"font-mono text-purple-600",children:"(macro:)"})," -  ,"," ",jsxRuntimeExports.jsx("span",{className:"font-mono text-green-600",children:"$variable"})," - "]})]})]})},MACRO_CATEGORIES=[{name:"Variables",description:"   ",macros:[{name:"set",syntax:"(set: $variable to value)",description:"  .",example:`(set: $name to "Alice")
(set: $score to 100)
(set: $isReady to true)`,result:"  (  )"},{name:"print",syntax:"(print: $variable)",description:"  .",example:`(print: $name)
(print: $score + 10)`,result:"Alice, 110"},{name:"Variable Display",syntax:"$variableName",description:"   .",example:", $name! : $score",result:", Alice! : 100"}]},{name:"Links & Navigation",description:" passage  ",macros:[{name:"Simple Link",syntax:"[[passage name]]",description:" passage   .",example:"[[ ]]",result:'  " " '},{name:"Named Link",syntax:"[[display text->passage name]]",description:"   passage  .",example:"[[->Chapter 2]]",result:'""     "Chapter 2" '},{name:"link-goto",syntax:'(link-goto: "text", "passage")',description:"  .",example:'(link-goto: "", "Introduction")',result:"  "},{name:"goto",syntax:'(goto: "passage")',description:"  passage .",example:'(goto: "Game Over")',result:' "Game Over" passage '},{name:"display",syntax:'(display: "passage")',description:" passage    .",example:'(display: "Common Header")',result:'"Common Header" passage  '}]},{name:"Conditionals",description:"     ",macros:[{name:"if",syntax:"(if: condition)[content]",description:"    .",example:"(if: $score > 50)[! .]",result:"score 50   "},{name:"else-if",syntax:"(else-if: condition)[content]",description:"if      .",example:`(if: $score >= 90)[A]
(else-if: $score >= 80)[B]`,result:"   "},{name:"else",syntax:"(else:)[content]",description:"    .",example:`(if: $hasKey)[   .]
(else:)[ .]`,result:"hasKey    "},{name:"cond",syntax:"(cond: condition, ifTrue, ifFalse)",description:"      .",example:': (cond: $score > 50, "", "")',result:":   "}]},{name:"Random",description:"   ",macros:[{name:"random",syntax:"(random: min, max)",description:"     .",example:" : (random: 1, 6)",result:" : 4 (1~6  )"},{name:"either",syntax:'(either: "a", "b", "c")',description:"     .",example:' : (either: "", "", "")',result:" :  ()"}]},{name:"Text Styling",description:"   ",macros:[{name:"text-style",syntax:'(text-style: "style")[text]',description:"  . (bold, italic, underline, strike, uppercase, lowercase)",example:'(text-style: "bold")[ ]',result:"<strong> </strong>"},{name:"text-color / color",syntax:'(text-color: "color")[text]',description:"  .",example:`(text-color: "red")[!]
(color: "#3b82f6")[ ]`,result:'<span style="color: red">!</span>'},{name:"background",syntax:'(background: "color")[text]',description:"  .",example:'(background: "yellow")[]',result:'<span style="background: yellow"></span>'}]},{name:"Hooks",description:"    ",macros:[{name:"Hook Definition",syntax:"|hookName>[content]",description:"  .",example:"|secret>[  ]",result:"  "},{name:"show",syntax:"(show: ?hookName)",description:" hook .",example:'(link: " ")[(show: ?secret)]',result:"   "},{name:"hide",syntax:"(hide: ?hookName)",description:" hook .",example:"(hide: ?secret)",result:"hook  "}]}],MacroGuideModal=({isOpen:s,onClose:e})=>{const[o,a]=reactExports.useState(new Set(MACRO_CATEGORIES.map(b=>b.name))),[c,d]=reactExports.useState(null),h=b=>{const j=new Set(o);j.has(b)?j.delete(b):j.add(b),a(j)},g=async(b,j)=>{await navigator.clipboard.writeText(b),d(j),setTimeout(()=>d(null),2e3)};return s?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-[900px] max-h-[85vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Macro Guide"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"  Twine   .     ."})]}),jsxRuntimeExports.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-6 h-6 text-gray-500"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:MACRO_CATEGORIES.map(b=>jsxRuntimeExports.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>h(b.name),className:"w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[o.has(b.name)?jsxRuntimeExports.jsx(ChevronDown,{className:"w-5 h-5 text-gray-500"}):jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-gray-500"}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900",children:b.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:b.description})]})]}),jsxRuntimeExports.jsx("span",{className:"text-sm bg-primary-100 text-primary-700 px-2 py-1 rounded-full",children:b.macros.length})]}),o.has(b.name)&&jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100",children:b.macros.map(j=>jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("div",{className:"flex items-start justify-between mb-2",children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-gray-900",children:j.name}),jsxRuntimeExports.jsx("code",{className:"text-sm bg-gray-100 px-2 py-1 rounded text-primary-700",children:j.syntax})]})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-3",children:j.description}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase",children:"Example"}),jsxRuntimeExports.jsx("button",{onClick:()=>g(j.example,j.name),className:"flex items-center gap-1 text-xs text-primary-600 hover:text-primary-700",children:c===j.name?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3"}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Copy,{className:"w-3 h-3"}),"Copy"]})})]}),jsxRuntimeExports.jsx("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap font-mono bg-white rounded p-2 border border-gray-200",children:j.example}),j.result&&jsxRuntimeExports.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase",children:"Result"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700 mt-1",children:j.result})]})]})]},j.name))})]},b.name))}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["  "," ",jsxRuntimeExports.jsx("a",{href:"https://twine2.neocities.org/",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:underline",children:"Twine/Harlowe "})," ."]})})]})}):null},nodeTypes={branch:BranchNode},MIN_PANEL_WIDTH=400,MAX_PANEL_WIDTH=900,DEFAULT_PANEL_WIDTH=600,PANEL_WIDTH_KEY="storyEditor.panelWidth",StoryEditor=({storyId:s})=>{var Ft,qt,en,on,cn,dn,mn,gn,En,bn;const[e,o]=reactExports.useState(null),[a,c,d]=useNodesState([]),[h,g,b]=useEdgesState([]),[j,$]=reactExports.useState(null),[_,_e]=reactExports.useState(null),[et,nt]=reactExports.useState(!1),[rt,it]=reactExports.useState([]),[st,lt]=reactExports.useState([]),[ot,ct]=reactExports.useState(!1),[ut,at]=reactExports.useState(!1),[dt,ft]=reactExports.useState(()=>{const jt=localStorage.getItem(PANEL_WIDTH_KEY);return jt?Math.max(MIN_PANEL_WIDTH,Math.min(MAX_PANEL_WIDTH,parseInt(jt,10))):DEFAULT_PANEL_WIDTH}),[xt,Ct]=reactExports.useState(!1),yt=reactExports.useRef(0),Et=reactExports.useRef(0),Tt=j?rt.find(jt=>jt.id===j):null;reactExports.useEffect(()=>{ht()},[s]),reactExports.useEffect(()=>{const jt=It=>{It.key==="Escape"&&ot&&ct(!1)};return window.addEventListener("keydown",jt),()=>window.removeEventListener("keydown",jt)},[ot]);const ht=reactExports.useCallback(async()=>{try{const It=(await api.get(`/admin/stories/${s}`)).data;o(It),it(It.passages);const Bt=[];It.passages.forEach(Gt=>{extractVariables(Gt.content).forEach(tn=>{Bt.includes(tn)||Bt.push(tn)})}),lt(Bt);const Yt=It.passages.map(Gt=>{const Jt=Gt.passage_type==="branch"||Gt.passage_type==="start",tn=()=>{if(Jt)return;const ln={width:Gt.width||200,minHeight:Gt.height||80,padding:"12px",borderRadius:"12px",transition:"all 0.2s ease",cursor:"pointer"};return Gt.passage_type==="end"?{...ln,background:"linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)",border:"2px solid #F87171",boxShadow:"0 4px 12px rgba(248, 113, 113, 0.15)"}:{...ln,background:"linear-gradient(135deg, #FFFFFF 0%, #F8FAFC 100%)",border:"2px solid #E2E8F0",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.06)"}};return{id:Gt.id,type:Jt?"branch":void 0,position:{x:Gt.position_x,y:Gt.position_y},data:{label:Gt.name,passage:Gt},style:tn()}}),Qt=new Map(It.passages.map(Gt=>[Gt.id,Gt])),Xt=new Map;It.links.forEach(Gt=>{const Jt=Xt.get(Gt.source_passage_id)||[];Jt.push(Gt),Xt.set(Gt.source_passage_id,Jt)}),Xt.forEach(Gt=>{Gt.sort((Jt,tn)=>Jt.link_order-tn.link_order)});const hn=It.links.map(Gt=>{const Jt=Qt.get(Gt.source_passage_id),tn=(Jt==null?void 0:Jt.passage_type)==="branch"||(Jt==null?void 0:Jt.passage_type)==="start",ln=(Jt==null?void 0:Jt.passage_type)==="start",fn=tn?`choice-${Gt.link_order}`:void 0,Nn=Xt.get(Gt.source_passage_id)||[],wn=!tn&&Nn.length>1,xn=wn?Nn.findIndex(Cn=>Cn.id===Gt.id)+1:null;let An="";return tn?An=`${Gt.link_order+1}`:wn&&xn?An=Gt.name?`${xn}. ${Gt.name}`:`${xn}`:An=Gt.name||"",{id:Gt.id,source:Gt.source_passage_id,target:Gt.target_passage_id,sourceHandle:fn,label:An,type:"smoothstep",animated:Gt.condition_type!=="always",markerEnd:{type:"arrowclosed",width:20,height:20,color:tn?ln?"#10B981":"#F59E0B":"#6B7280"},style:tn?{stroke:ln?"#10B981":"#F59E0B",strokeWidth:2}:{strokeWidth:wn?2:1.5},data:{conditionType:Gt.condition_type,conditionValue:Gt.condition_value,priority:xn}}}),vn=[],kn=new Set(It.links.map(Gt=>`${Gt.source_passage_id}-${Gt.target_passage_id}`));return It.passages.forEach(Gt=>{extractPassageRefs(Gt.content||"").forEach(tn=>{let ln;if(tn.type==="id"){const fn=parseInt(tn.value,10);ln=It.passages.find(Nn=>Nn.passage_number===fn)}else ln=It.passages.find(fn=>fn.name===tn.value);if(ln&&ln.id!==Gt.id){const fn=`${Gt.id}-${ln.id}`;kn.has(fn)||(kn.add(fn),vn.push({id:`content-${fn}`,source:Gt.id,target:ln.id,type:"smoothstep",style:{strokeDasharray:"5,5",stroke:"#9CA3AF"},animated:!1,markerEnd:{type:"arrowclosed",width:15,height:15,color:"#9CA3AF"}}))}})}),c(Yt),g([...hn,...vn]),It}catch(jt){return console.error("Failed to fetch story:",jt),null}},[s,c,g]),wt=reactExports.useCallback(async jt=>{var It;if(!(!jt.source||!jt.target))try{let Bt=0;if((It=jt.sourceHandle)!=null&&It.startsWith("choice-"))Bt=parseInt(jt.sourceHandle.replace("choice-",""),10);else{const Yt=await ht();Yt&&(Bt=Yt.links.filter(hn=>hn.source_passage_id===jt.source).reduce((hn,vn)=>Math.max(hn,vn.link_order),-1)+1)}await api.post("/admin/links",{story_id:s,source_passage_id:jt.source,target_passage_id:jt.target,condition_type:"always",link_order:Bt}),await ht()}catch(Bt){console.error("Failed to create link:",Bt)}},[s,rt,ht]),St=reactExports.useCallback(jt=>{d(jt)},[d]),bt=reactExports.useCallback(jt=>{b(jt)},[b]),mt=async()=>{try{const It=(await api.post("/admin/passages",{story_id:s,name:"New Passage",content:"",passage_type:"content",position_x:Math.random()*500,position_y:Math.random()*500})).data;c(Bt=>[...Bt,{id:It.id,position:{x:It.position_x,y:It.position_y},data:{label:It.name,passage:It},style:{width:200,minHeight:100,padding:"10px",backgroundColor:"#FFFFFF",border:"2px solid #E5E7EB",borderRadius:"8px"}}]),it(Bt=>[...Bt,It])}catch(jt){console.error("Failed to create passage:",jt)}},gt=async()=>{nt(!0);try{for(const jt of a)await api.put(`/admin/passages/${jt.id}`,{position_x:jt.position.x,position_y:jt.position.y});alert("Positions saved!")}catch(jt){console.error("Failed to save positions:",jt)}finally{nt(!1)}},pt=reactExports.useCallback((jt,It)=>{_e(null),$(It.id)},[]),kt=reactExports.useCallback((jt,It)=>{_e(null),$(It.id)},[]),Rt=reactExports.useCallback((jt,It)=>{It.id.startsWith("content-")||(_e(It),$(null))},[]),At=reactExports.useCallback(()=>{_e(null)},[]),Mt=reactExports.useCallback(async jt=>{if(!jt.startsWith("content-"))try{await api.delete(`/admin/links/${jt}`),g(It=>It.filter(Bt=>Bt.id!==jt)),_e(null)}catch(It){console.error("Failed to delete link:",It)}},[g]),Dt=reactExports.useCallback(async(jt,It)=>{try{await api.put(`/admin/links/${jt}`,{name:It}),g(Bt=>Bt.map(Yt=>Yt.id===jt?{...Yt,label:It}:Yt))}catch(Bt){console.error("Failed to update link label:",Bt)}},[g]),$t=reactExports.useCallback(async(jt,It,Bt)=>{try{await api.put(`/admin/links/${jt}`,{condition_type:It,condition_value:Bt}),g(Yt=>Yt.map(Qt=>Qt.id===jt?{...Qt,animated:It!=="always",data:{...Qt.data,conditionType:It,conditionValue:Bt}}:Qt)),_e(Yt=>Yt?{...Yt,animated:It!=="always",data:{...Yt.data,conditionType:It,conditionValue:Bt}}:null)}catch(Yt){console.error("Failed to update link condition:",Yt)}},[g]),_t=reactExports.useCallback(async(jt,It)=>{try{await api.put(`/admin/links/${jt}`,{link_order:It}),await ht()}catch(Bt){console.error("Failed to update link order:",Bt)}},[ht]),Pt=reactExports.useCallback(async()=>{try{const jt=await api.get(`/admin/stories/${s}/export/passages`,{responseType:"blob"}),It=window.URL.createObjectURL(new Blob([jt.data])),Bt=document.createElement("a");Bt.href=It,Bt.setAttribute("download",`passages_${s}.csv`),document.body.appendChild(Bt),Bt.click(),Bt.remove(),window.URL.revokeObjectURL(It)}catch(jt){console.error("Failed to export passages:",jt),alert("Failed to export passages")}},[s]),Ht=reactExports.useCallback(async()=>{try{const jt=await api.get(`/admin/stories/${s}/export/links`,{responseType:"blob"}),It=window.URL.createObjectURL(new Blob([jt.data])),Bt=document.createElement("a");Bt.href=It,Bt.setAttribute("download",`links_${s}.csv`),document.body.appendChild(Bt),Bt.click(),Bt.remove(),window.URL.revokeObjectURL(It)}catch(jt){console.error("Failed to export links:",jt),alert("Failed to export links")}},[s]),Kt=reactExports.useCallback(async()=>{const jt=document.createElement("input");jt.type="file",jt.accept=".csv",jt.onchange=async It=>{var Yt;const Bt=(Yt=It.target.files)==null?void 0:Yt[0];if(Bt)try{const Qt=new FormData;Qt.append("file",Bt);const Xt=await api.post(`/admin/stories/${s}/import/passages`,Qt,{headers:{"Content-Type":"multipart/form-data"}});alert(`Import complete!
Imported: ${Xt.data.imported}
Updated: ${Xt.data.updated}
Errors: ${Xt.data.errors.length}`),Xt.data.errors.length>0&&console.error("Import errors:",Xt.data.errors),await ht()}catch(Qt){console.error("Failed to import passages:",Qt),alert("Failed to import passages")}},jt.click()},[s,ht]),Ut=reactExports.useCallback(async()=>{const jt=document.createElement("input");jt.type="file",jt.accept=".csv",jt.onchange=async It=>{var Yt;const Bt=(Yt=It.target.files)==null?void 0:Yt[0];if(Bt)try{const Qt=new FormData;Qt.append("file",Bt);const Xt=await api.post(`/admin/stories/${s}/import/links`,Qt,{headers:{"Content-Type":"multipart/form-data"}});alert(`Import complete!
Imported: ${Xt.data.imported}
Updated: ${Xt.data.updated}
Errors: ${Xt.data.errors.length}`),Xt.data.errors.length>0&&console.error("Import errors:",Xt.data.errors),await ht()}catch(Qt){console.error("Failed to import links:",Qt),alert("Failed to import links")}},jt.click()},[s,ht]);reactExports.useEffect(()=>{const jt=It=>{var Bt,Yt;if((It.key==="Delete"||It.key==="Backspace")&&_&&!j){if(((Bt=document.activeElement)==null?void 0:Bt.tagName)==="INPUT"||((Yt=document.activeElement)==null?void 0:Yt.tagName)==="TEXTAREA")return;Mt(_.id)}};return window.addEventListener("keydown",jt),()=>window.removeEventListener("keydown",jt)},[_,j,Mt]);const Nt=()=>{window.open(`/story/${s}`,"_blank")},Ot=reactExports.useCallback(()=>{$(null)},[]),Wt=reactExports.useCallback(jt=>{jt.preventDefault(),Ct(!0),yt.current=jt.clientX,Et.current=dt},[dt]);return reactExports.useEffect(()=>{if(!xt)return;const jt=Bt=>{const Yt=yt.current-Bt.clientX,Qt=Math.max(MIN_PANEL_WIDTH,Math.min(MAX_PANEL_WIDTH,Et.current+Yt));ft(Qt)},It=()=>{Ct(!1),localStorage.setItem(PANEL_WIDTH_KEY,String(dt))};return window.addEventListener("mousemove",jt),window.addEventListener("mouseup",It),()=>{window.removeEventListener("mousemove",jt),window.removeEventListener("mouseup",It)}},[xt,dt]),e?jsxRuntimeExports.jsxs("div",{className:`flex ${ot?"fixed inset-0 z-50 bg-white":"h-[calc(100vh-64px)]"} ${xt?"cursor-col-resize select-none":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex items-center gap-2 flex-wrap",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-white/95 backdrop-blur-sm border border-gray-200 rounded-xl px-3 py-2 shadow-lg",children:[jsxRuntimeExports.jsxs(Button,{size:"sm",onClick:mt,children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})," "]}),jsxRuntimeExports.jsx("div",{className:"w-px h-6 bg-gray-200"}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"secondary",onClick:gt,disabled:et,loading:et,children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"})," "]}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"secondary",onClick:Nt,children:[jsxRuntimeExports.jsx(Play,{className:"w-4 h-4"}),""]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-white/95 backdrop-blur-sm border border-gray-200 rounded-xl px-2 py-2 shadow-lg",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct(!ot),title:ot?" ":"",className:"p-1.5 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:ot?jsxRuntimeExports.jsx(Minimize2,{className:"w-4 h-4"}):jsxRuntimeExports.jsx(Maximize2,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>at(!0),title:" ",className:"p-1.5 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(HelpCircle,{className:"w-4 h-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 bg-white/95 backdrop-blur-sm border border-gray-200 rounded-xl px-2 py-2 shadow-lg",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500 px-2 font-medium",children:"CSV"}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-200"}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Pt,title:" ",className:"flex items-center gap-1 px-2 py-1 rounded-lg text-xs text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Download,{className:"w-3.5 h-3.5"}),""]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Ht,title:" ",className:"flex items-center gap-1 px-2 py-1 rounded-lg text-xs text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx(Download,{className:"w-3.5 h-3.5"}),""]}),jsxRuntimeExports.jsx("div",{className:"w-px h-5 bg-gray-200"}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Kt,title:" ",className:"flex items-center gap-1 px-2 py-1 rounded-lg text-xs text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 transition-colors",children:[jsxRuntimeExports.jsx(Upload,{className:"w-3.5 h-3.5"}),""]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Ut,title:" ",className:"flex items-center gap-1 px-2 py-1 rounded-lg text-xs text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 transition-colors",children:[jsxRuntimeExports.jsx(Upload,{className:"w-3.5 h-3.5"}),""]})]})]}),jsxRuntimeExports.jsxs(index,{nodes:a,nodeTypes,edges:h.map(jt=>{var It,Bt;return{...jt,style:{...jt.style,stroke:(_==null?void 0:_.id)===jt.id?"#6366F1":(It=jt.style)==null?void 0:It.stroke,strokeWidth:(_==null?void 0:_.id)===jt.id?3:((Bt=jt.style)==null?void 0:Bt.strokeWidth)||2},labelStyle:{fill:(_==null?void 0:_.id)===jt.id?"#6366F1":"#374151",fontWeight:(_==null?void 0:_.id)===jt.id?600:400,fontSize:11},labelBgStyle:{fill:(_==null?void 0:_.id)===jt.id?"#EEF2FF":"#F9FAFB",fillOpacity:.9}}}),onNodesChange:St,onEdgesChange:bt,onConnect:wt,onNodeClick:pt,onNodeDoubleClick:kt,onEdgeClick:Rt,onPaneClick:At,fitView:!0,selectionOnDrag:!0,selectionMode:SelectionMode.Partial,panOnDrag:[1,2],selectNodesOnDrag:!1,defaultEdgeOptions:{type:"smoothstep",animated:!1},children:[jsxRuntimeExports.jsx(Background,{color:"#E2E8F0",gap:20,size:1}),jsxRuntimeExports.jsx(Controls,{className:"!bg-white !border !border-gray-200 !rounded-lg !shadow-lg",position:"bottom-left",showZoom:!0,showFitView:!0,showInteractive:!1}),jsxRuntimeExports.jsx(MiniMap,{nodeColor:jt=>{var Bt;const It=(Bt=jt.data)==null?void 0:Bt.passage;if(!It)return"#94A3B8";switch(It.passage_type){case"start":return"#10B981";case"branch":return"#F59E0B";case"end":return"#EF4444";default:return"#6366F1"}},nodeStrokeWidth:3,maskColor:"rgba(0, 0, 0, 0.1)",className:"!bg-white/80 !border !border-gray-200 !rounded-lg !shadow-lg",position:"bottom-right",pannable:!0,zoomable:!0})]})]}),Tt&&jsxRuntimeExports.jsxs("div",{className:"relative bg-white border-l border-gray-200 flex flex-col overflow-hidden shadow-xl",style:{width:`${dt}px`},children:[jsxRuntimeExports.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1.5 cursor-col-resize z-20 transition-colors
              ${xt?"bg-primary-500":"bg-transparent hover:bg-primary-300"}`,onMouseDown:Wt,title:"   ",children:jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-16 rounded-full bg-gray-300 opacity-0 hover:opacity-100 transition-opacity"})}),jsxRuntimeExports.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-gray-50 to-white",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900",children:" "}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:`
                  inline-block w-2 h-2 rounded-full
                  ${Tt.passage_type==="start"?"bg-emerald-500":Tt.passage_type==="branch"?"bg-amber-500":Tt.passage_type==="end"?"bg-red-500":"bg-indigo-500"}
                `}),Tt.passage_type==="start"?"":Tt.passage_type==="branch"?"":Tt.passage_type==="end"?"":""," "]})]}),jsxRuntimeExports.jsx("button",{onClick:Ot,className:"p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:jsxRuntimeExports.jsx(PassageEditForm,{passage:Tt,allPassages:rt,storyVariables:st,onUpdate:ht,onClose:Ot},Tt.id)})]}),_&&jsxRuntimeExports.jsxs("div",{className:"w-[380px] bg-white border-l border-gray-200 flex flex-col overflow-hidden shadow-xl",children:[jsxRuntimeExports.jsxs("div",{className:"px-5 py-4 border-b border-gray-200 flex items-center justify-between bg-gradient-to-r from-indigo-50 to-white",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900",children:" "}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"   "})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>_e(null),className:"p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-5",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[" ",jsxRuntimeExports.jsx("span",{className:"text-gray-400 font-normal",children:"()"})]}),jsxRuntimeExports.jsx("input",{type:"text",value:_.label||"",onChange:jt=>{const It=jt.target.value;g(Bt=>Bt.map(Yt=>Yt.id===_.id?{...Yt,label:It}:Yt)),_e(Bt=>Bt?{...Bt,label:It}:null)},onBlur:jt=>{Dt(_.id,jt.target.value)},onKeyDown:jt=>{jt.key==="Enter"&&(Dt(_.id,jt.target.value),jt.target.blur())},placeholder:"  ...",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors hover:border-gray-400"}),jsxRuntimeExports.jsx("p",{className:"mt-1.5 text-xs text-gray-500",children:"   "})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:" "}),jsxRuntimeExports.jsxs("select",{value:((Ft=_.data)==null?void 0:Ft.conditionType)||"always",onChange:jt=>{var Bt;const It=jt.target.value;$t(_.id,It,It==="previous_passage"?(Bt=_.data)==null?void 0:Bt.conditionValue:void 0)},className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors hover:border-gray-400 cursor-pointer",children:[jsxRuntimeExports.jsx("option",{value:"always",children:" "}),jsxRuntimeExports.jsx("option",{value:"previous_passage",children:"  "}),jsxRuntimeExports.jsx("option",{value:"user_selection",children:" "})]}),jsxRuntimeExports.jsxs("div",{className:`
                mt-2 p-3 rounded-lg text-xs
                ${((qt=_.data)==null?void 0:qt.conditionType)==="always"?"bg-gray-50 text-gray-600":((en=_.data)==null?void 0:en.conditionType)==="previous_passage"?"bg-amber-50 text-amber-700":"bg-indigo-50 text-indigo-700"}
              `,children:[((on=_.data)==null?void 0:on.conditionType)==="always"&&' .      ""  .',((cn=_.data)==null?void 0:cn.conditionType)==="previous_passage"&&"    .    .",((dn=_.data)==null?void 0:dn.conditionType)==="user_selection"&&" .      ."]})]}),((mn=_.data)==null?void 0:mn.conditionType)==="previous_passage"&&jsxRuntimeExports.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-amber-800 mb-1.5",children:"  "}),jsxRuntimeExports.jsxs("select",{value:((gn=_.data)==null?void 0:gn.conditionValue)||"",onChange:jt=>{$t(_.id,"previous_passage",jt.target.value)},className:"w-full px-3 py-2.5 border border-amber-300 rounded-lg bg-white focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:" ..."}),rt.filter(jt=>jt.id!==_.target).map(jt=>jsxRuntimeExports.jsx("option",{value:jt.id,children:jt.name},jt.id))]}),jsxRuntimeExports.jsx("p",{className:"mt-1.5 text-xs text-amber-600",children:"      "})]}),jsxRuntimeExports.jsx(LinkOrderControl,{selectedEdge:_,story:e,allPassages:rt,onUpdateOrder:_t}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-3",children:" "}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:":"})," ",((En=rt.find(jt=>jt.id===_.source))==null?void 0:En.name)||"Unknown"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:":"})," ",((bn=rt.find(jt=>jt.id===_.target))==null?void 0:bn.name)||"Unknown"]})]})]}),(()=>{if(!e||!e.links.find(Xt=>Xt.id===_.id))return null;const It=rt.find(Xt=>Xt.id===_.source);if((It==null?void 0:It.passage_type)==="branch"||(It==null?void 0:It.passage_type)==="start")return null;const Yt=e.links.filter(Xt=>Xt.source_passage_id===_.source).sort((Xt,hn)=>Xt.link_order-hn.link_order);if(Yt.length<=1)return null;const Qt=Yt.findIndex(Xt=>Xt.id===_.id)+1;return jsxRuntimeExports.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`
                        inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold
                        ${Qt===1?"bg-indigo-100 text-indigo-700":"bg-gray-200 text-gray-600"}
                      `,children:Qt}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-600",children:Qt===1?' ""  ':`${Qt} `})]})})})()]}),jsxRuntimeExports.jsxs(Button,{variant:"danger",onClick:()=>Mt(_.id),className:"w-full",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})," "]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-400 text-center bg-gray-50 rounded-lg py-2 px-3",children:"Delete  Backspace      "})]})]}),jsxRuntimeExports.jsx(MacroGuideModal,{isOpen:ut,onClose:()=>at(!1)})]}):jsxRuntimeExports.jsx("div",{className:"p-8",children:"Loading..."})},LinkOrderControl=({selectedEdge:s,story:e,allPassages:o,onUpdateOrder:a})=>{const c=e==null?void 0:e.links.find(_=>_.id===s.id),[d,h]=reactExports.useState("");if(reactExports.useEffect(()=>{c&&h(String(c.link_order))},[c==null?void 0:c.link_order]),!c)return null;const g=o.find(_=>_.id===s.source);if((g==null?void 0:g.passage_type)==="branch"||(g==null?void 0:g.passage_type)==="start")return null;const j=()=>{const _=parseInt(d,10);!isNaN(_)&&_>=0&&_!==c.link_order?a(s.id,_):h(String(c.link_order))},$=_=>{_.key==="Enter"&&(j(),_.target.blur())};return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium mb-1",children:" "}),jsxRuntimeExports.jsx("input",{type:"number",min:"0",value:d,onChange:_=>h(_.target.value),onBlur:j,onKeyDown:$,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"        .    ."})]})},PassageEditForm=({passage:s,allPassages:e,storyVariables:o,onUpdate:a,onClose:c})=>{const[d,h]=reactExports.useState(s.name),[g,b]=reactExports.useState(""),[j,$]=reactExports.useState([]),[_,_e]=reactExports.useState(s.passage_type),[et,nt]=reactExports.useState(!1),[rt,it]=reactExports.useState("idle"),[st,lt]=reactExports.useState("text"),[ot,ct]=reactExports.useState([]),[ut,at]=reactExports.useState(!1),[dt,ft]=reactExports.useState(!1),xt=reactExports.useRef(!1),Ct=reactExports.useRef(null),yt=reactExports.useRef(null),Et=reactExports.useRef("");reactExports.useEffect(()=>{console.log(" PassageEditForm  "),Ct.current&&(clearTimeout(Ct.current),Ct.current=null),xt.current=!1;const{content:pt,branchData:kt}=parseBranchData(s.content);h(s.name),_e(s.passage_type),b(pt);let Rt=[];kt?Rt=kt.choices:(s.passage_type==="branch"||s.passage_type==="start")&&(Rt=createDefaultBranchData().choices),$(Rt),Et.current=JSON.stringify(Rt),console.log(" branchChoices  :",Rt);const At=setTimeout(()=>{xt.current=!0,console.log("  ,   ")},200);return()=>{clearTimeout(At),Ct.current&&clearTimeout(Ct.current)}},[s.id]),reactExports.useEffect(()=>{if(!xt.current){console.log("   :  ");return}if(_!=="branch"&&_!=="start"||j.length===0)return;if(JSON.stringify(j)===Et.current){console.log("   :  ");return}return Ct.current&&clearTimeout(Ct.current),console.log("    (500ms )"),Ct.current=setTimeout(async()=>{try{const kt=serializeBranchData(g,{choices:j});await api.put(`/admin/passages/${s.id}`,{name:d,content:kt,passage_type:_}),Et.current=JSON.stringify(j),console.log(" Branch choices auto-saved")}catch(kt){console.error("Failed to auto-save branch choices:",kt)}},500),()=>{Ct.current&&clearTimeout(Ct.current)}},[j,_,g,d,s.id]);const Tt=()=>(_==="branch"||_==="start")&&j.length>0?serializeBranchData(g,{choices:j}):g;reactExports.useEffect(()=>{const pt=kt=>{kt.key==="Escape"&&ut&&at(!1)};return window.addEventListener("keydown",pt),()=>window.removeEventListener("keydown",pt)},[ut]),reactExports.useEffect(()=>{const pt=extractPassageRefs(g);ct(pt)},[g]),reactExports.useEffect(()=>{(_==="branch"||_==="start")&&j.length===0&&xt.current&&$(createDefaultBranchData().choices)},[_]);const ht=async()=>{nt(!0),it("saving"),yt.current&&clearTimeout(yt.current);try{const pt=Tt();await api.put(`/admin/passages/${s.id}`,{name:d,content:pt,passage_type:_}),Et.current=JSON.stringify(j),it("saved"),a(),yt.current=setTimeout(()=>{it("idle")},2e3)}catch(pt){console.error("Failed to update passage:",pt),it("error"),yt.current=setTimeout(()=>{it("idle")},3e3)}finally{nt(!1)}},wt=async()=>{if(confirm("  ?     .")){ft(!0);try{await api.delete(`/admin/passages/${s.id}`),a(),c()}catch(pt){console.error("Failed to delete passage:",pt),ft(!1)}}},St=async pt=>{const kt=new FormData;return kt.append("file",pt),(await api.post("/admin/upload/image",kt,{headers:{"Content-Type":"multipart/form-data"}})).data.url},bt=e.filter(pt=>pt.id!==s.id),mt=d.trim()===""?"  ":void 0,gt=!!mt;return jsxRuntimeExports.jsxs("div",{className:"space-y-5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-100",children:[jsxRuntimeExports.jsx("div",{className:`
          w-10 h-10 rounded-lg flex items-center justify-center
          ${_==="start"?"bg-emerald-100 text-emerald-600":_==="branch"?"bg-amber-100 text-amber-600":_==="end"?"bg-red-100 text-red-600":"bg-indigo-100 text-indigo-600"}
        `,children:_==="start"?jsxRuntimeExports.jsx(Play,{className:"w-5 h-5"}):_==="branch"?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}):_==="end"?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"})]}):jsxRuntimeExports.jsx(FileText,{className:"w-5 h-5"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:" "}),jsxRuntimeExports.jsxs("p",{className:"font-mono text-sm font-medium text-gray-900",children:["#",String(s.passage_number).padStart(6,"0")]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[" ",jsxRuntimeExports.jsx("span",{className:"text-red-500",children:"*"})]}),jsxRuntimeExports.jsx("input",{type:"text",value:d,onChange:pt=>h(pt.target.value),placeholder:"  ...",className:`
            w-full px-3 py-2.5 border rounded-lg
            transition-all duration-150
            focus:ring-2 focus:ring-offset-0
            ${mt?"border-red-400 focus:border-red-500 focus:ring-red-100":"border-gray-300 focus:border-primary-500 focus:ring-primary-100 hover:border-gray-400"}
          `}),mt&&jsxRuntimeExports.jsxs("p",{className:"mt-1.5 text-sm text-red-600 flex items-center gap-1",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),mt]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:""}),jsxRuntimeExports.jsxs("select",{value:_,onChange:pt=>_e(pt.target.value),className:`\r
            w-full px-3 py-2.5 border border-gray-300 rounded-lg\r
            bg-white text-gray-900\r
            transition-all duration-150\r
            focus:border-primary-500 focus:ring-2 focus:ring-primary-100 focus:ring-offset-0\r
            hover:border-gray-400\r
            cursor-pointer\r
          `,children:[jsxRuntimeExports.jsx("option",{value:"start",children:" (Start)"}),jsxRuntimeExports.jsx("option",{value:"content",children:" (Content)"}),jsxRuntimeExports.jsx("option",{value:"branch",children:" (Branch)"}),jsxRuntimeExports.jsx("option",{value:"end",children:" (End)"})]}),jsxRuntimeExports.jsxs("p",{className:"mt-1.5 text-xs text-gray-500",children:[_==="start"&&" .     .",_==="content"&&"  .",_==="branch"&&"    .",_==="end"&&" .     ."]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium",children:"Content"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-0.5",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("code"),className:`flex items-center gap-1 px-3 py-1 text-xs rounded-md transition-colors ${st==="code"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Code$1,{className:"w-3 h-3"}),"Code"]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("text"),className:`flex items-center gap-1 px-3 py-1 text-xs rounded-md transition-colors ${st==="text"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(FileText,{className:"w-3 h-3"}),"Text"]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("visual"),className:`flex items-center gap-1 px-3 py-1 text-xs rounded-md transition-colors ${st==="visual"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Play,{className:"w-3 h-3"}),"Visual"]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>at(!0),className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors",title:"Maximize editor",children:jsxRuntimeExports.jsx(Maximize2,{className:"w-4 h-4"})})]})]}),st==="code"?jsxRuntimeExports.jsx(PassageCodeEditor,{content:g,onChange:b,passages:bt,variables:o,placeholder:"Enter passage content with Twine-style macros..."}):st==="text"?jsxRuntimeExports.jsx(TipTapEditor,{content:g,onChange:b,onImageUpload:St}):jsxRuntimeExports.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white p-6 max-h-[400px] overflow-y-auto",children:jsxRuntimeExports.jsx("div",{className:"passage-content",children:jsxRuntimeExports.jsx(TwinePassageRenderer,{content:g,state:createInitialState(),onStateChange:()=>{},onNavigate:()=>{},passages:bt})})})]}),ut&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-lg",children:["Edit Content: ",d]}),jsxRuntimeExports.jsxs("div",{className:"flex bg-gray-200 rounded-lg p-0.5",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("code"),className:`flex items-center gap-1 px-3 py-1.5 text-sm rounded-md transition-colors ${st==="code"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Code$1,{className:"w-4 h-4"}),"Code"]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("text"),className:`flex items-center gap-1 px-3 py-1.5 text-sm rounded-md transition-colors ${st==="text"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(FileText,{className:"w-4 h-4"}),"Text"]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>lt("visual"),className:`flex items-center gap-1 px-3 py-1.5 text-sm rounded-md transition-colors ${st==="visual"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[jsxRuntimeExports.jsx(Play,{className:"w-4 h-4"}),"Visual"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Press ESC to exit"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>at(!1),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Exit maximize",children:jsxRuntimeExports.jsx(Minimize2,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-auto p-4",children:st==="code"?jsxRuntimeExports.jsx("div",{className:"h-full [&_.passage-code-editor]:h-full [&_.passage-code-editor>div:last-of-type]:h-[calc(100%-theme(spacing.14))] [&_.cm-editor]:h-full [&_.cm-scroller]:h-full",children:jsxRuntimeExports.jsx(PassageCodeEditor,{content:g,onChange:b,passages:bt,variables:o,placeholder:"Enter passage content with Twine-style macros..."})}):st==="text"?jsxRuntimeExports.jsx("div",{className:"h-full [&>div]:h-full [&_.ProseMirror]:min-h-[calc(100vh-200px)]",children:jsxRuntimeExports.jsx(TipTapEditor,{content:g,onChange:b,onImageUpload:St})}):jsxRuntimeExports.jsx("div",{className:"h-full bg-white rounded-lg border border-gray-200 p-8 overflow-auto",children:jsxRuntimeExports.jsx("div",{className:"passage-content",children:jsxRuntimeExports.jsx(TwinePassageRenderer,{content:g,state:createInitialState(),onStateChange:()=>{},onNavigate:()=>{},passages:bt})})})}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:()=>at(!1),children:"Close"}),jsxRuntimeExports.jsxs(Button,{onClick:ht,disabled:et,children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4 mr-2"}),et?"Saving...":"Save"]})]})]}),(_==="branch"||_==="start")&&jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsxs("h4",{className:"text-sm font-medium text-amber-800",children:["Branch Choices (",j.length,")",jsxRuntimeExports.jsx("span",{className:"ml-2 text-xs text-amber-600 font-normal",children:"(Auto-saved)"})]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>$([...j,{id:generateUniqueId(),button:"",description:""}]),className:"flex items-center gap-1 px-2 py-1 text-xs bg-amber-200 text-amber-800 rounded hover:bg-amber-300 transition-colors",children:[jsxRuntimeExports.jsx(Plus,{className:"w-3 h-3"}),"Add Choice"]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:j.map((pt,kt)=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 bg-white rounded-lg p-3 border border-amber-200",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-amber-100 rounded-full text-amber-700 font-bold text-sm flex-shrink-0",children:kt+1}),jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Button Text"}),jsxRuntimeExports.jsx("input",{type:"text",value:pt.button,onChange:Rt=>{const At=j.map(Mt=>Mt.id===pt.id?{...Mt,button:Rt.target.value}:Mt);$(At)},placeholder:"Enter button text...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Description"}),jsxRuntimeExports.jsx("textarea",{value:pt.description,onChange:Rt=>{const At=j.map(Mt=>Mt.id===pt.id?{...Mt,description:Rt.target.value}:Mt);$(At)},placeholder:"Enter description...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 resize-y"})]})]}),j.length>2&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const Rt=j.filter(At=>At.id!==pt.id);$(Rt)},className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors",title:"Remove choice",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"})})]},pt.id))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-600 mt-3",children:"Each choice will create a numbered connection point on the canvas. Connect each to a target passage."})]}),ot.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[jsxRuntimeExports.jsxs("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:["Linked Passages (",ot.length,")"]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:ot.map((pt,kt)=>{let Rt=!1,At="";if(pt.type==="id"){const Mt=parseInt(pt.value,10),Dt=e.find($t=>$t.passage_number===Mt);Rt=!!Dt,At=Dt?`${Dt.name} (#${pt.value.padStart(6,"0")})`:`#${pt.value.padStart(6,"0")}`}else Rt=e.some(Mt=>Mt.name===pt.value),At=pt.value;return jsxRuntimeExports.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs ${Rt?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"}`,children:[At,!Rt&&jsxRuntimeExports.jsx("span",{className:"ml-1 text-red-500",title:"Passage not found",children:""})]},kt)})})]}),o.length>0&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[jsxRuntimeExports.jsxs("h4",{className:"text-sm font-medium text-green-800 mb-2",children:["Story Variables (",o.length,")"]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.slice(0,10).map((pt,kt)=>jsxRuntimeExports.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs bg-green-100 text-green-700 font-mono",children:pt},kt)),o.length>10&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-green-600",children:["+",o.length-10," more"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-gray-200",children:[jsxRuntimeExports.jsx(Button,{onClick:ht,disabled:et||gt,loading:et,className:`
            ${rt==="saved"?"!bg-green-600 hover:!bg-green-700":""}
            ${rt==="error"?"!bg-red-600 hover:!bg-red-700":""}
          `,children:rt==="saved"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})," "]}):rt==="error"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})," "]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Save,{className:"w-4 h-4"}),et?" ...":""]})}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),jsxRuntimeExports.jsxs(Button,{variant:"danger",onClick:wt,disabled:dt,loading:dt,children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4"}),dt?" ...":""]})]})]})},StoryEditorPage=()=>{const{storyId:s}=useParams();return s?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50",children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs("div",{className:"pt-16",children:[jsxRuntimeExports.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-3",children:jsxRuntimeExports.jsx(Link$2,{to:"/admin",children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",children:[jsxRuntimeExports.jsx(ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})})}),jsxRuntimeExports.jsx(StoryEditor,{storyId:s})]})]}):jsxRuntimeExports.jsx("div",{children:"Story not found"})},ProtectedRoute=({children:s,adminOnly:e=!1})=>{const{isAuthenticated:o,user:a,isLoading:c}=useAuthStore();return c?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-primary-600 border-t-transparent"})}):o?e&&(a==null?void 0:a.role)!=="super_admin"&&(a==null?void 0:a.role)!=="editor"?jsxRuntimeExports.jsx(Navigate,{to:"/",replace:!0}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s}):jsxRuntimeExports.jsx(Navigate,{to:"/login",replace:!0})},App=()=>{const{checkAuth:s,isLoading:e}=useAuthStore();return reactExports.useEffect(()=>{s()},[]),e?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(StorySelectPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(LoginPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/register",element:jsxRuntimeExports.jsx(RegisterPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/passage",element:jsxRuntimeExports.jsx(PassagePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/passage/:passageId",element:jsxRuntimeExports.jsx(PassagePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/admin",element:jsxRuntimeExports.jsx(ProtectedRoute,{adminOnly:!0,children:jsxRuntimeExports.jsx(AdminDashboard,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/stories/:storyId",element:jsxRuntimeExports.jsx(ProtectedRoute,{adminOnly:!0,children:jsxRuntimeExports.jsx(StoryEditorPage,{})})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(Navigate,{to:"/",replace:!0})})]})};client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React$2.StrictMode,{children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(App,{})})}));
